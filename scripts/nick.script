-- Различные сюжетные функции
-- hi_flyer, OLR mod 2012-2024
-- olr.beep()


function has_radweaknow()
	if xvars.count_rad_weak > 0.0020 then
		return true
	else
		return false
	end
end

function esc_polter_dead_st()
	olr.beep()
	db.actor:change_character_reputation(15)
	news_manager.send_tip(db.actor, "Messer, it looks like the creature in the village is dead. You can go back.", 5, "trader", 25000)
end


-- стартовые параметры ГГ
function start_actor_params()
	local STbron = db.actor:object("outfit_stalker_startup")
	if STbron then
		STbron:set_condition(math.random(5,25)/100)
		local wait_time = 0
  		wait_time = time_global() + 1500
  		level.add_call(
    		function() return time_global() > wait_time end,
    		function() db.actor:move_to_slot(STbron) olr_ruck_limit.recheck_limit() end
  		)
	end
	local wait_time = 0
  	wait_time = time_global() + 1055
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() get_console():execute("r__actor_shadow 0") end
  	)

	local wait_time = 0
  	wait_time = time_global() + 5
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() get_console():execute("time_factor 0") end
  	)
	local wait_time = 0
  	wait_time = time_global() + 55
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() get_console():execute("time_factor 1") end
  	)
	-- lights_hanging_lamp0000_0000

	local wait_time = 0
  	wait_time = time_global() + 1000
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() nick.fixlampsstart() end
  	)

	local wait_time = 0
  	wait_time = time_global() + 5000
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() get_console():execute("time_factor 1") end
  	)
	-- lights_hanging_lamp0000_0000

	local wait_time = 0
  	wait_time = time_global() + 21000
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() get_console():execute("r__actor_shadow 1") end
  	)

	--nick.fixlampsstart()

end

function fixlampsstart()
	log1("start game now")
	for i=1,65535 do
	local lokobj = alife():object(i)
	if lokobj and lokobj.level_name == "lvl1_escape" then
	if IsAnomaly(lokobj) then

	--if get_clsid(lokobj) == clsid.obj_climable then
	--if get_clsid(lokobj) == clsid.obj_phys_destroyable or get_clsid(lokobj) == clsid.obj_physic or get_clsid(lokobj) == clsid.obj_breakable or get_clsid(lokobj) == clsid.obj_phskeleton or get_clsid(lokobj) == clsid.obj_climable then

		--olr.add_spot_on_map( lokobj.id,"controller_spotmap",lokobj:name() )

	
    		--alife():set_switch_offline (lokobj.id, true)
    		--alife():set_switch_online (lokobj.id, false)
    		--alife():set_interactive (lokobj.id, false)
		--olr_timers.st_timer("convert_online", 52, "olr_npc_eqp.convert_online_out("..lokobj.id..")")

		--alife():release(lokobj, true) 
		--olr.del_by_name(lokobj:name())
  		
		log1(" !!! --- name - "..lokobj:name().."")

	end
	end
	end
end

function start_actor_params_food()
	if db.actor then
		db.actor.satiety  = -0.11
		local bobj445 = alife():create('device_torch', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
 		level.client_spawn_manager():add(bobj445.id, 0, function(id,obj) obj:set_condition((math.random(15,45)/100)) end)	
	end
end

function bar_zombu_prisel_zombu()
	news_manager.send_tip(db.actor, "Stay right there, and you better not move...", 1, "act", 11000)
	news_manager.send_tip(db.actor, "Message: fuck... Who did you bring here?!", 5, "default", 5000)	
end


function esc_digger_go_nii_prec()
	if not has_alife_info("olr_agro_1_start") and level.name() == "lvl1_escape" then
		return true
	else
		return false
	end
end


function jaba_otvet_start_done()
	news_manager.send_tip(db.actor, "Damn, there's a blowout coming... I intercepted their radio transmission, they're all scrambling to their base right now. The artifact has to be out there somewhere. Wait, a stalker in a Niva is coming, talk to him.", 2, "trader", 25000)
	level.set_weather_fx("surge_day")
	olr.blow_add(500)
	olr.info("mil_quest_art_spawn_naparnik")
	olr.to_online("mil_naparnik_niva_ph")
end

function give_battery_charge()
	olr.give_item("battery_change")
	olr.beep()
	news_manager.send_tip(db.actor, "Message: science, you hide over there at your place...and you zombie, come out in kind!", 3, "exo_neutral", 20000)
end


function prof_sos_talk_saved_priz()
	olr.give_item("battery_change")
	news_manager.send_tip(db.actor, "The money received is 800.", nil, "money", 39000)
	db.actor:give_money(800)
	game_stats.money_quest_update(800)
end

function mil_nap_on_base_blow_st()
	level.set_weather_fx("surge_day")
	level.add_pp_effector("vibros_p.ppe", 231, false)
end

function mil_nap_on_base_blow_st_go()
	level.set_weather_fx("surge_day")
	level.add_pp_effector("vibros_p.ppe", 231, false)
	olr.kill_mon_in_radius(db.actor:position(), 50)
	olr_sleep.sleep_main(5)
end

function mil_monsters_qutscene_end()
	olr.enable_walk()
    	level.show_indicators()
    	level.enable_input()
    	db.actor:restore_weapon()
	level.add_pp_effector("total_recall.ppe", 204131, false)
	olr.info("mil_quest_art_spawn_naparnik_go")
end


function prec_art_mil_jaba()
	return nik_dialog.item_much("art_mil_jaba",1) ~= false
end

function pes_art_otdaem()
	news_manager.send_tip(db.actor, "Money received - 3,000.", nil, "money", 39000)
	db.actor:give_money(3000)
	game_stats.money_quest_update(3000)
	nik_dialog.out_item_much("art_mil_jaba",1)
	olr.del_by_name("mil_naparnik_niva_ph")
end

function mil_monsters_qutscene()

		olr.kill_mon_in_radius(db.actor:position(), 30)
		olr.blow_add(1000)
		level.set_weather_fx("surge_day")
		level.add_pp_effector("vibros_p.ppe", 231, false)
		level.add_cam_effector2("mil_mon_volna.anm", 3470, false, "nick.mil_monsters_qutscene_end")

		olr.snd([[ol3\koan\voc_stalker_a1]])
		bind_stalker.hide_weapon()
		level.add_pp_effector("black.ppe", 281, false)
		level.add_pp_effector("total_recall.ppe", 176, false)
		olr.disable_walk()
		level.disable_input()

		local wait_time = 0
  		wait_time = time_global() + 200
  		level.add_call(
    		function() return time_global() > wait_time end,
    		function() level.hide_indicators() end
  		)

		alife():set_switch_distance(1500)

		local se_obj = alife():object("lvl9_military_smart_terrain_0003")
		local se_obj2 = alife():object("voyaka_mill")
		local se_obj3 = alife():object("lvl9_military_smart_terrain_0014")
		local se_obj4 = alife():object("lvl9_military_zone_radioactive_killing_mon")		

		if se_obj then
		for id=1, 5 do
		local obj = alife():create("m_dog_e", se_obj.position, se_obj.m_level_vertex_id, se_obj.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj then
		for id=1, 4 do
		local obj = alife():create("m_boar_e", se_obj.position, se_obj.m_level_vertex_id, se_obj.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj then
		for id=1, 4 do
		local obj = alife():create("m_flesh_e", se_obj.position, se_obj.m_level_vertex_id, se_obj.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj then
		for id=1, 6 do
		local obj = alife():create("m_pseudodog_e", se_obj.position, se_obj.m_level_vertex_id, se_obj.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj2 then
		for id=1, 8 do
		local obj = alife():create("m_dog_e", se_obj2.position, se_obj2.m_level_vertex_id, se_obj2.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj2 then
		for id=1, 4 do
		local obj = alife():create("m_boar_e", se_obj2.position, se_obj2.m_level_vertex_id, se_obj2.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj2 then
		for id=1, 4 do
		local obj = alife():create("m_flesh_e", se_obj2.position, se_obj2.m_level_vertex_id, se_obj2.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj2 then
		for id=1, 4 do
		local obj = alife():create("m_pseudodog_e", se_obj2.position, se_obj2.m_level_vertex_id, se_obj2.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj3 then
		for id=1, 6 do
		local obj = alife():create("m_dog_e", se_obj3.position, se_obj3.m_level_vertex_id, se_obj3.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj3 then
		for id=1, 4 do
		local obj = alife():create("m_boar_e", se_obj3.position, se_obj3.m_level_vertex_id, se_obj3.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end


		if se_obj3 then
		for id=1, 4 do
		local obj = alife():create("m_flesh_e", se_obj3.position, se_obj3.m_level_vertex_id, se_obj3.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end


		if se_obj3 then
		for id=1, 4 do
		local obj = alife():create("m_pseudodog_e", se_obj3.position, se_obj3.m_level_vertex_id, se_obj3.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_centr_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end


		if se_obj4 then
		for id=1, 6 do
		local obj = alife():create("m_dog_e", se_obj4.position, se_obj4.m_level_vertex_id, se_obj4.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj4 then
		for id=1, 4 do
		local obj = alife():create("m_boar_e", se_obj4.position, se_obj4.m_level_vertex_id, se_obj4.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj4 then
		for id=1, 4 do
		local obj = alife():create("m_flesh_e", se_obj4.position, se_obj4.m_level_vertex_id, se_obj4.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end

		if se_obj4 then
		for id=1, 3 do
		local obj = alife():create("m_pseudodog_e", se_obj4.position, se_obj4.m_level_vertex_id, se_obj4.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = greh_base_vhod_mutants\nhome_min_radius = 2\nhome_max_radius = 14\naggressive_home"
		amk.write_monster_params(params,obj)
		end
		end
end

function surge_day_now()
	if level.name() ~= "lvl12_radar_bunker" or level.name() ~= "lvl16_generators" then
		level.set_weather_fx("surge_day")
	end
end


function zone_dead_zone_now_off()
	db.actor:disable_info_portion("deadzone_eff_now")
	level.remove_pp_effector(15233)
	level.remove_pp_effector(16771)
	level.add_pp_effector("blink.ppe", 20131, false)
end

function precond_dopseif_bar()
	return nik_dialog.item_much("af_night_star",4) ~= false and db.actor:money() >= 5000
end

function dopseif_bar_start()
	nik_dialog.out_item_much("af_night_star",4)
	db.actor:give_money(-5000)
	game_stats.money_quest_update(-5000)
	news_manager.send_tip(db.actor, "Lost money - 5,000.", 1, "money", 39000)
	olr_timers.st_timer("dopseif_bar_start", 1814, "nick.dopseif_bar_done()")
end

function dopseif_bar_done()
	olr.beep()
	news_manager.send_tip(db.actor, "Repairman: About the safe. You can come over, it's all ready, it's in the hut already...", nil, "af_merger", 10000)
	olr.del_by_name("lvl5_bar_physic_object_0028")
	olr.to_online("lvl5_bar_inventory_box_dopseif")
end

function set_horm_ecologs_rel()
	relation_registry.set_community_goodwill ("ecolog", db.actor:id(), 50)
	for k,v in pairs(db.storage) do
        local stalker = level.object_by_id(k)
            if stalker and (get_clsid(stalker)==clsid.script_stalker) and stalker:alive() and stalker:relation(db.actor)==game_object.enemy then
		relation_registry.set_community_goodwill ("ecolog", db.actor:id (), 150)
	    end
	end
end

function izlom_talk_anim(npc)
	--log1(npc:name())
	--npc:clear_animations()
	local rnd = math.random(1,3)
	if rnd == 1 then
		npc:play_cycle("stand_tell_0", true)
	elseif rnd == 2 then
		npc:play_cycle("stand_tell_1", true)
	elseif rnd == 3 then
		npc:play_cycle("stand_tell_2", true)
	end
	local wait_time = 0
  	wait_time = time_global() + 1500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() npc:play_cycle("stand_idle_after_talk", true) end
  	)
end

function precond_siga()
     return nik_dialog.item_much("sigaret",1) ~= false 
end

function siga_daem(npc)
	npc:set_relation(game_object.friend, db.actor)
	--db.actor:change_character_reputation(5)
	local siga = db.actor:object("sigaret")
	if siga ~= nil then
		db.actor:transfer_item(siga, npc)
	end	
end

function siga_daem_bar(npc)
	npc:set_relation(game_object.friend, db.actor)
	db.actor:change_character_reputation(5)
	nik_dialog.out_item_much("sigaret",1)
	olr_treasure.create_treasure()
end


function agr_perepat_tainik()
	news_manager.send_tip(db.actor, "Hmmm... looks like there's nothing here but 300 rubles in a book and a note on it....", 1, "act", 39000)
	news_manager.send_tip(db.actor, "Money received - 300.", 3, "money", 39000)
	db.actor:give_money(300)
	game_stats.money_quest_update(300)	
end

function bandgroups_final_oplata()
	news_manager.send_tip(db.actor, "Money received - 3,000.", nil, "money", 39000)
	db.actor:give_money(3000)
	game_stats.money_quest_update(3000)
	olr.give_item("wpn_usp")
	olr.give_item("wpn_g36")
end

function daem_snotvornoe_bar()
	olr.give_item("snotvornoe")
end

function osved_turisty_band_kill()
	olr.beep()
	news_manager.send_tip(db.actor, "Informant: So info on the last group. They call themselves the Jolly Tourists. A large group of veteran thugs. Be very careful. Saw them on MedPribor. I don't know where exactly. You have to take out the leader of the group. The rest of us are expendable at your discretion.", nil, "flash", 30000)
	olr.info("kill_band_turisty")
end

function kill_dolina_malboro_dead_all_spaw_now()
	olr.beep()
	news_manager.send_tip(db.actor, "Informant, the group in the Valley is already dead.... I'm a little late...", nil, "act", 30000)
	news_manager.send_tip(db.actor, "Informant: Roger that. Apparently Duty's already hustled up the poranishe.... Wait for info on the next group, according to me it's the last one...", 4, "flash", 30000)
	olr_timers.st_timer("osved_turisty_band_kill", 414, "nick.osved_turisty_band_kill()")
end

function osved_dolina_band_kill()
	olr.beep()
	news_manager.send_tip(db.actor, "Informant: On our next group - calling themselves the Marlboro Cowboys... Seen in the Dark Valley, in a ruined village. Take action.", nil, "flash", 30000)
	olr.info("kill_dolina_malboro")
	olr.info("kill_dolina_malboro_dead_all")
end

function osved_bar_band_kill()
	olr.beep()
	news_manager.send_tip(db.actor, "Alright. Word has gotten out about the next group. They call themselves the Rippers... total scumbags. So much so that they've been seen in Bar, downtown. You got the tip.", nil, "flash", 30000)
	olr.info("kill_bar_portoshitely")
end

function garage_tri_bandosa()
	olr.spawn_on_obj("agr_bandit_respawn_1", "lvl1_escape_blow_hide_restr_0009")
	olr.spawn_on_obj("agr_bandit_respawn_2", "lvl1_escape_blow_hide_restr_0009")
	olr.spawn_on_obj("agr_bandit_respawn_1", "lvl1_escape_blow_hide_restr_0009")	
end

function garage_fedka_bandosi()
	olr.spawn_on_obj("agr_bandit_respawn_1", "lvl2_garbage_stalker_0063")
	olr.spawn_on_obj("agr_bandit_respawn_2", "lvl2_garbage_stalker_0063")
	olr.spawn_on_obj("agr_bandit_respawn_1", "lvl2_garbage_stalker_0063")	
end


function garage_zombi_from_doliana()
	olr.spawn_on_obj("m_zombie_e", "gar_smart_bandit_2")
	olr.spawn_on_obj("m_zombie_e", "gar_smart_bandit_2")
	olr.spawn_on_obj("m_zombie_e", "gar_smart_bandit_2")

	olr.spawn_on_obj("m_zombie_e", "gar_smart_bandit_2")
	olr.spawn_on_obj("m_zombie_e", "gar_smart_bandit_2")

	olr.spawn_on_obj("m_zombie_e", "lvl2_garbage_zone_radioactive_weak_0117")
	olr.spawn_on_obj("m_zombie_e", "lvl2_garbage_zone_radioactive_weak_0117")
	olr.spawn_on_obj("m_zombie_e", "lvl2_garbage_zone_radioactive_weak_0117")
	olr.spawn_on_obj("m_zombie_e", "lvl2_garbage_zone_radioactive_weak_0117")
	olr.spawn_on_obj("m_zombie_e", "lvl2_garbage_zone_radioactive_weak_0117")

end

function garage_dolg_from_doliana()
	olr.spawn_on_obj("gar_dolg_respawn_1", "lvl2_garbage_zone_radioactive_weak_0161")
	olr.spawn_on_obj("gar_dolg_respawn_2", "lvl2_garbage_zone_radioactive_weak_0161")
end

function biolab_kamaz_fail()
	--local obj = alife():object("lvl9_militar_kam_quest_kordon")
	--if obj == nil then
	--	return true
	--else
	--	return false
	--end
	
end


function sos_yan_dead_sms()
	olr.beep()
	news_manager.send_tip(db.actor, "Professor: Stalker, what's the matter...? Is the assistant dead? Come back immediately.", 1, "saharov", 39000)
	olr_timers.st_timer("set_ac_gen_enem", 4, "nick.sos_yan_dead_sms2()")
end


function sos_yan_dead_sms2()
	olr.info("yan_sosed_talk_saved_done")
end


function sim_dialog_aboutlevel(obj,act)
	if level.name() == "lvl1_escape" then
		lm_where = "The anteroom of the Zone, an army cordon. You'll find a merchant in the cellar behind the village near the army checkpoint. I do not advise you to go to the checkpoint and get in front of the soldiers, they have orders to shoot without warning... You can't kill soldiers, only as a last resort, for every soldier killed the merchant has to pay for it and he won't be happy with this arrangement. There are large packs of blind dogs on the plains, only people with a suicidal wish go there."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl2_garbage" then
		lm_where = "It's a big stinking dump where they took mountains of radioactive garbage after the accident in '86... broken cranes, machinery. You can find the remains of old buildings. You can meet mutants. It's mostly newbies and gangsters, of course. You can find artifacts for little things, but it's best not to stay here for long. There are a lot of radiation hotspots down there, you can't go there without protection."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl3_agroprom" then
		lm_where = "Stalkers call this area dead, there's too much radiation here... If you move deeper into the territory but come out on the radioactive plains, you can find a shallow rusty lake. The whole lake is filled with the remains of cars, one big pile of rusty junk slightly covered with water. You can still find the old institute and the factory, only it's too overgrown with some mutated muck. Don't go without a gas mask, you'll get a fat dose of rads."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl4_darkdolina" then
		lm_where = "In the Dark Valley, it's always dark and foggy. It rains often. It's got one of the highest concentrations of anomalies.... You can get some nice artifacts, or you can easily part with your life... You're bound to meet veterans, they make money here pulling artifacts out of their asses. I heard they were talking about the Black Slugs gang, like they're back again, but I don't know if they've actually been seen. There's an entrance to the lab, but no one's ever come back from it, so I wouldn't recommend going in there... Like dwarfs, or maybe something worse..."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl5_bar" then
		lm_where = "Before the accident in '86, it was just an ordinary urban village. Now, as you realize, it is already the decayed remains of a former settlement.... In the local underground grocery store coffee shop you'll find a stalker bar, stalkers from all over the Zone gather here, a local merchant who works here as a Barkeep... contains, so to speak, a premise. You go there if you want to trade, socialize, and get an interesting assignment... If you go from the village, you'll come to the old Rostok factory. Behind the factory, is the base of the Duty faction. The base is closed from outsiders, I do not advise you to trespass there."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl6_rostok" then
		lm_where = "I'll tell you, this place is grim. How many of us died there. there's just no words. The bloodsuckers are out there, the bastards. they're already starting to crawl out at night. And they've been known to get stronger when they're drunk on blood. But they say something important is located in this plant, something just vital... The other day, a Duty detachment went there, but they all disappeared, only their screams we heard all day around the neighborhood. Don't go in there, let them all rot, those bloodsuckers."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl7_yantar" then
		lm_where = "The legendary Lake Yantar, how about that, of course I know. Black, oily... It drinks the souls of stalkers, just go to the shore, and instantly you're gone, only a shell of an empty bottle into the water and there... to the island, so, in the fog floats... And the zombies, zippers wander around, they will howl and start to follow you, then you have to run for it, because a lot of them, stalkers former lost on this lake, and now zippers only wander... If you go around the lake and the zombies, you'll find a scientist camp, they're studying something there... The helicopter brought them in, and it's been supplying them with regular provisions, so they're well entrenched there... You can talk to them, they buy artifacts, they can even ask you to do something."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl9_military" then
		lm_where = "An abandoned army base there, an old village and a small lake. And at the army base, a group has settled down. It's called Sin... former religious fanatics, used to believe in the divine essence of the Zone, but now they've turned into a mess, rumor has it that the mutants have them under control. Once all PDAs of the members of this group went offline at once, since then nothing has been heard from them."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	if level.name() == "lvl11_deadcity" then
		lm_where = "Light Beam is a city of zombies and the Freedom faction, which includes all the anarchist bastards of the Zone. Anarchist snipers sit in high-rises and shoot off all outsiders. So think twice before you go in there."
		db.actor:give_talk_message(""..lm_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	end
	local _s = CUIStatic();
	local bos = level.object_by_id(level.get_second_talker():id())
	_s:InitTexture(bos:character_icon())
	local str = lm_where
	local who = bos:character_name()		
	db.actor:add_answer_news(game.translate_string(who), game.translate_string(str), bos:character_icon(), _s:GetOriginalRect())
end



function daem_conserva_bar(fs,ss)
	local npc = fs:id()==0 and ss or fs
	npc:clear_animations()
	npc:add_animation("komandir_1", true, false)
	local sound = sound_object("characters_voice\\human_01\\stalker\\talk\\leave\\leave_5")
	sound:play_at_pos(db.actor, vector():set(0,0,0), 0, sound_object.s2d)
 	olr.give_item("conserva")
end


function gen_choise_exit_or_boss()
	if has_alife_info("flyer_fly") then
		news_manager.send_tip(db.actor, "...tell you a couple jokes.... before the finals... One, you're not Strelok...", 3, "unknown", 11000)
		news_manager.send_tip(db.actor, "...and the second......do you think I'm real?", 6, "unknown", 11000)
	end
	olr.kill_mon_in_radius(db.actor:position(), 150)
end


function prof_sos_talk_izlom_here_now()
	olr.blow_add(200)
	news_manager.send_tip(db.actor, "Son, help me, I'm dying...", 1, "unknown", 7000)
	olr.spawn_on_obj("zombie_normal", "lvl7_yantar_smart_terrain_0016")
	olr.spawn_on_obj("zombie_normal", "lvl7_yantar_smart_terrain_0016")
	olr.spawn_on_obj("zombie_normal", "lvl7_yantar_smart_terrain_0016")
	olr.spawn_on_obj("zombie_normal", "lvl7_yantar_smart_terrain_0016")
	olr.spawn_on_obj("zombie_blue", "lvl7_yantar_space_restrictor_izlom")
	olr.spawn_on_obj("zombie_blue", "lvl7_yantar_space_restrictor_izlom")
	olr.spawn_on_obj("zombie_blue", "lvl7_yantar_space_restrictor_izlom")
	olr.spawn_on_obj("zombie_blue", "lvl7_yantar_space_restrictor_izlom")
	olr_timers.st_timer("sos_talk_izlom_here_now2", 7, "nick.sos_talk_izlom_here_now2()")
	local snd_obj = xr_sound.get_safe_sound_object([[monsters\zombies\zombie_idle_1]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
end


function sos_talk_izlom_here_now2()
	news_manager.send_tip(db.actor, "Son, hurry up, I'm not feeling so good.", 1, "unknown", 7000)
	nick.gar_lamb_zombs()
	local snd_obj = xr_sound.get_safe_sound_object([[monsters\zombies\zombie_idle_2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
end


function feak_laba_chaos()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_large_away_2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function triway_spawn_zombie()
	local rnd = math.random(1,2)
	if rnd == 1 then
		--olr.spawn_on_obj("rad_zombied_respawn_1", "lvl16_generators_space_restrictor_0034")
		olr.spawn_on_obj("zombie_strong", "lvl16_generators_space_restrictor_0034")
		olr.partice_on_obj("lvl16_generators_space_restrictor_0034",[[anomaly2\group_items\body_tear_blood_01]])
	end
	local rnd2 = math.random(1,2)
	if rnd2 == 1 then
		--olr.spawn_on_obj("rad_zombied_respawn_2", "lvl16_generators_space_restrictor_0035")
		olr.spawn_on_obj("zombie_immortal", "lvl16_generators_space_restrictor_0035")
		olr.partice_on_obj("lvl16_generators_space_restrictor_0035",[[anomaly2\group_items\body_tear_blood_01]])
	end
	--olr.spawn_on_obj("rad_zombied_respawn_3", "lvl16_generators_space_restrictor_0036")
	olr.spawn_on_obj("zombie_blue", "lvl16_generators_space_restrictor_0036")
	olr.partice_on_obj("lvl16_generators_space_restrictor_0036",[[anomaly2\group_items\body_tear_blood_01]])
	local rnd3 = math.random(1,2)
	if rnd3 == 1 then
		--olr.spawn_on_obj("rad_zombied_respawn_1", "lvl16_generators_space_restrictor_0039")
		olr.spawn_on_obj("zombie_normal", "lvl16_generators_space_restrictor_0039")
		olr.partice_on_obj("lvl16_generators_space_restrictor_0039",[[anomaly2\group_items\body_tear_blood_01]])
	end
	--olr.spawn_on_obj("rad_zombied_respawn_2", "lvl16_generators_space_restrictor_0038")
	olr.spawn_on_obj("zombie_normal", "lvl16_generators_space_restrictor_0038")
		olr.partice_on_obj("lvl16_generators_space_restrictor_0038",[[anomaly2\group_items\body_tear_blood_01]])
	local rnd4 = math.random(1,2)
	if rnd4 == 1 then
		olr.spawn_on_obj("zombie_immortal", "lvl16_generators_space_restrictor_0037")
		--olr.spawn_on_obj("rad_zombied_respawn_3", "lvl16_generators_space_restrictor_0037")
		olr.partice_on_obj("lvl16_generators_space_restrictor_0037",[[anomaly2\group_items\body_tear_blood_01]])
	end
	--olr_timers.st_timer("triway_spawn_zombie", 10, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("set_ac_gen_enem", 2, "nick.set_ac_gen_enem()")
end


function kill_zombs_gen()
	olr.snd([[ol3\koan\voc_stalker_a1]])
	level.add_pp_effector("black.ppe", 231, false)
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:position():distance_to(db.actor:position()) < 95 and npc:is_monster() then
			local h = hit()
			h.draftsman = npc
			h.type = hit.strike
			h.direction = vector():set(math.random(1),0.1,math.random(1))
			h.power = 10000
			h.impulse = 2
			npc:hit(h)
		end
	end
	--olr_timers.st_timer("kill_zombs_genfly", 2, "nick.flying_corpses()")
end


function set_ac_gen_enem()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		--if npc and npc:position():distance_to(db.actor:position()) < 55 and npc:is_stalker() and not npc:is_actor() then
		if npc and npc:position():distance_to(db.actor:position()) < 55 and npc:is_monster() then
    			local h = hit()
			h.draftsman = db.actor
			h.type = hit.strike
			h.direction = vector():set(math.random(1),0.1,math.random(1))
			h.power = 0.01
			h.impulse = 2
			npc:hit(h)
		end
	end
end



function zombar_koshak_find_now()
	olr.spawn_on_obj("af_art_ruchk", "lvl11_deadcity_m_cat_e")
end


function yan_online_rafik()
	olr.to_online("lvl7_yantar_physic_object_0055")
	olr.to_online("lvl7_yantar_m_car_0000")
end


function monolit_na_kordone_funct()
	olr.spawn_on_obj("rad_soldier_master", "lvl1_escape_space_restrictor_0101")
	olr.spawn_on_obj("rad_soldier_master", "lvl1_escape_space_restrictor_0101")
	olr.spawn_on_obj("rad_soldier_master", "lvl1_escape_space_restrictor_0101")
	olr.spawn_on_obj("rad_specnaz_respawn_specnaz", "lvl1_escape_space_restrictor_0101")
	olr.spawn_on_obj("rad_specnaz_respawn_specnaz", "lvl1_escape_space_restrictor_0101")
	olr.spawn_on_obj("rad_specnaz_respawn_specnaz", "lvl1_escape_space_restrictor_0101")
	olr.spawn_on_obj("val_soldier_respawn_1", "lvl1_escape_space_restrictor_0101")
	olr.to_online("lvl1_escape_physic_object_0583")
	olr.del_by_name("lvl1_escape_big_safe_box")
end


function grez_zaruba_gg()
	local bsobj = alife():object("lvl9_military_stalker_0021") 
	if bsobj then 
		local car = level.object_by_id(bsobj.id)
		if car then
			car:set_relation(game_object.enemy, db.actor) 
		end
	end

	local sim = alife() 
	local se_obj = alife():object("lvl9_military_stalker_0021")
	if se_obj then 
		--se_obj:set_relation(game_object.enemy, db.actor) 
	end	
end


function set_horm_greh_rel()
	relation_registry.set_community_goodwill ("sin", db.actor:id(), 10)
end

function dosent_kk_quest_don()
	olr.give_item("hand_torch_super")
	olr.give_item("med_injector_capsule")
	olr.give_item("med_injector_capsule")
	olr.give_item("antirad")
	olr.give_item("antirad")
	olr.give_item("medkit_army")
	olr.give_item("medkit_scientic")
	olr.give_item("psy_stabilizator")
	local obj = olr.give_item("detector_advances")
	level.client_spawn_manager():add(obj.id, 0, function(id,obj) obj:set_condition((math.random(95,99)/100)) end)
	olr.give_item("item_razradnik")
	olr.give_item("item_razradnik")
	olr.give_item("wpn_wincheaster1300")
	olr.give_item("wpn_lr300")
	olr.del_by_name("lvl7_yantar_rat_staler_undead_olr_000")
	olr.del_by_name("lvl7_yantar_rat_staler_undead_olr_000_0000")
	olr.del_by_name("lvl7_yantar_rat_staler_undead_olr_000_0001")
	olr.del_by_name("lvl7_yantar_rat_staler_undead_olr_000_0002")
	olr.del_by_name("lvl7_yantar_rat_staler_undead_olr_000_0003")
end

function look_yantar(obj)
	if obj:name() == "lvl7_yantar_staler_undead_olr_0007" and not has_alife_info("dosent_kompl_dead_cheked") then
		news_manager.send_tip(db.actor, "Docent, I think I found your buddy.... he's the only one here.", nil, "act", 19000)
		news_manager.send_tip(db.actor, "Docent: One? Shit, so my worst fears are confirmed... Apparently they went down into the catacombs... They have built-in beacons in their suits, let's try to activate them now...", 8, "ecolog", 49000)
		news_manager.send_tip(db.actor, "Docent: I think I got it... Yeah, they're deep under the complex, according to the signal. There are five of them. You need to go downstairs and find them, the entrance to the catacombs is in a building near the road to Bright Ray.", 15, "ecolog", 49000)
		news_manager.send_tip(db.actor, "Okay, I'll figure it out.", 22, "act", 19000)

		alife():create("karlito_yellow", db.actor:position():add(db.actor:direction():mul(-22)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		alife():create("af_bl_kristal", db.actor:position():add(db.actor:direction():mul(-6)), db.actor:level_vertex_id(), db.actor:game_vertex_id())

		local se_obj = alife():object("lvl_rat_level_changer_0007")
  		if se_obj then
    			olr.add_spot_on_map( se_obj.id,"level_changer","On Yantar")
  		end

	
		local gar = alife():object("lvl7_yantar_rat_staler_undead_olr_000")
		if gar then
			olr.add_spot_on_map( gar.id,"esc_anomaly_field_location", "Missing environmentalist" )
		end
		local gar = alife():object("lvl7_yantar_rat_staler_undead_olr_000_0000")
		if gar then
			olr.add_spot_on_map( gar.id,"esc_anomaly_field_location", "Missing environmentalist" )
		end
		local gar = alife():object("lvl7_yantar_rat_staler_undead_olr_000_0001")
		if gar then
			olr.add_spot_on_map( gar.id,"esc_anomaly_field_location", "Missing environmentalist" )
		end
		local gar = alife():object("lvl7_yantar_rat_staler_undead_olr_000_0002")
		if gar then
			olr.add_spot_on_map( gar.id,"esc_anomaly_field_location", "Missing environmentalist" )
		end
		local gar = alife():object("lvl7_yantar_rat_staler_undead_olr_000_0003")
		if gar then
			olr.add_spot_on_map( gar.id,"esc_anomaly_field_location", "Missing environmentalist" )
		end


		db.actor:give_info_portion("dosent_kompl_dead_cheked")
	end	

	if obj:name() == "lvl7_yantar_stalker_0082" and has_alife_info("ohr_nachal_dead_st_pogo") and not has_alife_info("ohr_nachal_dead_st_pogo_nasel") then
		news_manager.send_tip(db.actor, "Looks like it's a guard from the camp....", 1, "act", 19000)
		olr.info("ohr_nachal_dead_st_pogo_nasel")
	end

end


function look_rat(obj)

	if obj:name() == "lvl7_yantar_rat_staler_undead_olr_000" and not has_alife_info("kkdead_chek_1") then
		news_manager.send_tip(db.actor, "Looks like a scientist from the group...", 1, "act", 19000)
		nick.gar_lamb_zombs()
		olr.info("kkdead_chek_1")
		alife():create("chimera_midl", db.actor:position():add(db.actor:direction():mul(-62)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		level.map_remove_object_spot(obj:id(), "esc_anomaly_field_location")
	end

	if obj:name() == "lvl7_yantar_rat_staler_undead_olr_000_0000" and not has_alife_info("kkdead_chek_2") then
		news_manager.send_tip(db.actor, "Looks like a scientist from the group...", 1, "act", 19000)
		nick.gar_lamb_zombs()
		olr.info("kkdead_chek_2")
		alife():create("karlito_yellow", db.actor:position():add(db.actor:direction():mul(-62)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		level.map_remove_object_spot(obj:id(), "esc_anomaly_field_location")
	end
	if obj:name() == "lvl7_yantar_rat_staler_undead_olr_000_0001" and not has_alife_info("kkdead_chek_3") then
		news_manager.send_tip(db.actor, "Looks like a scientist from the group...", 1, "act", 19000)
		nick.gar_lamb_zombs()
		olr.info("kkdead_chek_3")
		alife():create("chimera_weak", db.actor:position():add(db.actor:direction():mul(-62)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		level.map_remove_object_spot(obj:id(), "esc_anomaly_field_location")
	end
	if obj:name() == "lvl7_yantar_rat_staler_undead_olr_000_0002" and not has_alife_info("kkdead_chek_4") then
		news_manager.send_tip(db.actor, "Looks like a scientist from the group...", 1, "act", 19000)
		nick.gar_lamb_zombs()
		olr.info("kkdead_chek_4")
		alife():create("karlito_yellow", db.actor:position():add(db.actor:direction():mul(-62)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		level.map_remove_object_spot(obj:id(), "esc_anomaly_field_location")
	end
	if obj:name() == "lvl7_yantar_rat_staler_undead_olr_000_0003" and not has_alife_info("kkdead_chek_5") then
		news_manager.send_tip(db.actor, "Looks like a scientist from the group...", 1, "act", 19000)
		nick.gar_lamb_zombs()
		olr.info("kkdead_chek_5")
		alife():create("chimera_strong", db.actor:position():add(db.actor:direction():mul(-62)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		level.map_remove_object_spot(obj:id(), "esc_anomaly_field_location")
	end

	if obj:name() == "lvl_rat_physic_object_0018" or obj:name() == "lvl_rat_physic_object_0019" or obj:name() == "lvl_rat_physic_object_0020" or obj:name() == "lvl_rat_physic_object_0021" then
		nick.rat_kill_actor_niznii_uroven_now()	
	end
	if obj:name() == "lvl_rat_physic_object_0000" then
		local snd_obj = xr_sound.get_safe_sound_object([[ol3\zombies_mute\zombie_mute5]])
		if not snd_obj:playing() then 
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
			alife():create("controller_new", db.actor:position():add(db.actor:direction():mul(-9)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		end
	end
	if obj:name() == "lvl_rat_physic_object_0022" then
		olr.partice_on_obj("lvl_rat_physic_object_0022",[[anomaly2\group_items\body_tear_blood_01]])
		olr.spawn_on_obj("af_dummy_glassbeads", "lvl_rat_physic_object_0022")
		olr.spawn_on_obj("af_dummy_glassbeads", "lvl_rat_physic_object_0020")
		olr.spawn_on_obj("af_dummy_glassbeads", "lvl_rat_zone_radioactive_weak_0002")
		level.add_pp_effector("black.ppe", 20131, false)
		alife():create("karlito_yellow", db.actor:position():add(db.actor:direction():mul(-5)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
		level.add_pp_effector("snd_shock.ppe", 2031, false)
		local snd_obj = xr_sound.get_safe_sound_object([[ol3\h_otsteps_wood1]])
		if not snd_obj:playing() then 
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		end
		olr.del_by_name("lvl_rat_physic_object_0022")
	end
end



function spawen_killers_gar_dolg()
	olr.spawn_on_obj("mil_killer_respawn_1", "gar_dolg_blokpost")
	olr.spawn_on_obj("mil_killer_respawn_2", "gar_dolg_blokpost")
	olr.spawn_on_obj("mil_killer_respawn_3", "gar_dolg_blokpost")
	olr.spawn_on_obj("mil_killer_respawn_4", "gar_dolg_blokpost")
end


function chaes_anoms_dell_jurn()
	news_manager.send_tip(db.actor, "General network: Now we are in the power plant area, we were able to deactivate a large number of anomalies blocking the approaches to the sarcophagus. Who's around, ask for support, large number of mutants.", 28, "freedom", 19000)
	olr.kill_mon_in_radius(db.actor:position(), 50)
	olr.del_by_name("zone_gravi_zone_zeh_1")
	olr.del_by_name("zone_mosquito_bald0030_stan")

	olr.del_by_name("lvl11_deadcity_staler_undead_olr")

	olr.del_by_name("lvl13_prip_space_restrictor_0016")
	olr.del_by_name("lvl13_prip_space_restrictor_0015")
	olr.del_by_name("lvl13_prip_space_restrictor_0014")
	olr.del_by_name("lvl13_prip_space_restrictor_0013")
	olr.del_by_name("lvl13_prip_m_car")


	olr.spawn_on_obj("m_gigant_e", "rad_zone_radioactive_0038")
	olr.spawn_on_obj("gigant_strong", "rad_zone_radioactive_0038")

	olr.spawn_on_obj("rad_soldier_master", "rad_zone_radioactive_0072")
	olr.spawn_on_obj("rad_soldier_master", "rad_zone_radioactive_0072")
	olr.spawn_on_obj("rad_soldier_master", "rad_zone_radioactive_0072")
	olr.spawn_on_obj("rad_specnaz_respawn_specnaz", "rad_zone_radioactive_0072")
	olr.spawn_on_obj("rad_specnaz_respawn_specnaz", "rad_zone_radioactive_0072")
	olr.spawn_on_obj("rad_specnaz_respawn_specnaz", "rad_zone_radioactive_0072")
	olr.spawn_on_obj("val_soldier_respawn_1", "rad_zone_radioactive_0072")

	olr.spawn_on_obj("mil_stalker_respawn_1", "matress_prip_krovo")
	olr.spawn_on_obj("mil_stalker_respawn_2", "matress_prip_krovo")
	olr.spawn_on_obj("mil_stalker_respawn_3", "matress_prip_krovo")


	olr.spawn_on_obj("pri_monolith_respawn_1", "lvl56545_bar_space_restrictor_0013")
	olr.spawn_on_obj("pri_monolith_respawn_2", "lvl56545_bar_space_restrictor_0013")
	olr.spawn_on_obj("pri_monolith_respawn_3", "lvl56545_bar_space_restrictor_0013")
	olr.spawn_on_obj("rad_monolith_respawn_1", "lvl56545_bar_space_restrictor_0013")
	olr.spawn_on_obj("rad_monolith_respawn_2", "lvl56545_bar_space_restrictor_0013")
	olr.spawn_on_obj("rad_monolith_respawn_3", "lvl56545_bar_space_restrictor_0013")


	olr.to_online("lvl10_radar_physic_object_0206")

end



function jaba_kill_greh_kk_tip()
	news_manager.send_tip(db.actor, "Forgot to say... my memory's gone to hell. In this tower, where the descent into the catacombs was seen at night, one strange glow probably an artifact, mind you.", 26, "trader", 25000)
	olr.give_item("med_injector_capsule")
	local se_obj = alife():object("lvlmil_physic_object_0511")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the catacombs")
  	end
	local se_obj = alife():object("lvl_rat_level_changer_0009")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","into the hills")
  	end
	local se_obj = alife():object("lvl_rat_level_changer_0005")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","at the bar")
  	end
end



function engame_fun_monolitc()

        if level.name() == "lvl14_stancia" or level.name() == "lvl13_prip" or level.name() == "lvl8_swamp" then
		return
	end

level.add_pp_effector("vibros.ppe", 2001, true)
if math.random(1,10) == 1 then
	olr.spawen_phantoms()
	snd_obj_eq = sound_object([[ambient\earthquake]],sound_object.looped+sound_object.s2d)
    	snd_obj_eq:play(db.actor, 4, sound_object.looped+sound_object.s2d)
end
local snd_obj = xr_sound.get_safe_sound_object([[ambient\organic_moan1]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)


local sectionsa = 
{ 
"m_zombie_e",
"zombie_blue"
}


local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_max = math.max( unpack(gvtab))

local count = math.random(8,12) 
for ind = 1, count do

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)

end


local rnd = math.random(90,157)
olr_timers.st_timer("engame_fun_monolitc", rnd, "nick.engame_fun_monolitc()")
end


function spawn_jourlalist_monstrs_spawn_online()
	olr.snd([[ol3\koan\mix-01_pr1_1644]])
	olr.horror_snd()
	local wait_time = 0
  	wait_time = time_global() + 11200
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.snd([[characters_voice\scenario\helicopter\heli_attack]]) end
  	)
	news_manager.send_tip(db.actor, "General network: Men... in Pripyat, it's just a buzzing noise. mutants, they're everywhere... what's going on?", 8, "freedom", 19000)
	news_manager.send_tip(db.actor, "General network: You haven't seen what's going on at the power plant yet...", 17, "dolg", 19000)
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and IsStalker(kill) or IsMonster(kill) then
			if not kill:alive() then
			if kill.level_name == "lvl10_radar" or kill.level_name == "lvl9_military" or kill.level_name == "lvl13_prip" or kill.level_name == "lvl3_agroprom" or kill.level_name == "lvl4_darkdolina" or kill.level_name == "lvl11_deadcity" then
				if xvars.npc_actor_use[kill:name()] == true then
					cnt = cnt+1
					alife():release(kill, true) 
				end
			end
			end		
		end
	end
end





function fantasm_den_man_start_fun()

if has_alife_info("phantsam_boloto_ubil") then
	return
end

local obj = alife():object("lvl8_swamp_phantasm")
if obj and obj:health() > 0 then
olr.add_spot_on_map( obj.id,"monster_part_location","Phantasm" )
local zom = level.object_by_id(obj.id)
if zom then

	local snd_obj = xr_sound.get_safe_sound_object([[ol3\low_base]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)

	xr_effects.phatstm_telep()

	local boss_particle = particles_object("ghoul\\fx-06-blue-glow")
	local wait_time = 0
  	wait_time = time_global() + 500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() boss_particle:play_at_pos(vector():set(zom:position().x, zom:position().y+0.6, zom:position().z)) end
  	) 

end
end


local sectionsa = 
{ 

"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_konteyner_01",
"ph_balon_02",
"ph_balon_01",
"ph_item_box_01",
"ph_med_stolik_01",
"ph_box_wood_01",
"ph_ognetushitel",
"ph_med_stoyka_01",
"ph_vedro_01",
"ph_med_katalka_01",
"ph_tumba_1g",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_shkaf_4",
"ph_shkaf_5",
"ph_shkaf_6",
"ph_tumba_1",
"ph_tumba_1a",
"ph_tumba_1b",
"ph_tumba_1c",
"ph_tumba_1d",
"ph_tumba_1f",
"ph_garbage_11",
"ph_garbage_10",
"ph_garbage_9",
"ph_garbage_8",
"ph_garbage_7",
"ph_garbage_6",
"ph_garbage_5",
"ph_garbage_4",
"ph_garbage_3",
"ph_garbage_2",
"ph_garbage_1",
"ph_krovat_01",
"ph_krovat_02",
"ph_konteyner_03",
"ph_konteyner_02",
"ph_konteyner_01"

}

if math.random(1,5) == 1 then
	local section = sectionsa[math.random(table.getn(sectionsa))] 
	alife():create(section, db.actor:position():add(db.actor:direction():mul(-2)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
else
	nick.phantasms_zombies()
end

local rnd = math.random(28,48)
olr_timers.st_timer("fantasm_den_man", rnd, "nick.fantasm_den_man_start_fun()")
end





function mg_ph_spawn_boloto()
if has_alife_info("mg_spawen_raz_boloto_ubil") then
	return
end
local sectionsa = 
{ 

"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_konteyner_01",
"ph_balon_02",
"ph_balon_01",
"ph_item_box_01",
"ph_med_stolik_01",
"ph_box_wood_01",
"ph_ognetushitel",
"ph_med_stoyka_01",
"ph_vedro_01",
"ph_med_katalka_01",
"ph_tumba_1g",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_shkaf_4",
"ph_shkaf_5",
"ph_shkaf_6",
"ph_tumba_1",
"ph_tumba_1a",
"ph_tumba_1b",
"ph_tumba_1c",
"ph_tumba_1d",
"ph_tumba_1f",
"ph_garbage_11",
"ph_garbage_10",
"ph_garbage_9",
"ph_garbage_8",
"ph_garbage_7",
"ph_garbage_6",
"ph_garbage_5",
"ph_garbage_4",
"ph_garbage_3",
"ph_garbage_2",
"ph_garbage_1",
"ph_krovat_01",
"ph_krovat_02",
"ph_konteyner_03",
"ph_konteyner_02",
"ph_konteyner_01"

}

local section = sectionsa[math.random(table.getn(sectionsa))] 
alife():create(section, db.actor:position():add(db.actor:direction():mul(-2)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	olr_timers.st_timer("mg_ph_spawn_boloto", 14, "nick.mg_ph_spawn_boloto()")
end


function start_boss_firts_talk()
	olr.snd([[ol3\koan\Organizm1]])
	bind_stalker.hide_weapon()
	olr.del_by_name("lvl16_generators_stalker_0035")
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_pp_effector("proba_gray.ppe", 2032431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("actor_boss_talk_one_walk")
	local look = patrol("actor_boss_talk_one_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("total_recall.ppe", 15876, false)
	level.add_cam_effector("camera_effects\\shell_shock.anm", 3496, false, "")
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	news_manager.send_tip(db.actor, "How long I've been waiting for my time...", 15, "unknown", 5000)
	news_manager.send_tip(db.actor, "Look at me, I'm your brother of life! Sixteen years in the same cage has taken its wild toll on me!", 19, "unknown", 5000)
	news_manager.send_tip(db.actor, "I'm not sure what I'm seeing! Isn't another illusion coming to me?", 26, "unknown", 5000)
	news_manager.send_tip(db.actor, "Tell me what you see! I'm standing in front of you, can you see me? Am I not pure before my maker?", 28, "unknown", 5000)
	news_manager.send_tip(db.actor, "If I can't go out into the world, let the world come to me!", 32, "unknown", 5000)
	olr_timers.st_timer("atta44k33332333", 29, "nick.boss_talk_one_done()")
	nick.gen_vtotoy_zaval_offl() 	-- завалы второго этажа в оффлайн когда первый раз поговорили
end


function phantasms_zombies()
local sectionsa = { 
"m_zombie_e",
"zombie_normal",
"zombie_strong",
"zombie_blue"
}

 local snd_obj = xr_sound.get_safe_sound_object([[ambient\earthquake]])
 snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 2.0)

 for i = 1, math.random(2,3) do
	local noobposition = db.actor:position()
	local xnoob = math.random(10,20+i)
	local znoob = math.random(10,20+i)
	local nmpos = vector():set( noobposition.x + xnoob - i, noobposition.y - 2, noobposition.z - znoob )
	local section = sectionsa[math.random(table.getn(sectionsa))] 
	local zom = alife():create(section, nmpos, db.actor:level_vertex_id() , db.actor:game_vertex_id() )

	level.client_spawn_manager():add(zom.id, 0, 
	function(id,obj) 		

        local boss_particle = particles_object("anomaly2\\unknown_star") 
	boss_particle:play_at_pos(vector():set(obj:position().x, obj:position().y-4.6, obj:position().z))
	--olr.add_spot_on_map( obj.id,"green_location",obj:name() )

	end)


 end
end


function jaba_actor_atak_militarys()
	db.actor:change_character_reputation(-60)
	news_manager.send_tip(db.actor, "Messer! What the fuck!? I told you not to touch the military!", 16, "trader", 25000)
end

function kill_inrad_rost()
	olr.kill_mon_in_radius(db.actor:position(), 70)
end

function upd_cond_foods_serv()

local function TimeCondLostArts(obj)
	return 100/120/24/100/60 * 100 * 295
end

local function is_foods_cond(obj)
	local section = obj:section_name()
                       if section == "conserva" or section == "bread" or section == "kolbasa" 

				or section == "mutant_flesh_eye_coocked"
				or section == "mutant_boar_leg_coocked"
				or section == "mutant_dog_tail_coocked"
				or section == "mutant_psevdodog_tail"
				or section == "mutant_krovosos_jaw_coocked"
				or section == "mutant_burer_hand_coocked"
				or section == "mutant_zombie_hand_coocked" 

				or section == "rat_food_coocked"
				or section == "crow_food_coocked" 

				or section == "rat_food"
				or section == "crow_food" 

				or section == "mutant_flesh_eye"
				or section == "mutant_boar_leg"
				or section == "mutant_dog_tail"
				or section == "mutant_psevdodog_tail"
				or section == "mutant_krovosos_jaw"
				or section == "af_ameba_mica"
				or section == "mutant_burer_hand"
				or section == "mutant_zombie_hand" then
				return true
			end
end


	local foods = {}
	local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj and obj.level_name ~= level.name() then

if obj.level_name == "lvl2_garbage" and has_alife_info("gar_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl3_agroprom" and has_alife_info("agr_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl4_darkdolina" and has_alife_info("dol_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl5_bar" and has_alife_info("bar_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl6_rostok" and has_alife_info("ros_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl7_yantar" and has_alife_info("yan_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl8_swamp" and has_alife_info("swp_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl9_military" and has_alife_info("mil_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl10_radar" and has_alife_info("rad_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl12_radar_bunker" and has_alife_info("radlab_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl11_deadcity" and has_alife_info("dec_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl13_prip" and has_alife_info("prp_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl_level12" and has_alife_info("lvl12_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl15_sarcofag" and has_alife_info("sarco_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl14_stancia" and has_alife_info("stan_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl_rat" and has_alife_info("rat_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
if obj.level_name == "lvl16_generators" and has_alife_info("gen_first") and is_foods_cond(obj) then
	table.insert(foods, obj)
end
				
					
		end
		end


	--for i, obj in ipairs(foods) do

	--	log1(" added food to cond  - "..obj:name().." -- "..obj.level_name.."  ")

	--	local nowcond = obj.item_condition
	--	if nowcond and nowcond > 0 then
	--		local new_cond = nowcond - TimeCondLostArts(obj)
	--		if new_cond and new_cond <= 0 then
	--			new_cond = 0
	--		end
	--		obj.item_condition = new_cond
	--	end
--
--		if new_cond then
--			log1(" food  - "..obj:name().." -- "..obj.level_name.." --- cond old - "..nowcond.." set cond -  "..new_cond.." ")
--		else
--			log1("NO NEWCOND FOOR -  - "..obj:name().." -- "..obj.level_name.." --- cond old -  set cond -  NONE")
--		end
--	end

	for i, obj in ipairs(foods) do

		--log1(" added food to cond  - "..obj:name().." -- "..obj.level_name.."  ")

		local pk = get_netpk(obj,1)
		if pk == nil then 
			return nil 
		end
		local data = pk:get()
		if data == nil then 
			return nil 
		end
		local nowcond = data.condition

		if nowcond == nil then
			return nil
		end

		if not nowcond then
			return nil
		end

		if nowcond <= 0 then
			return nil
		end
		
		local new_cond = nowcond - TimeCondLostArts(obj)
		if new_cond <= 0 then
			new_cond = 0
		end
		data.condition = new_cond
		pk:set(data)

		--log1(" food  - "..obj:name().." -- "..obj.level_name.." --- cond old - "..nowcond.." set cond -  "..new_cond.." ")
	end


end


function posthuman_ending()
	--log1("sst")
	local wait_time = 0
  	wait_time = time_global() + 500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() nick.post_suka_blyat() end
  	)
end

function post_suka_blyat()
	olr.snd([[ol3\koan\Mix441]])
	olr.kill_mon_in_radius(db.actor:position(), 150)
	local point = patrol("gen_acr_tetep")
	local look = patrol("gen_acr_tetep")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	bind_stalker.hide_weapon()
	olr.hide_inv()
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_cam_effector2("camera_effects\\gen_posthuman_1.anm", 90, false, "nick.posthuman_ending_2")
	level.set_weather("1865",true)
end

function posthuman_ending_2()
	olr.snd([[ol3\koan\sfx_demo1]])
	olr.info("posthuman_cutscene_start")
	olr_timers.st_timer("posthuman_ending_kill_posthuman", 14, "nick.posthuman_ending_kill_posthuman()")
	level.add_cam_effector2("camera_effects\\gen_posthuman_2.anm", 90, false, "nick.posthuman_ending_3")
end

function posthuman_ending_3()
	olr.snd([[ol3\koan\Organizm2]])
	olr.info("gen_posthum_strelok_spawn")
	level.add_cam_effector2("camera_effects\\gen_posthuman_3.anm", 90, false, "dialogs_aes.osoznanie_agree")
end


function posthuman_ending_kill_posthuman()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_monster() and npc:name() == "lvl16_generators_m_posthuman_e" then  
			npc:kill(npc)
		end
	end
end


function set_snd_vol(snd)
	get_console():execute("snd_volume_eff "..snd.."")
end

function set_snd_vol_mus(snd)
	get_console():execute("snd_volume_music "..snd.."")
end



function nov_marevo_gtfodel_arra()
	olr_timers.st_timer("nov_marevo_gtfodel_arra_now", 100, "nick.nov_marevo_gtfodel_arra_now()")
end

function nov_marevo_gtfodel_arra_now()
	olr.del_by_name("lvl3_agroprom_stalker_0039")
	olr.del_by_name("lvl3_agroprom_lights_hanging_lamp")
	olr.del_by_name("lvl3_agroprom_space_restrictor_0007")
	news_manager.send_tip(db.actor, "Jarick: Thank you again, bro... don't forget to talk to the C.I. He already knows.", nil, "default", 39000)
end

function actor_problem_with_stalkers()
	local chkgoodwill = relation_registry.community_goodwill("stalker", db.actor:id())
	if chkgoodwill < -400 then 
		return true	
	end
	return false
end


function actor_problem_with_stalkers_fine()
	db.actor:give_money(-3000)
	game_stats.money_quest_update(-3000)
	news_manager.send_tip(db.actor, "Lost money - 3,000.", 5, "money", 39000)
end



function gar_slizen_noviki_dead_have_done_func()
	if has_alife_info("gar_slizen_noviki_dead_have_done") or
		has_alife_info("novics_vicup_dolina_done") then
		return true
	end
end


function mg_raz_boloto_ubil()
	olr.partice_on_obj("lvl11_deadcity_observer",[[anomaly2\group_items\body_tear_blood_01]])
	olr.snd([[ol3\koan\Drone1-m]])
	level.add_pp_effector("black.ppe", 20131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\low_pulse]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	olr.del_by_name("lvl11_deadcity_m_poltergeist_normal_tele_0004")
	olr.del_by_name("lvl11_deadcity_m_poltergeist_normal_tele_0005")
	local wait_time = 0
  	wait_time = time_global() + 111
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl11_deadcity_observer") end
  	)
end

function esc_blockpost_normal_timer()
	if not olr_timers.has_timer("esc_blockpost_normal_timer_now") then
		if not has_alife_info("choose_destiny_done") then
			local rnd = math.random(160,224)
			olr_timers.st_timer("esc_blockpost_normal_timer_now", rnd, "nick.esc_blockpost_normal_timer_now()")
			local rnd = math.random(1,2)
			if rnd == 1 then
				if not has_alife_info("actor_in_jaba_zone") then
					news_manager.send_tip(db.actor, "Toad: You've been seen by the military... picking up their walkie-talkie signal. hide somewhere before they shoot you.", 2, "trader", 39000)
				end
			end
		end
	end
end

function esc_blockpost_normal_timer_now()
	olr.info("esc_blockpost_normal")
end

function veterans_go_to_ploskd()
	olr.snd([[ol3\koan\L_discombat]])
	olr.blow_add(400)
	news_manager.send_tip(db.actor, "Gatsula: Okay, squad, time... let's move out.", nil, "default", 39000)
	olr.del_by_name("lvl6_rostok_physic_object_0157")
	olr.del_by_name("lvl5_bar_physic_object_1341")
	olr.spawn_on_obj("chimera_midl", "lvl5_bar_smart_terrain_0008")
	olr.spawn_on_obj("chimera_weak", "lvl5_bar_smart_terrain_0046")	
end


function barman_span_barwolf()
	level.add_pp_effector("black.ppe", 20131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\low_pulse]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
end


function oso_no()
	olr.snd([[ol3\koan\mix-01_pr1_1644]])
	level.add_pp_effector("black.ppe", 20131, false)
	db.actor:set_actor_position(vector():set(171,16,-485))
	local wait_time = 0
  	wait_time = time_global() + 111
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl16_generators_staler_undead_olr_0007") end
  	)
end


function major_start_kk_spaven()
	news_manager.send_tip(db.actor, "It's him! Fire!", nil, "unknown", 19000)
	local bsobj = alife():object("lvl_rat_stalker_0013") 
	if bsobj then 
		alife():create("wpn_groza_old", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id)
		alife():create_ammo("ammo_9x39_ap", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		local car = level.object_by_id(bsobj.id)
		if car then
			car:set_character_community("voenstals", 0, 0)
			car:set_relation(game_object.enemy, db.actor) 	
		end
	end

		olr.del_by_name("lvl_rat_stalker_0003")
		olr.del_by_name("lvl_rat_space_restrictor_0002")

	olr_timers.st_timer("set_enem_maior_kk", 3, "nick.set_enem_maior_kk()")
	olr_timers.st_timer("set_enem_maior_kk", 5, "nick.set_enem_maior_kk()")
	olr_timers.st_timer("set_enem_maior_kk", 7, "nick.set_enem_maior_kk()")
end

function set_enem_maior_kk()

	local bsobj = alife():object("lvl_rat_stalker_0013") 
	if bsobj then 
		local car = level.object_by_id(bsobj.id)
		if car then
			car:set_character_community("voenstals", 0, 0)
			car:set_relation(game_object.enemy, db.actor) 	
		end
	end

	local sim = alife() 
	local se_obj = alife():object("lvl_rat_stalker_0013")
	if se_obj then 
		se_obj:set_relation(game_object.enemy, db.actor) 
	end
	 
	for i=1, 65534 do
	local car = level.object_by_id(i)
		if car then
			if car ~= nil and 
				car:name() == "lvl_rat_stalker_0013" then
				local h = hit ()
				h.power = 0.05
				h.direction = vector():set (0, 1, 0)
				h.impulse = 0.1
				h.draftsman = db.actor
				h.type = hit.strike
				car:hit (h)
				car:set_character_community("voenstals", 0, 0)
				log1("setene")
			end
		end
	end
end

function has_weapon_slot_two()
	local wpn = db.actor:item_in_slot(2)
	if wpn and xvars.goodcondweaps[wpn:name()] == nil then
		return true
	else
		return false
	end
end

function set_vintovka_good_cond()
	news_manager.send_tip(db.actor, "The money given is 1,000.", nil, "money", 39000)
	db.actor:give_money(-1000)
	game_stats.money_quest_update(-1000)
	local wpn = db.actor:item_in_slot(2)
	if wpn then
		xvars.goodcondweaps[wpn:name()] = true
		--log1("set good weap")
		local wpn_ak = engine_object(wpn:id())
		if wpn_ak then
			wpn_ak.condition_shot_dec = 0.0001
			--log1("hq set")
		end	
	end
end


function daem_golovudead()
	olr.give_item("af_dummy_glassbeads")
end


function chn_doki_start_online()
	olr.to_online("lvl9_military_doki_dla_ch")
	olr.spawn_on_obj("controller_tubeman_old", "lvl9_military_zone_radioactive_weak_0015")
end

function chaes_actor_on_roof_now()
	olr_blowout.blowout_additional_timer()
	level.add_pp_effector("snd_shock.ppe", 20541, false)
end

function delete_warl_projectors()
	olr.del_by_name("generastprog_lights_hanging_lamp_0000")
	olr.del_by_name("generastprog_lights_hanging_lamp")
	olr.del_by_name("generastprog_lights_hanging_lamp_0001")
	olr.del_by_name("lvl16_generators_stalker_0026")
	olr.del_by_name("lvl16_generators_stalker_0024")
	olr.del_by_name("lvl16_generators_stalker_0023")
	olr.del_by_name("lvl16_generators_stalker_0025")
	olr.kill_mon_in_radius(db.actor:position(), 150)
end


function weapon_peshera_gig()
	olr.snd([[ol3\koan\new_flesh_idle2]])
	local bloodbridge = vector():set(-45.55, -4.29, 37.00 )
	alife():create("wpn_knife_anom", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
end


function doki_seven_online()
	olr.to_online("lvl14_stancia_jornal_7") 
	news_manager.send_tip(db.actor, "Appeal to those planning to go to the power plant area... the road looks like it's going to be clear there soon. We lost a group long ago that had very important information. Looks like a red folder of papers... Whoever gets this information, please contact the leadership of our group...", 50, "freedom", 59000) 
end


function precond_dva_kasara()
	return db.actor:money() >= 2000
end

function out_dva_kasara()
	news_manager.send_tip(db.actor, "The money given is 2,000.", nil, "money", 39000)
	db.actor:give_money(-2000)
	game_stats.money_quest_update(-2000)
	news_manager.send_tip(db.actor, "Informant: Your order was accepted, wait for a message on your PDA about the location of your documents...", nil, "flash", 29000)
end

function precond_desat_kasara()
	return db.actor:money() >= 10000
end

function out_desat_kasara()
	news_manager.send_tip(db.actor, "The money given is 10,000.", nil, "money", 39000)
	db.actor:give_money(-10000)
	game_stats.money_quest_update(-10000)
	news_manager.send_tip(db.actor, "Informant: Your order was accepted, wait for a message on your PDA when you can pick up your documents...", nil, "flash", 29000)
end

function dolgmed_about_injector_done()
	news_manager.send_tip(db.actor, "The money given is 10,000.", nil, "money", 39000)
	db.actor:give_money(-10000)
	game_stats.money_quest_update(-10000)
	olr.give_item("med_injector")
end

function out_doki_osved_journals()



	if has_alife_info("navodka_jurnal_finded_high_1") and not has_alife_info("jornal_1_taken") then
		local m_where = "Yeah, we got what you asked for..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_1"
				then
					alife():release(obj, true)	
				end					
		end
		end
		olr.give_item("jornal_1")
		return
	end



	if has_alife_info("navodka_jurnal_finded_high_2") and not has_alife_info("jornal_2_taken") then
		local m_where = "Yeah, we got what you asked for..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_2"
				then
					alife():release(obj, true)	
				end					
		end
		end
		olr.give_item("jornal_2")
		return
	end


	if has_alife_info("navodka_jurnal_finded_high_3") and not has_alife_info("jornal_3_taken") then
		local m_where = "Yeah, we got what you asked for..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_3"
				then
					alife():release(obj, true)	
				end					
		end
		end
		olr.give_item("jornal_3")
		return
	end

	if has_alife_info("navodka_jurnal_finded_high_4") and not has_alife_info("spawn_doks_yantar") then
		local m_where = "Yeah, we got what you asked for..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_4"
				then
					alife():release(obj, true)	
				end					
		end
		end
		olr.give_item("jornal_4")
		return
	end

	if has_alife_info("navodka_jurnal_finded_high_5") and not has_alife_info("spawn_doks_radar") then
		local m_where = "Yeah, we got what you asked for..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_5"
				then
					alife():release(obj, true)	
				end					
		end
		end
		olr.give_item("jornal_5")
		return
	end

	if has_alife_info("navodka_jurnal_finded_high_6") and not has_alife_info("jornal_6_taken") then
		local m_where = "Yeah, we got what you asked for..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		local sim = alife()
		for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_6"
				then
					alife():release(obj, true)	
				end					
		end
		end
		olr.give_item("jornal_6")
		return
	end
		

	local m_where = "No... I don't have anything for you."
	db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	return
end


----- 1 -------------------------------------------
function navodka_jurnal_1_high()
	olr_timers.st_timer("navodka_jurnal_1_high", 1545, "nick.navodka_jurnal_finded_high_1()")
end

function navodka_jurnal_finded_high_1()
	news_manager.send_tip(db.actor, "Informant: Come in... has some paperwork for you.", nil, "flash", 29000)
	olr.info("navodka_jurnal_finded_high_1")
end

function navodka_jurnal_1()
	olr_timers.st_timer("navodka_jurnal_1", 3415, "nick.navodka_jurnal_finded_1()")
end
function navodka_jurnal_finded_1()
	local dok = nil
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_1"
				then
					cnt=cnt+1
					dok=obj	
				end					
		end
	end
	if cnt == 0 then
		news_manager.send_tip(db.actor, "UPDATE: About the search for classified documents #1 - we couldn't find anything... there's no clue where they are, it's gonna take a much more expensive search. Come on over, we can make a deal.", nil, "flash", 29000)
		return
	end
	if cnt > 0 then
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(dok.m_game_vertex_id):level_id()), vector():set(dok.position.x,dok.position.y,dok.position.z))
		news_manager.send_tip(db.actor, "Informant: About the search for classified documents #1 - there's location information. "..pos.." ", nil, "flash", 29000)
		return
	end
end



----- 2 -------------------------------------------
function navodka_jurnal_2_high()
	olr_timers.st_timer("navodka_jurnal_2_high", 1545, "nick.navodka_jurnal_finded_high_2()")
end

function navodka_jurnal_finded_high_2()
	news_manager.send_tip(db.actor, "Informant: Come in... has some paperwork for you.", nil, "flash", 29000)
	olr.info("navodka_jurnal_finded_high_2")
end

function navodka_jurnal_2()
	olr_timers.st_timer("navodka_jurnal_2", 3415, "nick.navodka_jurnal_finded_2()")
end
function navodka_jurnal_finded_2()
	local dok = nil
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_2"
				then
					cnt=cnt+1
					dok=obj	
				end					
		end
	end
	if cnt == 0 then
		news_manager.send_tip(db.actor, "We can't find anything on classified document number two... no clue where they are, we need a much more expensive search. Come on over, we can make a deal.", nil, "flash", 29000)
		return
	end
	if cnt > 0 then
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(dok.m_game_vertex_id):level_id()), vector():set(dok.position.x,dok.position.y,dok.position.z))
		news_manager.send_tip(db.actor, "Informant: About the search for secret documents number two - we have information about the location. "..pos.." ", nil, "flash", 29000)
		return
	end
end

----- 3 -------------------------------------------
function navodka_jurnal_3_high()
	olr_timers.st_timer("navodka_jurnal_3_high", 1545, "nick.navodka_jurnal_finded_high_3()")
end

function navodka_jurnal_finded_high_3()
	news_manager.send_tip(db.actor, "Come on in. I have some documents for you.", nil, "flash", 29000)
	olr.info("navodka_jurnal_finded_high_3")
end

function navodka_jurnal_3()
	olr_timers.st_timer("navodka_jurnal_3", 3415, "nick.navodka_jurnal_finded_3()")
end
function navodka_jurnal_finded_3()
	local dok = nil
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_3"
				then
					cnt=cnt+1
					dok=obj	
				end					
		end
	end
	if cnt == 0 then
		news_manager.send_tip(db.actor, "We can't find anything on classified document number three... no clue where they are, we need a much more expensive search. Come on over, we can make a deal.", nil, "flash", 29000)
		return
	end
	if cnt > 0 then
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(dok.m_game_vertex_id):level_id()), vector():set(dok.position.x,dok.position.y,dok.position.z))
		news_manager.send_tip(db.actor, "Informant: About the search for secret documents number 3 - we have information about the location. "..pos.." ", nil, "flash", 29000)
		return
	end
end


----- 4 -------------------------------------------
function navodka_jurnal_4_high()
	olr_timers.st_timer("navodka_jurnal_4_high", 1645, "nick.navodka_jurnal_finded_high_4()")
end

function navodka_jurnal_finded_high_4()
	news_manager.send_tip(db.actor, "Come on in. I have some documents for you.", nil, "flash", 29000)
	olr.info("navodka_jurnal_finded_high_4")
end

function navodka_jurnal_4()
	olr_timers.st_timer("navodka_jurnal_4", 4415, "nick.navodka_jurnal_finded_4()")
end
function navodka_jurnal_finded_4()
	local dok = nil
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_4"
				then
					cnt=cnt+1
					dok=obj	
				end					
		end
	end
	if cnt == 0 then
		news_manager.send_tip(db.actor, "We can't find anything about classified documents number four... no clue where they are, we need a much more expensive search. Come on over, we can make a deal.", nil, "flash", 29000)
		return
	end
	if cnt > 0 then
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(dok.m_game_vertex_id):level_id()), vector():set(dok.position.x,dok.position.y,dok.position.z))
		news_manager.send_tip(db.actor, "Informant: About the search for secret documents number 4 - we have information about the location. "..pos.." ", nil, "flash", 29000)
		return
	end
end



-- 5  -------------------------------------------
function navodka_jurnal_5_high()
	olr_timers.st_timer("navodka_jurnal_5_high", 2554, "nick.navodka_jurnal_finded_high_5()")
end

function navodka_jurnal_finded_high_5()
	news_manager.send_tip(db.actor, "Come on in. I have some documents for you.", nil, "flash", 29000)
	olr.info("navodka_jurnal_finded_high_5")
end

function navodka_jurnal_5()
	olr_timers.st_timer("navodka_jurnal_5", 4514, "nick.navodka_jurnal_finded_5()")
end
function navodka_jurnal_finded_5()
	local dok = nil
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_5"
				then
					cnt=cnt+1
					dok=obj	
				end					
		end
	end
	if cnt == 0 then
		news_manager.send_tip(db.actor, "We can't find anything about classified documents number five... no clue where they are, we need a much more expensive search. Come on over, we can make a deal.", nil, "flash", 29000)
		return
	end
	if cnt > 0 then
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(dok.m_game_vertex_id):level_id()), vector():set(dok.position.x,dok.position.y,dok.position.z))
		news_manager.send_tip(db.actor, "Informant: About the search for secret documents number 5 - we have information about the location. "..pos.." ", nil, "flash", 29000)
		return
	end
end

-- 6  -------------------------------------------
function navodka_jurnal_6_high()
	olr_timers.st_timer("navodka_jurnal_6_high", 2125, "nick.navodka_jurnal_finded_high_6()")
end

function navodka_jurnal_finded_high_6()
	news_manager.send_tip(db.actor, "Come on in. I have some documents for you.", nil, "flash", 29000)
	olr.info("navodka_jurnal_finded_high_6")
end

function navodka_jurnal_6()
	olr_timers.st_timer("navodka_jurnal_6", 1994, "nick.navodka_jurnal_finded_6()")
end
function navodka_jurnal_finded_6()
	local dok = nil
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "jornal_6"
				then
					cnt=cnt+1
					dok=obj	
				end					
		end
	end
	if cnt == 0 then
		news_manager.send_tip(db.actor, "Informant: About the search for classified documents #6 - we couldn't find anything... no clue where they are, we need a much more expensive search. Come on over, we can make a deal.", nil, "flash", 29000)
		return
	end
	if cnt > 0 then
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(dok.m_game_vertex_id):level_id()), vector():set(dok.position.x,dok.position.y,dok.position.z))
		news_manager.send_tip(db.actor, "Informant: About the search for secret document number 6, we have a location. "..pos.." ", nil, "flash", 29000)
		return
	end
end


----------------------------------------------------------------------------------------








function ded_pomeraet_yan()
	olr.snd([[ol3\koan\sfx_demo1]])
	db.actor:give_info_portion("otpravlaet_spat_gg_done")
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\pm_shoot]])
	if not snd_obj:playing() then 
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
	end
for i=1, 65534 do
local car = level.object_by_id(i)
if car then
if car ~= nil and 
car:name() == "lvl7_yantar_stalker_sakharov" then
local h = hit ()
h.power = 100000
h.direction = vector():set (0, -1, 0)
h.impulse = 0
h.draftsman = car
h.type = hit.strike
car:hit (h)
end
end
end
  local se_obj = alife():object("lvl7_yantar_stalker_sakharov")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl7_yantar_physic_object_0673")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function add_vibr_tmer_yanzam()
	olr.blow_add(300)
	local wait_time = 0
  	wait_time = time_global() + 10000
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.snd([[ol3\koan\SlowWhoosh3-m]]) end
  	)
end


function clead_dead_sin()
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and IsStalker(kill) then
                if not kill:alive() and kill.level_name == "lvl9_military" then
		if kill:community() == "sin" then
		sim:release(kill)
		end
		end
		end
	end


	olr.del_by_name("lvl9_military_physic_object_0406")
	olr.del_by_name("lvl9_military_big_safe_box")
	olr.del_by_name("lvl9_military_physic_object_0341")
	olr.del_by_name("lvl9_military_physic_object_0217")


local se_obj = alife():object("military_spawn_rest_one_0000") 
local sobj = alife():object("mil_plennny_stalker_0027") 
if sobj then  
--olr.kill_offline_stalker(sobj)
alife():teleport_object(sobj.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
end

local sobj = alife():object("mil_plennny_stalker_0000") 
if sobj then  
--olr.kill_offline_stalker(sobj)
alife():teleport_object(sobj.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
end

local sobj = alife():object("mil_plennny_stalker_0001") 
if sobj then  
--olr.kill_offline_stalker(sobj)
alife():teleport_object(sobj.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
end
end

function chekart_belt()
	local art = nil
	local ini = system_ini()
	local artcnt = 0
	for i = 0, db.actor:belt_count() - 1 do
    		local item = db.actor:item_on_belt(i)
                if item and item:is_artefact() and item:section() ~= "af_jabiy_glaz_garbage" and item:section() ~= "af_jabiy_glaz_garbage" and item:section() ~= "af_dezintegrator_m1" 
				and item:section() ~= "af_dummy_dummy_q1"
				and item:section() ~= "af_magnet_drop_q2"
				and item:section() ~= "af_magnet_drop_q1"
				and item:section() ~= "af_studen_m1"
				and item:section() ~= "art_mil_jaba"
				and item:section() ~= "exo_acum_ob"
				and item:section() ~= "af_random_zakaz"
				and item:section() ~= "af_banka_s_holodcom"
				and item:section() ~= "af_compas"
				and item:section() ~= "af_dezintegrator_m2" then
				--log1("fdsfsd223 "..item:section().."" )
				artcnt=artcnt+1
				art = item
		end
	end
	if artcnt > 1 then
		local m_where = "You have to put only one artifact on your belt... Scanning interference..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		return
	end
	if artcnt == 0 then
		local m_where = "Not detecting the presence of artifacts on your belt..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		return
	end
	if artcnt == 1 then
		local known_inf = ini:r_string(art:section(), "known_info")
		local known_inf_desc = game.translate_string(known_inf)
		if has_alife_info(known_inf_desc) then
			local m_where = "Alright. the scan's starting to freeze. Hmm. it looks like you already have a description of the artifact in question..."
			db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
			return
		end
		local m_where = "Great... measurement is up. Here's the information about this type of artifact..."
		olr.info(known_inf_desc)
		news_manager.send_tip(db.actor, "The money given is 250.", nil, "money", 39000)
		db.actor:give_money(-250)
		game_stats.money_quest_update(-250)
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		return
	end
	local m_where = "Hmm... some kind of glitch... something is causing interference on your artifact belt..."
	db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
end


function zaradka_battery_exo()
	local art = nil
	local ini = system_ini()
	local artcnt = 0
	for i = 0, db.actor:belt_count() - 1 do
    		local item = db.actor:item_on_belt(i)
                if item and item:section() == "exo_acum_ob" then
			artcnt=artcnt+1
			art = item
		end
	end
	if artcnt == 0 then
		local m_where = "Where's the battery on the belt...?"
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		return
	end
	if artcnt == 1 then
		local m_where = "Oh, good. It's charging. I think that's it."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		news_manager.send_tip(db.actor, "The money is 150.", nil, "money", 39000)
		db.actor:give_money(-150)
		game_stats.money_quest_update(-150)
		art:set_condition(1)
		return
	end
	local m_where = "Hmm. there's a glitch. "
	db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
end



function conserva_sciet_food_hmm()
	news_manager.send_tip(db.actor, "Hmm. Maybe we should talk to the merchants about such a large shipment... Maybe Toad can help with this order...", 8, "act", 29000)	
end

function has_psy_shapka_proto_rostok()
     return nik_dialog.item_much("psy_shapka_proto_rostok",1) ~= false 
end


function psy_shapka_proto_rostok_otdaem()
	news_manager.send_tip(db.actor, "Money received - 900.", nil, "money", 39000)
	db.actor:give_money(900)
	game_stats.money_quest_update(900)
	nik_dialog.out_item_much("psy_shapka_proto_rostok",1)
	olr.give_item("item_razradnik")
end

function mony_pisot_krassov()
	news_manager.send_tip(db.actor, "Money received-- 500.", nil, "money", 39000)
	db.actor:give_money(500)
	game_stats.money_quest_update(500)
	olr.give_item("antirad")
	olr.give_item("medkit_army")
	olr.give_item("item_razradnik")
end


function ty_norm_ne_done_try_sps()
if has_alife_info("sps_bolot_mil_zomb") then
return
end
olr.info("sps_bolot_mil_zomb")
local rnd = math.random(1,2)
if rnd == 1 then
	olr_timers.st_timer("ty_norm_ne_done_try_spsgo", 473, "nick.ty_norm_ne_done_try_spsgo()")
else
	olr_timers.st_timer("ty_norm_ne_done_try_spsgo_art", 473, "nick.ty_norm_ne_done_try_spsgo_art()")
end
end

function ty_norm_ne_done_try_spsgo_art()
	news_manager.send_tip(db.actor, "Messer... Thanks again for helping me out back in Silent Hills... I just remembered something, some information. I heard at the psycho base. Take this as a thank you.", nil, "zombied", 29000)
	olr.info("encyclopedy_zone_artifact_af-dummy-glassbeads")
	olr.del_by_name("lvl9_military_stalker_0027")
	news_manager.send_tip(db.actor, "Information received on artifact: Dead Head.", 6, "default", 9000)
end

function ty_norm_ne_done_try_spsgo()
	olr.del_by_name("lvl9_military_stalker_0027")
	news_manager.send_tip(db.actor, "Messer. Thanks again for helping me out back in the Silent Hills...", nil, "zombied", 29000)	
end

function have_barprison_doc()
     return nik_dialog.item_much("bar_under_prison_doc",1) ~= false 
end


function has_brothers_talked()
     return has_alife_info("dolina_killer_dolg_escape_done_krav_have") and has_alife_info("dolina_killer_dolg_escape_done_brat_have")
end



function infa_voenstals()
	news_manager.send_tip(db.actor, "Information has surfaced here, from those in the know... Military stalkers are looking for a man. from some kind of death truck. Supposedly they've got an order for him. Strange things are happening.", nil, "default", 99000)
end


function out_diagnostica_bolezney()
	olr.info("diagnostica_bolezney_dolg_started")
	level.add_pp_effector("black.ppe", 20131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
	local tmr = math.random(120,340)
	olr_timers.st_timer("diagnostica_bolezney", tmr, "nick.diagnostica_bolezney_tmr()")
end

function diagnostica_bolezney_tmr()
	db.actor:disable_info_portion("diagnostica_bolezney_dolg_started")
	news_manager.send_tip(db.actor, "Come in, we've got the test results. Parasites-- "..olr_items_efs.get_paras().."rabies-- "..olr_items_efs.get_besh().."rat madness-- "..olr_items_efs.get_ratbezum().."Anthrax-- "..olr_items_efs.get_sibyazva().."zombification-- "..olr_items_efs.get_zombied().."  ", nil, "dolg", 59000)
end





function otdaem_device_pda_jan_one(first_speaker, second_speaker)
nik_dialog.out_item_much("device_pda_jan_one",1)
dialogs.relocate_money(first_speaker, 450, "in")
end
function precond_device_pda_jan_one()
     return nik_dialog.item_much("device_pda_jan_one",1) ~= false 
end



function otdaem_device_pda_jan_two(first_speaker, second_speaker)
nik_dialog.out_item_much("device_pda_jan_two",1)
dialogs.relocate_money(first_speaker, 450, "in")
end
function precond_device_pda_jan_two()
     return nik_dialog.item_much("device_pda_jan_two",1) ~= false 
end



function otdaem_device_pda_jan_tri(first_speaker, second_speaker)
nik_dialog.out_item_much("device_pda_jan_tri",1)
dialogs.relocate_money(first_speaker, 450, "in")
end
function precond_device_pda_jan_tri()
     return nik_dialog.item_much("device_pda_jan_tri",1) ~= false 
end



function otdaem_pda_ecol_dolina(first_speaker, second_speaker)
nik_dialog.out_item_much("pda_ecol_dolina",1)
dialogs.relocate_money(first_speaker, 650, "in")
olr.give_item("medkit")
end
function precond_pda_ecol_dolina()
     return nik_dialog.item_much("pda_ecol_dolina",1) ~= false 
end



function otdaem_device_pda_majors(first_speaker, second_speaker)
nik_dialog.out_item_much("device_pda_majors",1)
dialogs.relocate_money(first_speaker, 650, "in")
olr.give_item("medkit")
end
function precond_device_pda_majors()
     return nik_dialog.item_much("device_pda_majors",1) ~= false 
end



function otdaem_scintific_pda_military(first_speaker, second_speaker)
nik_dialog.out_item_much("scintific_pda_military",1)
dialogs.relocate_money(first_speaker, 250, "in")
olr.give_item("antirad")
end
function precond_scintific_pda_military()
     return nik_dialog.item_much("scintific_pda_military",1) ~= false 
end


function otdaem_ros_korpus_pass(first_speaker, second_speaker)
nik_dialog.out_item_much("ros_korpus_pass",1)
dialogs.relocate_money(first_speaker, 350, "in")
end
function precond_ros_korpus_pass()
     return nik_dialog.item_much("ros_korpus_pass",1) ~= false 
end


function otdaem_esc_vishka_dnevnik(first_speaker, second_speaker)
nik_dialog.out_item_much("esc_vishka_dnevnik",1)
dialogs.relocate_money(first_speaker, 250, "in")
end
function precond_esc_vishka_dnevnik()
     return nik_dialog.item_much("esc_vishka_dnevnik",1) ~= false 
end


function otdaem_radar_kompleks_doki(first_speaker, second_speaker)
nik_dialog.out_item_much("radar_kompleks_doki",1)
dialogs.relocate_money(first_speaker, 950, "in")
end
function precond_radar_kompleks_doki()
     return nik_dialog.item_much("radar_kompleks_doki",1) ~= false 
end


function otdaem_dolina_prelaba_doki(first_speaker, second_speaker)
nik_dialog.out_item_much("dolina_prelaba_doki",1)
dialogs.relocate_money(first_speaker, 550, "in")
end
function precond_dolina_prelaba_doki()
     return nik_dialog.item_much("dolina_prelaba_doki",1) ~= false 
end


function otdaem_yantar_mozg_doki(first_speaker, second_speaker)
nik_dialog.out_item_much("yantar_mozg_doki",1)
dialogs.relocate_money(first_speaker, 1250, "in")
end
function precond_yantar_mozg_doki()
     return nik_dialog.item_much("yantar_mozg_doki",1) ~= false 
end



function otdaem_mg_zombie_dnevnik_dead(first_speaker, second_speaker)
nik_dialog.out_item_much("mg_zombie_dnevnik_dead",1)
dialogs.relocate_money(first_speaker, 250, "in")
end
function precond_mg_zombie_dnevnik_dead()
     return nik_dialog.item_much("mg_zombie_dnevnik_dead",1) ~= false 
end



function otdaem_mg_monolitovec_doki(first_speaker, second_speaker)
nik_dialog.out_item_much("mg_monolitovec_doki",1)
dialogs.relocate_money(first_speaker, 550, "in")
end
function precond_mg_monolitovec_doki()
     return nik_dialog.item_much("mg_monolitovec_doki",1) ~= false 
end



function otdaem_killers_deadscient_doc(first_speaker, second_speaker)
nik_dialog.out_item_much("killers_deadscient_doc",1)
dialogs.relocate_money(first_speaker, 450, "in")
end
function precond_killers_deadscient_doc()
     return nik_dialog.item_much("killers_deadscient_doc",1) ~= false 
end


function otdaem_device_pda_last_day(first_speaker, second_speaker)
nik_dialog.out_item_much("device_pda_last_day",1)
dialogs.relocate_money(first_speaker, 750, "in")
end
function precond_device_pda_last_day()
     return nik_dialog.item_much("device_pda_last_day",1) ~= false 
end


function otdaem_jurn_plen_mesage(first_speaker, second_speaker)
nik_dialog.out_item_much("jurn_plen_mesage",1)
dialogs.relocate_money(first_speaker, 550, "in")
end
function precond_jurn_plen_mesage()
     return nik_dialog.item_much("jurn_plen_mesage",1) ~= false 
end


function otdaem_city_fake_dnevnik(first_speaker, second_speaker)
nik_dialog.out_item_much("city_fake_dnevnik",1)
dialogs.relocate_money(first_speaker, 950, "in")
end
function precond_city_fake_dnevnik()
     return nik_dialog.item_much("city_fake_dnevnik",1) ~= false 
end




function otdaem_ros_seif_zap_2(first_speaker, second_speaker)
nik_dialog.out_item_much("ros_seif_zap_2",1)
dialogs.relocate_money(first_speaker, 350, "in")
end
function precond_ros_seif_zap_2()
     return nik_dialog.item_much("ros_seif_zap_2",1) ~= false 
end


function otdaem_ros_seif_zap_1(first_speaker, second_speaker)
nik_dialog.out_item_much("ros_seif_zap_1",1)
dialogs.relocate_money(first_speaker, 350, "in")
end
function precond_ros_seif_zap_1()
     return nik_dialog.item_much("ros_seif_zap_1",1) ~= false 
end


function otdaem_zap_killera_jurn_zap(first_speaker, second_speaker)
nik_dialog.out_item_much("zap_killera_jurn_zap",1)
dialogs.relocate_money(first_speaker, 450, "in")
end
function precond_zap_killera_jurn_zap()
     return nik_dialog.item_much("zap_killera_jurn_zap",1) ~= false 
end



function otdaem_zombied_pda_dezintegr(first_speaker, second_speaker)
nik_dialog.out_item_much("zombied_pda_dezintegr",1)
dialogs.relocate_money(first_speaker, 550, "in")
end
function precond_zombied_pda_dezintegr()
     return nik_dialog.item_much("zombied_pda_dezintegr",1) ~= false 
end




function otdaem_bar_journalist_dnevnik(first_speaker, second_speaker)
nik_dialog.out_item_much("bar_journalist_dnevnik",1)
dialogs.relocate_money(first_speaker, 250, "in")
end
function precond_bar_journalist_dnevnik()
     return nik_dialog.item_much("bar_journalist_dnevnik",1) ~= false 
end


function otdaem_doki_agro_dyatel(first_speaker, second_speaker)
nik_dialog.out_item_much("doki_agro_dyatel",1)
dialogs.relocate_money(first_speaker, 250, "in")
end
function precond_doki_agro_dyatel()
     return nik_dialog.item_much("doki_agro_dyatel",1) ~= false 
end



function otdaem_gar_postroika_dnevnik(first_speaker, second_speaker)
nik_dialog.out_item_much("gar_postroika_dnevnik",1)
dialogs.relocate_money(first_speaker, 250, "in")
end
function precond_gar_postroika_dnevnik()
     return nik_dialog.item_much("gar_postroika_dnevnik",1) ~= false 
end





function has_ratlab_doki()
     return nik_dialog.item_much("ratlab_doki_jaba",1) ~= false and has_alife_info("ratlab_door_open")
end

function ratlab_strt_done()
	local sobj = alife():object("lvl2_garbage_physic_object_0118") 
	if sobj then  
		level.map_remove_object_spot(sobj.id, "crlc_mdl")
	end
	nik_dialog.out_item_much("ratlab_doki_jaba",1)
	nik_dialog.out_item_much("radlab_key_door",1)
	news_manager.send_tip(db.actor, "We got the money-- 1,200.", nil, "money", 39000)
	db.actor:give_money(1200)
	game_stats.money_quest_update(1200)
end


function ratlab_strt_onln()
	olr.to_online("lvl2_garbage_box_rukzak_treasure_0004")
	local sp1_place = alife():object("lvl2_garbage_physic_object_0118")
	if sp1_place then
		olr.add_spot_on_map( sp1_place.id,"crlc_mdl", "The place where the scientists took the measurements." )
	end
	news_manager.send_tip(db.actor, "Anyway. if you manage to get in, and if you find anything interesting under the Garbage, then bring it to me as usual, I'll give you a reward.", 15, "trader", 29000)
end

function jaba_rat_lowlevels() -- старт квеста на нижние уровни
	news_manager.send_tip(db.actor, "Hey! Come on in, we need to talk. about the dungeons.", nil, "trader", 29000)
	olr.info("ratlab_strt")
end



function has_biolab_start_money()
	if xvars.meat_money > 0 then
		return true
	else
		return false
	end
end

function money_obrazcy_give(obj,act)
	local mgive = tonumber(xvars.meat_money)
	m_where = "Okay. It's about money. "..mgive.." in rubles. Here, take it."
	db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	db.actor:give_money(mgive)
	game_stats.money_quest_update(mgive)
	xvars.meat_money = 0
	return
end

function kamaz_priehal_savk()
	if olr.obj_in_zone("lvl9_militar_kam_quest_kordon","lvl1_escape_blow_hide_restr_0006") then
		return true
	else
		return false
	end
end

function kanistra_savkin()
	olr.give_item("kanistra_benz")
	olr.give_item("kanistra_benz")
	news_manager.send_tip(db.actor, "Don't forget, the truck must be driven to the checkpoint at the Cordon factory. Our civilian man should be waiting there, he'll drive it further to the Big Land.", 15, "ecolog", 29000)
end

function kamaz_priehal_kordon_sav()
	log1("aa 51")
	db.actor:set_actor_position(vector():set(271,14,18))
	log1("aa 52")
	db.actor:set_actor_position(vector():set(271,14,18))
	get_console():execute("flush")
	local wait_time = 0
  	wait_time = time_global() + 500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() db.actor:set_actor_position(vector():set(271,14,18)) end
  	)
	olr_timers.st_timer("tepel_act_kamaz", 1, "nick.tepel_act_kamaz()")
	log1("aa 1")
	get_console():execute("flush")
	log1("aa 2")
	get_console():execute("flush")
	news_manager.send_tip(db.actor, "Are you there? Well done. give me the keys, I'll take it from here.", 3, "default", 29000)
	local wait_time = 0
  	wait_time = time_global() + 2500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl9_militar_kam_quest_kordon") end
  	)
	log1("aa 3")
	get_console():execute("flush")
	local wait_time = 0
  	wait_time = time_global() + 30000
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl1_escape_m_car_bigzemlya") end
  	)
	log1("aa 4")
	get_console():execute("flush")
	olr.snd([[ol3\koan\v_car_idle]])
	level.add_pp_effector("black.ppe", 20131, false)
end

function tepel_act_kamaz()
	db.actor:detach_vehicle()
	db.actor:set_actor_position(vector():set(271,14,18))
end

function dialog_parasite_actor()
	if olr_timers.has_timer("bolezn_parasite_timer_m") or olr_timers.has_timer("bolezn_parasite_timer_d") then
		return true
	else
		return false
	end
end

function ratcat_digger_cheked()
	olr.del_by_name("lvl_rat_staler_undead_olr_0000")
	news_manager.send_tip(db.actor, "And here's the rubble. I guess we'll have to dismantle it. It's an interesting place, I'm sure we'll find something valuable. I'll have to tell Toad what I saw. Maybe he'll give me something.", nil, "act", 39000)
end

function clear_zavar_gar_rat()
	olr.del_by_name("lvl_rat_staler_undead_olr_0000") 
	olr.del_by_name("ratnew_zaval_ph")
	olr.del_by_name("ratnew_zaval_ph_0000")
	olr.del_by_name("ratnew_zaval_ph_0001")
	olr.del_by_name("ratnew_zaval_ph_0002")
	olr.del_by_name("ratnew_zaval_ph_0003")
	olr.del_by_name("ratnew_zaval_ph_0004")
	olr.del_by_name("ratnew_zaval_ph_0005")
	olr.del_by_name("ratnew_zaval_ph_0006")
	olr.del_by_name("ratnew_zaval_ph_0007") 
	olr.del_by_name("lvl_rat_psy_to_new")
	if has_alife_info("dialog_ratcat_digger_jaba_done") then
		olr_timers.st_timer("jaba_zavali_off", 455, "nick.jaba_zavali_off()")
	end
	olr_timers.st_timer("jaba_rat_lowlevels", 1473, "nick.jaba_rat_lowlevels()") 
end


function create_detector_esc_zavod()
	local bloodbridge = vector():set( 105.76, 13.17, -45.00 )
	local obj = alife():create("detector_simple", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	clear_useful_for_ai(obj)
end


function set_level_choosen_zombied(level)
local montabl = 
{
       [clsid.script_stalker] = true
}
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if montabl[kill:clsid()]  then
                if kill:alive() and kill:community() ~= "neutral" then
		if kill.level_name == level then 

		olr.kill_offline_stalker(kill)

		local rnd = math.random(1,5)
		if rnd == 1 then
			alife():create("m_zombie_e", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		elseif rnd == 2 then
			alife():create("zombie_weak", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		elseif rnd == 3 then
			alife():create("zombie_strong", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		end
                --news_manager.send_tip(db.actor, "УМИРАЕТ "..kill:name().." у", nil, "freedom", 9000)
end              
end
end
end
end

end

function pre_aes_antenna_upravlenie()
	olr.beep()
	olr.snd([[ol3\koan\DA-2_anom1_loop]])
	news_manager.send_tip(db.actor, "Security system: Unable to disable emitter. Headquarters directive. Use the plant control terminal.", nil, "unknown", 39000)
	news_manager.send_tip(db.actor, "Warning! Adjusting the antenna to a different radiation sector can damage the transmitter! Contact the chief engineer!", 5, "unknown", 39000)
end


function sim_informator_lastnews(obj,act)
	local sim = alife()
	local tab = news_main.news_stack
	local tabraz = #tab
	if tabraz == 0 then
		local m_where = "Data is still being updated, come back later..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		return
	end
	for k,v in pairs(tab) do
		local npc_name = ""
		local textn = v.text
		if v.author_id == nil then
			local m_where = "Data retrieval error, come back later..."
			db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
			return
		end
		if textn == nil then
			local m_where = "Hmm, data reception error, come back later..."
			db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
			return
		end
		local sobj = sim:object(v.author_id)
		local pk = get_netpk(sobj,1)
  		if pk:isOk() then
			local data = pk:get()
          		npc_name = data.character_name
		end
		if textn ~= "" and npc_name ~= "" then
			db.actor:give_talk_message(""..npc_name.." - "..textn.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
			return
		else
			local m_where = "No news yet, come back later..."
			db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
			return
		end
	end
end


function sim_npc_lastnews(obj,act)
	if xvars.npc_seeing_news[obj:name()] ~= nil then
		m_where = tostring(xvars.npc_seeing_news[obj:name()])
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		xvars.npc_seeing_news[obj:name()] = nil
		return
	end
	local m_where = "I don't know anything."
	db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	local _s = CUIStatic();
	local bos = level.object_by_id(level.get_second_talker():id())
	_s:InitTexture(bos:character_icon())
	local str = m_where
	local who = bos:character_name()		
	db.actor:add_answer_news(game.translate_string(who), game.translate_string(str), bos:character_icon(), _s:GetOriginalRect())
end


function sim_npc_mainquest(obj,act)
	if xvars.npcs_tasks[obj:name()] == "find_monolit" then
		m_where = "Did you hear about the legend of the monolith? That's what I've heard too. Somehow I think there's something to it. I'm sure there's something to all these rumors. So. maybe we can really get to him."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	if xvars.npcs_tasks[obj:name()] == "reason_zone" then
		m_where = "I'll be blunt. I want to find the cause of the Zone and make it disappear. I think it's necessary to stop the spread of all this contagion... for if not me, then who?"
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	if xvars.npcs_tasks[obj:name()] == "revenge" then
		m_where = "I have an old score to settle. from before the Zone. So I found out that an old acquaintance of mine is also here... I won't say anything more about it."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	if xvars.npcs_tasks[obj:name()] == "cash" then
		m_where = "What do you think? Of course, money! What else is there to do here? I don't understand scientists who come here for an idea..."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	if xvars.npcs_tasks[obj:name()] == "tourism" then
		m_where = "I'm here as a tourist, so to speak. This place is truly unique in the world, I think there's nowhere else in the world with the adrenaline like here. You know?"
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	if xvars.npcs_tasks[obj:name()] == "find_himself" then
		m_where = "I ran away here to try to figure things out for myself. Maybe rediscover the value of life. who knows?"
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	if xvars.npcs_tasks[obj:name()] == "escape_in_zone" then
		m_where = "What's your interest? You wouldn't happen to be law enforcement, would you? Let's just part ways, man."
		db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
		this.save_dial_zel(m_where)
		return
	end
	m_where = "None of your business, fuck off..."
	db.actor:give_talk_message(""..m_where.."", "ui\\ui_iconstotal", Frect():set(0,0,10,10), "simple_answer_item")
	this.save_dial_zel(m_where)
end

function save_dial_zel(m_where)
	local _s = CUIStatic();
	local bos = level.object_by_id(level.get_second_talker():id())
	_s:InitTexture(bos:character_icon())
	local str = m_where
	local who = bos:character_name()		
	db.actor:add_answer_news(game.translate_string(who), game.translate_string(str), bos:character_icon(), _s:GetOriginalRect())
end

function has_smertlampa_swamp()
	return nik_dialog.item_much("af_art_lampa",1) ~= false and has_alife_info("has_lamp_swapm")
end

function otdaem_smert_lamp_swamp()
	news_manager.send_tip(db.actor, "Money received - 1100", nil, "money", 39000)
	db.actor:give_money(1100)
	game_stats.money_quest_update(1100)
	nik_dialog.out_item_much("af_art_lampa",1)
end

function deadcity_izlom_about()
	local sp1_place = alife():object("lvl11_deadcity_m_fracture_e")
	if sp1_place then
		olr.add_spot_on_map( sp1_place.id,"crlc_mdl", "A message came from here from an unknown person..." )
		news_manager.send_tip(db.actor, "I know you were looking for the Journalist. Go to a house in the center of town, I can help you...", nil, "unknown", 39000)
	end
end


function spawn_mons_rozd_sarco()
local sectionsa = 
{ 
"karlik",
"karlito",
"m_bloodsucker_e",
"bloodsucker_proto",
"m_zombie_e",
"zombie_blue", 
"poltergeist_build"
}


local count = math.random(20,60) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)

end
end


function podzem_sosatel_deadd()
	level.add_pp_effector("black.ppe", 20131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[monsters\bloodsucker\eat_0]])
	local snd_obj2 = xr_sound.get_safe_sound_object([[monsters\bloodsucker\eat_1]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_cam_effector2("camera_effects\\blood_suk_tennel_eating.anm", 30, false, "")
	local wait_time = 0
  	wait_time = time_global() + 5400
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() snd_obj2:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0) end
  	)
	olr.off_ui()
	olr_timers.st_timer("jaba_rat_lowlevels", 9, "olr.on_ui()") 
end

function plosadka_sosatel_deadd()
	olr.del_by_name("lvl5_bar_physic_object_0603")
	db.actor:set_actor_position(vector():set(-13,-40,-72))
	olr_timers.st_timer("jaba_rat_lowlevels", 36, "olr.on_ui()") 
	local snd_obj = xr_sound.get_safe_sound_object([[monsters\bloodsucker\idle_3]])
	local snd_obj2 = xr_sound.get_safe_sound_object([[monsters\bloodsucker\idle_3]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_cam_effector2("camera_effects\\blood_suk_tennel_go.anm", 30, false, "")
	olr.off_ui()
	local wait_time = 0
  	wait_time = time_global() + 1400
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl6_rostok_bloodsucker_strong_0003") end
  	)
	local wait_time = 0
  	wait_time = time_global() + 5400
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() snd_obj2:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0) end
  	)
	olr.kill_mon_in_radius(db.actor:position(), 50)
end

function flying_corpses()
	olr.snd([[ol3\koan\ew_gusty_over1]])
	for k,v in pairs(db.storage) do
        local stalker = level.object_by_id(k)
            	if stalker and (get_clsid(stalker)==clsid.script_stalker) and not stalker:alive() then
			local bone = stalker:get_physics_shell()
			if bone then
				bone:disable_collision()  
			end
		for i = 0, bone:get_elements_number() - 1 do       
           	local e = bone:get_element_by_order(i)
           	if e then
			bone:disable_collision()  
			local b = bone:get_element_by_bone_id(math.random(0,2))
			b:apply_force(0, math.random(10000,25000), 0) 
			local wait_time = 0
  			wait_time = time_global() + 400
  			level.add_call(
    			function() return time_global() > wait_time end,
    			function() e:fix() end
  			)
           	end 
			if bone then
				bone:disable_collision()  
			end             
		end

		end
	end
end

function actor_robbered_timer_sms()
	news_manager.send_tip(db.actor, "Huh. some cad is sleeping in the open air, having his tenth dream. He's also a drunk, I think. So he shared his loot with me.", nil, "unknown", 39000)	
end

function zombu_ressurect(victim,who)
	if level.name() == "lvl14_stancia" or level.name() == "lvl1_escape" or level.name() == "lvl5_bar" or level.name() == "lvl16_generators" then
		return
	end 
	local id = tostring(victim:id())
	local tmr = math.random(20,40)
	local rtmr = math.random(1,2)
	if rtmr == 1 then
		olr_timers.st_timer("zombu_ressurect", tmr, "nick.zombu_ressurect_tmr("..id..")")
	end	
end

function zombu_ressurect_tmr(id)
	local sobj = alife():object(id)
  	if sobj then
		local npc = level.object_by_id(id)
		if npc:position():distance_to(db.actor:position()) < 10 then
			return
		end
		if olr_protected.is_no_offline_alife_obj(npc:name()) then
			return
		end
		if db.actor:see_right_now(npc) then
			return
		end
		local sec = sobj:section_name()
		local strz = tostring(sec)
		local zom = alife():create(strz, sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id)
		local wait_time = 0
  		wait_time = time_global() + 500
  		level.add_call(
    			function() return time_global() > wait_time end,
    			function() olr.del_by_name(sobj:name()) end
  		)
	end
end

function gen_del_accil_timer()
	for i = 1, 100000 do
    		level.remove_pp_effector(i)
    		level.remove_cam_effector(i)
	end
	olr.del_by_name("lvl16_generators_space_restrictor_0023")
	olr.del_by_name("genpart_sertr_0000")
	olr.del_by_name("genpart_sertr_0001")
	olr.del_by_name("genpart_sertr_0002")
	olr.del_by_name("genpart_sertr_0003")
        level.add_pp_effector("black.ppe", 20131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\gen_ecolog_talk]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("tojaba", 3, "nick.gen_ecologs_talkerd()")  
	olr_timers.st_timer("tojabaf", 3, "nick.teleojabagen()") 
end

function gen_ecologs_talkerd()	
	olr.info("gen_ecs_talkedd")
end

function teleojabagen()
        level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("gen_esc_pre_last_walk")
	local look = patrol("gen_esc_pre_last_walk")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end


function final_cutscene_start_two()  -- площадка
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\thunder_2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_cam_effector2("camera_effects\\ending_two.anm", 30, false, "nick.final_cutscene_start_tri")
end

function final_cutscene_start_tri()  -- бараки
	level.add_cam_effector2("camera_effects\\ending_two.anm", 30, false, "nick.final_cutscene_start_four")
end

function final_cutscene_start_four() -- каморка
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\thunder_1]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_cam_effector2("camera_effects\\ending_tri.anm", 30, false, "nick.final_cutscene_start_end")
	-- верт звук
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\helicopter_end]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function final_cutscene_start_end()
        level.add_pp_effector("black.ppe", 20131, false)
	news_manager.send_tip(db.actor, "He's here!", 2, "ecolog", 39000)
	olr_timers.st_timer("darkkk", 1, "nick.darkscreen()")
	olr_timers.st_timer("darkkk", 2, "nick.darkscreen()")
	olr_timers.st_timer("darkkk", 3, "nick.darkscreen()")
	olr_timers.st_timer("darkkk", 4, "nick.darkscreen()")
	olr_timers.st_timer("darkkk", 5, "nick.edning_tv()")
end

function darkscreen()
        level.add_pp_effector("black.ppe", 20131, false)
end

function edning_tv()
	if not has_alife_info("start_freeplay_olr") then
	olr.info("start_freeplay_olr")
	get_console():execute("save olr_freeplay_start")
	nick.in_head_shelk()
	game.start_tutorial("mov_blokpost_endgame")
	end
end

function gen_prisli_kdverin()
	nick.enable_senf()
	news_manager.send_tip(db.actor, "They seem to be here. but it looks like the door's locked. Maybe the code is in here somewhere. Or maybe you have some notes?", nil, "default", 39000)
	if has_alife_info("glaz_fila_checked") then
		news_manager.send_tip(db.actor, "Need to check the PDA, there might be something...", 11, "act", 39000)
	end
end


function gen_spawn_psy_paparnik_to_warlab()
	olr_timers.st_timer("killudveri", 5, "nick.killudveri()")
	if has_alife_info("gener_fil_go_to_door") then -- фил
	local se_obj = alife():object("lvl16_generators_space_restrictor_0021")
	local montabl = 
	{
       		[clsid.script_stalker] = true
	}
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                	if montabl[kill:clsid()]  then     
				if kill:name() == "lvl16_generators_staler_undead_olr" then
					alife():teleport_object(kill.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
				end
			end
		end
	end
	end
end


function killudveri()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	for i=1, 65534 do
	local car = level.object_by_id(i)
		if car then
			if car ~= nil and 
				car:name() == "lvl16_generators_staler_undead_olr" then
				local h = hit ()
				h.power = 1000
				h.direction = vector():set (0, 0, 0)
				h.impulse = 0.1
				h.draftsman = car
				h.type = hit.strike
				car:hit (h)
			end
		end
	end
end


function gen_spawn_psy_paparnik()
	if has_alife_info("gener_fil_go_to_door") then -- фил
	local se_obj = alife():object("lvl16_generators_space_restrictor_0046")
	local montabl = 
	{
       		[clsid.script_stalker] = true
	}
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                	if montabl[kill:clsid()]  then     
				if kill:name() == "lvl16_generators_staler_undead_olr" then        
                			--olr.add_spot_on_map( kill.id,"jaba_spotmap",kill:name() )
					alife():teleport_object(kill.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
				end
			end
		end
	end
	end
end


function chaes_1_sms()

	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Strelok, come in. Are you at the power plant yet? This is, uh. better meet me, I'm here, too. Well, behind it, actually. In an area with some kind of generators. Waiting.".."".."\n", nil, "default", 30000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_news]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)

	news_manager.send_tip(db.actor, "Hmm. Who could that be? ", 8, "act", 29000)	

	local bsobj = alife():object("lvl16_generators_staler_undead_olr") 
	if bsobj then
		alife():create("wpn_sv17", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id)
		alife():create_ammo("ammo_gauss", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
	end

	-- фил
	if has_alife_info("fil_boloto_dialog_done") then
	local sobj = alife():object("lvl16_generators_staler_undead_olr") 
	if sobj then 
	log1("1f")
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\novice\green_stalker_7]]
    			data.visual_name = vis
          		data.character_name = "Phil."
      			pk:set( data )
		end	
	end
		return
	end

	-- тёмный сталкер
	if has_alife_info("mg_ds_now_done") then
	local sobj = alife():object("lvl16_generators_staler_undead_olr") 
	if sobj then
	log1("2f") 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\dark_stalker]]
    			data.visual_name = vis
          		data.character_name = "A dark stalker."
      			pk:set( data )
		end	
	end
		return
	end

	-- хмырь (дефаулт)
	local sobj = alife():object("lvl16_generators_staler_undead_olr") 
	if sobj then 
	log1("1h")
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\hmir_bar]]
    			data.visual_name = vis
          		data.character_name = "Chrom."
      			pk:set( data )
		end	
	end
end

function has_two_batony()
     return nik_dialog.item_much("bread",2) ~= false 
end

function fix_rostok_slizni_weapons()
	--news_manager.send_tip(db.actor, "ФИКС ОРУЖИЯ СЛИЗНЕЙ", nil, "freedom", 39000)
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 100 and npc:character_community() == "sliznyaki" then  
			npc:iterate_inventory(
			function(npc, obj) 
			if obj and obj:is_weapon_magazined() then
				npc:drop_item(obj)
				olr.del(obj)
			end
			--local wpn = bos:best_weapon()
			--if wpn then
			--	wpn:set_ammo_elapsed(5)
			--end
			end
			, npc)
		end
	end
end

function del_kamaz_questmono()
	olr.del_by_name("lvl7_dcccdewry_m_car_0000")
	news_manager.send_tip(db.actor, "Chrom: Everyone pay more attention to the road from the swamps. Now we've knocked the fanatics out of there, but there's no guarantee they won't show up again...", 42, "freedom", 39000)
end

function yan_figura_mosk_st()
	olr.kill_mon_in_radius(db.actor:position(), 40)
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("yan_figura_walk")
	local look = patrol("sudaobtarno_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	bind_stalker.hide_weapon()
	olr.hide_inv()
	olr.to_online("lvl7_yantar_physic_object_0598")
	news_manager.send_tip(db.actor, "It's my ghost, part of my inner chaos. An illusion that haunts me everywhere I go, in all my wanderings.", 2, "unknown", 39000)
	olr_timers.st_timer("ten2", 15, "nick.ten2()")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\koan\Mix441]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_pp_effector("radar_wake.ppe", 2013781, false)
end

function ten2()
	news_manager.send_tip(db.actor, "Something that doesn't belong to this world. If you destroy me, you will inherit it, as I once did when I killed a stalker long ago. But it is not as simple as it seems, the shadow leads the bearer to imminent doom, sooner or later it will lead you to death. Follow my lead.", 2, "unknown", 39000)
	olr.enable_walk()
    	level.show_indicators()
    	level.enable_input()
    	db.actor:restore_weapon()
	level.add_pp_effector("total_recall.ppe", 204131, false)
	olr.del_by_name("lvl7_yantar_physic_object_0598")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\heartbeat_fast]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_pp_effector("snd_shock.ppe", 201151, false)
	level.add_pp_effector("black.ppe", 20131, false)
	olr.info("yan_mosk_gluk_off")
	olr.del_by_name("lvl7_yantar_staler_undead_olr_0009")
	olr.del_by_name("lvl7_yantar_staler_undead_olr_0008")
end


function give_pribor_antivibros()
	olr.give_item("pribor_antivibros")
end

function done_zamvibrosa()
	nik_dialog.out_item_much("zameritel_vibrosa",1)
	olr.give_item("battery_change")
	olr.give_item("battery_change")
	
end

function prec_zamvibrosa()
     return nik_dialog.item_much("zameritel_vibrosa",1) ~= false 
end

function give_pribor_zamvibrosa()
	olr.give_item("zameritel_vibrosa")
	news_manager.send_tip(db.actor, "Yes, when you make the measurement, don't forget to bring the device itself.", 15, "ecolog", 39000)
end

function start_ohranik_quest_yan()
	olr.del_by_name("lvl7_yantar_physic_object_0287")
	olr.del_by_name("lvl7_yantar_physic_object_0286")
	olr.del_by_name("lvl7_yantar_physic_object_0288")
	if has_alife_info("ohrana_umer") then
		log1("dead")
		return
	else
		news_manager.send_tip(db.actor, "Professor: Stalker, come in. Did you find anything? Come back when you're done, I have one more thing for you...", 15, "saharov", 39000)
  		local se_obj = alife():object("lvl7_yantar_stalker")
  		if se_obj then
			olr.del_by_name("lvl7_yantar_stalker")
 		end
		olr.info("start_quest_deadohrana")	
	end

end

function nagrada_milyan()
	olr.give_item("psy_stabilizator")
	olr.give_item("med_injector_capsule")
	news_manager.send_tip(db.actor, "Over to all stalkers! Mobile camp on the territory of the lake Yantar announces recruitment to the guard group! All those who wish to join should contact the Professor directly. Conditions to be discussed at the meeting.", 25, "saharov", 39000)
end

function vodka_otdal_milyan()
	nik_dialog.out_item_much("vodka",5)
	local se_obj = alife():object("lvl7_yantar_stalker_0082")
	local jaba_place = alife():object("lvl7_yantar_space_restrictor_0041")
  	if se_obj and jaba_place then
		alife():create("karlik", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("karlik", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("karlik", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("wpn_spas12", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("af_kolco", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():teleport_object(se_obj.id, jaba_place.m_game_vertex_id, jaba_place.m_level_vertex_id, jaba_place.position)
 	end
end

function prec_dolg_five_vodka()
     return nik_dialog.item_much("vodka",5) ~= false 
end

function del_molot_agr()
	olr.del_by_name("lvl3_agroprom_lights_hanging_lamp_0004")
	olr.del_by_name("lvl3_agroprom_physic_object_0384")
  	--local se_obj = alife():object("lvl3_agroprom_physic_object_0384")
  	--if se_obj then
	--	local bloodbridgew = vector():set( -335, -123, -299 )
	--	alife():teleport_object(se_obj:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew)
 	--end
end

function blowout_time_ret_jaba()
	local task_texture, task_rect = get_texture_info("ui_iconsTotal_pda_info")
	local cur = olr_blowout.get_blow_timer()
	if cur <= 2000 and cur >= 1000 then
		item_name_and_price = game.translate_string("It won't be long yet.")
		db.actor:give_talk_message(item_name_and_price, task_texture, task_rect, "iconed_trade_info")
		--log1("ещё не скоро")
		return
	end
	if cur <= 1000 and cur >= 570 then
		item_name_and_price = game.translate_string("The equipment is already picking up faint psi activity.")
		db.actor:give_talk_message(item_name_and_price, task_texture, task_rect, "iconed_trade_info")
		--log1("ещё не скоро")
		return
	end
	if cur <= 570 and cur >= 130 then
		item_name_and_price = game.translate_string("It's on its way.")
		db.actor:give_talk_message(item_name_and_price, task_texture, task_rect, "iconed_trade_info")
		--log1("уже где-то на подходе")
		return
	end
	if cur <= 130 and cur >= 60 then
		item_name_and_price = game.translate_string("It'll start soon.  better take cover.")
		db.actor:give_talk_message(item_name_and_price, task_texture, task_rect, "iconed_trade_info")
		--log1("начнётся с минуты на минуту")
		return
	end
	if cur <= 60 and cur >= 1 then
		item_name_and_price = game.translate_string("It's coming...")
		db.actor:give_talk_message(item_name_and_price, task_texture, task_rect, "iconed_trade_info")
		--log1("нет данных")
		return
	end 
end

function kill_bandits()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 310 and npc:character_community() == "bandit" then  
			npc:kill(npc)
		end
	end
end

function deldorserogavedm()
	olr.to_offline("lvl5_bar_physic_object_0198")
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,245,118,54]Just keep up, it's suspiciously quiet...".."".."\n", 7, "default", 30000)
end


function scary_greh_finded_now()
	news_manager.send_tip(db.actor, "What is this place? Who are all these people? It's probably not a good idea to linger here, and we should get back to the bar...", nil, "act", 29000)
end

function onlineered_docs_rostok()
	olr.to_online("lvl6_rostok_bar_golg_docs")
	news_manager.send_tip(db.actor, "Be careful in the factory. Our squad has noticed some suspicious activity there.", 12, "dolg_voronin", 9000)
end

function mil_dok_feik_enable()
	olr.enable_walk()
	level.add_pp_effector("total_recall.ppe", 204131, false)
	level.add_pp_effector("black.ppe", 20131, false)
	--level.add_cam_effector2("camera_effects\\yan_mozg_off_1.anm", 90, false, "")
	olr.del_by_name("lvl9_military_physic_object_0435")
	olr.del_by_name("lvl9_military_physic_object_0436")
	news_manager.send_tip(db.actor, "What the...", 4, "act", 9000)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\heartbeat_fast]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function morak_talk_two_done()
	olr.give_item("grenade_rgd5_anom")
	olr.give_item("grenade_rgd5_anom")
	olr.give_item("grenade_rgd5_anom")
	olr.give_item("wpn_toz34_old")
end

function morak_talk_one_done()
	olr.give_item("wpn_tiss")
	olr.give_item("grenade_rgd5_anom")
	olr_timers.st_timer("morak_zombvoen", 143, "nick.morak_zombvoen()")
	olr.spawn_on_obj("zombie_strong", "lvl9_military_zone_radioactive_killing_0016")
	olr.spawn_on_obj("zombie_strong", "lvl9_military_zone_radioactive_killing_0016")
	olr.spawn_on_obj("zombie_strong", "lvl9_military_zone_radioactive_killing_0016")
end

function morak_zombvoen()
	news_manager.send_tip(db.actor, "Sailor: I forgot to tell you. be careful around the hills, we've seen a lot of zombified army units lately. They must be on radar. Yeah, if you want to make some money, come on down, I got a job to do...", nil, "freedom", 39000)
	olr.info("morak_job_two")
end

function precond_pisot_lech()
	return db.actor:money() >= 500
end

function precond_tri_kasara()
	return db.actor:money() >= 3000
end

function has_stopisat()
	return db.actor:money() >= 150
end

function precond_one_kasar()
	return db.actor:money() >= 1000
end


function konservi_ten_give()
	for id=1, 10 do
		olr.give_item("conserva")
	end
	db.actor:give_money(-3000)
	game_stats.money_quest_update(-3000)
end


function prec_exo_accum()
	return db.actor:object("exo_acum_ob_dead") ~= nil and db.actor:money() >= 500
end

function exo_accum_zarad()
	local acc = db.actor:object("exo_acum_ob_dead")
	olr.del(acc)
	olr.give_item("exo_acum_ob")
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
end

function disable_jaba_talkgen()
	local obj = alife():object("generators_m_trader")
	local bos = level.object_by_id(obj.id)
	bos:set_tip_text("")
	bos:set_nonscript_usable(false)
end


function from_sarco_to_cemetery()
	level.add_cam_effector2("camera_effects\\punch_effector.anm", 90, false, "")
	--olr.del_by_name("lvl16_generators_physic_object_0198")
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("gen_derevna_way")
	local look = patrol("gen_derevna_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr_timers.st_timer("raia", 1, "nick.from_sarco_to_cemetery2()")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\thunder_2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function from_sarco_to_cemetery2()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\thunder_3]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function chaes_city_ending()
	local point = patrol("cityy_derevna_way")
	local look = patrol("cityy_derevna_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	bind_stalker.hide_weapon()
	olr.hide_inv()
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_cam_effector2("camera_effects\\gen_ending_city.anm", 90, false, "xr_effects.game_credits")
	news_manager.send_tip(db.actor, "Whew.", 5, "act", 9000)
	news_manager.send_tip(db.actor, "Just a--", 15, "act", 9000)
	news_manager.send_tip(db.actor, "Bad dream.", 25, "act", 9000)
	news_manager.send_tip(db.actor, "Just a bad dream.", 35, "act", 9000)
	level.set_weather("1865",true)
end


function radar_plot_dialog_talked()
	level.add_pp_effector("black.ppe", 20131, false)
	local obj = alife():object("lvl10_radar_flesh_strong_0000")
	local bos = level.object_by_id(obj.id)
	bos:set_tip_text("")
	bos:set_nonscript_usable(false)
	olr_timers.st_timer("radar_pseudohuman_dia", 1, "nick.radar_plot_dialog_talkedttt()")
end

function radar_plot_dialog_talkedttt()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 50 then
			if npc:character_community() == "lastday" then
    				local h = hit ()
				h.power = 0.01
				h.direction = vector():set (0, 10, 0)
				h.impulse = 0.01
				h.draftsman = db.actor
				h.type = hit.strike
				npc:hit(h)
			end
		end
	end
	olr.del_by_name("lvl10_radar_flesh_strong_0000")
	olr.del_by_name("lvl10_radar_space_restrictor_0010")
	olr.del_by_name("lvl10_radar_physic_object_0140")
	olr.del_by_name("lvl10_radar_physic_object_0173")	
end


function radar_pseudohuman_gigant_ubil_dia()
	news_manager.send_tip(db.actor, "Flesh: Don't shoot...", 5, "unknown", 9000) 
	local snd_obj = xr_sound.get_safe_sound_object([[monsters\flesh\flesh_aggressive_5]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
end

function radar_pseudohuman_dia()
	local obj = alife():object("lvl10_radar_m_pseudohuman_e")
	local bos = level.object_by_id(obj.id)
	bos:set_tip_text("")
	bos:set_nonscript_usable(false)
	olr_timers.st_timer("radar_pseudohuman_dia", 1, "nick.radar_pseudohuman_diattt()")
end

function radar_pseudohuman_diattt()
	olr.del_by_name("lvl10_radar_physic_object_0227")
	olr.del_by_name("lvl10_radar_physic_object_0141")
	olr.del_by_name("lvl10_radar_m_pseudohuman_e")
	db.actor.psy_health = -0.11
	local snd_obj = xr_sound.get_safe_sound_object([[actor\hurt5]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_pp_effector("teleport.ppe", 20131, false)
	local point = patrol("radar_pseudohum_gig_walk")
	local look = patrol("radar_pseudohum_gig_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end

function out_barunder_docks()
	nik_dialog.out_item_much("bar_under_prison_doc",1)
	news_manager.send_tip(db.actor, "Money received - 500", 1, "money", 9000) 
	db.actor:give_money(500)
	game_stats.money_quest_update(500)
end

function nick.first_under_bar()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\creature_ghoul]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local bloodbridge = vector():set( 147.55, -99.69, 432.61 )
	alife():create("m_zombie_e", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 163.55, -99.69, 432.61 )
	alife():create("zombie_normal", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 155.55, -99.69, 438.61 )
	alife():create("zombie_weak", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 155.55, -99.69, 441.61 )
	alife():create("zombie_strong", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	olr_timers.st_timer("undezdva", 5, "nick.undezdva()")	
end

function undezdva()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\wood_break]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local bloodbridge = vector():set( 147.55, -99.69, 432.61 )
	alife():create("m_zombie_e", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 163.55, -99.69, 432.61 )
	alife():create("zombie_strong", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 155.55, -99.69, 438.61 )
	alife():create("zombie_weak", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 155.55, -99.69, 441.61 )
	alife():create("zombie_normal", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	olr_timers.st_timer("undezdva", 4, "nick.undeztri()")
end

function undeztri()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\bodyfall_3]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local bloodbridge = vector():set( 147.55, -99.69, 432.61 )
	alife():create("zombie_normal", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 163.55, -99.69, 432.61 )
	alife():create("zombie_normal", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 155.55, -99.69, 438.61 )
	alife():create("zombie_weak", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local bloodbridge = vector():set( 155.55, -99.69, 441.61 )
	alife():create("zombie_normal", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
end

function delglazazomb()
	olr.to_offline("lvl2_garbage_staler_undead_olr_0012")
	olr.del_by_name("lvl2_garbage_staler_undead_olr_0012")
end

function vorglaz_zombigo()
	olr.enable_walk()
	olr_timers.st_timer("delglazazomb", 2, "nick.delglazazomb()")	
	news_manager.send_tip(db.actor, "Crow's Eye: My stash is still intact! There's stew and breadcrumbs...", nil, "dolg", 9000)
	olr_timers.st_timer("gdfsdfsactcontsvd", 19, "nick.gdfsdfsactcontsvd()")
	olr.del_by_name("lvl3_agroprom_agro_case_02")
	olr.del_by_name("lvl3_agroprom_agro_case_02_0000")
	olr.del_by_name("lvl3_agroprom_agro_case_02_0001")
	olr.del_by_name("lvl3_agroprom_agro_case_02_0002")
end

function gdfsdfsactcontsvd()
	news_manager.send_tip(db.actor, "Messer: Hey, what's wrong with you?", nil, "act", 9000)
	--olr.spawn_on_obj("m_controller_e", "lvl2_garbage_zone_radioactive_weak_0008")
	local bloodbridge = vector():set( 51.55, 4.69, 448.00 )
	alife():create("controller_new", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
end

function vorglaz_way_dolgbazaa_zombigo()
	olr.disable_walk()
	olr.blow_add(100)
	olr.kill_mon_in_radius(db.actor:position(), 140)
	news_manager.send_tip(db.actor, "Crow's Eye: What the... what's with the roadblock...? I'll check my stash... stay here.", nil, "dolg", 9000)
	news_manager.send_tip(db.actor, "Messer: Okay.", 8, "act", 9000)
	news_manager.send_tip(db.actor, "Messer: Need to check the documents that guy returned to me...", 16, "act", 9000)

	olr.del_by_name("lvl5_bar_physic_object_0214")
	olr.del_by_name("lvl5_bar_physic_object_0798")
	olr.del_by_name("lvl5_bar_physic_object_0779")
	olr.del_by_name("lvl5_bar_physic_object_0792")
	olr.del_by_name("lvl5_bar_physic_object_0103")
	
end

function give_docks_vorglaz()
	olr.blow_add(200)
	olr.kill_mon_in_radius(db.actor:position(), 140)
	olr.give_item("olr_doc_lab_1")
	olr.give_item("killers_deadscient_doc")
end

function vorglaz_away_from_garbage()

	olr.to_online("garb_zarka_fly_glaz")

	local sobj = olr.spawn_on_obj("gar_dolg_respawn_1", "gar_dolg_blokpost")
	if sobj then
		olr.kill_offline_stalker(sobj)
	end
	local sobj = olr.spawn_on_obj("gar_dolg_respawn_2", "gar_dolg_blokpost")
	if sobj then
		olr.kill_offline_stalker(sobj)
	end
	local sobj = olr.spawn_on_obj("gar_dolg_respawn_2", "gar_fake_spot8")
	if sobj then
		olr.kill_offline_stalker(sobj)
	end

	nick.kill_all_dolgs_garbage()
	level.add_pp_effector("black.ppe", 20131, false)
	news_manager.send_tip(db.actor, "Messer, meet me at the Garbage, I'll meet you there. And from the Garbage move to the bar, we need to tell everything to the General...", nil, "dolg", 9000)
	olr.del_by_name("lvl4_darkdolina_stalker_0036")
	local sobj = alife():object("lvl2_garbage_stalker_0055") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\stalker_zombi\stalker_zombie2]]
    			data.visual_name = vis
          		data.character_name = "Crow's Eye"
      			pk:set( data )
		end	
	end
end

function kill_all_dolgs_garbage()
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if IsStalker(kill) then
                if kill:alive() and kill.level_name == "lvl2_garbage" then
		if kill:community() == "dolg" then
			xvars.dead_in_offline[kill:name()] = true
			olr.kill_offline_stalker(kill)
		end
		end
		end
		end
	end	
end

function vorglaz_killers_spawn()
	olr.beep()
	news_manager.send_tip(db.actor, "Crow's Eye: Messer! I'm here! Come and talk to me.", nil, "dolg", 9000)
	news_manager.send_tip(db.actor, "Shit. gotta find my weapon... Holy shit. and the paperwork from the lab is gone...", 15, "act", 49000)
	olr.info("cutcsene_dolg_killers_vorglaz")
	olr.spawn_crows(20,90)
	olr.del_by_name("lvl4_darkdolina_stalker_0003")
	olr.del_by_name("lvl4_darkdolina_stalker_0004")
	olr.del_by_name("lvl4_darkdolina_stalker")
end

function killers_specops_go()
	olr.kill_mon_in_radius(db.actor:position(), 100)
	olr.info("cutcsene_dolg_killers_major")
	for ind = 1, 2 do
		olr.spawn_on_obj("mil_killer_respawn_1", "lvl4_darkdolina_space_restrictor_0000")
		olr.spawn_on_obj("gar_dolg_respawn_1", "lvl4_darkdolina_space_restrictor_0000")
	end
	for ind = 1, 2 do
		olr.spawn_on_obj("mil_killer_respawn_2", "lvl4_darkdolina_respawn_0001")
		olr.spawn_on_obj("gar_dolg_respawn_2", "lvl4_darkdolina_respawn_0001")
	end
	for ind = 1, 2 do
		olr.spawn_on_obj("mil_killer_respawn_2", "lvl4u_darklab_physic_object_0376")
		olr.spawn_on_obj("gar_dolg_respawn_2", "lvl4u_darklab_physic_object_0376")
	end
	news_manager.send_tip(db.actor, "Where is he?", 10, "unknown", 9000)
	news_manager.send_tip(db.actor, "You must be really scared of him. You're making a big fuss. Oh. You're too late. we had him. in our hands, we had him. but it's gone!", 15, "killer", 9000)
	olr_timers.st_timer("chaes_ratss", 32, "nick.vorglaz_killers_spawn()")	
end

function chaes_ratss()
	olr_timers.st_timer("chaes_ratss", 4, "nick.chaes_ratss_spawn()")
	olr_timers.st_timer("chaes_ratss", 6, "nick.chaes_ratss_spawn()")
	olr_timers.st_timer("chaes_ratss", 10, "nick.chaes_ratss_spawn()")
	olr_timers.st_timer("chaes_ratss", 12, "nick.chaes_ratss_spawn()")
	level.add_pp_effector("snd_shock.ppe", 2031, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\sosichi_roscall]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	news_manager.send_tip(db.actor, "Strelok!", 5, "unknown", 9000)
end

function chaes_ratss_spawn()
	local count = math.random(10,15) 
	for ind = 1, count do
		olr.spawn_on_obj("m_rat_new", "lvl14_stancia_zone_radioactive_ratsspawn")
	end
end

function set_mertvecy_enemys()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 50 then
			if npc:character_community() == "deads" then
    				local h = hit ()
				h.power = 0.01
				h.direction = vector():set (0, 10, 0)
				h.impulse = 0.01
				h.draftsman = db.actor
				h.type = hit.strike
				npc:hit(h)
			end
		end
	end
end

function killers_acess_cutscene()
	olr.kill_mon_in_radius(db.actor:position(), 100)
	level.add_cam_effector2("camera_effects\\dolina_cut_killers.anm", 64, false, "")
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("cutdol_kil_kam_walk")
	local look = patrol("cutdol_kil_kam_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	xr_effects.disable_ui()
	olr_timers.st_timer("dolcutone", 8, "nick.dolcutone()")	
end

function dolcutone()
	olr.kill_mon_in_radius(db.actor:position(), 100)
	news_manager.send_tip(db.actor, "We'll pay you a sum that will give you a leading position in this region.", nil, "unknown", 9000)
	olr_timers.st_timer("dolcutont", 8, "nick.dolcutt()")		
end

function dolcutt()
	news_manager.send_tip(db.actor, " Did he really hurt you so badly that you're willing to--", nil, "killer", 9000)
	olr_timers.st_timer("dolcutontr", 8, "nick.dolcuttr()")
end

function dolcuttr()
	olr.kill_mon_in_radius(db.actor:position(), 100)
	news_manager.send_tip(db.actor, " Not yet, but he might.", nil, "unknown", 9000)
	olr_timers.st_timer("dolcutontch", 8, "nick.dolcuttch()")		
end

function dolcuttch()
	news_manager.send_tip(db.actor, " Wouldn't it be easier if you just--", nil, "killer", 9000)
	olr_timers.st_timer("dolcutontrp", 8, "nick.dolcuttrp()")
end

function dolcuttrp()
	olr.kill_mon_in_radius(db.actor:position(), 100)
	news_manager.send_tip(db.actor, " It's not. So you're gonna keep hunting? ", nil, "unknown", 9000)
	olr_timers.st_timer("dolcutontchs", 8, "nick.dolcuttchs()")		
end

function dolcuttchs()
	news_manager.send_tip(db.actor, "For that kind of money, we'll kill anyone! But where are the guarantees?", nil, "killer", 9000)
	olr_timers.st_timer("dolcutontrp", 8, "nick.dolcuttrpse()")
end


function dolcuttrpse()
	olr.kill_mon_in_radius(db.actor:position(), 100)
	news_manager.send_tip(db.actor, "First of all, your group isn't the only one. Secondly, we could just let the others know where you dug your hole. Besides, after today's circus. When your whole gang couldn't handle one crazy zombie for half an hour.", nil, "unknown", 29000)
	olr_timers.st_timer("dolcutontchse", 8, "nick.dolcuttchse()")		
end


function dolcuttchse()
	level.add_pp_effector("black.ppe", 20131, false)
	olr.kill_mon_in_radius(db.actor:position(), 100)
	news_manager.send_tip(db.actor, "It's the end result that counts. see you later, Major.", nil, "killer", 29000)
	local point = patrol("pre_base_walk")
	local look = patrol("pre_base_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	xr_effects.enable_ui()
	news_manager.send_tip(db.actor, "So the military stalkers put a bounty on my head. But why?", 15, "act", 9000)
	olr.del_by_name("lvl4_darkdolina_staler_undead_olr_0013")
	olr.del_by_name("lvl4_darkdolina_staler_undead_olr_0012")
	olr.del_by_name("lvl4_darkdolina_physic_object_0364")

	olr.del_by_name("lvl2_garbage_stalker_0042")

	local sobj = alife():object("gar_bandit_stroyka1") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka2") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka3") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka4") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka5") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end

end


function nagrada_escape_dolg()
	olr.give_item("wpn_aps_sk1")
	olr.give_item("wpn_tiss")
	olr_timers.st_timer("barmmntchse", 8, "nick.barman_gotodolkick()")
	if not has_alife_info("dolina_killer_dolg_escape_done_krav_have") then
		news_manager.send_tip(db.actor, "Major Kravtsov: Messer, I talked to my brother, well done. Come to me too, I have to talk to you...", nil, "dolg_mask1", 25000)
	end
end

function barman_gotodolkick()
	olr.beep()
	olr.to_offline("gar_bandit_stroyka1")
	olr.to_offline("gar_bandit_stroyka2")
	olr.to_offline("gar_bandit_stroyka3")
	olr.to_offline("gar_bandit_stroyka4")
	olr.to_offline("gar_bandit_stroyka5")
	news_manager.send_tip(db.actor, "Messer! What's your business? I thought we agreed you'd be looking for documents in the lab. You've been working as a stalker for, uh. for a long time. Anyway, go to the Valley, you'll find a henchman there... a colorful scumbag. You talk to him about the lab. He should know something about it. That's it, over and out.", nil, "barman", 79000)
end

function kravcov_brother_spawn_bar()
	news_manager.send_tip(db.actor, "Alright, I think we got through. Go through the Garbage to the bar. I'll meet you at our base.", nil, "dolg", 39000)
	level.add_pp_effector("black.ppe", 20131, false)
	olr.del_by_name("lvl4_darkdolina_staler_undead_olr_0011")
	olr.spawn_on_obj("fracture_normal", "lvl2_garbage_smart_terrain_0026")
	olr.spawn_on_obj("zombie_strong", "lvl2_garbage_smart_terrain_0026")
	olr.spawn_on_obj("zombie_strong", "lvl2_garbage_smart_terrain_0026")
	olr.spawn_on_obj("zombie_strong", "lvl2_garbage_smart_terrain_0026")
	olr.spawn_on_obj("zombie_strong", "lvl2_garbage_smart_terrain_0026")
end


function kravcov_brother_killer_start()
	olr.beep()
	news_manager.send_tip(db.actor, "Major Kravtsov: I know you're working for the assassin clan now. That's your right, but I need your help. And you're the only one who can help me because I can't get my guys on this case.", 10, "dolg_mask1", 45000)
	olr_timers.st_timer("kravcov_brother_killer_start_two", 12, "nick.kravcov_brother_killer_start_two()")
	olr.del_by_name("lvl5_bar_physic_object_0787")
	olr.del_by_name("lvl5_bar_explosive_fuelcan")
end

function kravcov_brother_killer_start_two()
	olr.beep()
	olr.info("killers_escape_brotha_start")
	news_manager.send_tip(db.actor, "krvzovpobeg_name", nil, "dolg_mask1", 45000)
end

function set_dol_names()
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0003") 
	if sobj then
	alife():create("wpn_rpk74", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)
	alife():create_ammo("ammo_5.45x39_fmj", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id, 10) 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "С-207"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0004") 
	if sobj then 
	alife():create("wpn_fn2000", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "К-652"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0005") 
	if sobj then
	alife():create("wpn_g36", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id) 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Р-788"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0006") 
	if sobj then
	alife():create("wpn_lr300", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)  
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Р-358"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0007") 
	if sobj then 
	alife():create("wpn_mp5", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "С-678"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0008") 
	if sobj then 
	alife():create("wpn_mp5_small", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Р-671"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0009") 
	if sobj then
	alife():create("wpn_g36_small", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id) 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "К-138"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl4_darkdolina_staler_undead_olr_0010") 
	if sobj then
	alife():create("wpn_sig550_small", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id) 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Р-227"
      			pk:set( data )
		end	
	end
end

function rnd_vis_killers()

	nick.set_dol_names()

local scientiscts = {

	["lvl4_darkdolina_staler_undead_olr_0003"] = true,
	["lvl4_darkdolina_staler_undead_olr_0004"] = true,
	["lvl4_darkdolina_staler_undead_olr_0005"] = true,
	["lvl4_darkdolina_staler_undead_olr_0006"] = true,
	["lvl4_darkdolina_staler_undead_olr_0007"] = true,
	["lvl4_darkdolina_staler_undead_olr_0008"] = true,
	["lvl4_darkdolina_staler_undead_olr_0009"] = true,
	["lvl4_darkdolina_staler_undead_olr_0010"] = true
}

local visuals = {
		[[actors\killer\stalker_ki_antigas]],
		[[actors\killer\stalker_ki_head_1]],
		[[actors\killer\stalker_ki_head_2]],
		[[actors\killer\stalker_ki_head_5]],
		[[actors\killer\stalker_ki_head_10]],
		[[actors\killer\stalker_ki_head_11]],
		[[actors\killer\stalker_ki_mask]],
		[[actors\killer\stalker_ki_nauchniy]]
}


	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
                	if IsStalker(kill) then
				local gvid = kill.m_game_vertex_id
	        		if game_graph():valid_vertex_id(gvid) then
					if alife():level_name(game_graph():vertex(gvid):level_id()) == "lvl4_darkdolina" then
						if scientiscts[kill:name()] then
		  					local pk = get_netpk(kill,1)
  							if pk:isOk() then
    								local data = pk:get()
    								data.visual_name = visuals[math.random(#visuals)]
      								pk:set( data )
							end
						end
					end       
				end
			end
		end
	end

end

function dolina_killers_acessss()
	olr.beep()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\voices\merc_radio_speech]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	news_manager.send_tip(db.actor, "Why don't you come in here. we need to talk. Don't show your weapons, but only if you're on our base. I sent you the coordinates. No one's gonna hurt you unless you start shooting.", nil, "killer", 39000)
	olr.del_by_name("dolg_zone_0001")
	local sobj = alife():object("lvl4_darkdolina_physic_object_0361") 
	if sobj then 
		olr.add_spot( sobj.id,"eliminate_lager_location","Killer base." )
	end
	xr_gulag.setGulagRelation ("val_x18_exit_base", game_object.friend, db.actor)
	
	xr_gulag.setGulagPersonalGoodwill("val_x18_exit_base", 400, db.actor)

	for id=1, 12 do
	olr.spawn_on_obj("m_rat_new", "lvl4u_darklab_space_restrictor_rats_1")
	end
	for id=1, 12 do
	olr.spawn_on_obj("m_rat_new", "lvl4u_darklab_space_restrictor_rats_1_0000")
	end
	for id=1, 12 do
	olr.spawn_on_obj("m_rat_new", "lvl4u_darklab_space_restrictor_rats_1_0001")
	end

end


function kill_go_krisa_st_kills()
	news_manager.send_tip(db.actor, "Take them out. they're being watched.", nil, "unknown", 5000)
	news_manager.send_tip(db.actor, "Got it. What's with the tail?", 8, "killer", 5000)
	news_manager.send_tip(db.actor, "You'll need it.", 17, "unknown", 15000)
	olr_timers.st_timer("gar_kill_one", 5, "nick.gar_kill_one()")
	olr_timers.st_timer("gar_kill_two", 12, "nick.gar_kill_two()")		
end

function gar_kill_one()
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_svd_shot]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local obj = alife():object("lvl2_garbage_staler_undead_olr_0011")
	if obj then
		local bos = level.object_by_id(obj.id)
		if bos then
			bos:kill(bos)
		end
	end
end

function gar_kill_two()
	olr.info("gar_krisi_done_razv")
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_svd_shot]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local obj = alife():object("lvl2_garbage_staler_undead_olr_0010")
	if obj then
		local bos = level.object_by_id(obj.id)
		if bos then
			bos:kill(bos)
		end
	end
end

function kill_go_krisa()
	olr.info("gar_krisa_kill_go_vodon")
	local pos = vector():set(-110,5,500)
	olr.kill_mon_in_radius(pos, 50)
	
end

function clear_chaes_zom()
	for k,v in pairs(db.storage) do
        	local zom = level.object_by_id(k)
            	if zom and not zom:alive() and zom:is_monster() then
			if db.actor:position():distance_to(zom:position()) > 20 then
				--log1("del chaes mon - "..zom:name().."")
				local boss_particle = particles_object("anomaly2\\unknown_star") 
				boss_particle:play_at_pos(vector():set(zom:position().x, zom:position().y-4.6, zom:position().z))
				olr.del(zom)
			end 
		end
	end
end

function yan_biogroup_online()
	olr.beep()
	olr.to_online("lvl7_yantar_physic_object_0640")
	olr.to_online("lvl7_yantar_physic_object_0641")
	olr.to_online("lvl7_yantar_physic_object_0684")
	olr.to_online("lvl7_yantar_physic_object_0720")
	olr.to_online("lvl7_yantar_physic_object_0721")
	olr.to_online("lvl7_yantar_physic_object_0744")
	olr.to_online("lvl7_yantar_physic_object_0745")
	olr.to_online("lvl7_yantar_physic_object_0746")
	olr.to_online("lvl7_yantar_physic_object_0747")
	olr.to_online("lvl7_yantar_physic_object_0748")
	olr.to_online("lvl7_yantar_physic_object_0749")
	olr.to_online("lvl7_yantar_physic_object_0750")
	olr.to_online("lvl7_yantar_physic_object_0751")
	olr.to_online("lvl7_yantar_physic_object_0752")
	olr.to_online("lvl7_yantar_physic_object_0753")
	olr.to_online("lvl7_yantar_physic_object_0754")
	olr.to_online("lvl7_yantar_physic_object_0755")
	olr.to_online("lvl7_yantar_physic_object_0756")
	olr.to_online("lvl7_yantar_physic_object_0757")
	olr.to_online("lvl7_yantar_physic_object_0758")
	olr.to_online("lvl7_yantar_physic_object_0759")
	olr.to_online("lvl7_yantar_physic_object_0760")
	olr.to_online("lvl7_yantar_physic_object_0761")
	olr.to_online("lvl7_yantar_physic_object_0762")
	olr.to_online("lvl7_yantar_physic_object_0763")
	olr.to_online("lvl7_yantar_physic_object_0764")
	olr.to_online("lvl7_yantar_physic_object_0765")
	olr.to_online("lvl7_yantar_physic_object_0766")
	olr.to_online("lvl7_yantar_physic_object_0767")
	olr.to_online("lvl7_yantar_staler_undead_olr_0002")
	olr.to_online("yan_contr_home_lamp1")
	olr.to_online("yan_contr_home_lamp1_0000")
	olr.to_online("yan_contr_home_lamp1_0001")
	olr.to_online("yan_contr_home_lamp1_0002")
	olr.to_online("yan_contr_home_lamp1_0003")
	olr.to_online("yan_contr_home_lamp1_0004")
	olr.to_online("yan_contr_home_lamp1_0005")
	olr.to_online("lvl7_yantar_lights_hanging_lamp_0001")
	news_manager.send_tip(db.actor, "Attention, everyone! A new laboratory group has opened near Lake Yantar. There are jobs for stalkers. Anyone who wants to earn some money, come on over.", nil, "artefact", 45000)
	olr.del_by_name("lvl5_bar_physic_object_0603")	
	olr.del_by_name("lvl7_yantar_controller_tubeman")	
	olr.del_by_name("lvl7_yantar_stalker_0002")	
end


function yan_biogroup_off()
	olr.to_offline("lvl7_yantar_physic_object_0640")
	olr.to_offline("lvl7_yantar_physic_object_0641")
	olr.to_offline("lvl7_yantar_physic_object_0684")
	olr.to_offline("lvl7_yantar_physic_object_0720")
	olr.to_offline("lvl7_yantar_physic_object_0721")
	olr.to_offline("lvl7_yantar_physic_object_0744")
	olr.to_offline("lvl7_yantar_physic_object_0745")
	olr.to_offline("lvl7_yantar_physic_object_0746")
	olr.to_offline("lvl7_yantar_physic_object_0747")
	olr.to_offline("lvl7_yantar_physic_object_0748")
	olr.to_offline("lvl7_yantar_physic_object_0749")
	olr.to_offline("lvl7_yantar_physic_object_0750")
	olr.to_offline("lvl7_yantar_physic_object_0751")
	olr.to_offline("lvl7_yantar_physic_object_0752")
	olr.to_offline("lvl7_yantar_physic_object_0753")
	olr.to_offline("lvl7_yantar_physic_object_0754")
	olr.to_offline("lvl7_yantar_physic_object_0755")
	olr.to_offline("lvl7_yantar_physic_object_0756")
	olr.to_offline("lvl7_yantar_physic_object_0757")
	olr.to_offline("lvl7_yantar_physic_object_0758")
	olr.to_offline("lvl7_yantar_physic_object_0759")
	olr.to_offline("lvl7_yantar_physic_object_0760")
	olr.to_offline("lvl7_yantar_physic_object_0761")
	olr.to_offline("lvl7_yantar_physic_object_0762")
	olr.to_offline("lvl7_yantar_physic_object_0763")
	olr.to_offline("lvl7_yantar_physic_object_0764")
	olr.to_offline("lvl7_yantar_physic_object_0765")
	olr.to_offline("lvl7_yantar_physic_object_0766")
	olr.to_offline("lvl7_yantar_physic_object_0767")
	olr.to_offline("lvl7_yantar_staler_undead_olr_0002")
	olr.to_offline("yan_contr_home_lamp1")
	olr.to_offline("yan_contr_home_lamp1_0000")
	olr.to_offline("yan_contr_home_lamp1_0001")
	olr.to_offline("yan_contr_home_lamp1_0002")
	olr.to_offline("yan_contr_home_lamp1_0003")
	olr.to_offline("yan_contr_home_lamp1_0004")
	olr.to_offline("yan_contr_home_lamp1_0005")	
	olr.to_offline("lvl7_yantar_lights_hanging_lamp_0001")
end


function bar_minsk()
	news_manager.send_tip(db.actor, "Heh, Sergey fixed the motorcycle that was lying at the bar... Drove somewhere in the direction of Silent Hills. What an asshole. I was so excited, I forgot the radiation was beating down there.", nil, "default", 39000)
end

function daem_luparu_ds()
	olr.give_item("wpn_boomstick")
end

function jaba_about_esc_sleep()
	if has_alife_info("kvest_esc_1_dialog_start") and not has_alife_info("jaba_about_esc_sleep_done") then
		olr.info("jaba_about_esc_sleep_done")
		olr.beep()
		news_manager.send_tip(db.actor, "It's nighttime, so don't hang around this time of night. If you want to spend the night, I have a cellar next to the bunker. I don't advise you to sleep in a clear field - they'll eat you, and if they don't eat you, your colleagues won't mind sniffing whoever passes by.", nil, "trader", 35000)
		news_manager.send_tip(db.actor, "And also... the nights are cold now, so I advise you to sleep near the fire... the chance of catching a cold in these conditions is very high. Besides, don't forget to keep your suit in proper condition - rags won't warm you much...", 11, "trader", 35000)
	end
end

function has_death_lamp()
	return nik_dialog.item_much("af_art_lampa",1) ~= false
end

function out_death_lamp()
	news_manager.send_tip(db.actor, "Money received - 3000", nil, "money", 39000)
	get_console():execute("cam_inert 0.35")
	level.add_pp_effector("black.ppe", 20131, false)
	nik_dialog.out_item_much("af_art_lampa",1)
	db.actor:give_money(3000)
	game_stats.money_quest_update(3000)
end

function out_death_lamp_osved()
	news_manager.send_tip(db.actor, "Money received - 1500", nil, "money", 39000)
	get_console():execute("cam_inert 0.35")
	level.add_pp_effector("black.ppe", 20131, false)
	nik_dialog.out_item_much("af_art_lampa",1)
	db.actor:give_money(1500)
	game_stats.money_quest_update(1500)
end

function lampa_online_garbage()
	olr.to_online("lvl2_garbage_physic_object_0114")
end

function look_garbage(obj)
	if obj:name() == "lvl2_garbage_physic_object_0114" then
		if not has_alife_info("lampa_finded_garbage") then
			olr.info("lampa_finded_garbage")
			level.add_pp_effector("black.ppe", 20131, false)
			level.add_pp_effector("snd_shock.ppe", 2031, false)
			local snd_obj = xr_sound.get_safe_sound_object([[ol3\dolina_psy_noise]])
			if not snd_obj:playing() then 
				snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
			end
			db.actor.psy_health = -0.34
			local point = patrol("gar_lamp_one_walk")
			local look = patrol("gar_lamp_one_look")
			db.actor:set_actor_position(point:point(0))
			local dir = look:point(0):sub(point:point(0))
			db.actor:set_actor_direction(-dir:getH())
			olr_timers.st_timer("gar_lamp_one", 25, "nick.gar_lamp_one()")
		end
	end
end


function gar_lamp_one()
	db.actor.psy_health = -0.14
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 2031, false)
	local point = patrol("gar_dolg_blokpost_kamp_point_task")
	local look = patrol("gar_dolg_blokpost_alarm_walk3")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr_timers.st_timer("gar_lamp_two", 15, "nick.gar_lamp_two()")
	local wait_time = 0
  	wait_time = time_global() + 200
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() nick.gar_lamb_zombs() end
  	)
end

function gar_lamp_two()
	db.actor.psy_health = -0.14
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 2031, false)
	local point = patrol("fil_walk")
	local look = patrol("fil_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr_timers.st_timer("gar_lamp_tri", 15, "nick.gar_lamp_tri()")
	local wait_time = 0
  	wait_time = time_global() + 200
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() nick.gar_lamb_zombs() end
  	)
end

function gar_lamp_tri()
	db.actor.psy_health = -0.14
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 2031, false)
	local point = patrol("gar_lamp_one_walk")
	local look = patrol("gar_lamp_one_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr.info("garbage_can_take_lamp")
end


function gar_lamb_zombs()
for id=1, math.random(1,5) do

local sectionsa = { 
"m_zombie_e",
"zombie_normal",
"zombie_strong",
"zombie_blue",
"zombie_plague"
}

local section = sectionsa[math.random(table.getn(sectionsa))] 
alife():create(section, db.actor:position():add(db.actor:direction():mul(-19)), db.actor:level_vertex_id(), db.actor:game_vertex_id())

end
end


function has_xlam_4()
	return nik_dialog.item_much("xlam_4",1) ~= false 
end

function open_hlam_box()
	nik_dialog.out_item_much("xlam_4",1)
	db.actor:give_money(-1000)
	game_stats.money_quest_update(-1000)
	olr.give_item("wpn_walther")
	olr.give_item("wpn_p90")
	olr.give_item("af_gravi")
	olr.give_item("grenade_rgd5_anom")
	olr.give_item("grenade_f1_anom")	
end

function is_level_bar()
	if level.name() == "lvl5_bar" then
		return true
	else
		return false
	end
end

function barbah()
	olr.info("start_bar_bah")
end

function rostok_sosich_prec()
	return has_alife_info("gvozf_net_nihrena_info6_done") and has_alife_info("bar_1_done")
end

function pre_radar_off_effs_ebaa()
	olr.del_by_name("lvl5_bar_space_restrictor_0128")
	news_manager.send_tip(db.actor, "Men! I think the radiation is really down! In the radar area, scientists say there's no radiation! Now it looks like everyone's going to go... to Pripyat.", nil, "default", 39000)
	olr_timers.st_timer("esc_son_novic", 225, "nick.esc_son_novic()")
end


function bar_bart_to_dead_room()
	olr.del_by_name("lvl5_bar_space_restrictor_0127")
	olr.del_by_name("bar_prefix_lights_hanging_lamp_0084")
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("deadroom_bar_walk")
	local look = patrol("deadroom_bar_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end


function bar_bbaah_explode()
	db.actor.health = - 0.1
	news_manager.send_tip(db.actor, "Messer: You can't meet anyone in the zone...", 5, "act", 5000)
	particles_object([[explosions\expl_benzin_00]]):play_at_pos(vector():set(-9.68,-90.15,-309.36))
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_f1_explosion]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local obj = alife():object("lvl5_bar_staler_undead_olr_0011")
	local loh = level.object_by_id(obj.id)
	if loh then
		loh:kill(loh)
	end
end

function swamp_voenstal_sms()
	news_manager.send_tip(db.actor, "Helicopter pilot: Blue 9, over. We've arrived in the swamp area, please contact us immediately or give us your location. Over.", nil, "heli", 25000)
	news_manager.send_tip(db.actor, "Blue 9, over. State your location. Over. We can't find you.", 10, "heli", 25000)
	--local snd_obj = xr_sound.get_safe_sound_object([[ol3\voices\helicopter_pilot_swamp]])
	--snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function is_garbage_level()
	if level.name() == "lvl2_garbage" then
		return true
	else
		return false
	end
end

function del_garbage_bandosy()
	olr.del_by_name("lvl2_garbage_stalker_0044")
	olr.del_by_name("lvl2_garbage_stalker_0048")
	olr.del_by_name("lvl2_garbage_stalker_0049")
	olr.del_by_name("pricep1_0000_garbageswe")
end


function chaes_perehod_spot()
	local sp1_place = alife():object("lvl14_stancia_level_changer_0002")
	olr.add_spot_on_map( sp1_place.id,"level_changer", "On the forgotten road" )
end

function del_prip_exit_psy_and_moks()
	olr.del_by_name("lvl13_prip_space_restrictor_0004")
	olr_timers.st_timer("del_pone_mosk_prp", 2, "nick.del_pone_mosk_prp()")
	if has_alife_info("bun_mosk_start_quest_go_done") then
		news_manager.send_tip(db.actor, "Brain mass: Okay bye, I'm going home...", nil, "default", 25000)
	end
	olr.to_offline("pripyat_brain_lab_nofeet")
	local wait_time = 0
  	wait_time = time_global() + 500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("pripyat_brain_lab_nofeet") end
  	)
end

function del_pone_mosk_prp()
	if has_alife_info("bun_mosk_start_quest_go_done") then
		news_manager.send_tip(db.actor, "Bye. I'll come out tomorrow, we'll go out again.", nil, "default", 25000)
	end
end

function daem_fantasm_metka()
	local sp1_place = alife():object("lvl8_swamp_space_restrictor_0013")
	olr.add_spot_on_map( sp1_place.id,"crlc_mdl", "The place where the phantasm was spotted" )
end

function rnd_vis_zobm_chaes()
local montabl = 
{
       [clsid.zombie_s] = true,
       [clsid.zombie] = true
}



local visuals = {
		[[monsters\zombi\zombie_blue]],
		[[monsters\zombi\zombi_1]],
		[[monsters\zombi\zombi_2]],
		[[monsters\zombi\zombi_3]],
		[[monsters\zombi\zombi_4]],
		[[monsters\zombi\zombi_5]],
		[[monsters\zombi\zombi_6]],
		[[monsters\zombi\zombi_7]]
}


	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
                	if montabl[kill:clsid()]  then
				if kill.level_name == "lvl14_stancia" then
		  			local pk = get_netpk(kill,1)
  					if pk:isOk() then
    						local data = pk:get()
    						data.visual_name = visuals[math.random(#visuals)]
      						pk:set( data )
						--log1("srt vis - "..kill:name().."")
					end    
				end
			end
		end
	end


end


function stancia_fake_anoms()
	if db.actor:alive() then

		if olr_rnd_sounds.actor_on_chaes() then

		if ( xr_conditions.actor_in_zone(nil,nil,{"lvl16_generators_space_restrictor_0067"}))  then
			return
		end

		local rnd_particle, rnd_sound
		local function play_particle(params)
		rnd_particle = particles_object(params.particle)
		local pos = params.pos or nil
		if params.sound then rnd_sound = sound_object(params.sound) end
		if rnd_particle and pos then
		rnd_particle:play_at_pos(pos)
		end
		if rnd_sound and pos then
		rnd_sound:play_at_pos(db.actor, pos)
		end
		end
		local obj=db.actor
		if obj==nil then return end
		local dir = db.actor:direction()
		num=math.random(0,15)
		local dist = math.random(4,6)
		if num==0 then play_particle({particle="anomaly2\\electra2_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_hit"})
		elseif num==1 then play_particle({particle="anomaly2\\electra_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_hit"})
		elseif num==2 then play_particle({particle="anomaly2\\electra2_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_hit"})
		elseif num==3 then play_particle({particle="anomaly2\\electra2_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_blast1"})
		elseif num==4 then play_particle({particle="static\\buble_distort00", pos=obj:position():add(dir:mul(dist)), sound="ambient\\fire2"})
		elseif num==5 then play_particle({particle="static\\zharka_static", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\zhar_blow"})
		elseif num==6 then play_particle({particle="static\\buble_distort00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\teleport_idle"})
		elseif num==7 then play_particle({particle="anomaly2\\gravi_anomaly_00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_rumble1"})
		elseif num==8 then play_particle({particle="anomaly2\\emi_entrance_big_00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\anomaly_gravy_blast1"})
		elseif num==9 then play_particle({particle="anomaly2\\mincer_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_idle01"})
		elseif num==10 then play_particle({particle="anomaly2\\gravity_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_idle00"})
		elseif num==11 then play_particle({particle="anomaly2\\gravity_blast_final00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_blowoutdist"})
		elseif num==12 then play_particle({particle="anomaly2\\studen_idle_bottom", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\buzz_idle"})
		elseif num==13 then play_particle({particle="anomaly2\\studen_blowout", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\buzz_hit"})
		elseif num==14 then play_particle({particle="anomaly2\\pux_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\anomaly_gravy_idle"})
		elseif num==15 then play_particle({particle="anomaly2\\pux_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\pux_blast"})
		end

		end

	end	
end


function kil_in_dcp()
	olr.kill_mon_in_radius(db.actor:position(), 25)
end

function olr_blowout_first_hideouts()
	olr.beep()
	news_manager.send_tip(db.actor, "Messer. I suggest you find some cover, and as soon as possible if you want to live.", nil, "trader", 25000)
end

function enemys_sms_pda_escape_mon()

	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and get_clsid(kill)==clsid.level_changer then
			local rnd = math.random(1,3)
			if rnd == 1 then
				cnt = cnt+1
				alife():create("m_posthuman_e",kill.position,kill.m_level_vertex_id,kill.m_game_vertex_id)
			end
		end	
	end
	log1(cnt)

	nick.delete_start_ammo_free()
	news_manager.send_tip(db.actor, "Attention, everyone! A missing stalker named Messer, also known as Strelok, has been subjected to a psy-zombie. He must not be allowed north. I repeat, he must be destroyed. The fate of the entire zone may depend on it... He's now disconnected from the stalker network and is unaware of our actions...", nil, "heli", 25000)
	nick.delete_start_ammo_free()

	local sobj = alife():object("l10u_radar_bunker_physic_object_0075") 
	if sobj then 
	alife():release(sobj, true) 
	end
	local sobj = alife():object("lvl12_radar_bunker_physic_object_0020") 
	if sobj then 
	alife():release(sobj, true) 
	end


	local wait_time = 0
  	wait_time = time_global() + 12200
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.snd([[ol3\koan\v_a10_cr]]) end
  	)

end

function bigrat_garbage_died()
	olr_timers.st_timer("garbage_timer_bigrat_done", 5, "nick.garbage_timer_bigrat_done()")
end

function garbage_timer_bigrat_done()
	db.actor:change_character_reputation(20)
	news_manager.send_tip(db.actor, "This is Major Kravtsov. The guys at the roadblock say you've done well. they've been watching you. Good for you. I'll put in a good word with our leader about you. When you get a chance, stop by. I got a case.", nil, "dolg_mask1", 25000)
	olr.del_by_name("lvl2_garbage_space_restrictor_0025")
	olr.del_by_name("lvl1_escape_stalker_0011") 
	olr.del_by_name("lvl1_escape_stalker_0013") 
	olr.del_by_name("lvl1_escape_stalker_0012") 
end

function kill_rats_garbage_timer_bigrat()
	olr_timers.st_timer("garbage_timer_bigrat", 40, "nick.garbage_timer_bigrat()")
end

function garbage_timer_bigrat()
	olr.info("spawn_bigrat_garbage")
end

function give_kill_rats_garbage_start()
	for i=1, 12 do
		local sp1_place = alife():object("lvl2_garbage_space_restrictor_0025")
		olr.add_spot_on_map( sp1_place.id,"crlc_mdl", "Rat Pack" )
  		local obj = alife():create("m_rat_e", sp1_place.position, sp1_place.m_level_vertex_id, sp1_place.m_game_vertex_id)
		local params=amk.read_monster_params(obj)
		params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = garb_rats_quest_one\nhome_min_radius = 2\nhome_max_radius = 4\naggressive_home"
		amk.write_monster_params(params,obj)
	end	
end

function bar_first_ivancov()
	--local snd_obj = xr_sound.get_safe_sound_object([[ol3\voices\kravzov_hello]])
	--snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	db.actor:give_info_portion("bar_ivancov_talk_first")
	news_manager.send_tip(db.actor, "Well, well. new face in the neighborhood. The southern roadblock has already reported you. This is Chief of Security of the Duty Group. Major Kravtsov. Come and talk to me, you'll find me at our base.", nil, "dolg_mask1", 25000)
end

function final_swapm_doctor_cutscene()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 195 then
			if npc:character_community() == "monolith" or npc:character_community() == "killer" or npc:character_community() == "bandit" or npc:character_community() == "military" then
				log1("go offline "..npc:name().."")
				local se_obj = alife():object(npc:id())
  				if se_obj then
    						alife():set_switch_offline (se_obj.id, true)
    						alife():set_switch_online (se_obj.id, false)
    						alife():set_interactive (se_obj.id, false)
						olr_timers.st_timer("convert_online", 370, "olr_npc_eqp.convert_online_out("..npc:id()..")")
  				end
			end
		end
	end
	olr.del_by_name("lvl8_swamp_space_restrictor_dok_house_nelez")  -- можно теперь попасть к доктору в хату
	olr.spawn_crows(20,90)
	olr_timers.st_timer("kistrelfail", 26, "nick.kistrelfail()")
	olr.to_online("lvl8_swamp_physic_object_0314")
	olr.to_online("lvl8_swamp_physic_object_0315")
	local pos = vector():set(110,2,146)
	olr.kill_mon_in_radius(pos, 200)
	xr_effects.disable_ui(db.actor, nil)
	level.add_pp_effector("black.ppe", 203131, false)
	news_manager.send_tip(db.actor, "Doctor!", nil, "act", 5000)
	olr_timers.st_timer("dok1", 3, "nick.docutsc_1()")
	olr_timers.st_timer("dok2", 5, "nick.docutsc_2()")
	olr_timers.st_timer("dok3", 6, "nick.docutsc_3()")
	olr_timers.st_timer("dok4", 9, "nick.docutsc_4()")
	olr_timers.st_timer("dok5", 12, "nick.docutsc_5()")
	olr_timers.st_timer("dok6", 15, "nick.docutsc_6()")
	olr_timers.st_timer("dok7", 17, "nick.docutsc_7()")
	olr_timers.st_timer("dok8", 19, "nick.docutsc_8()")
	olr_timers.st_timer("dok9", 21, "nick.docutsc_9()")
	olr_timers.st_timer("dok10", 23, "nick.docutsc_10()")
	olr_timers.st_timer("dok11", 24, "nick.docutsc_11()")
	level.add_cam_effector2("camera_effects\\swapm_dok_one_cut.anm", 30, false, "nick.final_swapm_doctor_cutscene_two")
end

function docutsc_1()
	news_manager.send_tip(db.actor, "Calm down, Cerberus, calm down... And you, young man, put the rifle down, he doesn't like guns pointed at him.", nil, "dok", 5000)
end
function docutsc_2()
	news_manager.send_tip(db.actor, "Doctor, you know.", nil, "act", 5000)
end
function docutsc_3()
	news_manager.send_tip(db.actor, "I know, but do you know? Wait, wait, wait, let me have a look at you. I do!", nil, "dok", 5000)
end
function docutsc_4()
	news_manager.send_tip(db.actor, "Do you know who I am? Don't tell me word of Messer has gotten to you.", nil, "act", 5000)
end
function docutsc_5()
	news_manager.send_tip(db.actor, "What Messer, I don't know any Messer. But I always recognize my work. That scar behind your ear, does it itch?", nil, "dok", 5000)
end
function docutsc_6()
	news_manager.send_tip(db.actor, "The only thing that itches and pulls at me is my memory. Or rather, my memorylessness.", nil, "act", 5000)
end
function docutsc_7()
	news_manager.send_tip(db.actor, "Well, that's the way it's supposed to be after the monolith.", nil, "dok", 5000)
end
function docutsc_8()
	news_manager.send_tip(db.actor, "To hell with this monolith stuff! Doctor, do you know who I am?!", nil, "act", 5000)
end
function docutsc_9()
	news_manager.send_tip(db.actor, "Of course I do. Everyone used to call you the Strelok.", nil, "dok", 5000)
end
function docutsc_10()
	news_manager.send_tip(db.actor, "How?!", nil, "act", 5000)
end
function docutsc_11()
	news_manager.send_tip(db.actor, "S-t-r-e-l-o-k! Do I make myself clear? Let's go to the hut and have some tea.", nil, "dok", 5000)
end


function kistrelfail()
	--olr.info("cit_fail_first_task")
end

function final_swapm_doctor_cutscene_two()
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("medzalupa_doma_look")
	local look = patrol("medzalupa_doma_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	olr.del_by_name("lvl8_swamp_physic_object_0314")
	olr.del_by_name("lvl8_swamp_physic_object_0315")
	olr.off_ui()
end


function swapm_dok_hello()
	olr_timers.st_timer("swapm_dok_hello", 10, "nick.swapm_dok_hello_to_stol()")
	olr.off_ui()
end

function swapm_dok_hello_to_stol()
	olr.del_by_name("lvl8_swamp_staler_undead_olr_0000")
	olr_timers.st_timer("swapm_dok_hello", 4, "nick.swapm_dok_hello_to_stol2()")
	level.add_pp_effector("black.ppe", 20131, false)
	news_manager.send_tip(db.actor, "Put him on the table. He needs to sleep with his new acquisition...", 2, "dok", 5000)
end

function swapm_dok_hello_to_stol2()
	olr.off_ui()
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_cam_effector2("camera_effects\\swapm_dok_one_stol.anm", 30, false, "nick.final_swapm_doctor_cutscene_two3")
end

function final_swapm_doctor_cutscene_two3()
	level.add_pp_effector("black.ppe", 20131, false)
	olr.info("final_spawn_dok_swmp_cutscene")
	news_manager.send_tip(db.actor, "Ah, he's awake.", 2, "dok", 5000)
	news_manager.send_tip(db.actor, "Well, well, well, you're a brave man, you're already a legend in the Zone...", 4, "dok", 5000)
	news_manager.send_tip(db.actor, "Now we'll drink tea, here in the Zone such a herb has formed, fatigue like a hand removes. The dishes, however, are specific, but don't worry, everything is sterile...", 8, "dok", 5000)
	level.add_cam_effector2("camera_effects\\swapm_dok_one_stol_wakep.anm", 30, false, "nick.final_swapm_doctor_cutscene_two4")
	olr_timers.st_timer("on_ui_start", 11, "olr.on_ui()")
	db.actor:restore_weapon()
end

function final_swapm_doctor_cutscene_two4()
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("way_wakup_walp")
	local look = patrol("way_wakup_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
    	db.actor:restore_weapon()
	db.actor:restore_weapon()
    	olr.enable_walk()
end


function swapm_mess_hello()
	log1("swapm_mess_hello funct")
	--news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Мессер:".."\\n".."%c[255,245,118,54]U".."".."\n", nil, "default", 10000)
end

function back_to_gens()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\gen_boss_scream_dead]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_pp_effector("black.ppe", 203131, false)
	olr.show_minimap(true)
	db.actor:give_info_portion("fin_rush_from_sarco_to_warlab")
	news_manager.send_tip(db.actor, "We need to get back to the Generators.", 6, "act", 49000)
	db.actor.satiety = 1
	nick.spawn_mons_rozd_sarco()
end

function gen_bunker_destr_alls_cutscene_start()
	level.add_pp_effector("black.ppe", 203131, false)
	level.add_pp_effector("blink.ppe", 20131, false)
	olr.to_online("lvl16_generators_physic_object_0199")
	olr.to_online("lvl16_generators_physic_object_0200")
	olr.to_online("lvl16_generators_physic_object_0231")
	olr.to_online("lvl16_generators_physic_object_0230")
	news_manager.send_tip(db.actor, "Let's go! Let's go!", 2, "default", 5000)
	xr_effects.disable_ui(db.actor, nil)		
	level.add_cam_effector2("camera_effects\\gen_kids_one.anm", 30, false, "nick.gen_bunker_destr_alls_cutscene_two")	
end

function gen_bunker_destr_alls_cutscene_two()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	news_manager.send_tip(db.actor, "Hey!", 2, "default", 5000)
	level.add_cam_effector2("camera_effects\\gen_kids_two.anm", 30, false, "nick.gen_bunker_destr_alls_cutscene_tri")	
end

function gen_bunker_destr_alls_cutscene_tri()
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("gen_wayout_sarcof")
	local look = patrol("gen_wayout_sarcof")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end

function gen_last_visel_clear_effs()
    	level.remove_pp_effector(2004)
    	level.remove_pp_effector(2002)
	olr_timers.del_timer("bosstelep_timer_gauss")
	olr_timers.del_timer("script_boss_death_timer")	
end

function gauss_door_boss_fight_open()
	olr.info("gen_pojarnn_dveri_open")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\siren_gen]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.spawn_on_obj("wpn_sv17", "lvl16_generators_stalker_0034")
	local bsobj = alife():object("lvl16_generators_stalker_0034") 
	if bsobj then
		alife():create_ammo("ammo_gauss", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_gauss", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_gauss", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
	end
	olr.del_by_name("lvl16_generators_physic_object_0203")
	news_manager.send_tip(db.actor, "Complex security system: Fire alarm! Everyone out of the building! Emergency opening of all rooms.", 1, "item", 25000)
	olr.del_by_name("lvl16_generators_staler_undead_olr")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\door_amb_open]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function bar_killer_sanya_txk()
	news_manager.send_tip(db.actor, "Sanya Borov: Brother, thank you for your help... I thought I was going to die. I'm sorry I can't thank you in person, - I'm leaving the Zone. So I'm throwing a marker on my stash, everything that's left there is yours. Use it, and thank you again.", nil, "default", 39000)
	db.actor:change_character_reputation(40)
	olr_treasure.create_treasure()
end


function bar_killer_timer_rasstrel()
	if not has_alife_info("killer_barmen_finish_talk_done") then
		olr.info("kill_sanya_borov")
		news_manager.send_tip(db.actor, "Security, over. We know the laws of our territory. I order you to shoot the killer. Accepted.", 15, "barman", 39000)
		news_manager.send_tip(db.actor, "Authorized to shoot.", 25, "default", 39000)
		olr.del_by_name("bar_bar_visitors_1_2_0000")
		olr.del_by_name("bar_bar_visitors_1_2_0001")
		olr.del_by_name("lvl5_bar_stalker_0063")
	end
end


function give_killer_barmen_finish_talk()
	if not has_alife_info("kill_sanya_borov") then
		olr_timers.st_timer("bar_killer_sanya_txk", 810, "nick.bar_killer_sanya_txk()")
		news_manager.send_tip(db.actor, "Guards, over. Let the prisoner go, he's innocent.", 15, "barman", 39000)
		news_manager.send_tip(db.actor, "Copy that.", 25, "default", 39000)
	end
	if has_alife_info("kill_sanya_borov") then
		news_manager.send_tip(db.actor, "Guard, over. You shouldn't have sentenced the guy. bury him over there. It's a bad luck, what can you do?", 15, "barman", 39000)
	end
	olr.del_by_name("bar_bar_visitors_1_2_0000")
	olr.del_by_name("bar_bar_visitors_1_2_0001")
	olr.give_item("wpn_beretta")
	olr.give_item("stalker_outfit")
	olr_timers.del_timer("bar_killer_timer_rasstrel")
	nik_dialog.out_item_much("pda_hmir_rostok",1)
	nik_dialog.out_item_much("zap_killera_bar",1)	
end

function tlp_out_hmir_away()
	db.actor:stop_talk()
	level.add_pp_effector("black.ppe", 20131, false)
	olr_timers.st_timer("del_hmirbar", 2, "nick.del_hmirbar()")
	olr.spawn_on_obj("zap_killera_bar_posr", "lvl5_bar_space_restrictor_0125")
	olr.to_online("lvl5_bar_box_rukzak")
	news_manager.send_tip(db.actor, "We should talk to Rat before they kill the poor guy.", 5, "act", 39000)
	olr.del_by_name("lvl5_bar_stalker_0063")
end

function del_hmirbar()
	olr.del_by_name("lvl5_bar_staler_undead_olr_0009")
end

function has_one_ka_mon()
	if db.actor:money() >= 1000 then
		return true
	else
		return false
	end
end

function give_onekamon()
	db.actor:give_money(-1000)
	game_stats.money_quest_update(-1000)
	olr.to_online("lvl6_rostok_physic_object_0286")
end

function give_zap_killera()
	olr.give_item("zap_killera_bar")
end

function tlp_out_kamera_killera()
	db.actor:stop_talk()
	db.actor:restore_weapon()
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("out_kil_kam_walk")
	local look = patrol("out_kil_kam_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	news_manager.send_tip(db.actor, "I think we should talk to Rat...", 2, "act", 39000)
end

function tlp_to_kamera_killera()
	db.actor:stop_talk()
	bind_stalker.hide_weapon()
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("kill_kamera_walk")
	local look = patrol("kill_kamera_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end


function set_sanya_borov()

	local sobj = alife():object("lvl2_garbage_stalker_0063") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Fedka Black"
      			pk:set( data )
		end	
	end

	local sobj = alife():object("lvl5_bar_stalker_0063") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Mediator"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("bar_bar_visitors_1_2") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\neytral\stalker_neytral_rukzak_4]]
    			data.visual_name = vis
          		data.character_name = "Sanya Borov"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("bar_bar_visitors_1_2_0000") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\neytral\stalker_neytral_rukzak_4]]
    			data.visual_name = vis
          		data.character_name = "Sanya Borov"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("bar_bar_visitors_1_2_0001") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Guard"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl7_yantar_stalker") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Lyonya Mogila"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl7_yantar_stalker_0082") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Lyonya Mogila"
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl9_military_stalker_0068_pes") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Dog"
      			pk:set( data )
		end	
	end
end

function bar_killer_strt_chek_barm()
	news_manager.send_tip(db.actor, "What the... We need to talk to the Barkeep, I think he should know what's going on here...", nil, "act", 39000)
	olr.del_by_name("lvl5_bar_staler_undead_olr_0007")  -- удаляем хмыря
	olr.del_by_name("bar_bar_visitors_1_2")  -- удаляем саню (появляется в тюрьме)
	olr_timers.st_timer("bar_killer_timer_rasstrel", 7210, "nick.bar_killer_timer_rasstrel()")
end

function bar_killer_strts2()
	news_manager.send_tip(db.actor, "Unknown contact: 0481", nil, "unknown", 39000)
	olr.info("talk_posrednik_bar")
end

function bar_killer_strts()
	olr_timers.st_timer("bar_killer_strts2", 10, "nick.bar_killer_strts2()")
	news_manager.send_tip(db.actor, "Mediator: You're looking for the Journalist, I understand correctly. I can help you with your search. I'll meet you on the Bar's grounds. First house from the entrance to the Garbage. Waiting.", nil, "unknown", 39000)
	local gar = alife():object("lvl5_bar_stalker_0063")
	if gar then
		olr.add_spot_on_map( gar.id,"crlc_mdl", "Mediator" )
	end
end

function kill_ec_dolin_sms()
	news_manager.send_tip(db.actor, "Docent, come in! I'm not picking up your signal! If you can hear me, go to the secret path in the closed part of the lab to the dungeons, then go to Rostok! Come in!", nil, "saharov", 39000)
end

function kill_ec_dolin()
	olr_timers.st_timer("kill_ec_dolin_sms", 30, "nick.kill_ec_dolin_sms()")
	olr.spawn_on_obj("bloodsucker_proto", "lvl4_darkdolina_stalker_0021")
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvl4_darkdolina_stalker_0021" then
	local h = hit ()
	h.power = 9999999
	h.direction = vector():set (0, 1, 0)
	h.impulse = 2
	h.draftsman = car
	h.type = hit.strike
	car:hit (h)
	end
	end
	end
end

function scient_strt()
	local pos = vector():set(200,2,200)
	olr.kill_mon_in_radius(pos, 110)
	news_manager.send_tip(db.actor, "Hey, over! Stalker, there's a job for you. Come on, I've uploaded my location to the PDA.", nil, "ecolog_red", 39000)
	local gar = alife():object("lvl4_darkdolina_physic_object_0362")
	if gar then
		olr.add_spot_on_map( gar.id,"crlc_mdl", "Scientist's location" )
	end
end

function radar_okno_open()
	local hour = level.get_time_hours()
	if hour >= 21 and hour <= 23 then
		return true
	else
		return false
	end
end

function radar_okno_close()
	local hour = level.get_time_hours()
	if hour >= 21 and hour <= 23 then
		return false
	else
		return true
	end
end

function del_naity_doki_zablika_spaven()
	news_manager.send_tip(db.actor, "Whoa! Another looter. Okay, let's not make any unnecessary moves. If you move, you'll lose the contents of your skull.", 2, "freedom", 5000)
	news_manager.send_tip(db.actor, "Wait... Turn your face a little... No way.", 7, "freedom", 8000)
	news_manager.send_tip(db.actor, "Um. okay, don't move. This is gonna hurt a little bit, and I didn't see you...", 12, "freedom", 8000)
	news_manager.send_tip(db.actor, "What the...?!", 18, "act", 18000)
end

function daem_zombu_done()
	olr.del_by_name("lvl5_bar_staler_undead_olr_0008")
	news_manager.send_tip(db.actor, "Rat: What's up with that?", 6, "barman", 5000)
	news_manager.send_tip(db.actor, "Searching... Uh, wait!", 7, "dolg", 5000)
	olr_timers.st_timer("szobmu_house", 10, "nick.daem_zombu_done2()")
end

function daem_zombu_done2()
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_svd_shot]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	news_manager.send_tip(db.actor, "The bastard got away. Well, I guess the bullet will catch up sooner or later...", 2, "dolg", 5000)
	news_manager.send_tip(db.actor, "Rat: Idiots. and who did the General send here?", 6, "barman", 5000)
end

function daem_zombu_art()
	olr.blow_add(220)
	alife():create('af_art_3_step_anom_svetim', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	news_manager.send_tip(db.actor, "Item received", nil, "default", 5000)
	--olr.give_item("af_art_3_step_anom_svetim")
	olr.del_by_name("lvl5_bar_physic_object_0954")
	olr_timers.st_timer("szobmu_house", 12, "nick.zobmu_barman_gde()")
end

function zobmu_barman_gde()
	news_manager.send_tip(db.actor, "Rat: Uh, where is he? We're already waiting. the whole team. The guys on duty on the roof say you found him... Let's finish talking and get him to the platform at the end of the bar.", 1, "barman", 25000)
	news_manager.send_tip(db.actor, "I think they're on their way. If anything, I got him in the palm of my hand.", 6, "dolg", 35000)
end

function dogskill_start_zombu()
	news_manager.send_tip(db.actor, "RAT: Yeah, one more thing. There's a zombie sighting nearby. He's wandering behind the Rostok plant, a veteran stalker who disappeared a few weeks ago. Bring him to the bar, we can try to bring him to his senses and find out what happened to him...", 1, "barman", 45000)
	local gar = alife():object("lvl5_bar_physic_object_0954")
	if gar then
		olr.add_spot_on_map( gar.id,"tutorial_wounded_location", "Zombified Veteran" )
	end
	olr.del_by_name("lvl5_bar_space_restrictor_0124")
end



function deadcity_paras_talk_to_dleader_sms4()
spawn_bombs_parasite_mg()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n This is Owl. Come on over, I need your help.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1700, 3000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function spawn_bombs_parasite_mg()
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then     
		if kill:name() == "lvl11_deadcity_physic_object_0767" then      
                local sobj = alife():create("explosive_barrel", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
                alife():create("explosive_barrel", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
                alife():create("explosive_barrel", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		clear_useful_for_ai(sobj)
		end
		end
	end
end


function spawn_bombs_parasite_mg_house()
        local sobj1 = olr.spawn_on_obj("explosive_barrel", "lvl11_deadcity_physic_object_0760")
        local sobj2 = olr.spawn_on_obj("explosive_barrel", "lvl11_deadcity_physic_object_0760")  
        local sobj3 = olr.spawn_on_obj("explosive_barrel", "lvl11_deadcity_physic_object_0760")
	clear_useful_for_ai(sobj1)
	clear_useful_for_ai(sobj2)
	clear_useful_for_ai(sobj3)
end


function mg_pre_explode_one()
olr_timers.st_timer("spawn_bombs_parasite_mg_house", 16, "nick.spawn_bombs_parasite_mg_house()")
olr_timers.st_timer("spawn_bombs_parasite_mg_house", 22, "nick.spawn_bombs_parasite_mg_house()")
news_manager.send_tip(db.actor, "Owl: What a shitty place this town is... I can't wait to get out of here...", 20, "dolg", 35000)
news_manager.send_tip(db.actor, "Don't be too busy, by the way. Freedom snipers are shooting the bad guys near their base... if you think of bending your fingers, you will catch a bullet right away...", 50, "dolg", 35000)
db.actor:give_info_portion("mg_pre_explode_one_done")
nick.explode_bombs_parasite_mg()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Owl:\\n Bomb Squad, we're in position. the charges are good. Blow it up.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(100, 200),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_rgd5_explosion]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function on_mg_pre_explode_two()
nick.explode_bombs_parasite_mg()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Owl:\\n Okay, here we are... Detonate the charges!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(100, 200),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
news_manager.send_tip(db.actor, "Owl: That's it. it's done. Now talk to the general in the bar, he should be waiting for you by now.", 5, "dolg", 35000)
end



function explode_bombs_parasite_mg()
local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_rgd5_explosion]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
local sim = alife()
	for id=1, 65534 do
		local kill = level.object_by_id(id)
		if kill then     
		if kill:section() == "explosive_barrel" then       
		local h = hit ()
		h.power = 100
		h.direction = vector():set (0, -1, 0)
		h.impulse = 1
		h.draftsman = db.actor
		h.type = hit.strike
		kill:hit (h)
	end
end
end
end



function nine_pda_rasch()
	news_manager.send_tip(db.actor, "Hey, come in. I think I've decoded your PDA from the swamp. But it doesn't make any sense, maybe it's broken data. Anyway, here's the info.", nil, "flash", 35000)
	db.actor:give_info_portion("nine_pda_rasch_rashifrvn")
	olr.spawn_on_obj("af_kolco", "lvl1_escape_physic_object_0266")
	olr.spawn_on_obj("af_kolco", "lvl1_escape_smart_terrain_0026")
	olr.spawn_on_obj("af_kolco", "lvl1_escape_zone_death_0000")
	olr.to_online("lvl10_radar_shron_weapons")
	local sp1_place = alife():object("lvl10_radar_shron_weapons")
	if sp1_place then
		olr.add_spot_on_map( sp1_place.id,"crlc_mdl", "A vault with weapons of military stalkers." )
	end
end

function daem_blue_pda_nine()
	nik_dialog.out_item_much("blue_pda_nine",1)
	olr_timers.st_timer("nine_pda_rasch", 1226, "nick.nine_pda_rasch()")
end

function has_blue_pda_nine()
     return nik_dialog.item_much("blue_pda_nine",1) ~= false 
end

function create_sinii()
	local sobj = olr.spawn_on_obj("sim_voenstal_num", "lvl8_swamp_physic_object_0312")
	if sobj then
	alife():create("blue_pda_nine",sobj.position,sobj.m_level_vertex_id,sobj.m_game_vertex_id,sobj.id)
	olr.kill_offline_stalker(sobj)
	local pk = get_netpk(sobj,1)
	if pk:isOk() then
    		local data = pk:get()
		local vis = [[actors\militari\soldier_military_old]]
    		data.visual_name = vis
        	data.character_name = "Blue 9"
      		pk:set( data )
	end
	end
end

function dead_naparnik_sms()
if has_alife_info("rad_first") then
	return
end
if has_alife_info("bar_first") and xvars.naparnik_name ~= "" then
	if level.get_time_hours() >= 2 and level.get_time_hours() < 6 then
		if level.name() ~= "lvl2_garbage" then
			return
		end
		local nap = game.translate_string(xvars.naparnik_name)
		local rnd = math.random(1,10)
		if rnd == 1 then
			news_manager.send_tip(db.actor, ""..nap.."Messer.", 3, "zombied", 35000)
		elseif rnd == 3 then
			news_manager.send_tip(db.actor, ""..nap.."Messer... help me, please...", 2, "zombied", 35000)
		elseif rnd == 4 then
			news_manager.send_tip(db.actor, ""..nap..": Stop...", 3, "zombied", 35000)
		elseif rnd == 6 then
			news_manager.send_tip(db.actor, ""..nap..": Where are you going...?", 4, "zombied", 35000)
		elseif rnd == 8 then
			news_manager.send_tip(db.actor, ""..nap..": I'm already waiting for you here...", 1, "zombied", 35000)
		end
	end
end
end


function move_online_blokpost()
        olr_timers.st_timer("online_blokpost", 6, "nick.move_online_blokpost2()")
end

function move_online_blokpost2()
local scientiscts = {
	["esc_blokpost_soldier6_0001"] = true,
	["esc_blokpost_commander"] = true,
	["esc_blokpost_soldier6_0000"] = true,
	["esc_blokpost_soldier1"] = true,
	["esc_blokpost_soldier2"] = true,
	["esc_blokpost_soldier3"] = true,
	["esc_blokpost_soldier4"] = true,
	["esc_blokpost_soldier5"] = true,
	["esc_blokpost_soldier6"] = true,
	["esc_blokpost_soldier7"] = true
}

	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
			if scientiscts[kill:name()] then
				local id = kill.id
    				alife():set_switch_offline (id, false)
    				alife():set_switch_online (id, true)
    				alife():set_interactive (id, true)
			end
		end
	end
end


function move_offline_blokpost()
local scientiscts = {
	["esc_blokpost_soldier6_0001"] = true,
	["esc_blokpost_commander"] = true,
	["esc_blokpost_soldier6_0000"] = true,
	["esc_blokpost_soldier1"] = true,
	["esc_blokpost_soldier2"] = true,
	["esc_blokpost_soldier3"] = true,
	["esc_blokpost_soldier4"] = true,
	["esc_blokpost_soldier5"] = true,
	["esc_blokpost_soldier6"] = true,
	["esc_blokpost_soldier7"] = true
}

	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
			if scientiscts[kill:name()] then
				local id = kill.id
    				alife():set_switch_offline (id, true)
    				alife():set_switch_online (id, false)
    				alife():set_interactive (id, false)
			end
		end
	end
end

function about_kamorka_habar()
	local obj = alife():object("lvl1_escape_big_safe_box")
	if math.random(1,2) == 1 then
		alife():create("af_kolco",obj.position, obj.m_level_vertex_id, obj.m_game_vertex_id, obj.id)
		alife():create("af_studen",obj.position, obj.m_level_vertex_id, obj.m_game_vertex_id, obj.id)	
		alife():create("af_banka_s_holodcom",obj.position, obj.m_level_vertex_id, obj.m_game_vertex_id, obj.id)			
	else
		alife():create("af_kolco",obj.position, obj.m_level_vertex_id, obj.m_game_vertex_id, obj.id)
		alife():create("af_fuzz_kolobok",obj.position, obj.m_level_vertex_id, obj.m_game_vertex_id, obj.id)
		alife():create("af_night_star",obj.position, obj.m_level_vertex_id, obj.m_game_vertex_id, obj.id)
	end
	news_manager.send_tip(db.actor, "There is a rumor that the commander of the soldiers at the cordon has a personal box in which he keeps the loot that patrols collected from the stalkers they killed... They say there are a lot of artifacts there...", nil, "unknown", 35000)
end


function reload_pda_escape_mon()
        news_manager.send_tip(db.actor, "PDA: Restore PDA system... Data restored...")
	db.actor:give_info_portion("try_reload_pda_now")
end

function try_reload_pda()
        olr_timers.st_timer("try_reload_pda", 26, "nick.try_reload_pda2()")
end

function try_reload_pda2()
        news_manager.send_tip(db.actor, "PDA: System reboot... attempt to restore corrupted data...")
        olr_timers.st_timer("try_reload_pda", 16, "nick.try_reload_pda3()")
end

function try_reload_pda3()
        news_manager.send_tip(db.actor, "PDA: System Restore Failed...")
	db.actor:give_info_portion("try_reload_pda_done")
	news_manager.send_tip(db.actor, "Damn... I guess it didn't work... Although...", 5, "act", 29000)
end


function clear_all_bolezns()
	get_hud():RemoveCustomStatic("actor_bolezn",true)
	db.actor:disable_info_portion("bolezn_sibyazva_info")
	db.actor:disable_info_portion("bolezn_sibyazva_info_m")
	if olr_timers.has_timer("bolezn_sibyazva_timer") then
		olr_timers.del_timer("bolezn_sibyazva_timer")
	end
	if olr_timers.has_timer("bolezn_sibyazva_timer_m") then
		olr_timers.del_timer("bolezn_sibyazva_timer_m")
	end
	if olr_timers.has_timer("bolezn_sibyazva_timer_d") then
		olr_timers.del_timer("bolezn_sibyazva_timer_d")
	end
	db.actor:disable_info_portion("bolezn_ratcrazy_info")
	db.actor:disable_info_portion("bolezn_ratcrazy_info_m")
	if olr_timers.has_timer("bolezn_ratcrazy_timer") then
		olr_timers.del_timer("bolezn_ratcrazy_timer")
	end
	if olr_timers.has_timer("bolezn_ratcrazy_timer_m") then
		olr_timers.del_timer("bolezn_ratcrazy_timer_m")
	end
	if olr_timers.has_timer("bolezn_ratcrazy_timer_d") then
		olr_timers.del_timer("bolezn_ratcrazy_timer_d")
	end
	db.actor:disable_info_portion("bolezn_parazity_info")
	if olr_timers.has_timer("bolezn_parasite_timer") then
		olr_timers.del_timer("bolezn_parasite_timer")
	end
	if olr_timers.has_timer("bolezn_parasite_timer_m") then
		olr_timers.del_timer("bolezn_parasite_timer_m")
	end
	if olr_timers.has_timer("bolezn_parasite_timer_d") then
		olr_timers.del_timer("bolezn_parasite_timer_d")
	end
	db.actor:give_info_portion("bolezn_beshenstvo_info_first_dis")
	db.actor:give_info_portion("bolezn_beshenstvo_info_lech")
	db.actor:disable_info_portion("bolezn_zombied_info")
	if olr_timers.has_timer("bolezn_zombied_timer") then
		olr_timers.del_timer("bolezn_zombied_timer")
	end
	if olr_timers.has_timer("bolezn_zombied_timer_m") then
		olr_timers.del_timer("bolezn_zombied_timer_m")
	end
	if olr_timers.has_timer("bolezn_zombied_timer_d") then
		olr_timers.del_timer("bolezn_zombied_timer_d")
	end
	xvars.count_rad_weak = 0
end

--------------------------------------------------------------------------------------------------------------

function bolezn_zombied_timer()
        if db.actor:has_info("bolezn_zombied_info") then
		db.actor.health = -0.12
        	db.actor.power = -0.22
		db.actor.satiety = -0.26
        	olr_timers.st_timer("bolezn_zombied_timer_m", 2900, "nick.bolezn_zombied_timer_m()")
		local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
		if not snd_obj:playing() then 
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		end
	end
end

function bolezn_zombied_timer_m()
        if db.actor:has_info("bolezn_zombied_info") then
        	soundtrack.achit1()
        	news_manager.send_tip(db.actor, "Damn, my head... My head is splitting. I think I've been zombified... I need a cure now.")
		db.actor.health = -0.2
        	db.actor.power = -0.26
		db.actor.satiety = -0.36
        	olr_timers.st_timer("bolezn_zombied_timer_d", 8600, "nick.bolezn_zombied_timer_d()")
    	end
end

function bolezn_zombied_timer_d()
        if db.actor:has_info("bolezn_zombied_info") then
        	soundtrack.achit1()
        	news_manager.send_tip(db.actor, "Я... I can't take it anymore.")
		db.actor.health = -1
        	db.actor.power = -1
    	end
end


function dolgmed_about_radwealech_otdaem()
	xvars.count_rad_weak = 0
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
end


function clear_zombied_bolezn()
	get_hud():RemoveCustomStatic("actor_bolezn",true)
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	db.actor:disable_info_portion("bolezn_zombied_info")
	if olr_timers.has_timer("bolezn_zombied_timer") then
		olr_timers.del_timer("bolezn_zombied_timer")
	end
	if olr_timers.has_timer("bolezn_zombied_timer_m") then
		olr_timers.del_timer("bolezn_zombied_timer_m")
	end
	if olr_timers.has_timer("bolezn_zombied_timer_d") then
		olr_timers.del_timer("bolezn_zombied_timer_d")
	end
end

function prec_dial_bol_zombied()
	if olr_timers.has_timer("bolezn_zombied_timer_m") or olr_timers.has_timer("bolezn_zombied_timer_d") then
		return true
	else
		return false
	end
end
--------------------------------------------------------------------------------------------------------------

function bolezn_sibyazva_timer()
        if db.actor:has_info("bolezn_sibyazva_info") then
		db.actor.health = -0.22
        	db.actor.power = -0.12
        	olr_timers.st_timer("bolezn_sibyazva_timer_m", 2700, "nick.bolezn_sibyazva_timer_m()")
		db.actor:give_info_portion("bolezn_sibyazva_info_m")
		local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
		if not snd_obj:playing() then 
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		end
	end
end

function bolezn_sibyazva_timer_m()
        if db.actor:has_info("bolezn_sibyazva_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "Damn, this bite. I think it's anthrax. I need to be cured right away.")
	db.actor.health = -0.2
        db.actor.power = -0.22
        olr_timers.st_timer("bolezn_sibyazva_timer_d", 7600, "nick.bolezn_sibyazva_timer_d()")
    end
end

function bolezn_sibyazva_timer_d()
        if db.actor:has_info("bolezn_sibyazva_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "Я... I can't take it anymore.")
	db.actor.health = -1
        db.actor.power = -1
    end
end



function clear_sibyazva_bolezn()
	get_hud():RemoveCustomStatic("actor_bolezn",true)
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	db.actor:disable_info_portion("bolezn_sibyazva_info")
	db.actor:disable_info_portion("bolezn_sibyazva_info_m")
	if olr_timers.has_timer("bolezn_sibyazva_timer") then
		olr_timers.del_timer("bolezn_sibyazva_timer")
	end
	if olr_timers.has_timer("bolezn_sibyazva_timer_m") then
		olr_timers.del_timer("bolezn_sibyazva_timer_m")
	end
	if olr_timers.has_timer("bolezn_sibyazva_timer_d") then
		olr_timers.del_timer("bolezn_sibyazva_timer_d")
	end
end


--------------------------------------------------------------------------------------------------------------

function bolezn_ratcrazy_timer()
        if db.actor:has_info("bolezn_ratcrazy_info") then
        	soundtrack.achit1()
		db.actor.health = -0.22
        	db.actor.power = -0.12
        	olr_timers.st_timer("bolezn_ratcrazy_timer_m", 2500, "nick.bolezn_ratcrazy_timer_m()")
		db.actor:give_info_portion("bolezn_ratcrazy_info_m")
		local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
		if not snd_obj:playing() then 
			snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
		end
	end
end

function bolezn_ratcrazy_timer_m()
        if db.actor:has_info("bolezn_ratcrazy_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "Damn, this bite. I think it's a rat bite. I need to be cured right away.")
	db.actor.health = -0.2
        db.actor.power = -0.22
        olr_timers.st_timer("bolezn_ratcrazy_timer_d", 7000, "nick.bolezn_ratcrazy_timer_d()")
    end
end

function bolezn_ratcrazy_timer_d()
        if db.actor:has_info("bolezn_ratcrazy_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "Я... I can't take it anymore.")
	db.actor.health = -1
        db.actor.power = -1
    end
end

function mani_min_pisot()
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
end


function clear_ratcrazy_bolezn()
	get_hud():RemoveCustomStatic("actor_bolezn",true)
	db.actor:give_money(-500)
	game_stats.money_quest_update(-500)
	level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\cough]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	db.actor:disable_info_portion("bolezn_ratcrazy_info")
	db.actor:disable_info_portion("bolezn_ratcrazy_info_m")
	if olr_timers.has_timer("bolezn_ratcrazy_timer") then
		olr_timers.del_timer("bolezn_ratcrazy_timer")
	end
	if olr_timers.has_timer("bolezn_ratcrazy_timer_m") then
		olr_timers.del_timer("bolezn_ratcrazy_timer_m")
	end
	if olr_timers.has_timer("bolezn_ratcrazy_timer_d") then
		olr_timers.del_timer("bolezn_ratcrazy_timer_d")
	end
end

--------------------------------------------------------------------------------------------------------------



function daem_studenonem()
	news_manager.send_tip(db.actor, "Item received: Modified Stud.", nil, "artefact", 5000)
	alife():create("af_studen_m1", db.actor:position(),db.actor:level_vertex_id(),  db.actor:game_vertex_id(),db.actor:id())
end


function otdaem_studenone2()
	olr_timers.st_timer("cheking_studen_reserr", 4126, "nick.studen_res_done()")
	nik_dialog.out_item_much("af_studen",1)
end

function studen_res_done()
	news_manager.send_tip(db.actor, "Stalker, come in. This is the research team at the MedPribor Research Institute. The research is over, you may approach...", nil, "artefact", 39000)
    	db.actor:give_info_portion("agr_studen_res_done")
end


function nii_cheking_studen_tmr()
	olr_timers.st_timer("cheking_studen_tmr", 126, "nick.agr_cheking_studen()")
end



function agr_cheking_studen()
	olr.beep()
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj and obj.parent_id == 65535 then
			local sect = obj:section_name()
			if sect == "af_studen" then
				cnt = cnt + 1 
				if obj.level_name == "lvl1_escape" or obj.level_name == "lvl2_garbage" or obj.level_name == "lvl3_agroprom" or obj.level_name == "lvl4_darkdolina" or obj.level_name == "lvl6_rostok" or obj.level_name == "lvl7_yantar" then
					local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(obj.m_game_vertex_id):level_id()), vector():set(obj.position.x,obj.position.y,obj.position.z))
     					news_manager.send_tip(db.actor, "Professor Shtoklov: Over, I think we have information on the location of the artifact Studen. "..pos..". I think we may be able to find it there.", nil, "artefact", 19000)
					break
				else
					news_manager.send_tip(db.actor, "Prof. Shtoklov: Over. About the Jelly artifact - there is no information about the possible place where it can be found, so you'll have to look for it yourself...", nil, "artefact", 19000)
					break
				end				
			end
		end
	end

	if cnt == 0 then
		news_manager.send_tip(db.actor, "Over, this is the group at the research institute. About the artifact - there is no information about a possible place where it can be found, so you'll have to look for it yourself...", nil, "artefact", 19000)
	end
end


function anihil_shooted() 
    db.actor:disable_info_portion("agr_anihil_shooted")
end


function precond_jguchipuh()
     return nik_dialog.item_much("af_electra_flash",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-electra-flash")
end


function precond_studenone()
     return nik_dialog.item_much("af_studen",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af_studen")
end



function otdaem_jguchipuh()
	news_manager.send_tip(db.actor, "Money received - 600.", nil, "money", 39000)
	db.actor:give_money(600)
	game_stats.money_quest_update(600)
	nik_dialog.out_item_much("af_electra_flash",1)
end


function otdaem_studenone()
	news_manager.send_tip(db.actor, "Money received, 500.", nil, "money", 39000)
	db.actor:give_money(500)
	game_stats.money_quest_update(500)
	nik_dialog.out_item_much("af_studen",1)
end


function precond_radbolt()
     return nik_dialog.item_much("af_ameba_slime",1) ~= false
end


function precond_radoblomok()
     return nik_dialog.item_much("af_ameba_slug",1) ~= false
end


function otdaem_radbolt()
	news_manager.send_tip(db.actor, "Money received - 300.", nil, "money", 39000)
	db.actor:give_money(300)
	game_stats.money_quest_update(300)
	nik_dialog.out_item_much("af_ameba_slime",1)
end


function otdaem_radoblomok()
	news_manager.send_tip(db.actor, "Money received - 250.", nil, "money", 39000)
	db.actor:give_money(250)
	game_stats.money_quest_update(250)
	nik_dialog.out_item_much("af_ameba_slug",1)
end



function agr_ecols_offl()
local scientiscts = {

	["agrrc_lights_hanging_lamp_0000"] = true,
	["agrrc_lights_hanging_lamp_0040"] = true,
	["agrrc_lights_hanging_lamp_0001"] = true,
	["agrrc_lights_hanging_lamp_0002"] = true,
	["agrrc_lights_hanging_lamp_0003"] = true,

	["lvl3_agroprom_physic_object_0387"] = true,
	["lvl3_agroprom_physic_object_0388"] = true,
	["lvl3_agroprom_physic_object_0389"] = true,
	["lvl3_agroprom_physic_object_0390"] = true,
	["lvl3_agroprom_physic_object_0391"] = true,
	["lvl3_agroprom_physic_object_0392"] = true,
	["lvl3_agroprom_physic_object_0393"] = true,
	["lvl3_agroprom_physic_object_0394"] = true,
	["lvl3_agroprom_physic_object_0395"] = true,
	["lvl3_agroprom_physic_object_0396"] = true,
	["lvl3_agroprom_physic_object_0397"] = true,
	["lvl3_agroprom_physic_object_0398"] = true,
	["lvl3_agroprom_physic_object_0399"] = true,
	["lvl3_agroprom_physic_object_0400"] = true,
	["lvl3_agroprom_physic_object_0401"] = true,
	["lvl3_agroprom_physic_object_0402"] = true,
	["lvl3_agroprom_physic_object_0403"] = true,
	["lvl3_agroprom_physic_object_0404"] = true,
	["lvl3_agroprom_physic_object_0405"] = true,
	["lvl3_agroprom_physic_object_0406"] = true,
	["lvl3_agroprom_physic_object_0407"] = true,
	["lvl3_agroprom_physic_object_0408"] = true,
	["lvl3_agroprom_physic_object_0409"] = true,
	["lvl3_agroprom_physic_object_0410"] = true,
	["lvl3_agroprom_physic_object_0411"] = true,
	["lvl3_agroprom_physic_object_0412"] = true,
	["lvl3_agroprom_physic_object_0413"] = true
}

	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
			if scientiscts[kill:name()] then
				local id = kill.id
    				alife():set_switch_offline (id, true)
    				alife():set_switch_online (id, false)
    				alife():set_interactive (id, false)
			end
		end
	end

end


function agr_ecols_online()
local scientiscts = {


	["agrrc_lights_hanging_lamp_0000"] = true,
	["agrrc_lights_hanging_lamp_0040"] = true,
	["agrrc_lights_hanging_lamp_0001"] = true,
	["agrrc_lights_hanging_lamp_0002"] = true,
	["agrrc_lights_hanging_lamp_0003"] = true,

	["lvl3_agroprom_physic_object_0387"] = true,
	["lvl3_agroprom_physic_object_0388"] = true,
	["lvl3_agroprom_physic_object_0389"] = true,
	["lvl3_agroprom_physic_object_0390"] = true,
	["lvl3_agroprom_physic_object_0391"] = true,
	["lvl3_agroprom_physic_object_0392"] = true,
	["lvl3_agroprom_physic_object_0393"] = true,
	["lvl3_agroprom_physic_object_0394"] = true,
	["lvl3_agroprom_physic_object_0395"] = true,
	["lvl3_agroprom_physic_object_0396"] = true,
	["lvl3_agroprom_physic_object_0397"] = true,
	["lvl3_agroprom_physic_object_0398"] = true,
	["lvl3_agroprom_physic_object_0399"] = true,
	["lvl3_agroprom_physic_object_0400"] = true,
	["lvl3_agroprom_physic_object_0401"] = true,
	["lvl3_agroprom_physic_object_0402"] = true,
	["lvl3_agroprom_physic_object_0403"] = true,
	["lvl3_agroprom_physic_object_0404"] = true,
	["lvl3_agroprom_physic_object_0405"] = true,
	["lvl3_agroprom_physic_object_0406"] = true,
	["lvl3_agroprom_physic_object_0407"] = true,
	["lvl3_agroprom_physic_object_0408"] = true,
	["lvl3_agroprom_physic_object_0409"] = true,
	["lvl3_agroprom_physic_object_0410"] = true,
	["lvl3_agroprom_physic_object_0411"] = true,
	["lvl3_agroprom_physic_object_0412"] = true,
	["lvl3_agroprom_physic_object_0413"] = true
}

	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
			if scientiscts[kill:name()] then
				local id = kill.id
    				alife():set_switch_offline (id, false)
    				alife():set_switch_online (id, true)
    				alife():set_interactive (id, true)
			end
		end
	end

end


function agro_ecologs_clear_hlam()
	db.actor:give_info_portion("agr_spawn_ecologs_exp")
	nick.agr_ecols_online()
	news_manager.send_tip(db.actor, "Attention! A new laboratory group has opened in the complex at the MedPribor Research Institute. There is work for stalkers and diggers. Anyone who wants to make some money, come on over.", nil, "artefact", 25000)
	olr.del_by_name("agrfire_vedro_0001")
	olr.del_by_name("lvl3_agroprom_physic_object_0323")
	olr.del_by_name("lvl3_agroprom_physic_object_0319")
	olr.del_by_name("lvl3_agroprom_zombie_plague_0001")
	olr.del_by_name("lvl3_agroprom_physic_object_0322")
	olr.del_by_name("lvl3_agroprom_physic_object_0167")
	olr.del_by_name("lvl3_agroprom_physic_object_0331")
	olr.del_by_name("agroprom_zavoble_object_0005")
	olr.del_by_name("agroprom_zavod_phyle_object_0004")
	olr.del_by_name("lvl3_agroprom_physic_object_0166")
	olr.del_by_name("agropromyable_object_0003")
	olr.del_by_name("lvl3_agroprom_physic_object_0158")
	olr.del_by_name("lvl3_agroprom_physic_object_0324")
	olr.del_by_name("argfkrane_02_0000")
	olr.del_by_name("afgkrane_krp_0000")
	olr.del_by_name("lvl3_agroprom_stalker_0035")
	olr.del_by_name("lvl3_agroprom_korpus_strong_0005")
	olr.del_by_name("lvl3_agroprom_korpus_strong_0006")
	olr.del_by_name("lvl3_agroprom_physic_object_0386")

	local sobj = alife():object("gar_bandit_stroyka1") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka2") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka3") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka4") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end
	local sobj = alife():object("gar_bandit_stroyka5") 
	if sobj and not sobj:alive() then
	olr.del(sobj)
	end


end


function yan_zaval_ofl()
	local sobj = alife():object("lvl7_yantar_physic_object_0722") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
end


function yan_zaval_onlin()
	olr.del_by_name("lvl7_yantar_physic_object_0723")
	local sobj = alife():object("lvl7_yantar_physic_object_0722") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
end


function gen_killkillkill()
	olr_timers.st_timer("57446", 16, "nick.genkilthem()")
	olr_timers.st_timer("57446", 26, "nick.genkilthem()")
	olr_timers.st_timer("57446", 39, "nick.genkilthem()")
end

function genkilthem()
	news_manager.send_tip(db.actor, "...kill him...", nil, "unknown", 5000)
end

function spawn_warlab_kostri()
	olr.spawn_on_obj("zone_flame", "genpart_sertr_0000")
	olr.spawn_on_obj("zone_flame", "lvl16_generators_stalker_0046")
	olr.spawn_on_obj("zone_flame", "ph_warlab_zaval_podval_0000")
	olr.spawn_on_obj("zone_flame", "lvl16_generators_physic_object_0160")
	olr.spawn_on_obj("zone_flame", "lvl4u_darklab_physic_object_0398")
	olr.spawn_on_obj("zone_flame", "lvl4u_darklab_physic_object_0001")
end


function gen_last_boss_dead_now()  -- посследний босс расстрелян
	nick.flying_corpses()
	olr.kill_mon_in_radius(db.actor:position(), 250)
	news_manager.send_tip(db.actor, "No... no!", nil, "unknown", 5000)
	olr_timers.del_timer("bosstelep_timer")
	for i=1, 50 do
		bind_stalker.hide_weapon() -- чтобы УБРАЛ
		olr_timers.st_timer(i, i, "nick.boss_part_zero()")
	end
	olr_timers.st_timer("57446", 16, "nick.boss_partcl_two()")
	olr.del_by_name("lvl16_generators_staler_undead_olr_0002")
        level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("total_recall.ppe", 15876, false)
	olr.del_by_name("lvl16_generators_physic_object_0225")
	olr.del_by_name("lvl16_generators_physic_object_0216")
	olr.del_by_name("lvl16_generators_physic_object_0185")
	db.actor:give_info_portion("oso_killed")
	olr_blowout.blowout_additional_timer()
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_cam_effector2("camera_effects\\gen_boss_end_one.anm", 10, false, "")
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	local point = patrol("gen_ac_last_walk")
	local look = patrol("gen_ac_last_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj and obj.parent_id == 65535 then
			local sect = obj:section_name()
			if sect == "wpn_shotgra" then 
				sim:release(obj)					
			end
		end
	end
end

function boss_part_zero()
	level.add_cam_effector("camera_effects\\shell_shock.anm", 3496, false, "")
	local objp = alife():object("lvl16_generators_staler_undead_olr_0003")
	local bosp = level.object_by_id(objp.id)
	if bosp then
		local boss_particle = particles_object("anomaly2\\unknown_star") 
		boss_particle:play_at_pos(vector():set(bosp:position().x, bosp:position().y-4.6, bosp:position().z))
	end
end

function boss_partcl_two()
	local objp = alife():object("lvl16_generators_staler_undead_olr_0003")
	local bosp = level.object_by_id(objp.id)
	if bosp then
	local boss_particle = particles_object("ghoul\\fx-06-blue-glow")
	if not boss_particle:playing() then 
		boss_particle:play_at_pos(vector():set(bosp:position().x, bosp:position().y+1.6, bosp:position().z))
	end
	olr_timers.st_timer("57446", 16, "nick.boss_partcl_tri()")
	end
end

function boss_partcl_tri()
	local objp = alife():object("lvl16_generators_staler_undead_olr_0003")
	local bosp = level.object_by_id(objp.id)
	if bosp then
	local boss_particle = particles_object("ghoul\\_fx_anomal-01")
	if not boss_particle:playing() then 
		boss_particle:play_at_pos(vector():set(bosp:position().x, bosp:position().y+1.6, bosp:position().z))
	end
	olr_timers.st_timer("57446", 16, "nick.boss_partcl_four()")
	end
end

function boss_partcl_four()
	local objp = alife():object("lvl16_generators_staler_undead_olr_0003")
	local bosp = level.object_by_id(objp.id)
	if bosp then
	local boss_particle = particles_object("anomaly2\\gravi_zaxvat_myasorubka")
	if not boss_particle:playing() then 
		boss_particle:play_at_pos(vector():set(bosp:position().x, bosp:position().y+1.6, bosp:position().z))
	end
	end
end

function tark_wt_et_one()
	news_manager.send_tip(db.actor, "Let's talk.", 2, "unknown", 5000)
	olr_timers.st_timer("57446", 6, "nick.tark_wt_et_two()")
	level.add_pp_effector("black.ppe", 20131, false)
	db.actor:set_actor_position(vector():set(249,-56.5,-366))
end

function tark_wt_et_two()
	news_manager.send_tip(db.actor, "Why are you going in there?", 2, "unknown", 5000)
end

function start_boss_podval_battle_now()

	nick.flying_corpses()
	--olr.kill_mon_in_radius(db.actor:position(), 250)
	nick.kill_zombies_around()

	local snd_obj = xr_sound.get_safe_sound_object([[ol3\final_boss_fight]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end

	local bsobj = alife():object("lvl16_generators_staler_undead_olr_0003") 
	if bsobj then 
		alife():create("wpn_shotgra", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
	end

	local bsobj = alife():object("lvl16_generators_staler_undead_olr_0002") 
	if bsobj then 
		alife():create("wpn_shotgra", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
		alife():create_ammo("ammo_bolts", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 10)
	end

	local sobj = alife():object("lvl16_generators_physic_object_0222") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_pp_effector("proba_gray.ppe", 2032431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("gen_ac_last_walk")
	local look = patrol("gen_ac_last_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("total_recall.ppe", 15876, false)
	level.add_cam_effector("camera_effects\\shell_shock.anm", 3496, false, "")
	
	olr_timers.st_timer("a333t332333", 5, "nick.hit_boss_atack()")
	olr_timers.st_timer("a333t33233322", 6, "nick.hit_boss_atack()")
	olr_timers.st_timer("bosstelep_timer", 26, "nick.teleport_boss_fight()")
	olr_timers.st_timer("script_boss_death_timer", 600, "nick.script_boss_kill_timer()") -- если у игрока всё плохо с аммуницией
	news_manager.send_tip(db.actor, "You'll never get out of here.", 2, "unknown", 5000)
	news_manager.send_tip(db.actor, "Just, uh. look at me.", 10, "unknown", 5000)
	news_manager.send_tip(db.actor, "Come on. show me what a marksman you are.", 20, "unknown", 5000)
	olr_timers.st_timer("bosstelep_timer_gauss", 296, "nick.gauss_door_boss_fight_open()")

	olr.spawn_on_obj("device_torch", "lvl16_generators_stalker_0072")

	local STbron = db.actor:object("wpn_rpg7")
	if STbron == nil then
		olr.spawn_on_obj("wpn_rpg7", "lvl16_generators_stalker_0072")
	end

	olr_timers.st_timer("set_boss_enemye", 2, "nick.set_boss_enemye()")

end


function set_boss_enemye()
	local source = nil
    	local sim = alife()
    	if sim then
        local se_obj = alife():object("lvl16_generators_staler_undead_olr_0002")
        if se_obj then
          source = level.object_by_id(se_obj.id)
        end
        end

        if source == nil then
         log1("expl not found")
         return
        end

	local h = hit()
	h.draftsman = db.actor
	h.type = hit.strike
        h:bone("head")
	h.direction = vector():set(1,-1,1)
	h.power = 0.1
	h.impulse = 1
	source:hit(h)
end


function teleport_boss_fight()
	olr_timers.st_timer("bosstelep_timer", math.random(20,37), "nick.teleport_boss_fight()")
	olr.spawen_phantoms()
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car and car:name() == "lvl16_generators_staler_undead_olr_0002" then
	if car:alive() then

        local bez_var = math.random(1,5)
	if bez_var == 1 then
	local bloodbridgew = vector():set( 165, -13, -499 )
	alife():teleport_object(car:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew)
	--log1("telep 1")

	elseif bez_var == 2 then
	local bloodbridgew2 = vector():set( 151, -13, -491 )
	alife():teleport_object(car:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew2)
	--log1("telep 2")

	elseif bez_var == 3 then
	local bloodbridgew3 = vector():set( 178, -13, -479 )
	alife():teleport_object(car:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew3)
	--log1("telep 3")

	elseif bez_var == 4 then
	local bloodbridgew4 = vector():set( 184, -13, -501 )
	alife():teleport_object(car:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew4)
	--log1("telep 4")

	elseif bez_var == 5 then
	local bloodbridgew5 = vector():set( 183, -13.36, -492 )
	alife():teleport_object(car:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew5)
	--log1("telep 5")

   	end
	end
	end
	end
end


function script_boss_kill_timer()
	local obj = alife():object("lvl16_generators_staler_undead_olr_0002")
	local loh = level.object_by_id(obj.id)
	if loh then
		loh:kill(loh)
	end
end

function hit_boss_atack()
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvl16_generators_staler_undead_olr_0002" then
	local h = hit ()
	h.power = 0.1
	h.direction = vector():set (0, 100, 0)
	h.impulse = 20
	h.draftsman = db.actor
	h.type = hit.strike
	car:hit (h)
	local pos = car:position()
	local x, y, z = pos.x, pos.y, pos.z
	particles_object([[anomaly\a-03-flash-sparks_old00]]):play_at_pos(vector():set(x,y,z))
	particles_object([[anomaly\a-03-expl-sparks_00]]):play_at_pos(vector():set(x,y,z))
	particles_object([[anomaly2\monolith_golo_death_olr]]):play_at_pos(vector():set(x,y,z))
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\sob2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	end
	end
end


function kill_zombies_around()	
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 195 then
			if npc:character_community() == "zombied" then
    				local h = hit ()
				h.power = 1114
				h.direction = vector():set (0, 10, 0)
				h.impulse = 1
				h.draftsman = db.actor
				h.type = hit.strike
				npc:hit(h)
			end
		end
	end
end

function start_boss_second_talk()
	particles_object([[alexmx\test_face_align_timed]]):play_at_pos(vector():set(155,6,-465))
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_pp_effector("proba_gray.ppe", 2032431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("gen_ac_boss_two_walk")
	local look = patrol("gen_ac_boss_two_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
	level.add_pp_effector("total_recall.ppe", 15876, false)
	level.add_cam_effector("camera_effects\\shell_shock.anm", 3496, false, "")
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	news_manager.send_tip(db.actor, "This is, uh. this is just the beginning. You wanted to know the truth, didn't you?", 15, "unknown", 5000)
	olr.kill_mon_in_radius(db.actor:position(), 150)
	db.actor.health = -db.actor.health/math.random(2,5)
	olr_blowout.blowout_additional_timer()
	olr_timers.st_timer("att332333", 19, "nick.boss_talk_two_done()")
	olr_timers.st_timer("att332333", 6, "nick.genstrelvisbos()")
end

function boss_talk_two_done()
	olr.del_by_name("lvl16_generators_staler_undead_olr_0001")
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_pp_effector("proba_gray.ppe", 2032431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.enable_walk()
    	level.show_indicators()
    	level.enable_input()
	--olr_timers.st_timer("spawen_zombis", 2, "nick.gen_first_etaj_zombies()")
	--olr_timers.st_timer("gen_one_zon_del_tdel", 50, "nick.gen_one_zon_del_tmr()")
end


function genstrelvisbos()
	news_manager.send_tip(db.actor, "Look at me, I'm your brother in life!", nil, "unknown", 5000)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\glass_crak_2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_large_away_2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	for k,v in pairs(db.storage) do
        local stalker = level.object_by_id(k)
            	if stalker and (get_clsid(stalker)==clsid.script_stalker) and not stalker:alive() then
			if math.random(1,2) == 1 then
			stalker:iterate_inventory( function(_, item)
			if item and item:is_weapon() then
				stalker:drop_item(item)
			end
			end)
			end
		end
	end
end


function gen_off_last_rubilnik()
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()	
	olr.del_by_name("lvl16_generators_physic_object_0215")
	olr.del_by_name("lvl16_generators_android_hen")
	olr.del_by_name("lvl16_generators_m_poltergeist_strong_flame")
	olr.del_by_name("lvl16_generators_m_poltergeist_strong_flame_0000")
	olr.del_by_name("lvl16_generators_m_poltergeist_strong_flame_0001")
	olr_timers.st_timer("fov_gen_out", 3, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 6, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 9, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 12, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 15, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out_end", 18, "nick.fov_gen_out_eff_rub()")
end


function fov_gen_out_eff_rub()
	olr.enable_walk()
    	level.show_indicators()
    	level.enable_input()
	level.add_pp_effector("black.ppe", 201831, false)
	device():set_fov(65)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\fear_hata]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	nick.gen_vtotoy_zaval_online() -- заваливаем второй этаж
	olr_blowout.blowout_additional_timer()
end




function gen_vtotoy_zaval_online()
	olr.del_by_name("labu_prefix_lights_hanging_lamp_01dfs09")
	olr.del_by_name("labu_prefix_lights_hanging_lamp_01564dgds")
	olr.del_by_name("labu_prefix_lights_hangdsfdsing_lamp_0039")
	olr.del_by_name("labu_prefix_lights_hanging_lamp_006334")
	local sobj = alife():object("ph_warlab_zaval_podval_0004") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0000") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0001") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0002") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0003") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
end


function gen_vtotoy_zaval_offl()
	local sobj = alife():object("ph_warlab_zaval_podval_0000") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0001") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0002") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("ph_warlab_zaval_podval_0003") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
	local sobj = alife():object("lvl16_generators_physic_object_0222") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
end


function boss_talk_one_done()

	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0398")
	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0398")
	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0398")

	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0363")
	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0363")
	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0363")

	olr.spawn_on_obj("m_zombie_e", "lvl16_generators_physic_object_0082")
	olr.spawn_on_obj("m_zombie_e", "lvl16_generators_physic_object_0082")
	olr.spawn_on_obj("m_zombie_e", "lvl16_generators_physic_object_0082")

	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0364")
	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0364")
	olr.spawn_on_obj("m_zombie_e", "lvl4u_darklab_physic_object_0364")


	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_pp_effector("proba_gray.ppe", 2032431, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.enable_walk()
    	level.show_indicators()
    	level.enable_input()
    	db.actor:restore_weapon()
	olr_timers.st_timer("spawen_zombis", 2, "nick.gen_first_etaj_zombies()")
	olr_timers.st_timer("gen_one_zon_del_tdel", 200, "nick.gen_one_zon_del_tmr()")
	
	db.actor:give_info_portion("gen_boss_firts_talked_info")

	olr_blowout.blowout_additional_timer()

	--local se_obj = alife():story_object(10011)
	olr.del_by_name("lvl16_generators_staler_undead_olr_0000")
	olr.del_by_name("lvl16_generators_physic_object_0197")

	db.actor.health = -db.actor.health/math.random(2,5)
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
			local sect = obj:section_name()
			if
				sect == "wpn_gauss" or
				sect == "wpn_pistol_future" or
				sect == "wpn_sv17" 
			then 
				sim:release(obj)					
			end
		end
	end

	local sobj = alife():object("ph_warlab_zaval_podval_0004") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
	log1("what")
end


function gen_first_etaj_zombies()
	if db.actor:alive() then

		if ( xr_conditions.actor_in_zone(nil,nil,{"lvl16_generators_space_restrictor_0067"}))  then
			return
		end

  		--log1("spawn zombies now")
		local rnd_particle, rnd_sound
		local function play_particle(params)
		rnd_particle = particles_object(params.particle)
		local pos = params.pos or nil
		if params.sound then rnd_sound = sound_object(params.sound) end
		if rnd_particle and pos then
			rnd_particle:play_at_pos(pos)
		end
		if rnd_sound and pos then
			rnd_sound:play_at_pos(db.actor, pos)
		end
		end
		local obj=db.actor
		if obj==nil then return end
		local dir = db.actor:direction()
		num=math.random(0,15)
		local dist = math.random(4,6)
		if num==0 then play_particle({particle="anomaly2\\electra2_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_hit"})
		elseif num==1 then play_particle({particle="anomaly2\\electra_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_hit"})
		elseif num==2 then play_particle({particle="anomaly2\\electra2_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_hit"})
		elseif num==3 then play_particle({particle="anomaly2\\electra2_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\electra_blast1"})
		elseif num==4 then play_particle({particle="static\\buble_distort00", pos=obj:position():add(dir:mul(dist)), sound="ambient\\fire2"})
		elseif num==5 then play_particle({particle="static\\zharka_static", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\zhar_blow"})
		elseif num==6 then play_particle({particle="anomaly2\\teleport_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\teleport_idle"})
		elseif num==7 then play_particle({particle="anomaly2\\gravi_anomaly_00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_rumble1"})
		elseif num==8 then play_particle({particle="anomaly2\\emi_entrance_big_00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\anomaly_gravy_blast1"})
		elseif num==9 then play_particle({particle="anomaly2\\mincer_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_idle01"})
		elseif num==10 then play_particle({particle="anomaly2\\gravity_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_idle00"})
		elseif num==11 then play_particle({particle="anomaly2\\gravity_blast_final00", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\gravi_blowoutdist"})
		elseif num==12 then play_particle({particle="anomaly2\\studen_idle_bottom", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\buzz_idle"})
		elseif num==13 then play_particle({particle="anomaly2\\studen_blowout", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\buzz_hit"})
		elseif num==14 then play_particle({particle="anomaly2\\pux_idle", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\anomaly_gravy_idle"})
		elseif num==15 then play_particle({particle="anomaly2\\pux_blast", pos=obj:position():add(dir:mul(dist)), sound="anomaly\\pux_blast"})
		end

		olr_timers.st_timer("spawen_zombis", math.random(8,12), "nick.gen_first_etaj_zombies()")
	end	
end

function gen_one_zon_del_tmr()
	olr_timers.del_timer("spawen_zombis")
end

function start_kill_gen_now()
	olr.del_by_name("lvl16_generators_physic_object_0214")
	news_manager.send_tip(db.actor, "Brain Link.", 3, "act", 5000)
end


function is_generators_lvl()
	if level.name() == "lvl16_generators" then
		return true
	else
		return false
	end
end


function zov_kontakta_pdamarevomarevo()
	olr.del_by_name("lvl3_agroprom_space_restrictor_0007")
	news_manager.send_tip(db.actor, tips_arg_nov_marevo, nil, "sos", 19000)
end

function has_all_mil_sms()
	news_manager.send_tip(db.actor, "Messer: Informant, I found the group. All dead. Seems to have fallen into unknown anomalous formations, I saw one strange anomaly, and some flying fire. That may be the cause, but I'm not sure...", nil, "act", 19000)
	olr_timers.st_timer("atta44k333323", 11, "nick.has_all_mil_sms2()")
end


function has_all_mil_sms2()
	olr_timers.st_timer("osved_yan_gauss", 2311, "nick.osved_yan_gauss()")
	db.actor:change_character_reputation(40)
	db.actor:give_info_portion("kvest_holmy_expedition_done")
	olr_treasure.create_treasure()
	news_manager.send_tip(db.actor, "Roger that, Messer. Thanks for your help. Actually, I found out they had some business with the scientists... but whatever. Those guys weren't poor, so I hope I found something fun to do. Nevertheless, I'll drop you a tip on a little stash, if you have time, check it out. Take care, see you later.", nil, "flash", 29000)
end

function osved_yan_gauss()
	news_manager.send_tip(db.actor, "Informant: Messer, thanks again for your help in finding the expedition on the Silent Hills. I did some checking up on your journalist the other day... They say he's got a secret location on Yantar. Have you seen the ruined building by the road to the bar? Well, he was seen on the roof there about three months ago. Well, uh. I gave you a tip, go ahead.", nil, "flash", 49000)
	olr.del_by_name("lvl7_yantar_physic_object_0270")
end


function look_military(obj)
	if obj:name() == "lvl9_military_stalker_0057" and not has_alife_info("mil_eqsped_one") then
		news_manager.send_tip(db.actor, "Looks like he's one of the missing group. Looks like he got caught in this anomaly.", nil, "act", 19000)
		db.actor:give_info_portion("mil_eqsped_one")
		olr.spawn_on_obj("zombie_normal", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("zombie_strong", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("zombie_blue", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("chimera_strong", "lvl9_military_zone_radioactive_killing")
	end
	if obj:name() == "lvl9_military_stalker_0058" and not has_alife_info("mil_eqsped_two") then
		news_manager.send_tip(db.actor, "Looks like he's from the missing group.", nil, "act", 19000)
		db.actor:give_info_portion("mil_eqsped_two")
		olr.spawn_on_obj("zombie_normal", "lvl9_military_respawn")
		olr.spawn_on_obj("zombie_strong", "lvl9_military_respawn")
		olr.spawn_on_obj("zombie_normal", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("zombie_strong", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("zombie_blue", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("chimera_weak", "lvl9_military_zone_radioactive_killing")
	end
	if obj:name() == "lvl9_military_stalker_0059" and not has_alife_info("mil_eqsped_tri") then
		news_manager.send_tip(db.actor, "I think it's the sniper from the missing group...", nil, "act", 19000)
		db.actor:give_info_portion("mil_eqsped_tri")
		olr.spawn_on_obj("zombie_normal", "lvl9_military_respawn_0000")
		olr.spawn_on_obj("zombie_strong", "lvl9_military_respawn_0000")
		olr.spawn_on_obj("zombie_normal", "lvl9_military_respawn")
		olr.spawn_on_obj("zombie_strong", "lvl9_military_respawn")
		olr.spawn_on_obj("zombie_normal", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("zombie_strong", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("zombie_blue", "lvl9_military_zone_radioactive_killing")
		olr.spawn_on_obj("chimera_midl", "lvl9_military_zone_radioactive_killing")
	end	
end


function holmy_expedition_start_now()
	news_manager.send_tip(db.actor, "Informant: Messer, one of the stalker squads decided to go deep into the Zone and explore the territory of the Silent Hills. Among the stalkers of the squad, more than half of them are elite. They were superbly equipped... can you go see what's on them? Anything you find on them is yours. Just tell me what happened to them. Okay?", nil, "flash", 49000)
	olr_timers.st_timer("attak333323", 14, "nick.holmy_expedition_startsss()")
end



function holmy_expedition_startsss()
	db.actor:give_info_portion("kvest_holmy_expedition_start_now_go")
	news_manager.send_tip(db.actor, "Informant: There were three stalkers in the group - two in exoskeletons, one in a black science suit, unless he changed his costume... I know he was a sniper. They're missing in the village area. When you find them, contact me. I'm waiting for a signal.", nil, "flash", 29000)
end





function is_pda_dead()
	local STbron = db.actor:object("device_pda")
	if STbron:condition() <= 0.01 then 
		return true
	end
end

function enable_senf() 
	local STbron = db.actor:object("device_pda") 
	STbron:set_condition(0.99)
	db.actor:disable_info_portion("pda_dead_off")
	olr.show_minimap(true)
end



function start_greh_prisoning_rush_spawn()
		olr.spawn_on_obj("cit_killer_respawn_1", "military_spawn_rest_one")
		olr.spawn_on_obj("val_soldier_respawn_1", "military_spawn_rest_one")
		olr.spawn_on_obj("val_soldier_respawn_1", "military_spawn_rest_one")
		olr.spawn_on_obj("val_soldier_respawn_1", "military_spawn_rest_one")


		olr.spawn_on_obj("val_soldier_respawn_1", "military_spawn_rest_one_0000")
		olr.spawn_on_obj("cit_killer_respawn_1", "military_spawn_rest_one_0000")
		olr.spawn_on_obj("cit_killer_respawn_1", "military_spawn_rest_one_0000")
		olr.spawn_on_obj("val_soldier_respawn_1", "military_spawn_rest_one_0000")

end


function set_rand_grehs()
local scientiscts = {

	["lvl9_military_stalker"] = true,
	["lvl9_military_stalker_0000"] = true,
	["lvl9_military_stalker_0001"] = true,
	["lvl9_military_stalker_0002"] = true,
	["lvl9_military_stalker_0003"] = true,
	["lvl9_military_stalker_0004"] = true,
	["lvl9_military_stalker_0005"] = true,
	["lvl9_military_stalker_0008"] = true,
	["lvl9_military_stalker_0009"] = true,
	["lvl9_military_stalker_0010"] = true,
	["lvl9_military_stalker_0011"] = true
}

local visuals = {
		[[actors\dark_stalker\dark_stalker_1]],
		[[actors\dark_stalker\dark_stalker_2]],
		[[actors\dark_stalker\dark_stalker_voron_old]],
		[[actors\dark_stalker\dark_stalker_3]]
}


	local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
                	if IsStalker(kill) then
				local gvid = kill.m_game_vertex_id
	        		if game_graph():valid_vertex_id(gvid) then
					if alife():level_name(game_graph():vertex(gvid):level_id()) == "lvl9_military" then
						if scientiscts[kill:name()] then
		  					local pk = get_netpk(kill,1)
  							if pk:isOk() then
    								local data = pk:get()
    								data.visual_name = visuals[math.random(#visuals)]
          							data.character_name = ""
      								pk:set( data )
							end
						end
					end       
				end
			end
		end
	end

end



function chaes_contrs_spawn()
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0234")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0225")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0204")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0222")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_strong_0051")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0082")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0061")
		olr.spawn_on_obj("controller_new", "zone_radioactive0031sss")
		olr.spawn_on_obj("controller_new", "lvl14_stancia_zone_radioactive_weak_0045")


		olr.spawn_on_obj("mil_killer_respawn_1", "rad_zone_radioactive_0046")
		olr.spawn_on_obj("mil_killer_respawn_2", "rad_zone_radioactive_0046")
		olr.spawn_on_obj("mil_killer_respawn_3", "rad_zone_radioactive_0046")
		olr.spawn_on_obj("mil_killer_respawn_4", "rad_zone_radioactive_0046")

		olr.spawn_on_obj("mil_killer_respawn_1", "rad_zone_radioactive_0094")
		olr.spawn_on_obj("mil_killer_respawn_2", "rad_zone_radioactive_0094")
		olr.spawn_on_obj("mil_killer_respawn_3", "rad_zone_radioactive_0094")
		olr.spawn_on_obj("mil_killer_respawn_4", "rad_zone_radioactive_0094")
		

end

function sarcosms()
	olr.kill_mon_in_radius(db.actor:position(), 250)
	news_manager.send_tip(db.actor, "You survived this time.", nil, "unknown", 19000)
	olr_timers.st_timer("attak3", 12, "nick.sarcosms2()")
end

function sarcosms2()
	news_manager.send_tip(db.actor, "Who are you?!", nil, "act", 19000)
	olr_timers.st_timer("attak323", 14, "nick.sarcosms3()")
end

function sarcosms3()
	news_manager.send_tip(db.actor, "Last time, you couldn't even pass this hall.", nil, "unknown", 19000)
end


function agr_yas_offl()
	local sobj = alife():object("lvl3_agroprom_inventory_box") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, true)
    		alife():set_switch_online (id, false)
    		alife():set_interactive (id, false)
		--log1(" box id"..id.."")
	end
end


function punck_mosk_up()
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvlobhod_nofeet_rad" then
	local h = hit ()
	h.power = 5230.1
	h.direction = vector():set (0, 100, 0)
	h.impulse = 2230
	h.draftsman = db.actor
	h.type = hit.strike
	car:hit (h)
	local pos = car:position()
	local x, y, z = pos.x, pos.y, pos.z
	particles_object([[anomaly\a-03-flash-sparks_old00]]):play_at_pos(vector():set(x,y,z))
	particles_object([[anomaly\a-03-expl-sparks_00]]):play_at_pos(vector():set(x,y,z))
	particles_object([[anomaly2\monolith_golo_death_olr]]):play_at_pos(vector():set(x,y,z))
	--log1("hit fucker")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\sob2]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	end
	end	
end


function leltwl_actor_away()
	news_manager.send_tip(db.actor, "Hey! Are you alive? I think the radiation has subsided. Hell knows, maybe the Zone doesn't want to let you in...", nil, "trader", 29000)
	olr_timers.st_timer("attakvert", 9, "nick.attakvert()")
	olr.del_by_name("lvl_lvltw_veh_nis_0001")
end

function attakvert()
	news_manager.send_tip(db.actor, "Base, hawk one down. Watching the wreckage. И... there doesn't seem to be any radiation. The equipment's not picking up.", nil, "heli", 29000)
	news_manager.send_tip(db.actor, "Base, I see an unknown person in an enclosed area. Possibly armed with heavy weaponry. Request to open fire.", 9, "heli", 29000)
	olr_timers.st_timer("attakrpgspawn", 7, "nick.attakrpgspawn()")
end

function attakrpgspawn()
	olr.spawn_on_obj("wpn_rpg7", "lvl_level12_space_restrictor_0004")
	olr.spawn_on_obj("wpn_rpg7", "lvl_level12_space_restrictor_0004")
	olr.spawn_on_obj("wpn_rpg7", "lvl_level12_space_restrictor_0004")
	olr.spawn_on_obj("detector_simple", "lvl_level12_space_restrictor_0004")
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_f1_explosion]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	particles_object([[explosions\expl_benzin_00]]):play_at_pos(vector():set(57.68,-11.15,-164.36))
	olr.info("lev_heli_atackmosk")
end

function start_shvatka_mosk_tmrst()
	db.actor:detach_vehicle()
	news_manager.send_tip(db.actor, "Stop! There's a strong radiation source down here! I think someone's--", nil, "trader", 29000)
	olr_timers.st_timer("attak1", 2, "nick.tlpmoskfight()")
	olr_timers.st_timer("attak2", 6, "nick.tlpmoskfight2()")
	olr_timers.st_timer("attak3", 16, "nick.tlpmoskfight3()")
end


function tlpmoskfight3()
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvlobhod_nofeet_rad" then
	local h = hit ()
	h.power = 0.1
	h.direction = vector():set (0, -1, 0)
	h.impulse = 0
	h.draftsman = db.actor
	h.type = hit.strike
	car:hit (h)
	--log1("hit fucker")
	end
	end
	end	
end

function tlpmoskfight2()
	db.actor:give_info_portion("start_mosk_figh_go")
	news_manager.send_tip(db.actor, "You can't go any further.", nil, "unknown", 49000)
	news_manager.send_tip(db.actor, "Play with me.", 12, "unknown", 49000)
	olr_timers.st_timer("attak3", 366, "nick.kill_mosk_strahovka()")
	local bsobj = alife():object("lvl_level12_big_container") 
	if bsobj then 
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	alife():create_ammo("ammo_vgm93", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	end

end

function kill_mosk_strahovka()
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvlobhod_nofeet_rad" then
	car:kill(car)
	end
	end
	end
end

function tlpmoskfight()
	if db.actor:alive() then
		olr.del_by_name("lvl_level12_space_restrictor_0001")
		olr.del_by_name("lvl_level12_space_restrictor_0000")
		local point = patrol("tlpmoskfight_walk")
		local look = patrol("tlpmoskfight_look")
		db.actor:set_actor_position(point:point(0))
		local dir = look:point(0):sub(point:point(0))
		db.actor:set_actor_direction(-dir:getH())
        	level.add_pp_effector("black.ppe", 20131, false)
	end
end



function sigaret_smoke()
	local pos = db.actor:bone_position("bip01_l_hand"):add(db.actor:direction():mul(0.1))
	local x, y, z = pos.x, pos.y, pos.z
	particles_object([[weapons\generic_sigarets]]):play_at_pos(vector():set(x,y,z))
end


function set_prip_mons()
	local sobj = alife():object("lvl16_generators_staler_undead_olr_0004") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\hero\strelok]]
    			data.visual_name = vis
          		data.character_name = ""
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl13_prip_staler_undead_olr") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\monolit\stalker_mo_hood_12]]
    			data.visual_name = vis
          		data.character_name = ""
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl16_generators_staler_undead_olr_0001") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\hero\strelok]]
    			data.visual_name = vis
          		data.character_name = ""
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl16_generators_staler_undead_olr_0002") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = ""
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl16_generators_staler_undead_olr_0003") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = ""
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl16_generators_stalker_0033") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = ""
      			pk:set( data )
		end	
	end
	local sobj = alife():object("lvl16_generators_stalker_0032") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = ""
      			pk:set( data )
		end	
	end
end


function spawn_barman_prip_now()
	level.add_pp_effector("fire_hit.ppe", 231, false)
	db.actor.power = -db.actor.power/math.random(2,5)
	level.add_cam_effector2("camera_effects\\punch_effector.anm", 950, false, "")
	olr.blow_add(300)
	news_manager.send_tip(db.actor, "What the... I think there's someone in that house. I'll have to check it out", 2, "act", 29000)
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\gauss_shoot]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1)
	local sobj = alife():object("lvl13_prip_space_restrictor_0010") 
	if sobj then 
		olr.add_spot_on_map(sobj.id,"blue_location","I think some strange weapons were fired from there.") 
	end
	olr.del_by_name("lvl13_prip_space_restrictor_0009")
	olr.spawn_on_obj("exo_outfit", "lvl13_prip_physic_object_0341")
	--olr.spawn_on_obj("exo_acum_ob", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("sigaret", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("sigaret", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("sigaret", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("sigaret", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("sigaret", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("sigaret", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("antirad", "lvl13_prip_physic_object_0341")
	olr.spawn_on_obj("antirad", "lvl13_prip_physic_object_0341")
	olr.kill_mon_in_radius(db.actor:position(), 55)
end



function spawn_barman_prip_now_hi()
	if db.actor:alive() then
	olr.del_by_name("lvl13_prip_physic_object_0342")
	level.disable_input()  -- при виде крысы
	level.disable_input()  -- при виде крысы ХАК
	local point = patrol("krisa_prip_walk")
	local look = patrol("krisa_prip_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
	olr.del_by_name("lvl13_prip_space_restrictor_0010")
	olr_timers.st_timer("attak1", 14, "nick.pr_bar_angr1()")
	olr.disable_walk()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 195 then
			if npc:character_community() == "monolith" or npc:character_community() == "killer" or npc:character_community() == "bandit" or npc:character_community() == "military" then
				log1("go offline "..npc:name().."")
				local se_obj = alife():object(npc:id())
  				if se_obj then
    						alife():set_switch_offline (se_obj.id, true)
    						alife():set_switch_online (se_obj.id, false)
    						alife():set_interactive (se_obj.id, false)
						olr_timers.st_timer("convert_online", 370, "olr_npc_eqp.convert_online_out("..npc:id()..")")
  				end
			end
		end
	end
	level.disable_input()  -- при виде крысы
	level.disable_input()  -- при виде крысы ХАК
	end
end



function pr_bar_angr1()
	level.disable_input()  -- при виде крысы
	level.disable_input()  -- при виде крысы ХАК
	olr_timers.st_timer("attak1", 14, "nick.pr_bar_angr2()")
	news_manager.send_tip(db.actor, "I was told that the devil himself was helping you, but I was a fool not to believe it! You threw the gun under your feet! For me to see.", nil, "barman", 9000)
	local act = db.actor		
	act:iterate_inventory(
			function(act, obj) 
			if obj and obj:is_weapon_magazined() then
				act:drop_item(obj)	
			end
			--local wpn = bos:best_weapon()
			--if wpn then
			--	wpn:set_ammo_elapsed(5)
			--end
			end
			, act)
end

function pr_bar_angr2()
	olr_timers.st_timer("attak21", 16, "nick.pr_bar_angr3()")
	news_manager.send_tip(db.actor, "Why don't you say something?", nil, "barman", 9000)
end

function pr_bar_angr3()
	level.disable_input()  -- при виде крысы
	level.disable_input()  -- при виде крысы ХАК
	olr_timers.st_timer("attak231", 17, "nick.kill_krisa_deagle()")
	olr_timers.st_timer("attak31", 18, "nick.kill_krisa_pri()")
	news_manager.send_tip(db.actor, "Why do you want to go to Monolith? You've already been there, and it didn't end well for you. What can you ask for? What do you know about life? You won't know what to ask! You--", nil, "barman", 16000)
end


function kill_krisa_deagle()
	local sobj = alife():object("lvl13_prip_stalker_0089") 
	if sobj then 
		alife():create("wpn_fort", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)
	end
	olr_timers.st_timer("kill_krisa_scr_prp", 1, "nick.kill_krisa_scr_prp()")	
end

function kill_krisa_scr_prp()
	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvl13_prip_stalker_0089" then
	local h = hit ()
	h.power = 0.1
	h.direction = vector():set (0, -1, 0)
	h.impulse = 0
	h.draftsman = db.actor
	h.type = hit.strike
	car:hit (h)
	--log1("hit fucker")
	end
	end
	end
end

function kill_krisa_pri()
	level.disable_input()  -- при виде крысы
	level.disable_input()  -- при виде крысы ХАК
	olr_timers.st_timer("attak5", 3, "nick.kill_barman_pr()")
	local point = patrol("krisa_prip_walk")
	local look = patrol("krisa_prip_look")
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	
	local active_item = db.actor:active_item()  -- нож
	if active_item and db.actor:active_slot()==0 then
		db.actor:move_to_ruck(active_item)
	end

	local active_item = db.actor:active_item()  -- пист
	if active_item and db.actor:active_slot()==1 then
		db.actor:move_to_ruck(active_item)
	end

	local active_item = db.actor:active_item()  -- винт
	if active_item and db.actor:active_slot()==2 then
		db.actor:move_to_ruck(active_item)
	end

	local active_item = db.actor:active_item()  -- 4
	if active_item and db.actor:active_slot()==4 then
		db.actor:move_to_ruck(active_item)
	end

	local active_item = db.actor:active_item()
	if active_item and db.actor:active_slot()==5 then  -- болт
		--log1("fff")
		get_actor_obj():press_action(29)
	end

	local active_item = db.actor:active_item()  -- гранаты
	if active_item and db.actor:active_slot()==11 then
		db.actor:move_to_ruck(active_item)
	end	

	local gaus = alife():create('wpn_gauss_m1', db.actor:position(),db.actor:level_vertex_id(),db.actor:game_vertex_id(),db.actor:id())
	if gaus then		
		olr_timers.st_timer("trygauss_kill_barmn", 2, "nick.trygauss_kill_barmn()")
		return
	end

	--local active_item = db.actor:active_item()
	--if active_item and db.actor:active_slot()==2 then
	--	active_item:set_ammo_elapsed(1)
	--	olr_timers.st_timer("attak", 1, "olr.emu_shoot()")
	--	return
	--end
end

function trygauss_kill_barmn()

       	local item_in_hands = db.actor:item_in_slot(2)
       	if item_in_hands ~= nil and item_in_hands:section()~="wpn_gauss_m1" then
       		db.actor:move_to_ruck(item_in_hands)
	end

	local wpng = db.actor:object("wpn_gauss_m1")
	if wpng ~= nil then
		log1("wpng")
		wpng:set_ammo_elapsed(3)

	local wait_time = 0
  	wait_time = time_global() + 100
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() db.actor:move_to_slot(wpng) end
  	)

	local wait_time = 0
  	wait_time = time_global() + 200
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() db.actor:activate_slot(2) end
  	)

	local wait_time = 0
  	wait_time = time_global() + 600
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.emu_shoot() end
  	)
		
		olr_timers.st_timer("attak", 1, "olr.emu_shoot()")
	end
end

function kill_barman_pr()
	local sobj = alife():object("lvl13_prip_stalker_0089") 
	if sobj then 
		alife():create("wpn_fort", sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id)
	end
	db.actor:give_info_portion("prip_monols_spawn")
	olr_timers.st_timer("mattak", 12, "nick.pr_molols_1()")
	level.enable_input()	-- как завалим
	olr.enable_walk()
	olr.del_by_name("lvl13_prip_space_restrictor_0018")
for i=1, 65534 do
local car = level.object_by_id(i)
if car then
if car ~= nil and 
car:name() == "lvl13_prip_stalker_0089" then
local h = hit ()
h.power = 100000
h.direction = vector():set (0, -1, 0)
h.impulse = 0
h.draftsman = car
h.type = hit.strike
car:hit (h)
--log1("kill fucker")
end
end
end	
end



function pr_molols_1()
	local sobj = alife():object("lvl13_prip_staler_undead_olr") 
	if sobj then 
		olr.add_spot_on_map(sobj.id,"blue_location","Monolith Stalker") 
	end
	news_manager.send_tip(db.actor, "Message: Don't shoot, twice-born, we're here to help you. You can't go any further without us... there are military snipers everywhere...", nil, "monolith", 9000)
	olr_timers.st_timer("matta2k", 9, "nick.pr_molols_2()")
end


function pr_molols_2()
	news_manager.send_tip(db.actor, "Message: What do you want?", nil, "act", 5000)
	olr_timers.st_timer("matta3k", 5, "nick.pr_molols_3()")
end


function pr_molols_3()
	news_manager.send_tip(db.actor, "Message: We are of the Monolith clan, we believe that the Zone has chosen you. And we will help you get to the power plant. But from here on, you will go alone. The Zone doesn't like it when someone uninvited gets close to its heart... But be warned that not everyone in our clan shares these views... Follow us...", nil, "monolith", 15000)
end


function onolsgoo_prip_now()
	news_manager.send_tip(db.actor, "Message: Come on, but don't fall behind... The military snipers are not dormant... they're guarding the approach.", nil, "monolith", 9000)
end

function onolsgoo_prip_nowpri()
	news_manager.send_tip(db.actor, "Message: There's a passageway. we think the Zone can't be wrong... good luck to you... ", nil, "monolith", 9000)
	olr_timers.st_timer("matta33k", 45, "nick.del_mon_prfriend()")
end


function del_mon_prfriend()
	olr.del_by_name("lvl13_prip_staler_undead_olr")
end



function rad_bun_to_mosk_sms()
local sobj = alife():object("l10u_radar_bunker_physic_object_0075") 
if sobj then 
olr.add_spot_on_map(sobj.id,"blue_location","detail") 
end
local sobj = alife():object("lvl12_radar_bunker_physic_object_0020") 
if sobj then 
olr.add_spot_on_map(sobj.id,"blue_location","detail") 
end
	news_manager.send_tip(db.actor, "I think I can sense where they are... I'm still able to scan their memories. even though they're dead. You should be able to see them now.", nil, "unknown", 49000)
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("m_burer_green", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("karlito_yellow", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("karlito_yellow", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("karlito", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("karlito", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawen_phantoms()
	olr_timers.st_timer("spawen_phantoms", 15, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 35, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 65, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 95, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 115, "olr.spawen_phantoms()")
end


function bun_on_nasos()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\drone_long_deep]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\machine_pulse]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("lvl12_radar_bunker_space_restrictor_0017")
	olr.del_by_name("lvl_test_physic_object_0005")
	olr.del_by_name("lvl_test_physic_object_0004")
	olr.del_by_name("lvl_test_physic_object_0002")
	olr.del_by_name("lvl_test_physic_object_0001")
	olr.del_by_name("lvl_test_physic_object_0003")
	olr.del_by_name("lvl_test_physic_object_0006")
	olr.del_by_name("lvl_test_physic_object_0066")
	olr.del_by_name("lvl_test_physic_object_0000")

	olr.del_by_name("lvl_test_physic_object_0007")
	olr.del_by_name("lvl_test_physic_object_0008")
	olr.del_by_name("lvl_test_physic_object_0009")

	olr.del_by_name("l10u_radar_bunker_physic_object_0048")
	olr.spawn_on_obj("item_razradnik", "l10u_radar_bunker_physic_object_0147")
	olr.spawn_on_obj("item_razradnik", "l10u_radar_bunker_physic_object_0148")

	local snd_obj = xr_sound.get_safe_sound_object([[ol3\re\water_sliv]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)

	olr.spawn_on_obj("karlito_yellow", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("karlito_yellow", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("m_burer_green", "lvl12_radar_bunker_zone_radioactive_killing_0003")

	olr.spawn_on_obj("conserva", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("conserva", "lvl12_radar_bunker_zone_radioactive_killing_0003")

end



function bun_mosk_start_otkachka()

	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and IsStalker(kill) or IsMonster(kill) then
			if kill.level_name == "lvl14_stancia" then
				if not kill:alive() then
					cnt = cnt+1
					alife():release(kill, true) 
				end
			end		
		end
	end
	log1(cnt)

	olr.blow_add(500)

	local bloodbridge = vector():set( -7.55, -25.69, 20.00 )
	local a = alife():create("hand_torch", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local b = alife():create("battery_change", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local c = alife():create("conserva", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	local d = alife():create("af_lichinka", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	--clear_useful_for_ai(a)
	--clear_useful_for_ai(b)
	--clear_useful_for_ai(c)
	--clear_useful_for_ai(d)

	olr.spawn_on_obj("item_razradnik", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("item_razradnik", "lvl12_radar_bunker_zone_radioactive_killing_0003")

	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0002")
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0002")

	olr.spawn_on_obj("bloodsucker_proto", "lvl12_radar_bunker_zone_radioactive_killing_0002")
	olr.spawn_on_obj("m_fracture_e", "lvl12_radar_bunker_zone_radioactive_killing_0002")
	olr.spawn_on_obj("poltergeist_build", "lvl12_radar_bunker_zone_radioactive_killing_0002")
	olr.spawn_on_obj("m_pseudodog_e", "lvl12_radar_bunker_zone_radioactive_killing_0002")
	olr.spawn_on_obj("m_burer_green", "lvl12_radar_bunker_zone_radioactive_killing_0002")

	olr.spawn_on_obj("af_lichinka", "lvl12_radar_bunker_zone_radioactive_killing_0002")


	news_manager.send_tip(db.actor, "It seems the lower levels are flooded. We have to find a way to pump out the water.", nil, "act", 49000)

	olr.to_online("l10u_radar_bunker_physic_object_0008")
	olr.to_online("l10u_radar_bunker_physic_object_0007")

	olr.del_by_name("lvl12_radar_bunker_physic_object_0028")
	olr.del_by_name("lvl12_radar_bunker_space_restrictor_0018")

local sobj = alife():object("l10u_radar_bunker_physic_object_0008") 
if sobj then 
olr.add_spot_on_map(sobj.id,"blue_location","generator") 
end
local sobj = alife():object("l10u_radar_bunker_physic_object_0007") 
if sobj then 
olr.add_spot_on_map(sobj.id,"blue_location","generator.") 
end
local sobj = alife():object("lvl12_radar_bunker_physic_object_0033") 
if sobj then 
olr.add_spot_on_map(sobj.id,"blue_location","pump power.") 
end

end



function ros_fun_start_delete()
	olr.spawn_on_obj("korpus_gas", "lvl6_rostok_physic_object_0278")
	olr.spawn_on_obj("korpus_gas", "lvl6_rostok_physic_object_0278")
	olr.del_by_name("lvl6_rostok_space_restrictor_0038")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\wood_break]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("del_bun_to_mosk", 12, "nick.radddl_ros()")
end

function radddl_ros()
	local snd_obj = xr_sound.get_safe_sound_object([[olr\music\megafon_music_10]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.spawn_on_obj("m_burer_green", "lvl6_rostok_physic_object_0278")
	olr.spawn_on_obj("dead_body_skelet", "lvl6_rostok_physic_object_0278")
end

function del_punks_ros_del()
	olr.del_by_name("bar_bar_visitors_3_3")
	olr.del_by_name("bar_bar_visitors_3_3_0000")
	olr.del_by_name("lvl5_bar_stalker_0031")
	olr.del_by_name("bar_bar_visitors_3_3_0001")
end


function rad_bun_to_mosk_prip()
	olr.kill_mon_in_radius(db.actor:position(), 55)
	local point = patrol("brain_prip_idl_look")
	local look = patrol("brain_prip_idl_walk")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	level.add_pp_effector("black.ppe", 201831, false)
	db.actor:give_info_portion("prip_mosk_start_quest_spawn")
	news_manager.send_tip(db.actor, "Brain mass: Well, here I am in town... Come on, they're waiting for me at home.", 2, "default", 60000)
	olr_timers.st_timer("del_bun_to_mosk_alert", 6, "nick.rad_bun_to_mosk_prip_go_kontrs()")
local sobj = alife():object("l10u_radar_bunker_physic_object_0075") 
if sobj then 
olr.del(sobj)
end
local sobj = alife():object("lvl12_radar_bunker_physic_object_0020") 
if sobj then 
olr.del(sobj)
end
end

function rad_bun_to_mosk_prip_go_kontrs()
	olr.info("mosk_prip_go_sturm")
	news_manager.send_tip(db.actor, "I'm coming, I'm coming!", 2, "default", 30000)
	news_manager.send_tip(db.actor, "Brain mass: In the house of culture there is some strong radiation... Stay close to me, I'll keep you safe...", 8, "default", 60000)
end

function rad_mosk_away_prip()
	nik_dialog.out_item_much("mosk_part_one",1)
	nik_dialog.out_item_much("mosk_part_two",1)
	olr_timers.st_timer("del_bun_to_mosk", 20, "nick.rad_bun_to_mosk_tmr_del()")
end

function rad_bun_to_mosk_tmr_del()
	olr.to_offline("lvl12_radar_bunker_brain_lab_nofeet")
	local wait_time = 0
  	wait_time = time_global() + 111
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl12_radar_bunker_brain_lab_nofeet") end
  	)
	olr.del_by_name("lvl12_radar_bunker_space_restrictor_0019")  -- рестриктор который пока не поможешь мозгу не удаляется
	olr.del_by_name("radar_m_car_0003_doroga_0002")  -- бтр на входе в лабу
	olr.del_by_name("radar_m_car_0003_doroga_0000")  -- бтр 
	olr.del_by_name("radar_m_car_0003_doroga_0001")  -- бтр
	db.actor:give_info_portion("bun_mosk_start_quest_go_done")
end

function rad_have_mosk_all()
     return nik_dialog.item_much("mosk_part_one",1) ~= false and nik_dialog.item_much("mosk_part_two",1) ~= false
end


function bun_mosk_start_ques()
	olr.del_by_name("lvl12_radar_bunker_physic_object_0005")
	olr.del_by_name("lvl12_radar_bunker_physic_object_0024")
	olr_timers.st_timer("bun_to_mosk", 12, "nick.rad_bun_to_mosk_sms()")
end

function rad_bun_to_mosk_tmr_go()
	local point = patrol("brain_idl_look")
	local look = patrol("brain_idl_walk")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	level.add_pp_effector("black.ppe", 201831, false)
	--level.add_cam_effector2("camera_effects\\fatigue.anm", 90, false, "")
end

function rad_bun_to_mosk_tmr()
	olr_timers.st_timer("ded_bun_to_mosk_i", 2, "nick.rad_bun_to_mosk_tmr_go()")
end

function pes_zapas_triday()
	local obj = olr.give_item("detector_simple")
	level.client_spawn_manager():add(obj.id, 0, function(id,obj) obj:set_condition((math.random(95,99)/100)) end)
	olr.give_item("wpn_addon_scope_susat")
	olr.give_item("wpn_l85")
	olr.give_item("af_banka_s_holodcom")
	olr.give_item("battery_change")
	olr.give_item("medkit")
	olr.give_item("antirad")
	alife():create_ammo("ammo_5.56x45_ap", db.actor:position(),db.actor:level_vertex_id(),  db.actor:game_vertex_id(),db.actor:id(),90)
end


function has_gravimolot()
     return nik_dialog.item_much("grav_molot",1) ~= false
end

function give_gravimolot_rev()
	nik_dialog.out_item_much("grav_molot",1)
	alife():create_ammo("ammo_gauss", db.actor:position(),db.actor:level_vertex_id(),  db.actor:game_vertex_id(),db.actor:id(),10)
	alife():create_ammo("ammo_gauss", db.actor:position(),db.actor:level_vertex_id(),  db.actor:game_vertex_id(),db.actor:id(),10)
end

function molot_burers()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\wood_break]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.spawn_on_obj("m_burer_green", "lvl3_agroprom_space_restrictor_0020")
	olr.spawn_on_obj("m_burer_weak", "lvl3_agroprom_space_restrictor_0020")
	olr.spawn_on_obj("m_burer_normal", "lvl3_agroprom_space_restrictor_0020")
end


function kvest_gravimolot_acessss()
	if ( xr_conditions.actor_in_zone(nil,nil,{"lvl3_agroprom_space_restrictor_0018"}))  then
		level.add_pp_effector("black.ppe", 20131, false)
	end
	db.actor:give_info_portion("kvest_gravimolot_go")
	olr.del_by_name("lvl3_agroprom_physic_object_0382")
	olr.del_by_name("lvl3_agroprom_rat_zaval")
	news_manager.send_tip(db.actor, "Informant: Messer, you've been to the research institute before, right? I'm interested in something from there. In the dungeons beneath the main complex, there's a lair of dwarves... or something bigger, but they have this thing that looks like a big sledgehammer. like a hammer. If you bring it to me, I'll thank you.", nil, "flash", 49000)
end


function away_zaval_and_del()
	olr.del_by_name("lvl1_escape_space_restrictor_0107")
	olr.del_by_name("lvl1_escape_stalker_0056")
	olr_timers.st_timer("delete_zaval_nii", 3223, "nick.agr_del_zaval()")
end

function agr_del_zaval()
	olr.beep()
	olr.del_by_name("lvl3_agroprom_physic_object_0421")
	olr.del_by_name("lvl3_agroprom_physic_object_0365")
	olr.del_by_name("lvl1_escape_space_restrictor_0107")
	olr.del_by_name("lvl1_escape_stalker_0056")
	news_manager.send_tip(db.actor, "Messer, it's done. You can go check out your basement on MedPribor...", nil, "trader", 49000)
end

function zaval_remove_start_talk_tmrst()
	olr_timers.st_timer("fov_gen_out", 23, "nick.esc_kil_mil_go()")
end

function esc_kil_mil_go()
	local sobj = alife():object("lvl1_escape_space_restrictor_0107") 
	if sobj then 
		olr.add_spot( sobj.id,"eliminate_lager_location","Wood" )
	end
	db.actor:give_info_portion("start_kill_mil_esc")
	news_manager.send_tip(db.actor, "Toad: Go ahead, he should be near the bridge by now. Hide in the tree, the marker has been downloaded to your PDA, and from there, kill him... Just don't let him see you! He shouldn't be able to see you.", nil, "trader", 49000)
end

function on_wood_talk_tmrst()
	local sobj = alife():object("lvl1_escape_stalker_0056") 
	if sobj then 
		olr.add_spot( sobj.id,"eliminate_lager_location","Military" )
	end
	local pos = vector():set(67,2,156)
	olr.kill_mon_in_radius(pos, 170)
end

function expl_actor_away()
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\pkm_btr_shoot]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	db.actor.health = -1
	local zh = hit()
	zh.draftsman = db.actor
	zh.type = hit.wound
	zh.direction = self.object:position():sub(actor)
	zh:bone("pelvis")
	zh.power = 1121
	zh.impulse = 20.01
	db.actor:hit(zh)
end



function bar_robber_actor()
	db.actor:change_character_reputation(-50)
	news_manager.send_tip(db.actor, "Message: What do you think. you know the one from the death truck? What a bunch of people. Took everything in the bar. right off the tables! Me and my boys were just marveling. the nerve of that guy. Well, nothing, we'll know.", nil, "unknown", 49000)
end

function first_killer_timer_seen(id)
	olr.info("messer_killar_washe")
	db.actor:change_character_reputation(-400)
	local sobj = alife():object(id)
  	if sobj then
		local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		local name = data.character_name
			local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(sobj.m_game_vertex_id):level_id()), vector():set(sobj.position.x,sobj.position.y,sobj.position.z))
     			news_manager.send_tip(db.actor, "Guys, you know that concussed guy from the death truck? Looks like he's totally fucked up. He killed our guy, I saw him. All I had time to do was make contact on the PDA-- "..name.."... Be advised. "..pos.." there's a dead body lying there right now. See for yourself if you don't believe me.", nil, "unknown", 39000)
		end
  	end	
end


function rat_fly_away()
	level.disable_input()
	level.hide_indicators()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\low_base]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	bind_stalker.hide_weapon()
	olr_timers.st_timer("fov_gen_out", 3, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 6, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 9, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 12, "nick.fov_gen_out2()")
	olr_timers.st_timer("fov_gen_out", 15, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out", 18, "nick.fov_gen_out()")
	olr_timers.st_timer("fov_gen_out_end", 22, "nick.fov_gen_out_end()")
end

function fov_gen_out()
	device():set_fov(device():get_fov() - 3)
end

function fov_gen_out2()
	olr.kill_mon_in_radius(db.actor:position(), 95)
	olr.disable_walk()
	level.add_pp_effector("black.ppe", 201831, false)
	device():set_fov(device():get_fov() - 3)
	local obj = alife():create("nap_krest_psyh", db.actor:position():add(db.actor:direction():add(10)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
	--clear_useful_for_ai(obj)
	--local pk = get_netpk(obj,1)
  	--	if pk:isOk() then
    	--		local data = pk:get()
	--			local vis = [[vlad\jurn_zombie]]
    	--		data.visual_name = vis
      	--		pk:set( data )
	--	end	
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\fear_hata]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function fov_gen_out_end()
	level.add_pp_effector("black.ppe", 201831, false)
	device():set_fov(65)
	xr_effects.game_credits()
end

function zov_start_rat_ending()
	local point = patrol("start_rat_ending_walk")
	local look = patrol("start_rat_ending_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	level.add_pp_effector("black.ppe", 201831, false)
	olr_timers.st_timer("morak_zombvoen", 23, "nick.killkrisageen()")
end

function killkrisageen()
	olr.kill_mon_in_radius(db.actor:position(), 125)
end


function del_jabas_art_navodki()
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
			local sect = obj:section_name()
			if sect == "treasure_place_metka" then 
				sim:release(obj)
			end					
		end
	end
end


function ufo_fly_away()
	db.actor:give_info_portion("mars_tarelka_goaway")
        level.add_pp_effector("black.ppe", 20131, false)
	--level.add_cam_effector2("camera_effects\\hid_disk_away.anm", 90, false, "xr_effects.game_credits")
	level.add_cam_effector2("camera_effects\\hid_disk_away.anm", 90, false, "nick.exitgameufo")
	db.actor:set_actor_position(vector():set(200,4,0))
end

function exitgameufo()
	get_console():execute("quit")
end

function has_case_and_money()
     return nik_dialog.item_much("diplomat_code_viska",1) ~= false and db.actor:money() >= 200
end


function out_money_200(t1, t2) 
 local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,200,"out") 
end


function out_5_conserva_sciet()
	nik_dialog.out_item_much("conserva",5)
	olr.give_item("detector_zomscan")
end

function has_five_conservas()
     return nik_dialog.item_much("conserva",5) ~= false 
end



function otdaem_detector_zomscan()
	olr.del_by_name("box_lab_0003_sms_sign_zomb_miliary")
	nik_dialog.out_item_much("detector_zomscan",1)
	olr.del_by_name("lvl9_military_stalker_0054")
	olr.give_item("medkit")
	olr.give_item("medkit")
	olr.give_item("medkit")
end

function scan_sms_zomb_doc()
	news_manager.send_tip(db.actor, "It's Docent. The group is in the territory of the Silent Hills. Maybe you've already been there. After you're done, don't forget the device. It's the only one we have at the moment.", nil, "ecolog", 39000)
end

function daem_detector_zomscan()
	olr_timers.st_timer("scan_sms_zomb_doc", 45, "nick.scan_sms_zomb_doc()")
	olr.give_item("detector_zomscan")
	local sobj = alife():object("box_lab_0003_sms_sign_zomb_miliary") 
	if sobj then 
		olr.add_spot( sobj.id,"eliminate_lager_location","A group of zombified stalkers" )
	end
end

function has_zomb_scaner()
     return nik_dialog.item_much("detector_zomscan",1)
end



function has_yan_check_zombied()
	return has_alife_info("mil_zomb_check_one") and has_alife_info("mil_zomb_check_two") and has_alife_info("mil_zomb_check_tri")
end


function has_yan_check_zombied_killed()
	return has_alife_info("docent_zobm_dead_1") and has_alife_info("docent_zobm_dead_2") and has_alife_info("docent_zobm_dead_3")
end


function has_yan_check_zombied_killed_scaned()
	return has_alife_info("mil_zomb_check_one_dead") and has_alife_info("mil_zomb_check_two_dead") and has_alife_info("mil_zomb_check_tri_dead")
end



function set_jaba_mil_offline()
  local se_obj = alife():story_object(1209)
  if se_obj then
    alife():set_switch_offline (se_obj.id, true)
    alife():set_switch_online (se_obj.id, false)
    alife():set_interactive (se_obj.id, false)
  end
end


function set_jaba_mil_online()
	news_manager.send_tip(db.actor, "Attention everyone, I repeat, who needs it, look for it in the territory of the Silent Hills.", 50, "trader", 25000)
end


function sky_resarch()
	if not has_alife_info("kolbat_research_knife") then
		news_manager.send_tip(db.actor, "This is Cobalt. Come on, I think we got something. Bring a bayonet knife. I have an idea.", nil, "flash", 39000)
		db.actor:give_info_portion("kolbat_research_knife")
		return
	end
	if not has_alife_info("kolbat_research_rgd") then
		news_manager.send_tip(db.actor, "It's Cobalt. Come on, I think we've got something. Take the RGD-5 grenade with you.", nil, "flash", 39000)
		db.actor:give_info_portion("kolbat_research_rgd")
		return
	end
	if not has_alife_info("kolbat_research_efka") then
		news_manager.send_tip(db.actor, "This is Cobalt. Come, I think I have something for you.", nil, "flash", 39000)
		db.actor:give_info_portion("kolbat_research_efka")
		return
	end
	if not has_alife_info("kolbat_research_ammo") then
		news_manager.send_tip(db.actor, "This is Cobalt. Come, I think I've got something.", nil, "flash", 39000)
		db.actor:give_info_portion("kolbat_research_ammo")
		return
	end
	news_manager.send_tip(db.actor, "This is Cobalt. The experiment failed, unfortunately. Maybe next time something will work.", nil, "flash", 39000)
end


function esc_to_bar_start_go_dolina_spawn_fix_enemys_delete()
	local pos = vector():set(-21,2,6)
	olr.kill_mon_in_radius(pos, 70)
	news_manager.send_tip(db.actor, "PDA: Error establishing connection (stalker Goplit) try to establish a connection manually.", nil, "sos", 39000)
	news_manager.send_tip(db.actor, "Messer: What? Goplit's here?", nil, "act", 39000)
	olr.del_by_name("lvl4_darkdolina_space_restrictor_glaz_place_0000")
end


function set_door_know()
	xvars.gentri_door_open = 1
end

function set_door_city()
	xvars.gentri_door_open = 2
end

function set_door_rat()
	xvars.gentri_door_open = 3
end


function fucnking_messer()

	olr_timers.st_timer("engame_fun_monolitc", 123, "nick.engame_fun_monolitc()")

	olr.del_by_name("lvl8_swamp_stalker_0014")

	olr.del_by_name("lvl11_deadcity_physic_object_0772")
	olr.del_by_name("lvl11_deadcity_physic_object_0773")

	olr.del_by_name("lvl9_military_staler_undead_olr")
	
	nick.remove_gg_sarko()
	olr.del_by_name("rad_start_btr_0001")
	olr.del_by_name("psy_izl_0000")
	olr.del_by_name("psy_izl_0001")
	olr.del_by_name("psy_izl")

	olr.del_by_name("bar_bar_lisiy")

	olr.to_online("lvl13_prip_space_restrictor_0007")  

	olr.del_by_name("lvl14_stancia_m_car_0003")
	olr.del_by_name("lvl13_prip_m_car_0006")
	olr.del_by_name("lvl13_prip_m_car_0005")
	olr.del_by_name("lvl13_prip_m_car_0004")
	olr.del_by_name("lvl13_prip_m_car_0001")
	olr.del_by_name("lvl13_prip_space_restrictor_0016")
	olr.del_by_name("lvl13_prip_space_restrictor_0015")
	news_manager.send_tip(db.actor, "Guys. you all know who's responsible for what happened. We need to find him. dead or alive. He can't get to the center.", nil, "exo_neutral", 39000)
	news_manager.send_tip(db.actor, "Attention, everyone! Stalker Messer, also known as Strelok, has been zombified in the Radar Antennae area. If he gets to the center, there's no telling what will happen to all of us...", 12, "exo_neutral", 39000)
end

function off_hata_gener()
	olr.del_by_name("lvl5_bar_physic_object_0281")
	olr.del_by_name("lvl5_bar_stalker_0024")
	olr.del_by_name("lvl5_bar_physic_object_1247")
	--db.actor:disable_info_portion("hata_svet_go")
end


function daem_anom_rgd5()
	olr.give_item("grenade_rgd5_anom")
	nik_dialog.out_item_much("grenade_rgd5",1)
	nik_dialog.out_item_much("af_gravi",1)
end

function daem_anom_f1()
	olr.give_item("grenade_f1_anom")
	nik_dialog.out_item_much("grenade_f1",1)
	nik_dialog.out_item_much("af_gold_fish",1)
end

function daem_anom_knife()
	olr.give_item("wpn_knife_anom")
	nik_dialog.out_item_much("wpn_knife",1)
	nik_dialog.out_item_much("af_gold_fish",1)
end

function daem_gravidrobbar()
	olr.give_item("wpn_shotgra")
	nik_dialog.out_item_much("wpn_spas12",1)
	nik_dialog.out_item_much("af_gold_fish",1)
end

function daem_anom_ammo_svd()
	alife():create_ammo("ammo_7.62x54_7h14_anom", db.actor:position(),db.actor:level_vertex_id(),  db.actor:game_vertex_id(),db.actor:id(),10)
	nik_dialog.out_item_much("af_gravi",1)
end

function daem_anom_ammo()
	olr_timers.st_timer("sky_resarch", 935, "nick.sky_resarch()")
	nik_dialog.out_item_much("af_gravi",2)
end

function has_anom_knife()
     return nik_dialog.item_much("wpn_knife",1) ~= false and nik_dialog.item_much("af_gold_fish",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gold-fish")
end

function has_anom_ammo()
     return nik_dialog.item_much("af_gravi",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gravi")
end

function has_two_gravi_cky()
     return nik_dialog.item_much("af_gravi",2) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gravi")
end

function has_anom_f1()
     return nik_dialog.item_much("grenade_f1",1) ~= false and nik_dialog.item_much("af_gold_fish",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gold-fish")
end

function has_anom_rgd()
     return nik_dialog.item_much("grenade_rgd5",1) ~= false and nik_dialog.item_much("af_gravi",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gravi")
end


function has_anom_drob()
     return nik_dialog.item_much("wpn_spas12",1) ~= false and nik_dialog.item_much("af_gold_fish",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gold-fish")
end


function has_exp_paras_all()
	return nik_dialog.item_much("pers_card_eco",3) ~= false and has_alife_info("paras_zaraz_dead") and has_alife_info("pribor_paras_mg_have") and nik_dialog.item_much("pribor_paras_spory_mg",1) ~= false
end


function has_yan_paras_cards()
     return nik_dialog.item_much("pers_card_eco",3) ~= false 
end


function pribor_paras_mg()
	db.actor:give_info_portion("pribor_paras_mg_have")
	news_manager.send_tip(db.actor, "Instrument: Results are in.", nil, "default", 39000)
end

function otdaem_kill_paras_exp_done()
	nik_dialog.out_item_much("pers_card_eco",3)
	nik_dialog.out_item_much("pribor_paras_spory_mg",1)
	olr.give_item("wpn_sig550")
	olr.del_by_name("yantarsie_zaraz_exp")
end


function daem_paras_mg_pribor()
	olr.give_item("pribor_paras_spory_mg")
	local sobj = alife():object("yantarsie_zaraz_exp") 
	if sobj then 
		olr.add_spot( sobj.id,"eliminate_lager_location","The last signal from the infected group of scientists" )
	end
end

function otdaem_psy_golovu()
	nik_dialog.out_item_much("af_dummy_glassbeads",1)
	olr.del_by_name("lvl7_yantar_space_restrictor_0084")
	olr_timers.st_timer("otdaem_psy_golovu", 135, "nick.daem_otdaem_psy_golovu()")
end

function daem_paras_pri()
	news_manager.send_tip(db.actor, "Just don't go inside the complex with that hat. Don't forget we still have to get it back.", nil, "ecolog", 39000)
end


function daem_proto_psy_shap()
	olr.give_item("proto_psy_shap")
	olr_timers.st_timer("daem_paras_pri", 35, "nick.daem_paras_pri()")
end

function daem_otdaem_psy_golovu()
	news_manager.send_tip(db.actor, "Docent: Sorry, I forgot to reward you... here are the coordinates of the hideout. I don't need it, I'm never gonna get there myself. Thanks again for helping science.", nil, "ecolog", 39000)
	db.actor:change_character_reputation(10)
	olr_treasure.create_treasure()
end

function oh_fuck_yan_escape()
	nick.start_ohranik_quest_yan()
	news_manager.send_tip(db.actor, "Oh, damn it, not him again! I'm outta here!", nil, "ecolog", 39000)
	olr.del_by_name("lvl7_yantar_stalker_bunker")
	olr.del_by_name("lvl7_yantar_stalker_0068")
	nick.gar_lamb_zombs()
	nick.gar_lamb_zombs()
end


function has_yan_paras_st()
     return nik_dialog.item_much("pribor_paras_spory",1) ~= false 
end


function otdaem_pribor_paras_spory()
	nik_dialog.out_item_much("pribor_paras_spory",1)
 	dialogs.relocate_money(first_speaker, 1200, "in")
	olr.del_by_name("lvl7_yantar_physic_object_0704")
	olr.blow_add(500)
end


function pribor_paras_inf()
	db.actor:give_info_portion("pribor_paras_inf_have")
	news_manager.send_tip(db.actor, "Dashboard: Results are in.", nil, "default", 39000)
end


function daem_paras_pribor()
	olr.give_item("pribor_paras_spory")
	olr.spawn_on_obj("pseudodog_w_namordnike_ghost2", "lvl11_deadcity_zone_radioactive_weak_0030")
olr.spawn_on_obj("zombie_plague", "lvl11_deadcity_zone_radioactive_weak_0031")
olr.spawn_on_obj("zombie_normal", "lvl11_deadcity_zone_radioactive_weak_0031")
olr.spawn_on_obj("m_zombie_e", "lvl11_deadcity_zone_radioactive_weak_0031")
olr.spawn_on_obj("zombie_strong", "lvl11_deadcity_zone_radioactive_weak_0031")
olr.spawn_on_obj("pseudodog_w_namordnike_ghost", "lvl11_deadcity_zone_radioactive_weak_0031")
olr.spawn_on_obj("zombie_plague", "lvl11_deadcity_zone_radioactive_weak_0034")
olr.spawn_on_obj("zombie_normal", "lvl11_deadcity_zone_radioactive_weak_0034")
olr.spawn_on_obj("m_zombie_e", "lvl11_deadcity_zone_radioactive_weak_0034")
olr.spawn_on_obj("zombie_strong", "lvl11_deadcity_zone_radioactive_weak_0034")
olr.spawn_on_obj("pseudodog_w_namordnike", "lvl11_deadcity_zone_radioactive_weak_0034")
olr.spawn_on_obj("pseudodog_w_namordnike_medpribor", "lvl11_deadcity_zone_radioactive_weak_0026")
olr.spawn_on_obj("pseudodog_w_namordnike_medpribor", "lvl11_deadcity_zone_radioactive_weak_0026")
olr.spawn_on_obj("zombie_plague_strong", "lvl11_deadcity_zone_radioactive_weak_0026")
olr.spawn_on_obj("zombie_plague_strong", "lvl11_deadcity_zone_radioactive_weak_0026")
olr.spawn_on_obj("zombie_plague_strong", "lvl11_deadcity_zone_radioactive_weak_0026")
olr.spawn_on_obj("pseudodog_w_namordnike", "lvl11_deadcity_zone_radioactive_weak_0025")
olr.spawn_on_obj("pseudodog_w_namordnike", "lvl11_deadcity_zone_radioactive_weak_0025")
olr.spawn_on_obj("pseudodog_w_namordnike_ghost", "lvl11_deadcity_zone_radioactive_weak_0025")
olr.spawn_on_obj("zombie_plague_strong", "lvl11_deadcity_zone_radioactive_weak_0025")
olr.spawn_on_obj("zombie_plague_strong", "lvl11_deadcity_zone_radioactive_weak_0025")
olr.spawn_on_obj("m_burer_green", "lvl11_deadcity_zone_radioactive_weak_0025")
olr.spawn_on_obj("chimera_midl", "lvl11_deadcity_zone_radioactive_weak_0025")
end


function yan_killmonster_go()
		db.actor:give_info_portion("yan_kill_himera_start")
		olr.del_by_name("lvl7_yantar_physic_object_0704")
		news_manager.send_tip(db.actor, "Stalker, it's the Professor! We've located the mutant. He's behind our bunker! Destroy it!", nil, "saharov", 30000)
end


function yan_killmonster_timer()
		olr_timers.st_timer("yan_killmonster_go", 1135, "nick.yan_killmonster_go()")
		news_manager.send_tip(db.actor, "Stalker, this is the Professor. Thank you for your help with the last case. We have a new problem. A strange Chimera-like mutant has been appearing around our base. She's being picked up by our security cameras. We can't let it stay here. According to our surveillance, the next time it appears will be in about four hours. I'll notify you via PDA. You must destroy her.", nil, "saharov", 30000)
end


function out_10_conserva_sciet_food()
	nik_dialog.out_item_much("conserva",10)
	olr_timers.st_timer("yan_killmonster_timer", 135, "nick.yan_killmonster_timer()")
end

function has_10_conserva()
     return nik_dialog.item_much("conserva",10) ~= false 
end


function out_10_conserva_sciet_reward(first_speaker, second_speaker) 
 	dialogs.relocate_money(first_speaker, 3500, "in") 
end


function esc_yan_seli()
	level.add_pp_effector("black.ppe", 20131, false)
	news_manager.send_tip(db.actor, "Thank you, stalker, for your help! The professor asked me to tell you: After the mission is over, I want you to go to their base. There's some business for you there.", nil, "ecolog", 30000)
	olr_timers.st_timer("del_vertuhaescsc_timer", 135, "nick.del_vertuhaescsc_timer()")
	olr.del_by_name("esc_raid_scientist")
	olr.del_by_name("esc_raid_scientist_0000")
	olr.del_by_name("esc_raid_scientist_0001")
end

function del_vertuhaescsc_timer()
	news_manager.send_tip(db.actor, "It's the Professor. Is the helicopter on its way? Good. I'll be waiting for you at our base.", nil, "saharov", 30000)
	olr.del_by_name("yan_equip_escapescint")
end

function give_yan_tri_raidgruppa_timer()
	olr.blow_add(300)
	news_manager.send_tip(db.actor, "enc_esc_evacuation", nil, "saharov", 30000)
	db.actor:give_info_portion("yan_tri_raidgruppa_start")
		local sobj = alife():object("esc_raid_scientist") 
		if sobj then 
			olr.add_spot( sobj.id,"eliminate_lager_location","Evacuating scientists" )
		end
end

function yan_tri_raidgruppa_timer()
	olr_timers.st_timer("give_yan_tri_raidgruppa_timer", 135, "nick.give_yan_tri_raidgruppa_timer()")
end

function give_prof_sos_talk_donesms()
			olr_timers.st_timer("give_prof_sos_talk_donesmspre", 35, "nick.give_prof_sos_talk_donesmspre()")
end


function give_prof_sos_talk_donesmspre()
		news_manager.send_tip(db.actor, "Stalker, hurry up. There's a chance he's still alive. I'm sending you the coordinates of the SOS location where he was last seen.", nil, "saharov", 30000)
		local sobj = alife():object("lvl7_yantar_physic_object_0282") 
		if sobj then 
			olr.add_spot( sobj.id,"tutorial_wounded_location","SOS" )
		end


end



function give_prof_zamer_donesms()
		olr_timers.st_timer("prof_zamer_donesms_psy", 15, "nick.prof_zamer_donesms_psy()")
		news_manager.send_tip(db.actor, "Professor, the measurements are done. I'm transmitting the data to the server... Stalker, let's get back to base. The Professor is waiting for you.", nil, "ecolog", 30000)
		olr.del_by_name("lvl7_yantar_physic_object_0282")
		olr.del_by_name("lvl7_yantar_stalker_0067")
		nick.gar_lamb_zombs()
end

function give_prof_zamer_donesms_dead()
	if not has_alife_info("zamer_anom_st_dat_done") then
		news_manager.send_tip(db.actor, "What the hell!? You! Come back here to me right now!", 4, "saharov", 30000)
		olr.del_by_name("lvl7_yantar_physic_object_0282")
		olr.del_by_name("lvl7_yantar_stalker_0067")
	end
end	
	

function prof_zamer_donesms_psy()
		news_manager.send_tip(db.actor, "What the hell...? The machine seems to be increasing in power. Better hurry back to the bunker...", 3, "ecolog", 30000)
		level.add_pp_effector("psy_antenna.ppe", 1875, true)
		level.add_pp_effector("yantar_underground_psi.ppe", 15876, false)
		level.add_cam_effector("camera_effects\\shell_shock.anm", 3496, false, "")
		level.add_cam_effector("camera_effects\\earthquake.anm", 3297, false, "")
		db.actor.psy_health = -0.15 
		db.actor.health = -0.05 
		nick.gar_lamb_zombs()
		olr_timers.st_timer("prof_zamer_donesms_psyoff", 15, "nick.prof_zamer_donesms_psyoff()")
end

function prof_zamer_donesms_psyoff()
	news_manager.send_tip(db.actor, "It's calmed down. That's weird.", 3, "ecolog", 30000)
    	level.remove_pp_effector(1875)
    	level.remove_pp_effector(15876)
	level.add_cam_effector("camera_effects\\shell_shock.anm", 3496, false, "")
	level.add_cam_effector("camera_effects\\earthquake.anm", 3297, false, "")
end

function away_from_triway()
        level.add_pp_effector("red_fade_out.ppe", 20131, false)
	local point = patrol("away_from_triway_walk")
	local look = patrol("away_from_triway_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
end


function on_chhose_tri_way_gen_fin_room()
	olr.disable_walk()
	level.disable_input()
	level.hide_indicators()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\low_base]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("gen_roon_end_walk")
	local look = patrol("gen_roon_end_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
	bind_stalker.hide_weapon()
	olr_timers.st_timer("open_war_door_1", 5, "nick.what_you_want_1()")
end

function what_you_want_1()
	news_manager.send_tip(db.actor, "...What do you want... in exchange for your life...?...", nil, "unknown", 10000)
	olr_timers.st_timer("open_war_door_1", 15, "nick.what_you_want_2()")
end

function what_you_want_2()
	xr_effects.game_credits()
end

function open_war_door_napar()
	news_manager.send_tip(db.actor, "...Strelok... Strelok!", nil, "sos", 10000)
end

function open_war_door_tri()
	olr.enable_walk()
	olr.del_by_name("lvl16_generators_physic_object_0213")
    	level.show_indicators()
    	level.enable_input()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("try_choise_walk")
	local look = patrol("try_choise_look_tri")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
	olr_timers.st_timer("open_war_door_napar", 4, "nick.open_war_door_napar()")
end


function open_war_door_two()
	olr.enable_walk()
	olr.del_by_name("lvl16_generators_physic_object_0212")
    	level.show_indicators()
    	level.enable_input()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("try_choise_walk")
	local look = patrol("try_choise_look_two")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
end


function open_war_door_one()
	olr.enable_walk()
	olr.del_by_name("lvl16_generators_physic_object_0211")
    	level.show_indicators()
    	level.enable_input()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("try_choise_walk")
	local look = patrol("try_choise_look_one")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
end

function triway_choose_door()
	gen_spawn_psy_paparnik()
	if xvars.gentri_door_open == 1 then
		open_war_door_one()
	elseif xvars.gentri_door_open == 2 then
		open_war_door_two()
	elseif xvars.gentri_door_open == 3 then
		open_war_door_tri()
	end	
end

function on_chhose_tri_way_gen()
	olr.disable_walk()
	olr_timers.st_timer("triway_choose_door", 5, "nick.triway_choose_door()")
	level.disable_input()
	level.hide_indicators()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\low_base]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local point = patrol("try_choise_walk")
	local look = patrol("try_choise_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
end

function go_to_treeway_stop()
	olr.del_by_name("labu_prefix_lights_hanging_lamp_0290")
	olr.del_by_name("labu_prefix_lights_hanging_lamp_0282")
	olr.del_by_name("labu_prefix_lights_hanging_lamp_0179")
	olr.del_by_name("labu_prefix_lights_hanging_lamp_0285")
	olr.del_by_name("labu_prefix_lights_hanging_lamp_0287")
	olr.del_by_name("lvl16_generators_space_restrictor_0042")
	db.actor:give_info_portion("warlab_door_tri_open")
        --level.add_pp_effector("black.ppe", 203131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\h_or_metal_large]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("kill_zombs_gen", 6, "nick.kill_zombs_gen()")
	--olr_timers.st_timer("delzomgentmer", 3, "nick.delzomgentmer()")
end

--function delzomgentmer()
--	if olr_timers.has_timer("triway_spawn_zombie") then
--		olr_timers.del_timer("triway_spawn_zombie")
--	end
--end


function go_to_treeway()
	olr.snd([[ol3\koan\game_demo]])
	level.add_pp_effector("snd_shock.ppe", 203342431, false)
	level.add_pp_effector("proba_gray.ppe", 2032431, false)
	level.set_weather("indoor",true)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("go_to_treeway", 15, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway", 25, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway", 35, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway", 45, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway", 55, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway", 65, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway", 75, "nick.triway_spawn_zombie()")
	olr_timers.st_timer("go_to_treeway_stop", 120, "nick.go_to_treeway_stop()")
	local point = patrol("teleport_gen_way_olr2")
	local look = patrol("teleport_gen_look_olr2")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
end



function jaba_ab_patrols()
	news_manager.send_tip(db.actor, "Keep your eyes open, the road is patrolled by the military. If they see you, they won't think twice about you...", nil, "trader", 30000)
end

function deadcity_jaba_about()
	local sobj = alife():object("lvl11_deadcity_staler_undead_olr") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Bomb Squad"
      			pk:set( data )
		end	
	end
	news_manager.send_tip(db.actor, "I'm picking up your signal from the city. Yeah, you've come a long way, buddy. I didn't think you'd make it there at all. So listen, I'm gonna brief you on this place. Don't even think about going in there without a protective airtight suit. The city is infected with an unknown contagion that will turn you into a parasite-infested biomass. He... Bless you.", nil, "trader", 20000)
end

function step_yan_deadtw()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:alive() and npc:position():distance_to(db.actor:position()) < 35 then
			npc:enable_memory_object(db.actor,false)
		end
	end
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\siren_gen]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	db.actor:set_actor_position(db.actor:position():add(db.actor:direction():mul(5)), db.actor:level_vertex_id())
	local dir_d = vector()
  	dir_d:set(-6,3,0.01)
  	local h = -dir_d:getH()
  	local p = -dir_d:getP()
    	local cam = actor_camera(0)
    	if cam == nil then
       		return 0, 0
    	end
    	if h then
       		cam.yaw = h 
    	end
    	if p then
       		cam.pitch = p
    	end  
end

function step_yan_dead()
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:alive() and npc:position():distance_to(db.actor:position()) < 35 then
			npc:enable_memory_object(db.actor,false)
		end
	end
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\siren_gen]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("step_yan_dead2", 3, "nick.step_yan_deadtw()")
	db.actor:set_actor_position(db.actor:position():add(db.actor:direction():mul(5)), db.actor:level_vertex_id())
	local dir_d = vector()
  	dir_d:set(-6,2,0.01)
  	local h = -dir_d:getH()
  	local p = -dir_d:getP()
    	local cam = actor_camera(0)
    	if cam == nil then
       		return 0, 0
    	end
    	if h then
       		cam.yaw = h 
    	end
    	if p then
       		cam.pitch = p
    	end  
end

function from_yan_dead()
	bind_stalker.restore_weapon()
    	level.show_indicators()
    	level.enable_input()
	olr_timers.st_timer("from_yan_dead", 15, "nick.from_yan_dead_now()")
	local cttt
	local phantom_max 					= 28
	local phantom_spawn_probability		= 0.8
	local phantom_spawn_radius			= 20.0
	local phantom_spawn_height			= 2.5
	local phantom_fov					= 45
        for cttt = 1, 5 do
	  if math.random() < phantom_spawn_probability then
			if phantom_manager:phantom_count() < phantom_max then
				local radius = phantom_spawn_radius * ( math.random()/2.0+0.5 )
				local ang    = phantom_fov * math.random() - phantom_fov * 0.5
				local dir    = vector_rotate_y( db.actor:direction(), ang )
				phantom_manager.spawn_phantom( db.actor:position():add( dir:mul(radius) ) )
			end
	  end
    end	
end

function from_yan_dead_now()
	local point = patrol("from_dead_yan_walk")
	local look = patrol("from_dead_yan_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
	level.add_pp_effector("black.ppe", 201831, false)
end

function hit_yan_zombies()
	olr_timers.st_timer("from_yan_dead", 2, "nick.from_yan_dead()")	
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:alive() and npc:position():distance_to(db.actor:position()) < 35 and not npc:is_actor() then
			npc:enable_memory_object(db.actor,true)
    			local h = hit()
			h.draftsman = db.actor
			h.type = hit.strike
			h.direction = vector():set(math.random(1),0.1,math.random(1))
			h.power = 0.01
			h.impulse = 2
			npc:hit(h)
			npc:enable_memory_object(db.actor,true)
		end
	end

end


function explode_lenin()

	olr.del_by_name("lvl7_yantar_space_restrictor_0079")
	local source = nil
    	local sim = alife()
    	if sim then
       local se_obj = sim:story_object(5484)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end

    if source == nil then
       log1("expl not found")
       return
    end

	local h = hit()
	h.draftsman = source
	h.type = hit.strike
        h:bone("head")
	h.direction = vector():set(1,-1,1)
	h.power = 1
	h.impulse = 20
	source:hit(h)

    local h = hit()
	h.draftsman = source
	h.type = hit.strike
        h:bone("torso")
	h.direction = vector():set(1,-1,1)
	h.power = 1
	h.impulse = 45
	source:hit(h)
   
end

function create_agro_case()
	olr.spawn_crows(5,12)
		
end

function create_agro_case_del()

	local rnd = math.random(1,4)
	if rnd == 1 then
			--olr.del_by_name("lvl3_agroprom_agro_case_02")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0000")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0001")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0002")
		elseif rnd == 2 then
			olr.del_by_name("lvl3_agroprom_agro_case_02")
			--olr.del_by_name("lvl3_agroprom_agro_case_02_0000")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0001")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0002")
		elseif rnd == 3 then
			olr.del_by_name("lvl3_agroprom_agro_case_02")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0000")
			--olr.del_by_name("lvl3_agroprom_agro_case_02_0001")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0002")
		elseif rnd == 4 then
			olr.del_by_name("lvl3_agroprom_agro_case_02")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0000")
			olr.del_by_name("lvl3_agroprom_agro_case_02_0001")
			--olr.del_by_name("lvl3_agroprom_agro_case_02_0002")
	end
	olr.del_by_name("gar_zaraza_nap_0001")
	olr.del_by_name("gar_zaraza_nap_0000")
	olr.del_by_name("gar_zaraza_nap")
	olr.del_by_name("lvl2_garbage_stalker_0043")

end


function nii_podval_zaval_actor()
	olr_timers.st_timer("croswss", 1000, "nick.croswss_svyatoy()")
	olr.hud_tip("", "It's like a man-made rubble pile... with the wind blowing behind it. Looks like there's something behind it. Maybe Toad can help break it up...", 35)
	olr.del_by_name("lvl3_agroprom_space_restrictor_0017")
end




function radbun_restore_stuffmosk()
	olr.del_by_name("lvl12_radar_bunker_space_restrictor_0016")
	olr.del_by_name("lvl12_radar_bunker_physic_object_0027")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0010")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0012")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0013")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0011")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0009")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0007")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0008")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0005")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0006")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0004")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0002")
	olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0003")
	olr.del_by_name("lvl12_radar_bunker_space_restrictor_0015")

	olr.del_by_name("l10u_radar_bunker_lights_hanging_lamp_0114")
	olr.del_by_name("l10u_radar_bunker_lights_hanging_lamp_0123")
	olr.del_by_name("l10u_radar_bunker_lights_hanging_lamp_0124")
	olr.del_by_name("l10u_radar_bunker_lights_hanging_lamp_0125")
	olr.del_by_name("l10u_radar_bunker_lights_hanging_lamp_0126")
	olr.del_by_name("l10u_radar_bunker_lights_hanging_lamp_0127")

	local point = patrol("farbun_gluk_walk")
	local look = patrol("farbun_gluk_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)

	olr.spawn_on_obj("psy_stabilizator", "l10u_radar_bunker_lights_hanging_lamp_0128")

end



function setvisradbun()
local scientiscts = {

	["lvl12_radar_bunker_staler_undead_olr_0002"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0003"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0004"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0005"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0006"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0007"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0008"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0009"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0010"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0011"] = true,
	["lvl12_radar_bunker_staler_undead_olr_0012"] = true,

	["lvl12_radar_bunker_stalker_0004"] = true,
	["lvl12_radar_bunker_stalker_0000"] = true,

	["lvl12_radar_bunker_staler_undead_olr_0013"] = true
}

local visuals = {
		[[actors\science_groups\uchehiy_1]],
		[[actors\science_groups\uchehiy_2]],
		[[actors\science_groups\uchehiy_3]],
		[[actors\science_groups\uchehiy_4]],
		[[actors\science_groups\uchehiy_5]],
		[[actors\science_groups\uchehiy_6]],
		[[actors\science_groups\uchehiy_7]]
}


local sim = alife()
	for id=1, 65534 do
	local kill = sim:object(id)
		if kill then
                	if IsStalker(kill) then
				local gvid = kill.m_game_vertex_id
	        		if game_graph():valid_vertex_id(gvid) then
					if alife():level_name(game_graph():vertex(gvid):level_id()) == "lvl12_radar_bunker" then
						if scientiscts[kill:name()] then
		  					local pk = get_netpk(kill,1)
  							if pk:isOk() then
    								local data = pk:get()
    								data.visual_name = visuals[math.random(#visuals)]
          							data.character_name = ""
      								pk:set( data )
							end
						end
					end       
				end
			end
		end
	end

end


--------------------------------------------------------------------------------------------------------------

function ecologs_neutral_task_select() 
	--olr_timers.st_timer("ecologs_neutral_task_select", 85, "nick.ecologs_neutral_task_select()")
        olr_offline_task.ecologs_neutral_task_select()
end

function stalkers_bandits_task_select_timer()
	--olr_timers.st_timer("stalkers_bandits_task_select_timer", 70, "nick.stalkers_bandits_task_select_timer()")
        olr_offline_task.bandits_neutral_task_select()
end

function stalkers_neutral_task_select_timer()
	--olr_timers.st_timer("stalkers_neutral_task_select_timer", 65, "nick.stalkers_neutral_task_select_timer()")
        olr_offline_task.stalkers_neutral_task_select()
end

function zombies_task_select_timer()
	--olr_timers.st_timer("zombies_task_select_timer", 66, "nick.zombies_task_select_timer()")
        olr_offline_task.zombies_task_select()
end

function dogs_task_select_timer()
        olr_offline_task.dogs_task_select()
	--olr_timers.st_timer("dogs_task_select_timer", 76, "nick.dogs_task_select_timer()")	
end


--------------------------------------------------------------------------------------------------------------

function bolezn_beshenstvo_timer()
        if db.actor:has_info("bolezn_beshenstvo_info") then
        if not has_alife_info("bolezn_beshenstvo_info_first") then
        	db.actor:give_info_portion("bolezn_beshenstvo_info_first")
        	soundtrack.achit1()
	end
        --news_manager.send_tip(db.actor, "Черт, что со мной.. Похоже я заразился чем-то..")
	db.actor.health = -0.2
        db.actor.power = -0.2
        olr_timers.st_timer("bolezn_beshenstvo_timer_m", 2500, "nick.bolezn_beshenstvo_timer_m()")
end
end

function bolezn_beshenstvo_timer_m()
        if db.actor:has_info("bolezn_beshenstvo_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "Damn, this bite. I need to heal myself.")
	db.actor.health = -0.5
        db.actor.power = -0.52
        olr_timers.st_timer("bolezn_beshenstvo_timer_d", 8000, "bolezn_beshenstvo_timer_d")
    end
end

function bolezn_beshenstvo_timer_d()
        if db.actor:has_info("bolezn_beshenstvo_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "I can't take it anymore.")
	db.actor.health = -0.1
        db.actor.power = -0.1
        olr_bolezn.suicide_knife()
    end
end



--------------------------------------------------------------------------------------------------------------

function bolezn_parasite_timer()
        if db.actor:has_info("bolezn_parazity_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "What the hell is wrong with me? My skin is so hard.")
	db.actor.health = -0.1
        db.actor.power = -0.3
        olr_timers.st_timer("bolezn_parasite_timer_m", 2900, "nick.bolezn_parasite_timer_m()")
    local te = texture_find("act\\act_arm_perchatka")
    if te then
    te:set_name("act\\act_pr1_perchatka")
    te:reload() 
end
end
end

function bolezn_parasite_timer_m()
        if db.actor:has_info("bolezn_parazity_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "What's wrong with me? I need a cure. My skin's rotting.")
	db.actor.health = -0.2
        db.actor.power = -0.52
    olr_timers.st_timer("bolezn_parasite_timer_d", 8000, "nick.bolezn_parasite_timer_d()")
    local te = texture_find("act\\act_pr1_perchatka")
    if te then
    te:set_name("act\\act_pr2_perchatka")
    te:reload() 
end
    local te = texture_find("act\\act_arm_perchatka")
    if te then
    te:set_name("act\\act_pr2_perchatka")
    te:reload() 
end
end
end

function bolezn_parasite_timer_d()
        if db.actor:has_info("bolezn_parazity_info") then
        soundtrack.achit1()
        news_manager.send_tip(db.actor, "I can't take it anymore.")
	db.actor.health = -0.1
        db.actor.power = -0.1
        olr_bolezn.suicide_knife()
    end
end

-------------------------------------------------------------------------------------------------------------------



function item_repair_bar_timer()
        news_manager.send_tip(db.actor, "Repairman: About the repairs. You can come in, it's ready.", nil, "af_merger", 10000)
        db.actor:give_info_portion("ametist_repair_gotovo_done_info")
        db.actor:disable_info_portion("ametist_go_to_stanok_info")
end

function autosave_quest()
	if olr.can_save() then
			get_console():execute("save "..olr.autosavename().." - "..xvars.autosave_count.."")
			xvars.autosave_count = xvars.autosave_count + 1
		else
			olr_timers.st_timer("autosave_quest", 3, "nick.autosave_quest()")
	end
end

function eat_radiation_tmr_timer()
        db.actor:disable_info_portion("actor_healing_antirad")
end

function eat_medkit_tmr_timer()
        db.actor:disable_info_portion("eat_medkit_tmr")
        db.actor:disable_info_portion("actor_healing_medkit")
end


function gen_ka_delkarlikg()
	news_manager.send_tip(db.actor, "Strelok: Hide somewhere. We need to take a look around this room.", nil, "act", 10000)
	olr.del_by_name("lvl16_generators_karlik")

	olr.del_by_name("lvl16_generators_stalker_0078")
	olr.del_by_name("lvl16_generators_stalker_0079")
	olr.del_by_name("lvl16_generators_stalker_0080")
	olr.del_by_name("lvl16_generators_stalker_0081")
	olr.del_by_name("lvl16_generators_stalker_0082")
	olr.del_by_name("lvl16_generators_stalker_0083")
	olr.del_by_name("lvl16_generators_stalker_0032")
	olr.del_by_name("lvl16_generators_stalker_0033")

	olr.del_by_name("lvl16_generators_physic_object_0239")
	olr.del_by_name("lvl16_generators_physic_object_0240")

	level.add_pp_effector("black.ppe", 20131, false)

	olr_timers.st_timer("feak_laba_chaos", 5, "nick.feak_laba_chaos()")
end


function start_sarcofag_findmyself_del_all()
	db.actor:give_info_portion("actor_ishet_sebbya_info")
	olr.del_by_name("lvl1_escape_helicopter")
	olr.del_by_name("esc_matugalnik")
	olr.del_by_name("lvl_test_lights_hanging_lamp")
	olr.del_by_name("lvl_test_lights_hanging_lamp_0000")
	olr.del_by_name("lvl5_bar_physic_object_1123")
	olr.del_by_name("bar_prefix_lights_hanging_lamp_0040")
	olr.del_by_name("bar_bar_drunk_dolg")
	olr.del_by_name("bar_bar_visitors_3_4")
	--olr.del_by_name("bar_bar_osvedomitel")
	olr.del_by_name("bar_dolg_leader")
	olr.del_by_name("bar_dolg_petrenko")
	olr.del_by_name("lvl5_bar_stalker_0051")
	olr.del_by_name("lvl5_bar_stalker_0002")
	olr.del_by_name("lvl5_bar_staler_undead_olr_0001")
	olr.del_by_name("lvl5_bar_stalker")
	olr.del_by_name("lvl5_bar_staler_undead_olr")
	olr.del_by_name("lvl5_bar_staler_undead_olr_0004")
	olr.del_by_name("lvl5_bar_stalker_0007")
	olr.del_by_name("lvl5_bar_staler_undead_olr_0006")
	olr.del_by_name("l12u_sarcofag_physic_object_0003")
	olr.del_by_name("l12u_sarcofag_physic_object_0013")
	olr.del_by_name("l12u_sarcofag_physic_object_0022")
	olr.del_by_name("l12u_sarcofag_physic_object_0007")

olr.kill_mon_in_radius(db.actor:position(), 1550)

local montabl = 
{
       [clsid.script_stalker] = true
}

	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if montabl[kill:clsid()]  then
                if kill:alive() then
		local strn_id = kill:smart_terrain_id()
		if strn_id ~= 65535 then

		if math.random(1,3) == 1 then
			olr.kill_offline_stalker(kill)
		end

		--local wait_time = 0
  		--wait_time = time_global() + 100
  		--level.add_call(
    		--function() return time_global() > wait_time end,
    		--function() alife():release(kill, true) end
  		--)

end
end
end
end
end

end


function deldoor_zablik_doks()
	olr.del_by_name("lvl6_rostok_physic_object_0199")
end

function goaway_from_dolina()

	local sobj = alife():object("lvl15_sarcofag_stalker_0004") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Strelok"
      			pk:set( data )
		end	
	end

	local sobj = alife():object("lvl4_darkdolina_stalker_0093") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\bandit\stalker_bandit_rnd_15]]
    			data.visual_name = vis
          		data.character_name = "Siply."
      			pk:set( data )
		end	
	end

	local sobj = alife():object("lvl4_darkdolina_stalker_0091") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\bandit\stalker_bandit_rnd_12]]
    			data.visual_name = vis
          		data.character_name = "Pyotr Mihalych."
      			pk:set( data )
		end	
	end

	local sobj = alife():object("lvl4_darkdolina_stalker_0092") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
			local vis = [[actors\bandit\stalker_bandit_rnd_11]]
    			data.visual_name = vis
          		data.character_name = "Winter"
      			pk:set( data )
		end	
	end

	if level.name() == "lvl4_darkdolina" then
		news_manager.send_tip(db.actor, "Unknown: Hey, buddy. We picked up your PDA signal... you must be clearly lost... do us a favor and leave Dark Valley once and for all. We'll wait.", nil, "unknown", 60000)
		olr_timers.st_timer("goaway_from_dolina2", 105, "nick.goaway_from_dolina2()")
	else
		news_manager.send_tip(db.actor, "Unknown: Do me a favor - don't go to the Dark Valley again... This is our territory, and stalkers have no business here... We'll warn you only once.", nil, "unknown", 60000)
	end
end

function goaway_from_dolina2()
	if level.name() == "lvl4_darkdolina" then
		news_manager.send_tip(db.actor, "Unknown: Well, you're still here, which means you're obviously quite arrogant. You've already gotten one warning, which means...", nil, "unknown", 60000)
	end
end

function rossosfixone()
	olr.del_by_name("lvl6_rostok_bloodsucker_strong_0001")
end

function anti_glob_rad_timer()
        db.actor:disable_info_portion("anti_glob_rad")
        db.actor.health = -0.1
end


function first_killer_timer()
	if not has_alife_info("messer_killar_pre") then
		db.actor:give_info_portion("messer_killar_pre")
        	db.actor:change_character_reputation(-100)
        end 
end


function disable_rand_stuff()
	db.actor:disable_info_portion("rand_shit_timer_now")
end


function rostok_spawn_unic_vss()
	olr.spawn_on_obj("wpn_vintorez_gravi", "lvl6_rostok_stalker_0027")
	olr.spawn_on_obj("chimera_strong", "lvl6_rostok_stalker_0027")
	db.actor:give_info_portion("rostok_spawn_unic_vss_timer")
	news_manager.send_tip(db.actor, "Man, did the scientists buy up all the magnets already? Shit, I brought them four grand from the Garbage, and they're gone, along with all the equipment. And my brother was shooting some rifle for them at the Rostok factory. But I haven't heard from him in a long time... Ah, the zone is changing.", nil, "af_merger", 69000)
end


function angar_art_jaba()
	if has_alife_info("find_art_spiral_done") then
		return 
	end
	news_manager.send_tip(db.actor, "Messer. where's my damn artifact from the hangar at the Garbage? Don't even think about pocketing it, I'll find out.", nil, "trader", 39000)
	db.actor:change_character_reputation(-10)
end

function viska_yas_jaba2()
	news_manager.send_tip(db.actor, "Let's hope they haven't found it yet.", nil, "unknown", 30000)
end

function daem_za_esc_fantoma_sms_barmen()
	olr.beep()
	news_manager.send_tip(db.actor, "Messer, come to the bar, I think we're making some progress on our case.", nil, "barman", 90000)
	db.actor:give_info_portion("esc_fantoma_sms_barmen_done")
	local sobj = alife():object("lvl1_escape_space_restrictor_0102") 
	if sobj then  
		level.map_remove_object_spot(sobj.id, "crlc_big")
	end
end


function viska_yas_jaba()
	news_manager.send_tip(db.actor, "I think someone was seen near the tower. You think he's still out there?", nil, "unknown", 30000)
	olr_timers.st_timer("sms_about_keys_viska2", 15, "nick.viska_yas_jaba2()")
end


function ive_viska_yas_jaba()
olr_timers.st_timer("sms_about_keys_viska1", 400, "nick.viska_yas_jaba()")
if nik_dialog.item_much("af_esc_vishka",1) ~= false then
return 
end
if has_alife_info("bar_dolg_propusk_have") then
return 
end
news_manager.send_tip(db.actor, "Messer. where's my goddamn artifact from the tower? What, are you gonna run off with my stuff? You're not gonna last much longer if you do that.", nil, "trader", 39000)
db.actor:change_character_reputation(-5)
end


function ive_nojik_yas_jaba()
if has_alife_info("esc_olr_1_have") then
return 
end
news_manager.send_tip(db.actor, "Hey, you alright in there? Where's my box?", nil, "trader", 39000)
db.actor:change_character_reputation(-5)
end


function croswss_svyatoy()
 news_manager.send_tip(db.actor, "I think he's readjusting the antenna again. There's a lot of crows flying around. He's been seen there again, by the way.", nil, "unknown", 90000)
 local sim = alife()
 for i = 1, 15 do
  alife():create("m_crow", db.actor:position():add(db.actor:direction():mul(90)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
 end
end


function mg_paras_spots()
local sobj = alife():object("lvl11_deadcity_staler_undead_olr_0004") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Owl") 
end
local sobj = alife():object("lvl11_deadcity_space_restrictor_0036") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Suspected source of contamination.") 
end
local sobj = alife():object("lvl11_deadcity_space_restrictor_0035") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Suspected source of the contamination.") 
end
end




function set_mus_04()
        get_console():execute("snd_volume_music 0.4")
	get_console():execute("snd_volume_eff 1")
	olr_timers.st_timer("set_mus_08", 10, "nick.set_mus_08()")
end

function set_mus_08()
        get_console():execute("snd_volume_music 0.8")
end


function daem_shit_mg_mono()
	olr.give_item("med_injector_capsule")
	local se_obj = alife():object("lvl11_deadcity_level_changer_0002")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","Catacombs.")
  	end
end

function arpop_und_killer()
	local se_obj = alife():object("lvl_rat_level_changer_0003")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","Into the medical device.")
  	end
	local se_obj = alife():object("lvl3_agroprom_level_changer_0002")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the catacombs.")
  	end
	olr.del_by_name("lvl3_agroprom_rat_zaval")
end

function daem_mg_zaparas()
	olr.give_item("wpn_val")
	olr_timers.st_timer("yatector", 1930, "nick.mg_del_parasites()")
	olr.del_by_name("lvl11_deadcity_space_restrictor_0035")
	olr.del_by_name("lvl11_deadcity_staler_undead_olr_0004")
	olr.del_by_name("lvl11_deadcity_space_restrictor_0036")

	olr.del_by_name("lvl11_deadcity_physic_object_0777")
	olr.del_by_name("lvl11_deadcity_physic_object_0778")
	olr.del_by_name("lvl11_deadcity_physic_object_0776")
	olr.del_by_name("lvl11_deadcity_physic_object_0775")
	olr.del_by_name("lvl11_deadcity_physic_object_0774")

end


function mg_del_parasites()
news_manager.send_tip(db.actor, "Guys, I think the air in the city is back to normal! And there's no spores at all. What the hell?", nil, "freedom", 90000)
olr.del_by_name("lvl11_deadcity_space_restrictor_0034")
olr.del_by_name("lvl11_deadcity_space_restrictor_0019")
olr.del_by_name("lvl11_deadcity_space_restrictor_0018")
end



function mg_lead_about_mon_start()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Leader:".."\\n".."%c[255,160,160,160,160,160]Stalker, come to my office, I have a private conversation...".."".."\n", nil, "freedom", 90000)
db.actor:give_info_portion("mg_lead_about_mon_start_timer")
olr.snd([[characters_voice\scenario\rostok\wolfhound_pda_job_1]])
end



function the_god_is_seven()
	olr.del_by_name("lvl11_deadcity_lights_hanging_lamp_0008")
	olr.del_by_name("lvl11_deadcity_stalker_0012")
	news_manager.send_tip(db.actor, "Reporter: Stalker. I think you're experiencing some old, somewhat forgotten feelings right now. Deja vu again? Maybe... I'm heading over there, to a secluded spot behind the power plant... There's a way to get there now. don't follow me. I guess I'll see you around, friend. Goodbye.", nil, "default", 99000)
end


function has_art_koluchka()
     return nik_dialog.item_much("af_rusty_thorn",1) ~= false 
end


function art_koluchka_give()
	nik_dialog.out_item_much("af_rusty_thorn",1)
	olr.give_item("conserva")
end


function yan_use_drink_yan_on()
	xvars.yan_use_drink_yan = true
end


function create_psystab()
	olr.give_item("psystab_helmet")
end

function create_outfit_antirad()
	olr.give_item("outfit_antirad")
end

function create_psivizor_detector()
	local obj = olr.give_item("psivizor_detector")
	level.client_spawn_manager():add(obj.id, 0, function(id,obj) obj:set_condition((math.random(95,99)/100)) end)
end

function create_elite_det()
	local obj = olr.give_item("detector_elite")
	level.client_spawn_manager():add(obj.id, 0, function(id,obj) obj:set_condition((math.random(95,99)/100)) end)
end




function yan_vsidetector_documentacia()
olr_timers.st_timer("yan_yan_vsidetector", 1530, "nick.yan_vsidetector_documentacia_exec()")
nik_dialog.out_item_much("jurn_visual_device",1)
end
function yan_vsidetector_documentacia_exec()
db.actor:give_info_portion("yan_vsidetector_documentacia_talk_done_timer") 
news_manager.send_tip(db.actor, "Docent: Stalker, about the visual detector documents. Come and talk to me.", nil, "saharov", 30000)
end



function yan_psistab_documentacia()
olr_timers.st_timer("yan_yan_psistab", 1550, "nick.yan_psistab_documentacia_exec()")
nik_dialog.out_item_much("jurn_psi_defence",1)
end
function yan_psistab_documentacia_exec()
db.actor:give_info_portion("yan_psistab_documentacia_talk_done_timer")
news_manager.send_tip(db.actor, "Docent: Stalker, about the psi-stabilizer documents. Come and talk to me.", nil, "saharov", 30000)
end



function yan_psivizor_documentacia()
olr_timers.st_timer("yan_yan_documentacia", 1560, "nick.yan_psivizor_documentacia_exec()")
nik_dialog.out_item_much("jurn_psi_vision",1)
end
function yan_psivizor_documentacia_exec()
db.actor:give_info_portion("yan_psivizor_documentacia_talk_done_timer")
news_manager.send_tip(db.actor, "Docent: Stalker, about the documents. Come and talk to me.", nil, "saharov", 30000)
end



function yan_radcostum_documentacia()
olr_timers.st_timer("yan_yan_documentacia", 1580, "nick.yan_radcostum_documentacia_exec()")
nik_dialog.out_item_much("jurn_rad_outfit",1)
end
function yan_radcostum_documentacia_exec()
db.actor:give_info_portion("yan_radcostum_documentacia_talk_done_timer")
news_manager.send_tip(db.actor, "Docent: Stalker, about the documentation of the suit. Come and talk to me.", nil, "saharov", 30000)
end



function precond_vsidetector()
     return nik_dialog.item_much("jurn_visual_device",1) ~= false 
end

function precond_psistab()
     return nik_dialog.item_much("jurn_psi_defence",1) ~= false 
end

function precond_psivizor()
     return nik_dialog.item_much("jurn_psi_vision",1) ~= false 
end

function precond_radcostum()
     return nik_dialog.item_much("jurn_rad_outfit",1) ~= false 
end



function create_hand_medkit_actor()
	olr.give_item("med_injector")
end

function del_ohranik_yan_del()
	olr.del_by_name("lvl7_uch_stalker_0006")
	olr.del_by_name("lvl7_yantar_physic_object_0683")
	olr.del_by_name("lvl7_yantar_physic_object_0248")
end



function plot_door_letat_vertilo_hey_skazu_sms()
news_manager.send_tip(db.actor, "Professor? Are you here?", nil, "default", 39000)
	olr_timers.st_timer("yan_hey_skazu_sms", 3, "nick.yan_zam_hey_skazu_sms()")
end

function yan_zam_hey_skazu_sms()
news_manager.send_tip(db.actor, "Lab technician: Hey! And the Professor is not here... Come here, let's talk.", nil, "ecolog", 39000)
end

function yan_zam_zombies_rush_spawen()
if has_alife_info("yan_dot_start_zamery_done") then
	return
end
if xvars.yan_phase_zam_quest <= 5 then
	olr_timers.st_timer("yan_zam_zombies_rush", 19, "nick.yan_zam_zombies_rush_spawen()")

	local sp1_place = alife():object("lvl7_yantar_space_restrictor_0072")
  	local obj = alife():create("zombie_normal", sp1_place.position, sp1_place.m_level_vertex_id, sp1_place.m_game_vertex_id)
	local params=amk.read_monster_params(obj)
	params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = yan_zombies_home_bunker\nhome_min_radius = 5\nhome_max_radius = 15\naggressive_home"
	amk.write_monster_params(params,obj)

	local sp2_place = alife():object("lvl7_yantar_space_restrictor_0073")
  	local obj2 =alife():create("zombie_strong", sp2_place.position, sp2_place.m_level_vertex_id, sp2_place.m_game_vertex_id)
	local params=amk.read_monster_params(obj2)
	params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = yan_zombies_home_bunker\nhome_min_radius = 5\nhome_max_radius = 15\naggressive_home"
	amk.write_monster_params(params,obj2)

	local sp3_place = alife():object("lvl7_yantar_space_restrictor_0074")
  	local obj3 =alife():create("zombie_immortal", sp3_place.position, sp3_place.m_level_vertex_id, sp3_place.m_game_vertex_id)
	local params=amk.read_monster_params(obj3)
	params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = yan_zombies_home_bunker\nhome_min_radius = 5\nhome_max_radius = 15\naggressive_home"
	amk.write_monster_params(params,obj3)

	local sp4_place = alife():object("lvl7_yantar_space_restrictor_0076")
  	local obj4 =alife():create("zombie_immortal", sp4_place.position, sp4_place.m_level_vertex_id, sp4_place.m_game_vertex_id)
	local params=amk.read_monster_params(obj4)
	params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = yan_zombies_home_bunker\nhome_min_radius = 5\nhome_max_radius = 15\naggressive_home"
	amk.write_monster_params(params,obj4)

	local sp5_place = alife():object("lvl7_yantar_space_restrictor_0077")
  	local obj5 =alife():create("zombie_immortal", sp5_place.position, sp5_place.m_level_vertex_id, sp5_place.m_game_vertex_id)
	local params=amk.read_monster_params(obj5)
	params.custom = "[smart_terrains]\nnone=true\n[logic]\nactive = mob_home\n[mob_home]\npath_home = yan_zombies_home_bunker\nhome_min_radius = 5\nhome_max_radius = 15\naggressive_home"
	amk.write_monster_params(params,obj5)
end
end


function yan_prof_uletel_gde_laborant_light_on()
	news_manager.send_tip(db.actor, "Guard: That's better... Start the device, it's by the window with an antenna, and get ready for the cycle switches. Just don't run too far away.", nil, "military", 39000)
	olr_timers.st_timer("yan_hms", 35, "nick.del_yan_zam_hey_skazu_sms()")
end

function del_yan_zam_hey_skazu_sms()
	olr.del_by_name("lvl7_yantar_lights_hanging_lamp_0019")
	olr.del_by_name("lvl7_yantar_lights_hanging_lamp_0029")
	olr.del_by_name("lvl7_yantar_lights_hanging_lamp_0030")
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\electric_crash]])
	if not snd_obj:playing() then 
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
end
end


function yan_prof_uletel_gde_laborant_start_talked_gonow()
  local sobj = alife():object("lvl7_yantar_stalker_0022")
  if sobj then
	olr.kill_offline_stalker(sobj)
  end
news_manager.send_tip(db.actor, "Hey! I'm coming with you to the Dot... let's go.", nil, "military", 39000)
olr.del_by_name("lvl7_yantar_swamp_karlik_0009")
olr.del_by_name("lvl7_yantar_m_burer_normal")
olr.del_by_name("lvl7_yantar_physic_object_0581")
olr.del_by_name("lvl7_yantar_zombie_plague_0008")
olr.del_by_name("lvl7_yantar_rat_volk_0008")
olr.del_by_name("lvl7_yantar_rat_volk_0006")
olr.del_by_name("lvl7_yantar_physic_object_0564")
olr.del_by_name("lvl11_deadcity_physic_destroyable_object_0015")
olr.del_by_name("lvl7_yantar_physic_object_0581")
olr.del_by_name("lvl7_yantar_physic_object_0566")
olr.del_by_name("lvl7_yantar_stalker_0022")
	olr.del_by_name("lvl7_yantar_physic_object_0567")
	olr.del_by_name("lvl7_yantar_physic_object_0569")
end


function prof_uletel_gde_laborant_talked_precond(actor,npc)
    return has_alife_info("olr_traders_night") and has_alife_info("prof_uletel_gde_laborant_talked")
end



function del_agr_yan_arg_ployt()
olr.del_by_name("yan_equip_helicopter_0001")
olr.del_by_name("lvl7_yantar_physic_object_0668")
olr.del_by_name("lvl7_yantar_physic_object_0546")
end

function del_bomj_and_sosach_vedmak()
news_manager.send_tip(db.actor, "Witcher: Messer, when you're at the bar, stop by. I have some interesting information that might interest you...", nil, "default", 39000)
olr.info("zedmak_lampa_start")
olr.del_by_name("lvl5_bar_bloodsucker_weak")
--olr.del_by_name("lvl5_bar_stalker_0005")
olr.del_by_name("lvl5_bar_space_restrictor_0009")
olr.del_by_name("lvl5_bar_physic_object_0062")
olr.del_by_name("lvl5_bar_physic_object_1391")
end


function bar_first_del_bar_alcoholics()

olr.del_by_name("lvl5_bar_physic_object_0234")
olr.del_by_name("lvl5_bar_stalker_0065")
olr.del_by_name("lvl5_bar_stalker_0066")
olr.del_by_name("lvl5_bar_stalker_0067")
olr.info("bar_first_del_bar_alcoholics_done")
olr.del_by_name("lvl5_bar_physic_object_1245")
olr.del_by_name("lvl5_bar_stalker_0024")
olr.del_by_name("lvl5_bar_physic_object_0377")
olr.del_by_name("lvl5_bar_physic_object_1380")
olr.del_by_name("bar_prefix_lights_hanging_lamp_0056")
olr.del_by_name("lvl5_bar_physic_object_1388")
olr.del_by_name("lvl5_bar_physic_object_1389")
olr_timers.st_timer("toprip", 15, "nick.to_prip_alc_gaaway()")
news_manager.send_tip(db.actor, "Unknown: Guys, you're not gonna believe this. you remember that handyman in the bar that used to hang around the school? Still saying he'd get to the center no matter what it took?", nil, "default", 60000)

local jaba_place = alife():object("lvl1_escape_jaba_place")
  local sobj = alife():create("agr_stalker_veteran", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
  if sobj then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
end


	if level.name() == "lvl5_bar" then

		olr.del_by_name("lvl5_bar_stalker_0022")
		olr.del_by_name("lvl5_bar_stalker_0021")
		olr.del_by_name("lvl5_bar_stalker_0020")

		olr.del_by_name("lvl5_bar_stalker_0041")
		olr.del_by_name("lvl5_bar_stalker_0042")
		olr.del_by_name("lvl5_bar_stalker_0043")

	else

  local sobj = alife():object("lvl5_bar_stalker_0020")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl5_bar_stalker_0021")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl5_bar_stalker_0022")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl5_bar_stalker_0041")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl5_bar_stalker_0042")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl5_bar_stalker_0043")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

end



end


function wtf_holmi()
news_manager.send_tip(db.actor, "Don't know what's going on in the Silent Hills, man. Anybody know? They say Messer's missing. hasn't been seen for days.", nil, "default", 60000)
end



function to_prip_alc_gaaway()
news_manager.send_tip(db.actor, "Unknown: Well, he's not kidding around, and he's in Silent Hills right now... I don't know what the hell that's gonna do. But maybe he'll succeed. Whoever's picking up this signal, I'm sending you a tag on his PDA. Might have to help someone out.", nil, "default", 60000)
local jaba_place = alife():object("lvl9_military_zone_radioactive_killing_0016")
  local sobj = alife():create("pri_respawn_neutral", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
  if sobj then
  olr_timers.st_timer("del_toprip_durak", 500, "nick.del_toprip_durak("..tostring(sobj.id)..")")
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl13_prip_smart_terrain_0005 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  olr.add_spot_on_map(sobj.id,"green_location","Stalker trying to make his way to the center.")
end
end


function del_toprip_durak(id)
	local sobj = alife():object(id)
  	if sobj then
		level.map_remove_object_spot(sobj.id, "green_location")
	end
end

function esc_prizrak_spot()
	if xr_conditions.is_day() then
    		news_manager.send_tip(db.actor, "Toad: Anyway. when night falls, go there under the bridge, and solve the problem. Now while it's daytime, walk around somewhere...", nil, "trader", 60000)
      	elseif not xr_conditions.is_day() then
       		news_manager.send_tip(db.actor, "Toad: Well. it's nighttime. he's probably already there. Go on, go under the bridge.", nil, "trader", 60000)
	end
local sobj = alife():object("lvl1_escape_space_restrictor_0102") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","The place where the stalker who died on Yantar was seen at night.") 
end
end



function set_norm_relation_stalkers()
for k,v in pairs(db.storage) do
        local stalker = level.object_by_id(k)
            if stalker and (get_clsid(stalker)==clsid.script_stalker) and stalker:alive() and stalker:relation(db.actor)==game_object.enemy then
		relation_registry.set_community_goodwill ("stalker", db.actor:id (), 150)
	    end
end
end


function del_agr_vertuha_arg()
olr_timers.st_timer("del_agr_vertuha_arg", 1115, "nick.del_agr_vertuha_arg2()")
end


function del_agr_vertuha_arg2()
olr.del_by_name("agro_escape_helicopter_0000")
--olr.del_by_name("lvl3_agroprom_physic_object_0028")
--olr.del_by_name("lvl3_agroprom_physic_object_0027")
end


function bandosy_otmetka_kalash()
local sobj = alife():object("lvl1_escape_stalker_0030") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","The bandits who took the gun from the rookie.") 
end
end

function clear_otmetka_kalash()
	olr.del_by_name("lvl1_escape_stalker_0030")
	olr.del_by_name("lvl1_escape_physic_object_0193")
end


function pre_deadcity_paras_talk_to_dleader()
	db.actor:give_info_portion("deadcity_paras_talk_to_dleader")	
end




function zombied_monotith_talk_kill_fucc()
for i=1, 65534 do
local car = level.object_by_id(i)
if car then
if car ~= nil and 
car:name() == "lvl15_sarcofag_stalker_0003" then

local h = hit ()
h.power = 1000
h.direction = vector():set (0, -1, 0)
h.impulse = 0
h.draftsman = car
h.type = hit.strike
car:hit (h)
end
end
end
end



function kill_jan_jan_konteer_tree()
for i=1, 65534 do
local car = level.object_by_id(i)
if car then
if car ~= nil and 
car:name() == "lvl7_yantar_stalker_0002" then

local h = hit ()
h.power = 1000
h.direction = vector():set (0, -1, 0)
h.impulse = 0
h.draftsman = car
h.type = hit.strike
car:hit (h)
end
end
end
olr_timers.st_timer("pre_yantar_off_effs_ebaa_contr", 15, "nick.pre_yantar_off_effs_ebaa_contr()")
end



function pre_yantar_off_effs_ebaa_contr()
news_manager.send_tip(db.actor, "Hey! Anybody here?! I'm down here in the cellar!", nil, "default", 39000)
db.actor:give_info_portion("spawn_contr_pogreb_info")
end



function pre_yantar_off_effs_ebaa()
news_manager.send_tip(db.actor, "The radiation's gone down. Don't wait for the target, move out now. Repeat, team, move out.", nil, "default", 39000)
local snd_obj = xr_sound.get_safe_sound_object([[ol3\babka_noise]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
db.actor:change_character_reputation(45)
olr_timers.st_timer("omssbioff3223", 45, "nick.pre_yantar_off_effs_ebaa2()")
end


function pre_yantar_off_effs_ebaa2()
	news_manager.send_tip(db.actor, "Roger, we're on our way.", nil, "default", 39000)
end


function pre_radar_off_effs()
olr.del_by_name("lvl12_radar_bunker_karlik_0002")
olr.del_by_name("lvl12_radar_bunker_karlik_0003")
olr.del_by_name("lvl12_radar_bunker_swamp_karlik")
olr.del_by_name("lvl12_radar_bunker_lights_hanging_lamp_0003")
olr_timers.st_timer("ombi3223", 125, "nick.clear_earth_quake_radar2()")
olr_timers.st_timer("omssbi3223", 225, "nick.pre_radar_off_effs_ebaa()")
end



function esc_son_novic()
	if math.random(1,2) == 1 then
		news_manager.send_tip(db.actor, "I'll meet you at the Cordon.", nil, "zombied", 12000)
	end
	olr.info("esc_son_novic_spawn")
end


function osved_radas_places()
local sobj = alife():object("lvl7_yantar_physic_object_0147") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Coordinates of the laboratory under Lake Yantar.") 
end
local sobj = alife():object("central_complex") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Coordinates of the Yantar radiation") 
end
local sobj = alife():object("lvl10_radar_space_restrictor_0005") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Radar radiation coordinates") 
end
end


function jaba_bigbrotha_remind()
news_manager.send_tip(db.actor, "Hey, I got a report you found something interesting. Some weird folders. Yeah, my guys are keeping a little eye on you... what you're doing..., where you're going..., what you're looking for... I got eyes all over the Zone. If it's something interesting, drag it in, I'll see what's what.", nil, "trader", 39000)
  local sobj = nil
  local jaba_place = alife():object("lvl1_escape_jaba_place")
  local sobj = alife():create("agr_stalker_veteran", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
  if sobj then
  --log1("has sobj")
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  --level.map_add_object_spot_ser( sobj.id, "green_location", "fff" )
  end

  local sobj = alife():object("lvl1_escape_stalker_0029")
  if sobj then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl1_escape_stalker_0001")
  if sobj then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end


end


function stader_kv_4_remind()
olr_timers.st_timer("ombied_stader_kv_4_remind", 225, "nick.stader_kv_4_remind2()")
end


function stader_kv_4_remind2()
if has_alife_info("esc_olr_kvest_4_dont_shoot") then
return 
end
news_manager.send_tip(db.actor, "Hey, what are you doing out there? Run to the factory!", nil, "trader", 39000)
end


function selfdestruck_lab_start_explode()
local level_name = level.name()
if level_name == "lvl12_radar_bunker" then
local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_deep]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
level.add_cam_effector("camera_effects\\earthquake.anm", 1488228, false)
level.add_pp_effector("blink.ppe", 20131, false)
db.actor:kill(db.actor)
get_console():execute("sv_setweather dark")
for i=1,65535 do
local lokobj = level.object_by_id(i)
if lokobj then
if get_clsid(lokobj) == clsid.hanging_lamp then
if lokobj:name() ~= "lights_alarm_1_0004_svtoy" then
lokobj:get_hanging_lamp():set_brightness(0.001)
end
end
end
end
else
olr.del_by_name("lvl10_radar_level_changer_0000")
local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_deep]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
level.add_cam_effector("camera_effects\\earthquake.anm", 1, false)
olr_timers.st_timer("ombied_punk_tele33323", 15, "nick.clear_earth_quake_radar()")
olr_timers.st_timer("ombied_punk_tele333223", 25, "nick.clear_earth_quake_radar2()")
end
end


function clear_earth_quake_radar()
    level.remove_pp_effector(1488228)
local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_large_away]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function clear_earth_quake_radar2()
local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_large_away_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function selfdestruck_lab_start_60()
olr_timers.st_timer("ombied_punk_tele3323", 30, "nick.selfdestruck_lab_start_explode()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Program B-175 activated. 30 seconds left.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\medik_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
end



function selfdestruck_lab_start_90()
olr_timers.st_timer("ombied_punk_tele333", 30, "nick.selfdestruck_lab_start_60()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Program B-175 activated. 60 seconds remaining.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\medik_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
end



function selfdestruck_lab_start_10()
olr_timers.st_timer("ombied_punk_tele333", 30, "nick.selfdestruck_lab_start_90()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Program B-175 activated. 90 seconds remaining.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\medik_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
end


function selfdestruck_lab_start()
olr_timers.st_timer("ombied_punk_tele33", 10, "nick.selfdestruck_lab_start_10()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Program B-175 activated. Personnel must leave the facility immediately.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\medik_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.blow_add(500)
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
end



function bun_swatoy_down_light()
olr_timers.st_timer("ombied_punk_a", 10, "nick.down_light_svatoy()")
olr_timers.st_timer("ombied_onow_cool_generators", 270, "nick.tihonow_cool_generators()")
end


function tihonow_cool_generators()
    	news_manager.send_tip(db.actor, "Lab technician Tikhonov: Strelok... it seems the level of psi activity behind the stanitsa is starting to drop... I hope you know what you're doing...", nil, "ecolog", 15000)
end


function down_light_svatoy()
get_console():execute("sv_setweather dark")
local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\electric_crash]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
for i=1,65535 do
local lokobj = level.object_by_id(i)
if lokobj then
if get_clsid(lokobj) == clsid.hanging_lamp then
if lokobj:name() ~= "lights_alarm_1_0004_svtoy" then
lokobj:get_hanging_lamp():set_brightness(0.05)
end
end
end
end
end


function bun_swatoy_look_hey()
    	news_manager.send_tip(db.actor, "Svyatoy: No!", nil, "default", 5000)
	olr_timers.st_timer("ombied_punk_ass_mf", 2, "nick.punk_ass_mf_svatoy()")
	level.disable_input()
	level.hide_indicators()
	bind_stalker.hide_weapon()
	olr.snd([[weapons\pistol_future\gauss_pistol_shoot]])
	level.add_pp_effector("snd_shock.ppe", 2371, false)
	olr.snd([[ol3\koan\Organizm1]])
end


function remove_cam_inert_timer()
get_console():execute("cam_inert 0.2")
end


function punk_ass_mf_svatoy()
get_console():execute("cam_inert 0.9")
olr_timers.st_timer("remove_cam_inert_timer", 1, "nick.remove_cam_inert_timer()")

for i=1,65535 do
local lokobj = level.object_by_id(i)
if lokobj then
if lokobj:name() == "lvl12_radar_bunker_staler_undead_olr_0001" then

local pos = lokobj:bone_position("bip01_head")
local vDir = pos:sub(db.actor:position())
db.actor:set_actor_direction(-vDir:getH())
end
end
end
end


function on_lab_swithc_dok_fin_done_del_door()
        local snd_obj = xr_sound.get_safe_sound_object([[ol3\siren_gen]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("lvl16_generators_physic_object_0226")
	olr.del_by_name("lvl16_generators_physic_object_0207")
	olr.del_by_name("lvl16_generators_physic_object_0187")
	olr.del_by_name("lvl16_generators_physic_object_0186")
	olr_timers.st_timer("blowout_additional_timer5", 11, "olr_blowout.blowout_additional_timer5()")
end



function buy_hand_zonamap_action()
	olr.give_item("planshet")
end

function buy_elmagnbads_action()
local montabl = 
{
       ["zone_witches_galantine"] = true,
       ["zone_witches_galantine_strong"] = true,
       ["zone_witches_galantine_average"] = true,
       ["zone_witches_galantine_weak"] = true
}
local sim = alife()
local obj
for i = 1, 65534 do
obj = sim:object(i)
if obj then
if montabl[obj:section_name()]  then
if math.random(1,20) == 1 then
olr.add_spot_on_map(obj.id,"alife_presentation_stalker","Electromagnetic anomaly.")
--log1("elmag add")  
end	
end
end
end
end


function buy_strange_zonamap_action()
local sobj = alife():object("lvl3_agroprom_physic_object_0176") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Coordinates of the strange place.") 
end
end

function buy_traders_zonamap_action()
local sobj = alife():object("vhod_v_bar") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Stalker Bar") 
end
local sobj = alife():object("bar_dolg_locator") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Duty merchant") 
end
local sobj = alife():object("lvl7_yantar_space_restrictor_0023") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Lake Yantar Science Camp") 
end
local sobj = alife():object("lvl11_deadcity_physic_object_0007") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Freedom merchant") 
end
local sobj = alife():object("lvl8_swamp_physic_object_0301") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Scientific camp on the Swamps") 
end
end

function hass_money_50(actor,npc)
    return db.actor:money() >= 50
end

function hass_money_500(actor,npc)
    return db.actor:money() >= 500
end

function hass_money_200(actor,npc)
    return db.actor:money() >= 200
end

function hass_money_100(actor,npc)
    return db.actor:money() >= 100
end


function givess_money_50(t1,t2)    
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,50,"out")
end  

function givess_money_500(t1,t2)    
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,500,"out")
end

function givess_money_200(t1,t2)    
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,200,"out")
end 

function givess_money_100(t1,t2)    
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,100,"out")
end  



function find_mass_gruz_fucc()
     return nik_dialog.item_much("yan_massive_gruz",1) ~= false    
end

function give_mass_gruz_fucc()
	nik_dialog.out_item_much("yan_massive_gruz",1)
	olr.give_item("actor_boots")
end


function yan_create_dead_moskv()
  local se_obj = alife():object("lvl1_escape_stalker_0053")
  if se_obj then
	alife():create("ph_dead_moskvich", se_obj.position, se_obj.m_level_vertex_id, se_obj.m_game_vertex_id)
	alife():create("controller_new", se_obj.position, se_obj.m_level_vertex_id, se_obj.m_game_vertex_id)
  end
end



function bar_space_group_quest_delete()
olr.del_by_name("lvl5_bar_physic_object_1297")
olr.del_by_name("lvl5_bar_physic_object_1300")
olr.del_by_name("lvl5_bar_physic_object_1304")
olr.del_by_name("lvl5_bar_physic_object_1308")
olr.del_by_name("lvl5_bar_physic_object_1315")
olr.del_by_name("lvl5_bar_staler_undead_olr_0004")
olr.del_by_name("lvl5_bar_physic_object_1311")
olr.del_by_name("lvl5_bar_physic_object_1314")
olr.del_by_name("lvl5_bar_physic_object_1313")
olr.del_by_name("lvl5_bar_space_restrictor_0123")
olr.del_by_name("bar_prefix_lights_hanging_lamp_00sss57")
olr.del_by_name("bar_prefix_lights_hanging_lamp_00sa56")
olr.del_by_name("lvl5_bar_physic_object_1301")
olr.del_by_name("lvl5_bar_physic_object_1309")
olr.del_by_name("lvl5_bar_physic_object_1305")
olr.del_by_name("lvl5_bar_physic_object_1342")
olr.del_by_name("lvl5_bar_physic_object_1185")
olr.del_by_name("lvl5_bar_physic_object_1341")
olr_timers.st_timer("ombied_start_teleport", math.random(1300,1570), "nick.bar_zombied_start_nagrada()")
end



function bar_zombied_start_nagrada()
local snd_obj = xr_sound.get_safe_sound_object([[device\pda\pda_news]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
db.actor:give_info_portion("dezint_bar_zombied_start_nagrada_info")
news_manager.send_tip(db.actor, "Professor Markov: Hey, Stalker! Can you hear me? This is Professor Markov. I flew to the Big Land, but I couldn't leave you without a reward. After all, you did bring me a new degree. Talk to the guard outside the bar. I left my disintegrator activation prototype with him. You might still need it, but if not, you can sell it for good money. Okay, see you later, stalker.", nil, "item", 90000)	
end




function bar_gopstopers_del()
olr.del_by_name("lvl5_bar_space_restrictor_0119")
olr.del_by_name("lvl5_bar_stalker_0053")
olr.del_by_name("lvl5_bar_stalker_0054")
olr.del_by_name("lvl5_bar_space_restrictor_0118")
olr.del_by_name("bar_prefix_lights_hanging_lamp_0072")
olr.del_by_name("lvl5_bar_physic_object_1387")
end




function bar_prisoners_del()
olr.del_by_name("lvl5_bar_space_restrictor_0008")
olr.del_by_name("lvl5_bar_space_restrictor_0062")
olr.del_by_name("lvl5_bar_stalker_000000")
olr.del_by_name("lvl5_bar_stalker_0027")
olr.del_by_name("lvl5_bar_stalker_0028")
olr.del_by_name("lvl5_bar_stalker_0018")
olr.del_by_name("lvl5_bar_ammo_12x76_zhekan")
olr.del_by_name("lvl5_bar_physic_object_0371")
olr.del_by_name("lvl5_bar_lights_hanging_lamp_0013_ostanovka")
olr.del_by_name("bar_beter_start")
end



function bar_zombied_start_teleporting()
level.disable_input()
news_manager.send_tip(db.actor, "Scientist: So, ready for a magical magical journey? Stay where you are and don't move...", nil, "default", 10000)
level.add_pp_effector("black.ppe", 20131, false)
xr_effects.disable_ui(db.actor, nil)
level.add_pp_effector("blink.ppe", 20131, false)
local point = patrol("space_telep_walk")
local look = patrol("space_telep_look")
db.actor:set_actor_position(point:point(0))
local dir = look:point(0):sub(point:point(0))
db.actor:set_actor_direction(-dir:getH())
olr_timers.st_timer("bar_zombied_start_telep", math.random(10,17), "nick.bar_zombied_start_teleporting2()")	
end


function bar_zombied_start_teleporting2()
news_manager.send_tip(db.actor, "Hey, what the--", nil, "default", 3000)
level.add_pp_effector("black.ppe", 20131, false)
level.add_pp_effector("blink.ppe", 220131, false)
xr_effects.disable_ui(db.actor, nil)
level.add_pp_effector("blink.ppe", 20131, false)
local point = patrol("dezint_walk")
local look = patrol("dezint_look")
db.actor:set_actor_position(point:point(0))
local dir = look:point(0):sub(point:point(0))
db.actor:set_actor_direction(-dir:getH())
level.enable_input()
local snd_obj = xr_sound.get_safe_sound_object([[ol3\teleport]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
local snd_obj = xr_sound.get_safe_sound_object([[ol3\space_ody]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr_timers.st_timer("bar_zombied_start_telep2", math.random(30,37), "nick.bar_zombied_start_teleporting_final()")	
end


function bar_zombied_start_teleporting_final()
news_manager.send_tip(db.actor, "Scientist:...why the hell did I come here?.... Hey! Are you alive?", nil, "default", 10000)
level.add_cam_effector("camera_effects\\hit_back.anm", 1, false)
level.add_pp_effector("blink.ppe", 20131, false)
local point = patrol("space_telep_walk")
local look = patrol("space_telep_look")
db.actor:set_actor_position(point:point(0))
local dir = look:point(0):sub(point:point(0))
db.actor:set_actor_direction(-dir:getH())
level.enable_input()
xr_effects.enable_ui(db.actor, nil)
local snd_obj = xr_sound.get_safe_sound_object([[ol3\teleport]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)	
db.actor:give_info_portion("dezint_qt_spawn_teleportered_info")
olr_sleep.sleep_main(5)
db.actor:restore_weapon()
end




function dezint_qt_spawn_two()
level.add_pp_effector("blink.ppe", 220131, false)
local snd_obj = xr_sound.get_safe_sound_object([[ol3\teleport]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
alife():create("zombied_pda_dezintegr", db.actor:position():add(db.actor:direction():mul(0.1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
alife():create("ph_food_vater", db.actor:position():add(db.actor:direction():mul(0.1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
alife():create("ph_food_konserva_orehi_open", db.actor:position():add(db.actor:direction():mul(0.1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
alife():create("ph_item_battery_02", db.actor:position():add(db.actor:direction():mul(0.1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
alife():create("ph_item_rukzak", db.actor:position():add(db.actor:direction():mul(0.1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
alife():create("dead_body_skelet", db.actor:position():add(db.actor:direction():mul(0.3)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
news_manager.send_tip(db.actor, "Hey, are you here?", nil, "act", 39000)
db.actor:give_info_portion("dezint_qt_spawn_two_info")	
olr.enable_walk()
end




function daem_dezintegrator_pribor()
	olr.give_item("detector_activator_deznt")
end


function daem_dezintegrator_t()
	olr.give_item("af_dezintegrator_m2")
olr.del_by_name("lvl5_bar_physic_object_1386")
olr.del_by_name("lvl5_bar_physic_object_1385")
  local se_obj = alife():object("lvl5_bar_staler_undead_olr_0005")
  if se_obj then
    olr.add_spot_on_map( se_obj.id,"crlc_mdl","Zombified stalker")
  end
end



function daem_dezintegrator_two_done()
	news_manager.send_tip(db.actor, "Money received - 1000", nil, "money", 39000)
	db.actor:give_money(1000)
	game_stats.money_quest_update(1000)
	olr_timers.st_timer("markov_tri", 8000, "nick.markov_tri_diattt()")
end


function markov_tri_diattt()
	news_manager.send_tip(db.actor, "This is Professor Markov. You can come over, there's work to be done. I have some interesting information for you.", nil, "ecolog", 39000)
	olr.info("can_markov_quest_tri")
end


function dezint_qt_spawn()
local snd_obj = xr_sound.get_safe_sound_object([[ol3\teleport]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
local snd_obj = xr_sound.get_safe_sound_object([[anomaly\zhar_blow]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
local snd_obj = xr_sound.get_safe_sound_object([[anomaly\anomaly_gravy_hit]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
alife():create("zone_zharka_static", db.actor:position():add(db.actor:direction():mul(0.2)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
news_manager.send_tip(db.actor, "What the hell? Almost got fried... I think it appeared right in front of me...", 4, "act", 39000)
db.actor:give_info_portion("dezint_qt_spawn_done_info")	
end



function daem_dezintegrator_m()
	olr.give_item("af_dezintegrator_m1")
end


function dezintegrator_precond()
     return nik_dialog.item_much("af_dummy_battery",1) ~= false 
end



function otdaem_dezintegrator_f()
	db.actor:give_money(500)
	game_stats.money_quest_update(500)
	nik_dialog.out_item_much("af_dummy_battery",1)
	olr_timers.st_timer("dezint_two_now", 6000, "nick.has_timer_spacesms()")
end

function has_timer_spacesms()
	news_manager.send_tip(db.actor, "This is Professor Markov. You're welcome to come in, there's work to be done.", nil, "ecolog", 39000)
	olr.info("dezint_two_startnow")
end

function has_timer_space_two()
	if has_alife_info("dezint_two_startnow") then
		return true
	else
		return false
	end
end



function del_mgg_beteers()
	olr.del_by_name("lvl7_dcccdewry_m_car_0002")
	olr.del_by_name("lvl11_deadcity_space_restrictor_0003")
end


function metka_plot_mg()
  local se_obj = alife():object("lvl11_deadcity_flesh_strong")
  if se_obj then
    olr.add_spot_on_map( se_obj.id,"crlc_big","Flesh to catch")
  end
end


function yan_zablik_dead_del()
	olr.del_by_name("lvl7_yantar_space_restrictor_0037")
	olr.del_by_name("lvl7_yantar_physic_object_0627")
end


function jaba_art_zakaz_spawn()
	if level.name() == "lvl1_escape" or level.name() == "lvl5_bar" then
		return 
	end
        local lname = level.name()
	local lvtab = GetLevelVertexes( lname )
	local lvx = math.max(unpack(lvtab))
	local lv  = math.random(1,lvx)
	local gvtab  = GetGameVertexes(lname)
	local gv_min = math.min( unpack(gvtab))
	local gv_max = math.max( unpack(gvtab))
	local objsp = alife():create("af_random_zakaz", level.vertex_position(lv), lv, gv_max)
	if objsp then
		local metka = alife():create("treasure_place_metka", level.vertex_position(lv), lv, gv_max)
		olr.add_spot_on_map( metka.id,"tutorial_artefact_location", "The approximate location where Toad's special artifact was seen." )
		olr_timers.st_timer("del_rnd_zakaz_metka", 1500, "nick.del_rnd_zakaz_metka("..tostring(metka.id)..")")
	end
	if math.random(1,2) == 1 then
		alife():create("agr_stalker_regular", level.vertex_position(lv), lv, gv_max)
	end
        local text_phrase = {"I have a special order here. Bring anything weird you find. You never know what kind of surprise the Zone is gonna spring on you next time. For an unknown artifact, it's ten times the price. And hurry, you're not alone", 
	"Hey, are you outside the Cordon now? I was told a strange artifact was seen in that area. Bring anything strange you find. You never know what kind of surprise the Zone will give you next time. There's a tenfold fee for an unknown artifact. And hurry, you're not alone", 
	"There's information about a special artifact in the area where you are. Bring anything weird you find. You never know what surprise the Zone will give you next time."}
	local news_text = "%c[255,245,118,54]"..game.translate_string("Toad:").."\\n".."%c[255,245,118,54]"..game.translate_string(text_phrase[math.random(#text_phrase)])
	db.actor:give_game_news(news_text, "ui\\ui_icons_task", Frect():set(50,0,50,50),3*1000, 15000)

	--local sactor = alife():actor()
	--local cactor = level.object_by_id(sactor.id)
	--cactor:give_game_news("Toad:\n "..text_phrase[math.random(#text_phrase)].."", "ui\\ui_icons_task",Frect():set(50,100,50,50),math.random(1000, 3000),15000)

	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function del_rnd_zakaz_metka(id)
	local sobj = alife():object(id)
  	if sobj then
		--news_manager.send_tip(db.actor, "!!!!!!!! DEL METKA ZAKAZA !!! -- "..sobj:name().."  -- "..sobj.level_name.."  ", nil, "act", 39000)
		level.map_remove_object_spot(sobj.id, "tutorial_artefact_location")
		olr.del(sobj)
	end
end

function gen_restore_sarcofag()
	level.add_pp_effector("black.ppe", 20131, false)
	sarcofag_dead_stalkers_teleport()
	level.add_cam_effector2("camera_effects\\fusker.anm", 1523, false, "")
end

function find_journalist_restore_weapon()
	bind_stalker.restore_weapon()
	news_manager.send_tip(db.actor, "I think this is it. We need to destroy these flasks.", nil, "act", 39000)
end

function precond_fake_destroy_lab_gen(actor,npc)
    return has_alife_info("gen_bunker_destr_1") and has_alife_info("gen_bunker_destr_2") and has_alife_info("gen_bunker_destr_3") and has_alife_info("gen_bunker_destr_4")
end

function gen_piss_sms()
	news_manager.send_tip(db.actor, "You found what you were looking for after all. We need to find the main control center and end this...", nil, "act", 39000)
end

function antenna_off_jaba_sms()
news_manager.send_tip(db.actor, "Strelok, this is Toad. I know where you are and where you're going. You have two choices right now. The first is to go through Pripyat, but I have a vague idea of what's there now, I know the city's on fire and the radiation is off the scale. You can't get through without protection. The second way is to follow the old road to the power plant. There's some psi radiation, some spikes. But it's probably safe.", nil, "trader", 39000)
news_manager.send_tip(db.actor, "Besides, I hear there's a military group missing from the old road. so there's a chance of getting some gear. Oh, and, uh. I'll put in a good word for you, because it's not good for you to be wearing monoliths...", 11, "trader", 39000)
  local se_obj = alife():object("lvl10_radar_level_changer_0002")
  if se_obj then
    olr.add_spot_on_map( se_obj.id,"level_changer","To the forgotten road")
  end
  	if db.actor then
		db.actor:set_character_community("actor", 0, 0)
	end
  local se_obj = alife():object("lvl13_prip_level_changer_0001")
  if se_obj then
    olr.add_spot_on_map( se_obj.id,"level_changer","To the forgotten road")
  end

end


function find_all_zarazas(actor,npc)
    return has_alife_info("deadcity_paras_find_first") and has_alife_info("deadcity_paras_find_second")
end


function explode_all_zarazas(actor,npc)
    return has_alife_info("mg_pre_explode_two") and has_alife_info("mg_pre_explode_one_done")
end


function deadcity_paras_talk_to_dleader_sms2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n Hmm, looks like the source of the infestation...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1700, 3000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function deadcity_paras_talk_to_dleader_sms3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n Hmm, looks like a source of contagion...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1700, 3000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end





function deadcity_paras_talk_to_dleader_sms()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n Messer, this is the leader of the Duty faction. I'm waiting for you at my place, we need to talk.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),40000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function proffecor_group_quest_delete_del()
local se_obj = alife():object("lvl_test_lights_hanging_lamp")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl_test_lights_hanging_lamp_0000")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_space_restrictor_0049")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0088")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_uch_stalker_0004")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_space_restrictor_0011")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("yan_prefix_lights_hanging_lamp_0034")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_stalker")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_stalker_0013")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0635")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0545")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0544")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_lights_hanging_lamp_0016")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0649")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0164")
if se_obj then
alife():release(se_obj, true)
end
--local se_obj = alife():object("lvl7_yantar_physic_object_0016")
--if se_obj then
--alife():release(se_obj, true)
--end
local se_obj = alife():object("lvl7_yantar_physic_object_0166")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_staler_undead_olr_0000")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_m_chimera_e_0003")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_staler_undead_olr_0001")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0276")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_space_restrictor_0022")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_space_restrictor_0052")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0627")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0280")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_physic_object_0279")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_yantar_stalker_0001")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl7_uch_stalker_0005")
if se_obj then
alife():release(se_obj, true)
end


local sobj = alife():object("lvl7_yantar_stalker_0058") 
if sobj then  
	olr.kill_offline_stalker(sobj)
end

local se_obj = alife():object("lvl7_yantar_stalker_0058")
if se_obj then
alife():release(se_obj, true)
end


local se_obj = alife():object("lvl7_yantar_physic_object_0648")
if se_obj then
alife():release(se_obj, true)
end

local se_obj = alife():object("lvl7_yantar_physic_object_0547")
if se_obj then
alife():release(se_obj, true)
end


local se_obj = alife():object("lvl7_yantar_smart_terrain_0013") 
local sobj = alife():object("lvl7_yantar_inventory_box") 
if sobj then  
	alife():teleport_object(sobj.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
end

olr_timers.st_timer("delyan_additional", 11, "nick.delyan_additional()")

	olr.del_by_name("lvl7_yantar_physic_object_0734")
	olr.del_by_name("lvl7_yantar_physic_object_0725")
	olr.del_by_name("lvl7_yantar_physic_object_0726")
	olr.del_by_name("lvl7_yantar_physic_object_0735")
	olr.del_by_name("lvl7_yantar_physic_object_0724")

	olr.del_by_name("lvl7_uch_stalker_0003")
	olr.del_by_name("lvl7_uch_stalker_0002")
	olr.del_by_name("lvl7_uch_stalker_0005")
	olr.del_by_name("lvl7_uch_stalker_0004")


end




function delyan_additional()
	local se_obj = alife():object("lvl7_yantar_smart_terrain_0015") 
	local sobj = alife():object("lvl7_yantar_stalker_0058") 
	if sobj then  
		alife():teleport_object(sobj.id, se_obj.m_game_vertex_id, se_obj.m_level_vertex_id, se_obj.position)
	end
end





function daem_doki_vetrov_bezumia_zapiska(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "zapiska_dead_proffecor","in")
dialogs.relocate_item_section(second_speaker, "grafic_ciklichnosti_vetrov_doki","in")
end



function otdaem_doki_vetrov_bezumia()
nik_dialog.out_item_much("vetri_bezumia_doki",1)
end



function yantar_proff_zona_first()
       if has_alife_info("yantar_proff_zona_first_info") then
		return
	end
	db.actor:give_info_portion("yantar_proff_zona_first_info")
	first_bunker_fake_sms1()
	first_bunker_fake_sms2()
	first_bunker_fake_sms3()
	olr.disable_walk()
	olr_timers.st_timer("disable_wsslk", 9, "nick.enab_yan_walk()")
end




function first_bunker_fake_sms1()
	olr_timers.st_timer("hfghfg_wsslk", 59, "nick.agro_ecologs_clear_hlam()")
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Science Camp:\\n What do you want?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 2000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function first_bunker_fake_sms2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Science Camp:\\n Wait, I'm about to disable the security system...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 5000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function first_bunker_fake_sms3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Science Camp:\\n Alright, come on in.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(6000, 8000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function daem_antirad_para(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "med_injector_capsule","in")
dialogs.relocate_item_section(second_speaker, "antirad","in")
end


function enab_yan_walk()
	olr.enable_walk()
end


function del_monolit_hlam()
olr.del_by_name("lights_gi_r2_0001")
olr.del_by_name("lights_gi_r2_0000")
local se_obj = alife():object("lvl15_sarcofag_space_restrictor_0005")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_space_restrictor_0000")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("sar_monolith_spot")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl_sar_lights_hanging_lamp_0000")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl_sar_lights_hanging_lamp")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("sar_monolith")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_physic_object_0011")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_physic_object_0015")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_physic_object_0013")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_physic_object_0014")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_space_restrictor_0002")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_physic_object_0010")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl15_sarcofag_physic_object_0012")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lights_hanging_lamp0007")
if se_obj then
alife():release(se_obj, true)
end

end




function now_iremember_delhlam()
	local item_in_slot = db.actor:item_in_slot(6)
	if item_in_slot ~= nil then
		olr_ruck_limit.on_to_box(item_in_slot)
	end
local iskluch_items = 
{
["device_pda"] = true,
["bolt"] = true
}
db.actor:iterate_inventory( function(_, obj)
        local ini = system_ini()
	if ini:line_exist(obj:section(), "quest_item") and ini:r_bool(obj:section(), "quest_item") == true then
		return nil
	end
        if iskluch_items[obj:section()] then 
        	return nil
	end
	if obj then
		local pos = vector():set(1000,-100,0)
        	db.actor:drop_item_and_teleport(obj, pos)
	end
end)
olr.del_noparent_weapons()
end



function daem_aksu_small(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "wpn_aksu_small","in")
dialogs.relocate_item_section(second_speaker, "ammo_5.45x39_fmj","in")
dialogs.relocate_item_section(second_speaker, "ammo_5.45x39_fmj","in")
dialogs.relocate_item_section(second_speaker, "ammo_5.45x39_fmj","in")
dialogs.relocate_item_section(second_speaker, "medkit","in")
dialogs.relocate_item_section(second_speaker, "medkit","in")
dialogs.relocate_item_section(second_speaker, "antirad","in")
dialogs.relocate_item_section(second_speaker, "antirad","in")
end




function del_agro_musor_after_pohod()
  local se_obj = alife():object("lvl3_agroprom_space_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_m_car")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl3_agroprom_m_car_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0011")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0013")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0014")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_stalker_0043")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_stalker_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("zavod_terr_0000")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("zavod_terr_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0012")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_physic_object_0028")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_physic_object_0027")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_zone_ameba1_0037")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_zone_ameba1_0039")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_zone_ameba1_0036")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("zomb13_agroprom_stalker_0029")
  if se_obj then
    alife():release(se_obj, true)
  end

end






function jrat_precond()
if db.actor.satiety <= 0.35 then
return true
else
return false
end
end


function set_jrat_jaba()
	db.actor.satiety = db.actor.satiety + 0.4
	db.actor:give_money(-50)
	game_stats.money_quest_update(-50)
	news_manager.send_tip(db.actor, "The money is 50.", nil, "money", 39000)
end



function kk_create_lchanger_first()
  local se_obj = alife():object("lvl1_escape_physic_object_0509")
  if se_obj then
    olr.add_spot_on_map( se_obj.id,"level_changer","To the catacombs")
  end
	local se_obj = alife():object("lvl_rat_level_changer")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the cordon.")
  	end
end


function swp_first_scr()
level.add_pp_effector("black.ppe", 20131, false)
end


function has_timer_bablo_patnashka_osved()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.timer_bablo_patnashka_osved
	if (gtime - ftime) >= 24*2 or has_alife_info("bar_doki_patnashak_timer") then
		return true
	else
		return false
	end
end


function otdaem_has_bablo_patnashka_osved(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "documentacia_zombibrain_doki","in")
end





function precond_bablo_patnashka_osved(actor,npc)
    return actor:money() >= 15000
end



function give_bablo_patnashka_osved(t1,t2)
local gtime = level.get_time_days()*60*50+level.get_time_hours()*60+level.get_time_minutes() 
xvars.timer_bablo_patnashka_osved = gtime 
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,15000,"out")
olr_timers.st_timer("braindok_navodka_timer_patnashka", 11000, "nick.braindok_navodka_timer_patnashka()")
end


function give_bablo_braindok_navodka(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,5000,"out")
olr_timers.st_timer("braindok_navodka_timer", 5000, "nick.braindok_navodka_timer()")
end

function braindok_navodka_timer_patnashka()
	news_manager.send_tip(db.actor, "Messer, this is Informant. There are documents, come and get them...", nil, "flash", 95000)
	db.actor:give_info_portion("bar_doki_patnashak_timer")
end

function braindok_navodka_timer()
	nick.osved_about_docstalker()
end


function give_treasure_brain_docs()
	--local places = {}
	--local sim = alife()
	--for id=1, 65534 do
	--	local obj = sim:object(id)
	--	if obj then
	--	if obj.m_game_vertex_id then
	--	if game_graph():valid_vertex_id(obj.m_game_vertex_id) then
	--	if obj:section_name() == "treasure_place_obj" then 
	--	if alife():level_name(game_graph():vertex(obj.m_game_vertex_id):level_id()) == "lvl1_escape" 
	--	or alife():level_name(game_graph():vertex(obj.m_game_vertex_id):level_id()) == "lvl2_garbage"
	--	or alife():level_name(game_graph():vertex(obj.m_game_vertex_id):level_id()) == "lvl3_agroprom"
	--	or alife():level_name(game_graph():vertex(obj.m_game_vertex_id):level_id()) == "lvl4_darkdolina"
	--	or alife():level_name(game_graph():vertex(obj.m_game_vertex_id):level_id()) == "lvl5_bar" then     
	--	table.insert(places, obj)
	--	end
	--	end
	--	end
	--	end
	--	end
	--	end
	--	local rand_obj = places[math.random(#places)]
	--	local metka = alife():create("treasure_place_metka", rand_obj.position, rand_obj.m_level_vertex_id, rand_obj.m_game_vertex_id) -- серверный
	--	olr.add_spot_on_map( metka.id,"crlc_big", "Приблизительное место где находится схрон с документами" )
	--	alife():create("documentacia_zombibrain_doki", rand_obj.position, rand_obj.m_level_vertex_id, rand_obj.m_game_vertex_id) -- серверный
	--	local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(rand_obj.m_game_vertex_id):level_id()), vector():set(rand_obj.position.x,rand_obj.position.y,rand_obj.position.z))
	--	news_manager.send_tip(db.actor, "...спрятал пока хабар, а то в рюкзаке места нет. Да и документы выложил, а то мало ли, бандиты могут докопаться. Чтобы не забыть где оставил, запишу - "..pos..".", nil, "artefact", 19000)

	local tab = {}
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "box_rukzak_treasure"
				then
					table.insert(tab, obj)
				end					
		end
	end
	local rand_obj = tab[math.random(#tab)]
	if rand_obj and rand_obj.id then
		--log1("  rand_obj   "..rand_obj:name().."  "..rand_obj.id.."   "..rand_obj.level_name.." ")
		local metka = alife():create("treasure_place_metka", rand_obj.position, rand_obj.m_level_vertex_id, rand_obj.m_game_vertex_id) -- серверный
		olr.add_spot_on_map( metka.id,"crlc_big", "Approximate location of the stash of documents." )
		alife():create("documentacia_zombibrain_doki", rand_obj.position, rand_obj.m_level_vertex_id, rand_obj.m_game_vertex_id, rand_obj.id) -- серверный
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(rand_obj.m_game_vertex_id):level_id()), vector():set(rand_obj.position.x,rand_obj.position.y,rand_obj.position.z))
		news_manager.send_tip(db.actor, "...I hid the stuff for now, because there's no room in my backpack. I also put the documents out, or the bandits might get to me. In order not to forget where I left it, I'll write down - "..pos..".", nil, "artefact", 19000)
	end

	for id=1, 65534 do
		local npc = level.object_by_id(id)
		if npc and npc:is_stalker() and not npc:alive() then


	local sobj = alife():object(npc:id()) 
	if sobj then  
		level.map_remove_object_spot(sobj.id, "esc_blockpost_box_location")
	end


end
end


end




function osved_about_docstalker()
local rand_stlk = {}
local montabl = 
{
       [clsid.script_stalker] = true
}

local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if montabl[kill:clsid()]  then
                if kill:alive() then
		if kill:community() == "stalker" then
		if alife():level_name(game_graph():vertex(kill.m_game_vertex_id):level_id()) == "lvl1_escape" 
		or alife():level_name(game_graph():vertex(kill.m_game_vertex_id):level_id()) == "lvl2_garbage"
		or alife():level_name(game_graph():vertex(kill.m_game_vertex_id):level_id()) == "lvl3_agroprom"
		or alife():level_name(game_graph():vertex(kill.m_game_vertex_id):level_id()) == "lvl4_darkdolina"
		or alife():level_name(game_graph():vertex(kill.m_game_vertex_id):level_id()) == "lvl5_bar" then 
                local strn_id = kill:smart_terrain_id()
		if strn_id ~= 65535 then
		table.insert(rand_stlk, kill)
end
end
end
end
end
end
end

	if #rand_stlk > 0 then
		local rand_obj = rand_stlk[math.random(#rand_stlk)]
		alife():create("dedast_docs_brain", rand_obj.position, rand_obj.m_level_vertex_id, rand_obj.m_game_vertex_id, rand_obj.id)
		olr.add_spot_on_map( rand_obj.id,"esc_blockpost_box_location","Stalker who has documentation on psi weapons." )

		olr.kill_offline_stalker(rand_obj)

		local name = news_main.get_npc_name(rand_obj)
		local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(rand_obj.m_game_vertex_id):level_id()), vector():set(rand_obj.position.x,rand_obj.position.y,rand_obj.position.z))

                news_manager.send_tip(db.actor, "Messer, this is the Informant. About the documents. I found out about this guy. Anyway, his name "..name..". "..pos.." the last time anyone saw him. Well, that's where you'll find him. I tagged him in your PDA. Oh, and I suggest you hurry before he disappears. I'm done.", nil, "flash", 95000)
		olr.beep()
	else
		news_manager.send_tip(db.actor, "Messer, it's the Informant. I'm sorry, I don't have your stalker data. So I can help you get it on your own. If you need anything, just don't forget the money.", nil, "default", 95000)
		olr.beep()
	end
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_news]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end






function precond_meddol_flash()
     return nik_dialog.item_much("med_dolga_flash",1) ~= false 
end


function precond_meddol_flash_done(t1,t2)
	nik_dialog.out_item_much("med_dolga_flash",1)
	olr.give_item("wpn_toz34_old")
	olr_treasure.create_treasure()
end




function bar_dolg_quest_npc()
local flg = false
local montabl = 
{
       [clsid.script_stalker] = true
}

local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if montabl[kill:clsid()] and kill:alive() then

		if not olr_protected.is_no_offline_alife_obj(kill:name()) then

		if kill.level_name == "lvl2_garbage" or kill.level_name == "lvl3_agroprom" or kill.level_name == "lvl4_darkdolina" then
		
		if flg == false then
			flg = true
			local sobj = alife():create("med_dolga_flash", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id, kill.id)
			olr.kill_offline_stalker(kill)
			olr_timers.st_timer("jaba_med_dolg_info", 20, "nick.jaba_med_dolg_info("..tostring(sobj.id)..")")
			olr_timers.st_timer("jaba_med_dolg_info_delmetka", 720, "nick.jaba_med_dolg_info_delmetka("..tostring(sobj.id)..")")
			olr.add_spot_on_map( kill.id,"crlc_mdl", "Mediator with medical supplies for Duty." )
		end
		
		--log1(""..pos.."")

end
end
end
end
end
end

function jaba_med_dolg_info_delmetka(id)
	local sobj = alife():object(id)
  	if sobj then
		level.map_remove_object_spot(sobj.id, "crlc_mdl")	
	end
end

function jaba_med_dolg_info(id)
	local sobj = alife():object(id)
  	if sobj then
	local pos = news_main.get_point_description(alife():level_name(game_graph():vertex(sobj.m_game_vertex_id):level_id()), vector():set(sobj.position.x,sobj.position.y,sobj.position.z))
	news_manager.send_tip(db.actor, "Messer. Didn't the Duty doctor send you to me? Well, I've already sent the medical supplies. The man's already left me. If you need them badly, I'll send you the location of this stalker in your PDA. You can deal with him yourself. "..pos..". Just be warned, the tag won't stay on him for long, for certain reasons. So hurry up.", nil, "trader", 31000)	
	end
end

function hm_vetra_bezumia_krisa_offline()
news_manager.send_tip(db.actor, "The documentation on the Winds of Madness. Rat mentioned it. Should come in handy.", nil, "flash", 31000)
  local se_obj = alife():story_object(500)
  if se_obj then
    alife():set_switch_offline (se_obj.id, true)
    alife():set_switch_online (se_obj.id, false)
    alife():set_interactive (se_obj.id, false)
  end
	olr.to_offline("bar_radio")
	olr.to_offline("bar_prefix_lights_hanging_lamp_0010")
	olr_timers.st_timer("barman_go_to_online", 8321, "nick.hm_vetra_bezumia_krisa_online()")
end




function hm_vetra_bezumia_krisa_online()
	olr.info("bar_krisa_vernulsya_after_greh")
  local se_obj = alife():story_object(500)
  if se_obj then
    alife():set_switch_offline (se_obj.id, false)
    alife():set_switch_online (se_obj.id, true)
    alife():set_interactive (se_obj.id, true)
  end
	olr.to_online("bar_radio")
	olr.to_online("bar_prefix_lights_hanging_lamp_0010")

	olr.del_by_name("lvl9_military_physic_object_0440")
	olr.del_by_name("lvl9_military_physic_object_0441")
	olr.del_by_name("lvl9_military_physic_object_0442")
	olr.del_by_name("lvl9_military_physic_object_0443")
	olr.del_by_name("lvl9_military_physic_object_0444")
	olr.del_by_name("lvl9_military_physic_object_0445")
	olr.del_by_name("lvl9_military_physic_object_0446")
	olr.del_by_name("lvl9_military_physic_object_0447")
	olr.del_by_name("lvl9_military_physic_object_0448")
end




function kill_grehs_all()
	olr.del_by_name("podsluhat")
	olr.del_by_name("lvl9_military_stalker_0014")
	olr.del_by_name("lvl9_military_stalker_0013")
	olr.del_by_name("lvl9_military_stalker_0012")
	olr.del_by_name("lvl9_military_physic_object_0340")

	olr.del_by_name("lvl9_military_physic_object_0417")
	olr.del_by_name("lvl9_military_zone_flame_small_0005")
	olr.del_by_name("lvl9_military_physic_object_0136")
	olr_timers.st_timer("wtf_holmi", 1473, "nick.wtf_holmi()")
  	olr.del_by_name("lvl_rat_psy_to_new_mil")  -- удаляем пси под милитари рат
	olr.del_by_name("lvl9_military_space_restrictor_0014")  
	news_manager.send_tip(db.actor, "We need to get these fucking lunatics out of bed. and find my stuff.", nil, "act", 31000)
	relation_registry.set_community_goodwill ("sin", db.actor:id(), -3000)
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 195 then
			if npc:character_community() == "sin" then
    				local h = hit ()
				h.power = 0.1
				h.direction = vector():set (0, 10, 0)
				h.impulse = 1
				h.draftsman = db.actor
				h.type = hit.strike
				npc:hit(h)
			end
		end
	end
end



function greh_multicutscene_one(actor)
	if bind_car.act_in_car_now() == true then
		db.actor:detach_vehicle()
	end
	level.add_pp_effector("controller_psy.ppe", 2054131, false)
	olr.disable_walk()
	olr_timers.st_timer("greh_multicutscene_one_strnt", 5, "nick.greh_multicutscene_one_strnt()")
	olr.kill_mon_in_radius(db.actor:position(), 25)
	level.add_pp_effector("blink.ppe", 20131, false)
	xr_effects.disable_ui(db.actor, nil)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\head_kikc]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local se_obj = alife():object("lvl9_military_physic_object_0201")
	if se_obj then
	alife():release(se_obj, true)
	end
	local se_obj = alife():object("lvl9_military_physic_object_0405")
	if se_obj then
	alife():release(se_obj, true)
	end
	local se_obj = alife():object("lvl9_military_physic_object_0201")
	if se_obj then
	alife():release(se_obj, true)
	end	
end


function greh_multicutscene_one_strnt(actor)



level.add_pp_effector("blink.ppe", 20131, false)

local point = patrol("prisongreh_walk")
local look = patrol("prisongreh_look")
db.actor:set_actor_position(point:point(0))
local dir = look:point(0):sub(point:point(0))
db.actor:set_actor_direction(-dir:getH()) 

level.add_cam_effector2("camera_effects\\greh_cut_0.anm", 30, false, "nick.greh_multicutscene_two")

olr.del_noparent_weapons()
--del_noparen_wpn("lvl9_military")
--del_dead_stalkers(lvl9_military)  -- не стоит

get_console():execute("cam_inert 0.2")
db.actor:disable_info_portion("bolezn_parazity_info")
if olr_timers.has_timer("bolezn_parasite_timer") then
olr_timers.del_timer("bolezn_parasite_timer")
end
if olr_timers.has_timer("bolezn_parasite_timer_m") then
olr_timers.del_timer("bolezn_parasite_timer_m")
end
if olr_timers.has_timer("bolezn_parasite_timer_d") then
olr_timers.del_timer("bolezn_parasite_timer_d")
end
db.actor:give_info_portion("bolezn_beshenstvo_info_first_dis")
db.actor:give_info_portion("bolezn_beshenstvo_info_lech")

	local se_obj = alife():object("lvl9_military_stalker_0007")
	if se_obj then
	alife():release(se_obj, true)
	end

	db.actor:disable_info_portion("bolezn_sibyazva_info")
	db.actor:disable_info_portion("bolezn_sibyazva_info_m")
	if olr_timers.has_timer("bolezn_sibyazva_timer") then
		olr_timers.del_timer("bolezn_sibyazva_timer")
	end
	if olr_timers.has_timer("bolezn_sibyazva_timer_m") then
		olr_timers.del_timer("bolezn_sibyazva_timer_m")
	end
	if olr_timers.has_timer("bolezn_sibyazva_timer_d") then
		olr_timers.del_timer("bolezn_sibyazva_timer_d")
	end
	db.actor:disable_info_portion("bolezn_ratcrazy_info")
	db.actor:disable_info_portion("bolezn_ratcrazy_info_m")
	if olr_timers.has_timer("bolezn_ratcrazy_timer") then
		olr_timers.del_timer("bolezn_ratcrazy_timer")
	end
	if olr_timers.has_timer("bolezn_ratcrazy_timer_m") then
		olr_timers.del_timer("bolezn_ratcrazy_timer_m")
	end
	if olr_timers.has_timer("bolezn_ratcrazy_timer_d") then
		olr_timers.del_timer("bolezn_ratcrazy_timer_d")
	end
end

function greh_multicutscene_two(actor)
local pos = vector():set(-25,-5,-16)
olr.kill_mon_in_radius(pos, 150)
olr.kill_mon_in_radius(db.actor:position(), 125)
level.add_cam_effector2("camera_effects\\greh_cut_1.anm", 30, false, "nick.greh_multicutscene_tri")
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n You are the chosen one.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
cactor:give_game_news("\\n You are twice born...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(4000, 6000),7000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("lvl4_darkdolina_stalker_0096")

	olr.del_by_name("lvl9_military_stalker_0015")
	olr.del_by_name("lvl9_military_stalker_0016")
	olr.del_by_name("lvl9_military_stalker_0017")
end

function greh_multicutscene_tri(actor)
local se_obj = alife():object("lvl9_military_stalker_0047")
if se_obj then
alife():release(se_obj, true)
end
level.add_pp_effector("black.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\greh_cut_2.anm", 30, false, "nick.greh_enable_newui")
end


function greh_enable_newui(actor)
	olr.del_by_name("lvl5_bar_zone_gravi_zone_weak_noart_0004")
	olr.del_by_name("lvl5_bar_physic_object_1342")
	olr.del_by_name("lvl5_bar_zone_radioactive_killing_0023")
	olr.del_by_name("lvl5_bar_zone_radioactive_killing_0015")
	olr.del_by_name("lvl5_bar_zone_radioactive_killing_0020")
	olr.del_by_name("lvl5_bar_zone_radioactive_killing_0026")
	olr.del_by_name("lvl5_bar_zone_acid_fog")
	olr.del_by_name("lvl5_bar_zone_mosquito_bald_strong")
olr.enable_walk()
level.add_pp_effector("black.ppe", 20131, false)
local snd_obj = xr_sound.get_safe_sound_object([[ol3\head_kikc]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
local se_obj = alife():object("lvl9_military_stalker_0046")
if se_obj then
--alife():release(se_obj, true)
end
xr_effects.enable_ui(db.actor, nil)
level.add_cam_effector("camera_effects\\fusker.anm", 999, false, "")
level.add_pp_effector("blink.ppe", 20131, false)
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer:\\n What have they done to me...? Well Rat... I'll remember that for you...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0) 
db.actor:give_info_portion("start_greh_prisoning")
olr_timers.st_timer("drop_gg_item_greh", 2, "nick.drop_gg_item_greh()")




  local sobj = alife():object("lvl5_bar_smart_terrain_united_dolg_stalkers_0001")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end


  local sobj = alife():object("lvl5_bar_stalker_0001")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end

  local sobj = alife():object("lvl5_bar_stalker_0000")
  if sobj and IsStalker(sobj) and sobj:alive() then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  table.insert(olr_offline_walk.tabst, sobj)
  end


end



function drop_gg_item_greh()
	local obox = alife():object("lvl9_military_big_safe_box_0000")
	local box = level.object_by_id(obox.id)
	if box then
		db.actor:iterate_inventory( function(_, item)
			if item then
				if item:is_weapon() or item:is_weapon_magazined() or item:is_weapon_gl() or item:is_grenade() or item:is_artefact() then 
					db.actor:transfer_item(item, box)
					--log1("trrr has box")
				end
			end
		end )
	end 
end


function del_dead_stalkers(lev_name)
local montabl = 
{
       [clsid.script_stalker] = true
}

local sim = alife()
	for i=1, 65534 do
		local kill = sim:object(i)
		if kill then
                if montabl[kill:clsid()]  then
		if not kill:alive() then
		local gvid = kill.m_game_vertex_id
	        if game_graph():valid_vertex_id(gvid) then
		if alife():level_name(game_graph():vertex(gvid):level_id()) == lev_name then
   		alife():release(kill, true)
end
end       
end
end
end
end
end



function del_noparen_wpn(lev_name)
local montabl = 
{
	[clsid.wpn_vintorez_s] = true,
	[clsid.wpn_ak74_s] = true,
	[clsid.wpn_ak74] = true,
	[clsid.wpn_binocular] = true,
	[clsid.wpn_binocular_s] = true,
	[clsid.wpn_lr300_s] = true,
	[clsid.wpn_hpsa_s] = true,
	[clsid.wpn_pm_s] = true,
	[clsid.wpn_shotgun_s] = true,
	[clsid.wpn_bm16_s] = true,
	[clsid.wpn_bm16] = true,
	[clsid.wpn_svd_s] = true,
	[clsid.wpn_rpg7_s] = true,
	[clsid.wpn_groza_s] = true,
	[clsid.wpn_knife_s] = true,
	[clsid.wpn_grenade_launcher] = true,
	[clsid.wpn_grenade_f1] = true,
	[clsid.wpn_grenade_rpg7] = true,
	[clsid.wpn_grenade_rgd5] = true,
	[clsid.wpn_grenade_fake] = true,
	[clsid.wpn_fort] = true,
	[clsid.wpn_fn2000] = true,
	[clsid.wpn_groza] = true,
    [clsid.wpn_hpsa] = true,
    [clsid.wpn_knife] = true,
    [clsid.wpn_lr300] = true,
    [clsid.wpn_mounted] = true,
    [clsid.wpn_pm] = true,
    [clsid.obj_bolt] = true,
    [clsid.wpn_rg6] = true,
    [clsid.wpn_rg6_s] = true,
    [clsid.wpn_rpg7] = true,
    [clsid.wpn_shotgun] = true,
    [clsid.wpn_stat_mgun] = true,
    [clsid.wpn_svd] = true,
    [clsid.wpn_svd_s] = true,
    [clsid.wpn_svu] = true,
    [clsid.wpn_svu_s] = true,
    [clsid.wpn_usp45] = true,
    [clsid.wpn_usp45_s] = true,
    [clsid.wpn_val] = true,
    [clsid.wpn_val_s] = true,
    [clsid.wpn_vintorez] = true,
    [clsid.wpn_walther] = true,
    [clsid.wpn_walther_s] = true,
    [clsid.wpn_wmagaz] = true,
    [clsid.wpn_wmaggl] = true
}

local sim = alife()
	for i=1, 65534 do
		local kill = sim:object(i)
		if kill then
                if montabl[kill:clsid()]  then
		if kill.parent_id == 65535  then
		local gvid = kill.m_game_vertex_id
	        if game_graph():valid_vertex_id(gvid) then
		if alife():level_name(game_graph():vertex(gvid):level_id()) == lev_name then
   		alife():release(kill, true)
end
end       
end
end
end
end
end








function start_sarcofag_cutscene_findmyself(actor)
level.add_pp_effector("blink.ppe", 20131, false)
xr_effects.disable_ui(db.actor, nil)
level.add_cam_effector2("camera_effects\\sarc_mon_0.anm", 30, false, "nick.start_sarcofag_cutscene_two")
db.actor:give_info_portion("spawn_start_sarko_cut_find_myself")
end

function start_sarcofag_cutscene_two(actor)
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
		local rnd = math.random(1,2) == 1
                if isArtefact(kill) and rnd then
			alife():release(kill, true)
			cnt = cnt + 1            
		end
		end
	end
	--log1(cnt)
	olr.blow_add(500)
	nick.clear_all_bolezns()
db.actor.satiety = 1
olr.spawn_on_obj("controller_new", "lvl1_escape_space_restrictor_0030")
olr_timers.st_timer("fucnking_messer", 435, "nick.fucnking_messer()")
level.add_pp_effector("blink.ppe", 20131, false)
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Wish:\\n I want to remember everything!...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
level.add_cam_effector2("camera_effects\\sarc_mon_1.anm", 30, false, "nick.sarcof_multicutscene_tri")
	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if isArtefact(kill) and math.random(1,2) == 1 then
			alife():release(kill, true)
			cnt = cnt + 1            
		end
		end
	end
	--log1(cnt)
	nick.flying_corpses()
	olr.info("monolit_olr_jur_have")
	olr_timers.st_timer("otdaem_goplit_pda", 4, "nick.tele()") 
end

function sarcof_multicutscene_tri(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_2.anm", 30, false, "nick.sarcof_multicutscene_for")
in_head_shelk()
end

function sarcof_multicutscene_for(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_3.anm", 30, false, "nick.sarcof_multicutscene_fiv")
in_head_shelk()
end

function sarcof_multicutscene_fiv(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_4.anm", 30, false, "nick.sarcof_multicutscene_six")
in_head_shelk()
end

function sarcof_multicutscene_six(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_5.anm", 30, false, "nick.sarcof_multicutscene_sev")
in_head_shelk()
end

function sarcof_multicutscene_sev(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_6.anm", 30, false, "nick.sarcof_multicutscene_eig")
in_head_shelk()
end

function sarcof_multicutscene_eig(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_8.anm", 30, false, "nick.sarcof_multicutscene_nin")
in_head_shelk()
end

function sarcof_multicutscene_nin(actor)
level.add_pp_effector("blink.ppe", 20131, false)
level.add_cam_effector2("camera_effects\\sarc_mon_9.anm", 30, false, "nick.sarcof_multicutscene_done")
end

function sarcof_multicutscene_done(actor)
level.add_pp_effector("blink.ppe", 20131, false) 
xr_effects.enable_ui(db.actor, nil)
local point = patrol("aes2_teleport_walk_exit1")
local look = patrol("aes2_teleport_look_exit1")
db.actor:set_actor_position(point:point(0))
local dir = look:point(0):sub(point:point(0))
db.actor:set_actor_direction(-dir:getH())
end


function in_head_shelk()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\marsh_click_1]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function del_goplit_pda_dolina_info()
  local se_obj = alife():object("lvl4_darkdolina_staler_undead_olr_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function precond_goplit_pda()
     return nik_dialog.item_much("goplit_pda_dolina",1) ~= false 
end


function otdaem_goplit_pda(t1,t2)
	nik_dialog.out_item_much("goplit_pda_dolina",1)
	olr_timers.st_timer("otdaem_goplit_pda", 2224, "nick.give_info_gopl_pda_new()") 
end

function give_info_gopl_pda_new()
	news_manager.send_tip(db.actor, "There's progress on Goplit's PDA... you're good to go. Just don't forget to bring me a «Dead Head» artifact for the work.", nil, "default", 9000)
	olr.info("give_info_gopl_pda_new")
end

function has_dead_head_one()
     return nik_dialog.item_much("af_dummy_glassbeads",1) ~= false 
end


function has_timer_pda_goplit()
	return has_alife_info("give_info_gopl_pda_new")
end


function otdaem_has_timer_pda_goplit(first_speaker, second_speaker)
nik_dialog.out_item_much("af_dummy_glassbeads",1)
dialogs.relocate_item_section(second_speaker, "goplit_pda_dolina_hacked","in")
olr_treasure.create_treasure()
olr_treasure.create_treasure()
olr_treasure.create_treasure()
olr_treasure.create_treasure()
end




function yan_acid_terrain_hitted_fuck()
olr.hud_tip("Messer:", "Damn, looks like the ground here in the lowlands is full of acid... I need protection to walk here. Maybe the scientists can tell me something...", 27)
end



function daem_val_vintovku_vsk(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "wpn_vsk94","in")
end


function prec_boltun_vsk_level_talkerd_name_second()
	local lname = level.name() 
	if lname ~= xvars.boltun_vsk_level_talkerd_name then
		return true
end
end


function akim_give_money_kompensacia2(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,500,"out")
xvars.boltun_vsk_level_talkerd_name = level.name() 
end





function start_talk_dolg_garbage_sms()
local sobj = alife():object("lvl2_garbage_staler_undead_olr_0002") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Boar") 
end
news_manager.send_tip(db.actor, "Toad: Messer, there's information about Strelok... There's a roadblock in the north of the Garbage, I think we saw him there. Try to talk to members of the group, maybe someone knows something. I think a Dutyer named Boar knows something. Try to talk to him. Just don't slow down, he won't wait long. After you talk, I'll wait for the Eye...", nil, "trader", 49000)
end


function del_uchenyys_greh()
  local se_obj = alife():object("lvl9_military_stalker_0030")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl9_military_stalker_0029")
  if se_obj then
    alife():release(se_obj, true)
  end
	local se_obj = alife():object("lvl9_military_stalker_0028")
  if se_obj then
    alife():release(se_obj, true)
  end
	local se_obj = alife():object("lvl9_military_physic_object_0167")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function del_radovoy_uderz_restrictors()
  local se_obj = alife():object("lvl4u_darklab_space_restrictor_0034")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl4u_darklab_space_restrictor_0009")
  if se_obj then
    alife():release(se_obj, true)
  end
	local se_obj = alife():object("lvl4u_darklab_space_restrictor_0007")
  if se_obj then
    alife():release(se_obj, true)
  end
	local se_obj = alife():object("lvl4u_darklab_space_restrictor_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function start_yaroslav_timer()
	local yaz_var = math.random(250,360)
	olr_timers.st_timer("yaroslav_spawn_timer", yaz_var, "nick.spawn_yaroslav_garbage()")
end


function spawn_yaroslav_garbage()
news_manager.send_tip(db.actor, "Toad: Messer, I've done some more research on your Strelok... Anyway, there's a stalker named Yaroslav. He is rumored to have gone with Strelok to Pripyat, I think you should talk to him about it. He is now at the Duty checkpoint at the dump, although he may leave. I've texted you his location in general...", nil, "trader", 49000)
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then     
		if kill:name() == "gar_dolg_blokpost" then        
                local obj = alife():create("yaroslav", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		if obj then
			olr_timers.st_timer("jar_toprip_durak", 500, "nick.jar_toprip_durak("..tostring(obj.id)..")")
			olr.add_spot_on_map( obj.id,"green_location", "A stalker who knows something about Strelok..." )
			table.insert(olr_offline_walk.tabst, obj)
		end
end
end
end
end


function jar_toprip_durak(id)
	local sobj = alife():object(id)
  	if sobj then
		level.map_remove_object_spot(sobj.id, "green_location")
	end
end



function greh_lider_dead_sms_restrdel()
  local se_obj = alife():object("lvl9_military_space_restrictor_0014")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("mil_prefix_lights_hanging_lamp_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
end






-- удляем отработанные рестрикторы с кордона после того как первый раз поговорили с барменом (квест на доки в первой лабе)
function del_escape_trash_restrictors()
  local se_obj = alife():object("lvl1_escape_space_restrictor_0009")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0064")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0058")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0098")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0097")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0065")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0089")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0092")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0095")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0087")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0062")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0066")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0083")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0086")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("goon")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0074")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0077")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_blow_hide_restr_0011")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0084")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0091")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0085")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0011")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("zone_kvest_1")
  if se_obj then
    alife():release(se_obj, true)
  end
  	olr.del_by_name("lvl1_escape_pseudodog_strong_0000")
end


 


function clear_drinked_vodka()
if db.actor then
xvars.drinked_vodkas = 0
end
end



function delete_start_ammo_free()
local wpntabl = 
{
       [clsid.wpn_ammo] = true,
       [clsid.wpn_ammo_m209] = true,
       [clsid.wpn_ammo_og7b] = true,
       [clsid.wpn_ammo_vog25] = true
}
        local count = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
		if wpntabl[obj:clsid()]  then
		if not obj.parent then
                          local bol_var = math.random(1,2) 
                          if bol_var == 1 then  
                           --news_manager.send_tip(db.actor, "старт игры удалено "..count.."----"..obj:name().." аммо", nil, "freedom", 9000)
			   sim:release(obj)
                          count = count + 1
end					
end
end
end
end
end



function delete_bar_hmiri_imeshkow()
  local se_obj = alife():object("bar_bar_guard_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("bar_bar_guard_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function bar_krisa_gavgav3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Major\\n Hello, Rat. Going behind my back to do your business?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 1500),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function bar_krisa_gavgav4()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Rat\\n Hello, Major. I was acting solely on your instructions.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(5000, 7000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
level.add_pp_effector("black.ppe", 20131, false)
olr.info("lonewolf_bar_talk_to_spawen_maiora_new")
end




function bar_krisa_gavgav()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Rat\\nLeave us two alone.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 1500),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function bar_krisa_gavgav2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Rat\\n Do I have to repeat myself?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(4000, 6000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function actor_have_patka_deneg(actor,npc)
    return actor:money() >= 5000
end


function actor_barman_patka_habar(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,5000,"out")
end





function daem_val_vintovku(first_speaker, second_speaker)
	olr.del_by_name("bar_bar_guard_0004_maijor")
  dialogs.relocate_item_section(second_speaker, "wpn_val","in")
	olr.del_by_name("lvl5_bar_space_restrictor_0129")
end




function krisa_all_have_one_prec(actor,npc)
    return has_alife_info("pizduems_v_kamorku") and has_alife_info("lonewolf_bar_spawn_have_krisatalk")
end



--' переводим в ОФФЛАЙН КРЫСУ
function set_barman_offline()
  --level.add_pp_effector("black.ppe", 20131, false)
  --news_manager.send_tip(db.actor, "Это, что ли, ваш хваленый дважды рождённый?", nil, "barman", 19000)
  local se_obj = alife():story_object(500)
  if se_obj then
    alife():set_switch_offline (se_obj.id, true)
    alife():set_switch_online (se_obj.id, false)
    alife():set_interactive (se_obj.id, false)
  end
  local se_obj = alife():object("lvl5_bar_space_restrictor_barman_nozone_pre_have_one")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function set_barman_online()

  level.add_pp_effector("black.ppe", 20131, false)
  db.actor:give_info_portion("barmen_gtfo_vkamorku")


  local se_obj = alife():object("bar_bar_guard_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("bar_bar_guard_0000")
  if se_obj then
    alife():release(se_obj, true)
  end

end



--' переводим в ОНЛАЙН КРЫСУ
function set_barman_online_delhlam()
  level.add_pp_effector("black.ppe", 20131, false)
  local se_obj = alife():story_object(500)
  if se_obj then
    alife():set_switch_offline (se_obj.id, false)
    alife():set_switch_online (se_obj.id, true)
    alife():set_interactive (se_obj.id, true)
  end
  local se_obj = alife():object("lvl5_bar_staler_undead_olr_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_space_restrictor_0121")
  if se_obj then
    alife():release(se_obj, true)
  end
end





function volk_sasesc_del_alkashi()
  local se_obj = alife():object("lvl5_bar_physic_object_1348")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_physic_object_1350")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function volk_sasesc_bar4()
	if bind_car.act_in_car_now() == true then
		db.actor:detach_vehicle()
	end
	level.add_pp_effector("black.ppe", 20131, false)
	local point = patrol("lonewolf_bar_sit_look")
	local look = patrol("lonewolf_bar_sit_walk")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())

for k,v in pairs(db.storage) do
if k then
local obj = level.object_by_id(k)
if obj then
if obj:name() == "lvl5_bar_staler_undead_olr_0003_lonewolf" then

	local wait_time = 0
  	wait_time = time_global() + 500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() db.actor:run_talk_dialog(obj) end
  	)
		
end
end
end
end

local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n Now we can talk...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(6000, 8000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function medyasik_have_sms()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad:\\n Messer, I heard the military sent a team toward MedPribor. Most likely for those documents you're supposed to get me. Anyway, if you run into them, try calling for help on the PDA. It'll distract some of the hostiles. That's it. Don't forget the box.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function hmm_final_journal_where_start2()
  news_manager.send_tip(db.actor, "Stalker, this is Freedom Group. I know you've helped us in the past, and we have one more favor to ask of you. You're at the power plant, aren't you? The thing is, a year ago, one of our groups went missing in the northern part of the power plant. We took some reports from them then, but now it's clear they're dead. Can you go down there to the power plant and try to find them? We'd appreciate it. They must have a red folder on them, it's very valuable to us! If possible, try to get it. They were traveling in an APC, if anything.", nil, "freedom", 19000)
  local se_obj = alife():object("lvl13_prip_space_restrictor_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl13_prip_space_restrictor_0005")
  if se_obj then
    alife():release(se_obj, true)
  end
  olr.info("find_stancia_last_doc")
end


function hmm_final_journal_where_start()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Hmm.\\n I think the documents should be here.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function clear_metki_tihonov()
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then     
			if kill.id == xvars.tihonov_zakazy_weapons_one_id or kill.id == xvars.tihonov_zakazy_weapons_two_id or kill.id == xvars.tihonov_zakazy_weapons_tri_id then        
                		--olr.del(kill)
				alife():release(kill, true) 
			end
		end
	end
end


function this_id_tih_tri(fs,ss)
if fs:id() == xvars.tihonov_zakazy_weapons_tri_id then
return true
end
end


function this_id_tih_not3(fs,ss)
if fs:id() ~= xvars.tihonov_zakazy_weapons_tri_id then
return true
end
end



function this_id_tih_two(fs,ss)
if fs:id() == xvars.tihonov_zakazy_weapons_two_id then
return true
end
end


function this_id_tih_not2(fs,ss)
if fs:id() ~= xvars.tihonov_zakazy_weapons_two_id then
return true
end
end


function this_id_tih_not(fs,ss)
if fs:id() ~= xvars.tihonov_zakazy_weapons_one_id then
return true
end
end


function this_id_tih_one(fs,ss)
if fs:id() == xvars.tihonov_zakazy_weapons_one_id then
return true
end
end



function tihonov_zakazy_weapons_one()
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then     
		if kill:name() == "lvl4_darkdolina_zone_radioactive_weak_0002" then        
                local obj = alife():create("swamp_quest_scienific", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		olr.add_spot_on_map( obj.id,"green_location", "Scientist with information number one." )
		xvars.tihonov_zakazy_weapons_one_id = obj.id
		table.insert(olr_offline_walk.tabst, obj)
		xvars.npc_ofl_trade_yan[obj:name()] = true
end
end
end
end




function tihonov_zakazy_weapons_two()
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then     
		if kill:name() == "lvl6_rostok_space_restrictor_0004" then        
                local obj = alife():create("swamp_quest_scienific", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		olr.add_spot_on_map( obj.id,"green_location", "Scientist with information number two." )
		xvars.tihonov_zakazy_weapons_two_id = obj.id
		table.insert(olr_offline_walk.tabst, obj)
		xvars.npc_ofl_trade_yan[obj:name()] = true
end
end
end
end


function tihonov_zakazy_weapons_tri()
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then     
		if kill:name() == "lvl7_yantar_physic_object_0092" then        
                local obj = alife():create("swamp_quest_scienific", kill.position, kill.m_level_vertex_id, kill.m_game_vertex_id)
		olr.add_spot_on_map( obj.id,"green_location", "Scientist with information number three." )
		xvars.tihonov_zakazy_weapons_tri_id = obj.id
		table.insert(olr_offline_walk.tabst, obj)
		xvars.npc_ofl_trade_yan[obj:name()] = true
end
end
end
end




function esc_voyaka_monolith_del()
  local se_obj = alife():object("lvl1_escape_space_restrictor_0105")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_stalker_0039")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_stalker_0040")
  if se_obj then
    alife():release(se_obj, true)
  end
end





function on_lab_swithc_dok_1_part()
particles_object([[alexmx\test_face_align_timed]]):play_at_pos(vector():set(183,5,-473))
end

function on_lab_swithc_dok_2_part()
particles_object([[alexmx\test_face_align_timed]]):play_at_pos(vector():set(208,4.5,-472))
end

function on_lab_swithc_dok_3_part()
particles_object([[alexmx\test_face_align_timed]]):play_at_pos(vector():set(135,4.5,-468))
end

function on_lab_swithc_dok_4_part()
particles_object([[alexmx\test_face_align_timed]]):play_at_pos(vector():set(121,4.5,-480))
end


function precond_ametist_golmar_combez()
     return nik_dialog.item_much("killer_outfit",1) ~= false and nik_dialog.item_much("wpn_p90",1) ~= false and nik_dialog.item_much("vodka",5) ~= false and (nik_dialog.item_much("ecolog_outfit",1) ~= false or nik_dialog.item_much("protection_outfit",1) ~= false)
end

function precond_dead_pda()
     return nik_dialog.item_much("item_pda_dead_taken",2) ~= false and db.actor:money() >= 200 
end


function give_info_treasure_all(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,500,"out")
nik_dialog.out_item_much("item_pda_dead_taken",2)
olr_treasure.create_treasure()
end


function otdaem_ametist_golmar_combez(first_speaker, second_speaker)
nik_dialog.out_item_much("killer_outfit",1)
if nik_dialog.item_much("ecolog_outfit",1) ~= false then
	nik_dialog.out_item_much("ecolog_outfit",1)
end
if nik_dialog.item_much("protection_outfit",1) ~= false then
	nik_dialog.out_item_much("protection_outfit",1)
end
nik_dialog.out_item_much("wpn_p90",1)
nik_dialog.out_item_much("vodka",5)
dialogs.relocate_item_section(second_speaker, "outfit_stalker_golmar","in")
end


function daem_golmar_outfit(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "outfit_stalker_golmar","in")
end




function bun_head_aai()
	local bsobj = alife():object("lvl12_radar_bunker_staler_undead_olr_0000") 
	if bsobj then 
		alife():create("wpn_pistol_future", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id)
		alife():create_ammo("ammo_psy", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 3)
	end
	local wait_time = 0
  	wait_time = time_global() + 500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.info("svyatoy_angry_aim") end
  	)
        local snd_obj = xr_sound.get_safe_sound_object([[ol3\dolina_psy_noise]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_pp_effector("duality_circle.ppe", 203123131, false)
end




function rad_bun_tv_casuality_room()

	local wait_time = 0
  	wait_time = time_global() + 1500
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() olr.del_by_name("lvl12_radar_bunker_staler_undead_olr_0000") end
  	)

        local snd_obj = xr_sound.get_safe_sound_object([[ol3\siren_gen]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)

    local te = texture_find("fx\\fx_stalker")
    if te then
    te:set_name("fx\\bloody_eye")
    te:reload() 
end
end


function rad_bun_tv_casuality_roomoff()

        local snd_obj = xr_sound.get_safe_sound_object([[ol3\siren_gen]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)

    local te = texture_find("fx\\fx_stalker")
    if te then
    te:set_name("fx\\fx_stalker")
    te:reload() 
end
end



function bun_swatoy_rush_bun_swatoy_rush_del()
  olr.kill_mon_in_radius(db.actor:position(), 150)
  level.add_pp_effector("black.ppe", 203123131, false)
  local se_obj = alife():object("lvl12_radar_bunker_staler_undead_olr")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function bun_swatoy_rush_enable()
            level.show_indicators()
            level.enable_input()
	    bind_stalker.restore_weapon()
	    device():set_fov(xvars.cur_fov)
	    olr.enable_walk()
	    olr.kill_mon_in_radius(db.actor:position(), 150)
end



function bun_swatoy_rush_enable2()
	    xvars.cur_fov = device():get_fov()
	    device():set_fov(40)
  	    olr_timers.st_timer("omsfssssf3", 3, "nick.bun_swatoy_rush_enable()")
end



function bun_swatoy_rush_sms()
	olr.kill_mon_in_radius(db.actor:position(), 150)
    	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Message Messer:\\n Hey, you! Stop!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)

 	get_console():execute("cam_inert 0.9")
	olr_timers.st_timer("remove_cam_inert_timer", 1, "nick.remove_cam_inert_timer()")
            level.disable_input()
            level.hide_indicators()
	    bind_stalker.hide_weapon()
	    olr.disable_walk()
olr_timers.st_timer("omsfssssf33", 0.5, "nick.bun_swatoy_rush_enable2()") 

for i=1,65535 do
local lokobj = level.object_by_id(i)
if lokobj then
if lokobj:name() == "lvl12_radar_bunker_staler_undead_olr" then

local pos = lokobj:bone_position("bip01_head")
local vDir = pos:sub(db.actor:position())
db.actor:set_actor_direction(-vDir:getH())


  local dir_d = vector()
  dir_d:set(-2,1,-1)
  local h = -dir_d:getH()
  local p = -dir_d:getP()

    local cam = actor_camera(0)
    if cam == nil then
       return 0, 0
    end
    
    if h then
       cam.yaw = h 
    end
    if p then
       cam.pitch = p
    end  

end
end
end

end



function actor_have_somefood()
     if nik_dialog.item_much("bread",1) ~= false or nik_dialog.item_much("kolbasa",1) ~= false or nik_dialog.item_much("conserva",1) ~= false then
	return true
     end
end


function otdaem_somefood_fix(first_speaker, second_speaker)
local kolbas = db.actor:object("bread")
if kolbas then
nik_dialog.out_item_much("bread",1)
end
local brad = db.actor:object("kolbasa")
if brad then
nik_dialog.out_item_much("kolbasa",1)
end
local conserv = db.actor:object("conserva")
if conserv then
nik_dialog.out_item_much("conserva",1)
end
end






function daem_slab_gravi(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "af_vyvert","in")
 olr.snd([[characters_voice\scenario\newbie_on_garbage\newbie_on_garbage_1]])
end


function mg_mg_darkstalker_spawn4_check_allcool()

  local se_obj = alife():object("lvl11_deadcity_staler_undead_olr_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl11_deadcity_staler_undead_olr_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl11_deadcity_staler_undead_olr_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
	if has_alife_info("leader_temniy_start_tri_done") then
	local sobj = alife():object("lvl11_deadcity_staler_undead_olr_0003") 
	if sobj then 
	olr.add_spot_on_map(sobj.id,"crlc_big","Unknown SOS signal") 
	end

	local snd_obj = xr_sound.get_safe_sound_object([[device\pda\pda_sos]])
	if not snd_obj:playing() then 
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("SOS message:\\n Somebody help... I'm home, on the outskirts.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
		db.actor:give_info_portion("mg_final_ds_spawn")
	end
	
end



function mg_city_del_darkstalker3_del()
  level.add_pp_effector("black.ppe", 203131, false)
  local se_obj = alife():object("lvl11_deadcity_staler_undead_olr_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function mg_zombie_dnevnik_dead_info_spawn_del()
  local snd_obj = xr_sound.get_safe_sound_object([[monsters\biting\def_0]])
  snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
  local se_obj = alife():object("lvl11_deadcity_stalker_0049")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl11_deadcity_physic_object_0756")
  if se_obj then
    alife():release(se_obj, true)
  end
end





function mg_deaddoor_open_zombie_del_light()
  local se_obj = alife():object("lvl11_deadcity_lights_hanging_lamp_0011")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl11_deadcity_physic_object_0750")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function daem_pat_konservas(first_speaker, second_speaker)  
 	olr.give_item("conserva")
 	olr.give_item("conserva")
 	olr.give_item("conserva")
 	olr.give_item("conserva")
 	olr.give_item("conserva")
	olr_timers.st_timer("ludoed_off", 861, "nick.ludoed_away_feedback()")
end

function ludoed_away_feedback()
	db.actor:change_character_reputation(-60)
	news_manager.send_tip(db.actor, "Did you hear about the Goliath that was in the bar? He was rumored to be a man-eater. I remember him selling canned goods all the time. And Messer was seen with him once... as if he wasn't his accomplice...", nil, "unknown", 49000)
end

function del_mg_ludoed_door()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0747")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function prec_sokol_level_second()
	local lname = level.name() 
	if lname ~= "lvl_rat" then
		return true
	end
end


function daem_sokol_gun(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_gsh18","in")
end


function del_mars_horok()
  local se_obj = alife():object("mars_horek_name_stalker")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function del_mars_digger()
  local se_obj = alife():object("mars_digger_stalker")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function del_mars_shustriy()
  local se_obj = alife():object("mars_shustriy_stalker")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function zazda_precond()
	local zazda = db.actor:get_actor_thirst()
	if zazda <0.3 then
		return true
	end
end



function iskatel_level_talkerd()
        xvars.iskatel_level_talkerd_name = level.name()
	if math.random(1,2) == 1 then
		olr_timers.st_timer("remember_ten", 1010, "nick.chislo_ten()")
	end 
end


function chislo_ten()
	if math.random(1,10) == 1 then
		news_manager.send_tip(db.actor, "Remember the number, 10.", nil, "unknown", 19000)
	end
end


function prec_iskatel_level_second()
	local lname = level.name() 
	if lname ~= xvars.iskatel_level_talkerd_name then
		return true
end
end


function del_swamp_door_psy()
  local se_obj = alife():object("lvl8_swamp_physic_object_0299")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl8_swamp_physic_object_0307")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function radar_del_otrad()
  olr.del_by_name("lvl12_rest_earthquake")
  local se_obj = alife():object("psy_izl_0003_script")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl10_radar_stalker_0031")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl10_radar_stalker_0039")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl10_radar_stalker_0038")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl10_radar_stalker_0033")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl10_radar_stalker_0036")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl10_radar_stalker_0034")
  if se_obj then
    alife():release(se_obj, true)
  end
  olr.del_by_name("lvl10_radar_space_restrictor_0000")
  olr.del_by_name("lvl10_radar_space_restrictor_0001")
  olr.del_by_name("lvl10_radar_space_restrictor_0002")
	if math.random(1,4) == 1 then
		olr_timers.st_timer("bob_ten", 1010, "nick.bob_ten()")
	end 
end


function bob_ten()
	news_manager.send_tip(db.actor, "I'll be waiting for you in the black tepee.", nil, "unknown", 19000)
end




function radar_na_tochke_govlab_sms()
    	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("\\n You're on your own from here. We're not going in there with you. Our orders are to hold this area...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
end





function radar_del_sniper_in_vhod()
  local se_obj = alife():object("lvl10_radar_space_restrictor_0006")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function start_timer_destroy_dyatel_pre()
	olr_timers.st_timer("timer_destroy_dyatel_pre", 12141, "nick.timer_destroy_dyatel_pre_done()") 
	olr_timers.st_timer("timer_jaba_mil_quest", 31, "nick.timer_jaba_mil_quest()") 
	olr_timers.st_timer("timer_jaba_mil_quest", 41, "nick.timer_jaba_mil_quest2()") 
	olr_timers.st_timer("timer_jaba_mil_quest", 51, "nick.timer_jaba_mil_quest3()") 
	olr_timers.st_timer("timer_jaba_mil_quest", 61, "nick.timer_jaba_mil_quest4()")
	olr.blow_add(1000) 
end

function timer_destroy_dyatel_pre_done()
	news_manager.send_tip(db.actor, "Messer, go to the bar. About our case.", nil, "barman", 79000)
	olr.info("destroy_dyatel_pre_done_inf")
end


function timer_jaba_mil_quest()
	news_manager.send_tip(db.actor, "Messer. You still alive, asshole? I got a favor to ask of you. You're going up north, aren't you? I can sponsor your trip in exchange for a favor.", nil, "trader", 29000)	
end

function timer_jaba_mil_quest2()
	news_manager.send_tip(db.actor, "There are assassins where I am right now. They're assassins, but that's not the point. scum who do all the dirty work for money. At the former Sin base. We saw one thing they had, an artifact. unique. worth a lot of dough, rumor has it they got it straight from the center.", nil, "trader", 29000)	
end

function timer_jaba_mil_quest3()
	news_manager.send_tip(db.actor, "Remember those artifact orders I gave you? It looks just like those artifacts, but it has a property, namely, as far as I could find out, it can cause a blowout if you do something with it... That's why it was ten times the price...", nil, "trader", 29000)	
end

function timer_jaba_mil_quest4()
	news_manager.send_tip(db.actor, "So. The mastermind behind these killers is a certain Dog. He's probably got the artifact. I don't advise you to go to the base, they have snipers on the towers, they'll take you down right away. Try to check the farm near the road to Bar, there is one of their groups there now, maybe they know something about the artifact...", nil, "trader", 29000)	
	olr.info("mil_jaba_quest_art_start")
	olr.blow_add(1000)
end


function precond_emulator_shapka()
     return nik_dialog.item_much("psy_shapka_mg",1) ~= false 
end


function otdaem_emulator_shapka(first_speaker, second_speaker)
	olr.del_by_name("lvl11_deadcity_space_restrictor_phantasm")
	olr.del_by_name("lvlmili_space_restrictor_phantasm")
	olr.del_by_name("lvlradar_space_restrictor_phantasm")
nik_dialog.out_item_much("psy_shapka_mg",1)
olr.give_item("wpn_striker")
db.actor:set_actor_sleep(-1)
olr.kill_mon_in_radius(db.actor:position(), 150)
olr.blow_add(200)
  local se_obj = alife():object("lvl8_swamp_phantasm")
  if se_obj then
    alife():release(se_obj, true)
  end
end






function daem_killboloto_prichendaly(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "psy_shapka_mg","in")
 dialogs.relocate_item_section(second_speaker, "pribor_primanka_mg","in")
end





function spawn_rat_knife()
 	local level_name = level.name()
		if level_name == "lvl_rat" then
			local bloodbridge = vector():set( 10, 2.69, -13.00 )
			local obj = alife():create("wpn_knife_bowie", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
			clear_useful_for_ai(obj)

end
end




function disable_input_esc()
--level.disable_input()
--level.hide_indicators()
olr_timers.st_timer("enable_input_timolr", 15, "nick.enable_input_timolr()")
end

function enable_input_timolr()
        level.enable_input()
	level.show_indicators()
end


function kvest_esc_5_dialog_vdome()
 	local level_name = level.name()
		if level_name == "lvl1_escape" then
			local bloodbridge = vector():set( 135.55, 0.75, 314.00 )
			alife():create("horok_rukzak_arts", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )

end
	if not has_alife_info("horek_zdoh_nahui") then
    	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Ferret:\\n You guy better stand still...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
	end
end



function del_norm_papdu_karlik()
olr_timers.st_timer("omss3gh23", 10, "nick.del_norm_papdu_karlik2()")
end


function del_norm_papdu_karlik2()
  local inv_window = level.main_input_receiver()
	if inv_window and inv_window:IsShown() then
	level.start_stop_menu(inv_window,true)
  end
  level.add_pp_effector("black.ppe", 203131, false)
  local se_obj = alife():object("lvl4u_darklab_karlik_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function precond_saf_papka_fil()
     return nik_dialog.item_much("fil_saf_papka",1) ~= false 
end


function otdaem_saf_papka_fil()
nik_dialog.out_item_much("fil_saf_papka",1)
--local has_boots = db.actor:object("fil_saf_papka")
--if has_boots ~= nil then
--alife():release(alife():object(has_boots:id()))
--end
news_manager.send_tip(db.actor, "Items received - box of bolts, 3pcs.", nil, "default", 39000)
alife():create('ammo_bolts', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
alife():create('ammo_bolts', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
alife():create('ammo_bolts', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
olr.del_by_name("lvl4_darkdolina_karlik_0024")
olr.del_by_name("lvl4_darkdolina_karlik_0020")
olr.del_by_name("lvl4_darkdolina_karlik_0021")
olr.del_by_name("lvl4_darkdolina_karlik_0023")
olr.del_by_name("lvl4u_darklab_space_restrictor_0014")
end



function karlik_kikandos_docs()
	db.actor.health = - 0.05
	local point = patrol("karlik_doldoks_idle_look")
	local look = patrol("karlik_doldoks_idle_walk")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())

        level.add_pp_effector("black.ppe", 20131, false)
    	 level.add_cam_effector("camera_effects\\hit_back.anm", 1, false)

        local snd_obj = xr_sound.get_safe_sound_object([[affects\hit_fist]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end







function kvest_esc_5_dialog_start_spaven_glazagar_kick()
	olr.beep()
    	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Crow's Eye:\\n Hey! Hey stalker!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
		local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_news]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end





function del_gar_nap_hvatalka()
  local se_obj = alife():object("lvl2_garbage_physic_object_0041")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function del_gar_nap_dead_doroga_nap()
  local se_obj = alife():object("lvl2_garbage_stalker_0043")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function otdaem_gazeta_otrivok_1(first_speaker, second_speaker)
nik_dialog.out_item_much("gazeta_otrivok_1",1)
dialogs.relocate_money(first_speaker, 50, "in")
end



function precond_gazeta_otrivok_1()
     return nik_dialog.item_much("gazeta_otrivok_1",1) ~= false 
end






function otdaem_bar_barman_kamaz_doki(first_speaker, second_speaker)
nik_dialog.out_item_much("bar_barman_kamaz_doki",1)
dialogs.relocate_money(first_speaker, 250, "in")
end



function precond_bar_barman_kamaz_doki()
     return nik_dialog.item_much("bar_barman_kamaz_doki",1) ~= false 
end




function del_most_restrickor_escape()
  local se_obj = alife():object("lvl1_escape_stalker_0057")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0096")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_stalker_0025")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function hey_del_balon_kk()
	local se_obj = alife():object("lvl1_escape_physic_object_0510")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the catacombs")
  	end
	local se_obj = alife():object("lvl1_escape_physic_object_0511")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the catacombs.")
  	end
    	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Message:\\n Hey! Hey stalker!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
  local se_obj = alife():object("lvl_rat_balloon")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_physic_object_0005")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_physic_destroyable_object_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_physic_destroyable_object_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function kk_gotcha_actor_kick()
	db.actor.health = 0.1
	local point = patrol("awwwshiit_kk_walk")
	local look = patrol("awwwshiit_kk_walk")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
        level.add_pp_effector("black.ppe", 20131, false)
    	 level.add_cam_effector("camera_effects\\hit_back.anm", 1, false)
    	 level.add_pp_effector("black.ppe", 201831, false)
        soundtrack.ros_shoot_max()
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Message:\\n Got him. That's him... the leader will be pleased...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
	olr.kill_mon_in_radius(db.actor:position(), 200)
end



function start_kk_plen_quest()
     olr_timers.st_timer("start_kk_plen_quest_now", 150, "nick.start_kk_plen_quest_go()")
end

function start_kk_plen_quest_go()
        news_manager.send_tip(db.actor, "jackal_podz", nil, "trader", 29000)
        db.actor:give_info_portion("start_kk_plen_quest_now_info")
	local sobj = alife():object("lvl_rat_stalker_0003") 
	if sobj then 
		olr.add_spot( sobj.id,"esc_bridge_stalkers_location","Jackal" )
	end
end


function daem_nagrada_rat_cat(first_speaker, second_speaker)  
  dialogs.relocate_money(first_speaker, 450, "in")
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "sigaret","in")
 dialogs.relocate_item_section(second_speaker, "water","in")
end


function otdaem_blackbox_rat()
	olr.del_by_name("lvl_rat_physic_object_0080")
	nik_dialog.out_item_much("rat_black_box",1)
	db.actor:change_character_reputation(10)
	local se_obj = alife():object("lvl_rat_level_changer_0000")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the cordon")
  	end
	local se_obj = alife():object("lvl_rat_level_changer_0001")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the cordon.")
  	end
end

function jaba_zavali_off()
	news_manager.send_tip(db.actor, "Yeah, I forgot to tell you. The rubble in that place under the Garbage seems to have been dismantled, so you can go check it out.", nil, "trader", 29000)
end

function precond_black_box_rat()
     return nik_dialog.item_much("rat_black_box",1) ~= false 
end



function esc_timer_one_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
        xvars.esc_timer_one = gtime   
end


function has_esc_timer_one_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.esc_timer_one
	if (gtime - ftime) >= 60*1 then
		return true
	else
		return false
	end
end

function kill_actor_now()
        db.actor.health = -1
end

function rat_kill_actor_niznii_uroven_now()
     level.add_pp_effector("black.ppe", 201831, false)
	olr_timers.st_timer("kill_actor_now", 5, "nick.kill_actor_now()")
   for i = 1, 35 do
  alife():create("m_rat_e", db.actor:position():add(db.actor:direction():mul(1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
 end
end




function blackened_city_darksalkertwo()
     level.add_pp_effector("black.ppe", 201831, false)
  local se_obj = alife():object("lvl11_deadcity_staler_undead_olr_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function blackened_city_darksalkerone()
     level.add_pp_effector("black.ppe", 201831, false)
  local se_obj = alife():object("lvl11_deadcity_staler_undead_olr_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end




function kill_actor_svd_dolina()
	if has_alife_info("voyaki_spaven_bandosy_alarm") then
		return
	end
        soundtrack.ros_shoot_max()
	olr.kill_actor()
        db.actor.health = -10
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Unknown Sniper:\\n Where are you going, stalker?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
end




function hy_punk_dont_shoor_my_rat()
	if has_alife_info("voyaki_spaven_bandosy_alarm") then
	return
	end
        soundtrack.ros_shoot_max()
        db.actor.health = -1
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Message:\\n Hey, he's shooting at our rats!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
end


--' удаляем группу магнит
function magnet_group_quest_delete_netspawn()

  local se_obj = alife():object("lvl5_bar_space_restrictor_0117")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_staler_undead_olr_0002")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_staler_undead_olr_0001")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0064")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0063")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1320")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0313")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0067")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1347")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("lvl5_bar_physic_object_1322")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("lvl5_bar_physic_object_1327")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("lvl5_bar_physic_object_0841")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("lvl5_bar_physic_object_1346")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("lvl5_bar_physic_object_1345")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0061")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0314")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0315")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0316")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0317")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0059")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0060")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0065")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0062")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0312")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1328")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1338")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1324")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1325")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1323")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_0934")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1352")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl5_bar_physic_object_1353")
  if se_obj then
    alife():release(se_obj, true)
  end

end




function daem_el_detector()
	local obj = olr.give_item("detector_elite")
	level.client_spawn_manager():add(obj.id, 0, function(id,obj) obj:set_condition((math.random(95,99)/100)) end)
end



function blacened_ekran()
     level.add_pp_effector("black.ppe", 20131, false)
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\amb10_l]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function olr_robber_all(npc, actor)
	local v = db.actor:money()
	if v >= 0 then
	dialogs.relocate_money(actor, v, "out")
	end
end



function del_prizrak_esk_most()
     	level.add_pp_effector("black.ppe", 20131, false)
	soundtrack.esc_prizrak_agressive()
	olr_timers.st_timer("del_prizrak_esk_timer", 5, "nick.del_prizrak_esk_most_deltimer()")

 	db.actor:disable_info_portion("esc_prizrak_lamp_info")

	for i=1, 65534 do
	local car = level.object_by_id(i)
	if car then
	if car ~= nil and 
	car:name() == "lvl1_escape_stalker_0038" then
    	local bloodbridgew5 = vector():set( 10056, -0.36, 157 )
	alife():teleport_object(car:id(), db.actor:game_vertex_id(), db.actor:level_vertex_id(), bloodbridgew5)
	end
	end
	end
end



function del_prizrak_esk_most_deltimer()
	olr.del_by_name("level_prefix_lights_hanging_lamp_00153fff")
	olr.del_by_name("lvl1_escape_stalker_0038")
	nick.set_norm_relation_stalkers()
end




function blacened_pp2()
     level.add_pp_effector("black.ppe", 20131, false)
	soundtrack.esc_prizrak_agressive()
	        db.actor.health = 0.05
end



function blacened_pp()
	olr.blow_add(500)
     	level.add_pp_effector("black.ppe", 20131, false) 
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Message:\\n Oh, hey. Come on over and have a chat.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	db.actor:give_info_portion("esc_prizrak_lamp_info")
	olr.kill_mon_in_radius(db.actor:position(), 60)
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and (get_clsid(npc)==clsid.script_stalker) and npc:alive() then
		--log1("000go offline "..npc:name().."")
		--if npc and npc:is_stalker() and npc:alive() and npc:position():distance_to(db.actor:position()) < 90 then
			if npc:character_community() == "stalker" then
				--log1("go offline "..npc:name().."")
				local se_obj = alife():object(npc:id())
  				if se_obj then
    						alife():set_switch_offline (se_obj.id, true)
    						alife():set_switch_online (se_obj.id, false)
    						alife():set_interactive (se_obj.id, false)
						olr_timers.st_timer("convert_online", 670, "olr_npc_eqp.convert_online_out("..npc:id()..")")
  				end
			end
		end
	end
end



function has_medyasik_2()
     return nik_dialog.item_much("agro_case_01",1) ~= false
end



function otdaem_special_artefact_zakaz_daem_shesot(first_speaker, second_speaker)  
 dialogs.relocate_money(first_speaker, 600, "in")
end


function start_neizv_zakaz_timer()
        local rand_time_zak = math.random(80,160)
	if not olr_timers.has_timer("rand_neizv_art_timer_start") then
		olr_timers.st_timer("rand_neizv_art_timer_start", rand_time_zak, "nick.jaba_art_zakaz_spawn()")
	end
end





function sarcofag_dead_stalkers_teleport()
level.add_pp_effector("black.ppe", 20131, false) 
local sectionsa = 
{ 
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4"

}


local count = math.random(100,150) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))


local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)
end
end





function daem_za_esc_fantoma(first_speaker, second_speaker) 
 dialogs.relocate_item_section(second_speaker, "wpn_bm16","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x76_zhekan","in")
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "sigaret","in")
 dialogs.relocate_item_section(second_speaker, "water","in")
 olr_timers.st_timer("daem_za_esc_fantoma_start", 35, "nick.daem_za_esc_fantoma_sms_barmen()")
end


function daem_drip_magnet(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "af_magnet_drop_q1","in")
end


function daem_fntwok(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_fn2000","in")
end


function daem_middle_det_yelow(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "detector_advances","in")
end


function daem_rpg_seven(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_rpg7","in")
end




function start_bar_one_timer()
	if not has_alife_info("kill_rats_garbage_start_done") then
		news_manager.send_tip(db.actor, "Major Kravtsov: I am waiting for your presence here at our base... Come and talk to me, you'll find me at our base.", nil, "dolg_mask1", 25000)
	end
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
        xvars.bar_one_timer = gtime   
end



function start_mag_one_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
        xvars.mag_timer_one = gtime   
end



function start_mag_four_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
        xvars.mag_timer_four = gtime   
end


function has_bar_one_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.bar_one_timer
	if (gtime - ftime) >= 60*48 or has_alife_info("esc_fantoma_sms_barmen_done") then
		return true
	else
		return false
	end
end


function has_start_mag_four_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.mag_timer_four
	if (gtime - ftime) >= 60*12 then
		return true
	else
		return false
	end
end


function has_start_mag_one_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.mag_timer_one
	if (gtime - ftime) >= 60*6 then
		return true
	else
		return false
	end
end

function has_start_mag_two_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.mag_timer_two
	if (gtime - ftime) >= 60*15 then
		return true
	else
		return false
	end
end

function start_mag_two_timer()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
        xvars.mag_timer_two = gtime   
end


function has_two_magnet_and_elshar()
     return nik_dialog.item_much("af_night_star",2) ~= false and nik_dialog.item_much("af_electra_moonlight",1) ~= false
end


function has_mag_accum_gauss()
     return nik_dialog.item_much("af_night_star",1) ~= false and nik_dialog.item_much("ammo_gauss",1) ~= false
end


function otdaem_mag_accum_gauss()
nik_dialog.out_item_much("af_night_star",1)
nik_dialog.out_item_much("ammo_gauss",1)
end


function otdaem_two_magnet_elshar()
nik_dialog.out_item_much("af_night_star",2)
nik_dialog.out_item_much("af_electra_moonlight",1)
end



function otdaem_two_magnet()
nik_dialog.out_item_much("af_night_star",2)
end

function otdaem_vss_vintorez()
nik_dialog.out_item_much("wpn_vintorez",1)
end


function daem_vss_gravi()
	olr.give_item("wpn_vintorez_gravi")
end


function has_two_magnet()
     return nik_dialog.item_much("af_night_star",2) ~= false 
end


function has_vss_vintorez()
     return nik_dialog.item_much("wpn_vintorez",1) ~= false 
end


function has_one_magnet()
     return nik_dialog.item_much("af_night_star",1) ~= false 
end


function has_one_magnet_q2()
     return nik_dialog.item_much("af_magnet_drop_q2",1) ~= false 
end


function otdaem_one_magnet()
nik_dialog.out_item_much("af_night_star",1)
end


function otdaem_magnet_q2()
nik_dialog.out_item_much("af_magnet_drop_q2",1)
end



function daem_nagradu_kulon(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_l85","in")
 dialogs.relocate_item_section(second_speaker, "ammo_5.56x45_ap","in")
 dialogs.relocate_item_section(second_speaker, "ammo_5.56x45_ap","in")
 	olr.del_by_name("lvl7_yantar_space_restrictor_0054")
end


function lech_parasite_now()
get_hud():RemoveCustomStatic("actor_bolezn",true)
get_console():execute("cam_inert 0.2")
db.actor:disable_info_portion("bolezn_parazity_info")

if olr_timers.has_timer("bolezn_parasite_timer") then
olr_timers.del_timer("bolezn_parasite_timer")
end

if olr_timers.has_timer("bolezn_parasite_timer_m") then
olr_timers.del_timer("bolezn_parasite_timer_m")
end

if olr_timers.has_timer("bolezn_parasite_timer_d") then
olr_timers.del_timer("bolezn_parasite_timer_d")
end

level.add_pp_effector("peace_fade.ppe", 12973, false)

if db.actor then
    local currout = db.actor:item_in_slot(6)
	if currout then
	if currout:section() == "scientific_outfit" or currout:section() == "ecolog_outfit" then
    return 
	end
	end
    local te = texture_find("act\\act_arm_perchatka")
    if te then
    te:set_name("act\\act_arm_perchatka")
    te:reload() 
end
end


end






function gg_prec_midle_parasite()
     return olr_timers.has_timer("bolezn_parasite_timer_m") ~= false or olr_timers.has_timer("bolezn_parasite_timer_d") ~= false 
end



function start_work_ohr_timer_wpn()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
        xvars.ohr_timer_wpn = gtime   
end


function has_work_ohr_timer_wpn()
	local gtime = level.get_time_days()*60*24+level.get_time_hours()*60+level.get_time_minutes() 
	local ftime = xvars.ohr_timer_wpn
	if (gtime - ftime) >= 60*36 then
		return true
	else
		return false
	end
end


function del_timers_beshenstvo()

get_console():execute("cam_inert 0.2")
get_hud():RemoveCustomStatic("actor_bolezn",true)

if olr_timers.has_timer("bolezn_beshenstvo_timer") then
olr_timers.del_timer("bolezn_beshenstvo_timer")
end

if olr_timers.has_timer("bolezn_beshenstvo_timer_m") then
olr_timers.del_timer("bolezn_beshenstvo_timer_m")
end

if olr_timers.has_timer("bolezn_beshenstvo_timer_d") then
olr_timers.del_timer("bolezn_beshenstvo_timer_d")
end

end




function spawn_random_stuff_onlok()
if db.actor then
if not has_alife_info("kvest_esc_1_dialog_start") then
return
end
if has_alife_info("rand_shit_timer_now") then
return
end
db.actor:give_info_portion("rand_shit_timer_now")
olr_timers.st_timer("rand_shit_timer_start", 2500, "nick.disable_rand_stuff()")
--news_manager.send_tip(db.actor, "РАНДОМНЫЙ ХЛАМ ЗАСПАВНЕН - СТАРТ ТАЙМЕРА ПО НОВОЙ", nil, "freedom", 9000)
local sectionsa = 
{ 
"wpn_pm",
"wpn_knife_old_rotten",
"bandage",
"medkit",
"grenade_f1",
--"ammo_5.45x39_ap",
"vodka",
"energy_drink",
"ph_banka_kraski_1",
"antirad",
"ph_box_wood_01",

"item_pda_dead",
"item_razradnik",
"af_studen",
"grenade_rgd5",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",

"ph_food_vater",

"korobok_spichek",
"ph_item_krovosos_jaw",
"ph_item_zombie_hand",

"dead_body_skelet4",
"dead_body_skelet2",
"dead_body_skelet3",

"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_food_conserv1",
"ph_food_conserv2",
"ph_food_konserva_sardina",
"ph_food_konserva_sardina_open",
"ph_food_konserva_tushenka",
"ph_food_konserva_yantar",
"ph_shifer_03",
"vodka_used_empty",
"ph_item_gasmask1"

}

local count = math.random(10,20) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))


local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)
--olr.add_spot_on_map( obj.id,"green_location",obj:name() )
xvars.rand_shit_timer_cnt = xvars.rand_shit_timer_cnt + 1
end
end
end




function yan_multicutscene_one()
	nick.yan_zaval_onlin()
	xr_effects.disable_ui(db.actor, nil)
	level.add_pp_effector("blink.ppe", 20131, false) 
	level.add_cam_effector2("camera_effects\\yan_mozg_off_1.anm", 30, false, "nick.yan_multicutscene_two")
	olr_timers.st_timer("pre_yantar_off_effs_eba", 85, "nick.pre_yantar_off_effs_ebaa()")
end

function yan_multicutscene_two()
	level.add_cam_effector2("camera_effects\\yan_mozg_off_2.anm", 30, false, "nick.enable_newui")
	level.set_weather("1865")
	local point = patrol("kostil_ay_walk")
	local look = patrol("kostil_ay_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end


function enable_newui()
	xr_effects.enable_ui(db.actor, nil)
	level.add_pp_effector("blink.ppe", 20131, false) 
	local point = patrol("sudaobtarno_walk")
	local look = patrol("sudaobtarno_look")
	db.actor:set_actor_position(point:point(0))
	local dir = look:point(0):sub(point:point(0))
	db.actor:set_actor_direction(-dir:getH())
end




function set_startgame_random_money()

if db.actor then

local montabl = 
{
       [clsid.script_stalker] = true
}
local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill then
                if montabl[kill:clsid()]  then
                if not kill.online then
                if kill:alive() then
                if kill:community()~="trader" then

                local coeff = math.random(30,450)

                local tbl = amk.read_stalker_params(kill)
		local old_money = tbl.money
		if (old_money == nil) then old_money = 0 end
		tbl.money = coeff
		amk.write_stalker_params(tbl, kill)


end
end
end
end
end
end
end
end



function gg_prec_midle_beshenstvo()
     return olr_timers.has_timer("bolezn_beshenstvo_timer_d") ~= false 
end



function novic_leaded_dead_sms_slizen()
if has_alife_info("ds_olr_1_slizen") then
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Slug\\n Uh, I don't fucking get it. Is he dead? Come on, get over here!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),25000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
db.actor:give_info_portion("ds_olr_1_slizen_fail_info")
end
end


function vikup_novika_dolinovskie(first_speaker, second_speaker)  
 dialogs.relocate_money(first_speaker, 2700, "in")
end

function vikup_novika_dolinovskie_now(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,2700,"out")
end


function daem_dezintegrator(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "af_dummy_battery","in")
end


function daem_wpn_groza(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_groza","in")
end


function create_gar_doki()
	olr_timers.st_timer("jaba_bigbrotha_remind", 585, "nick.jaba_bigbrotha_remind()")
	--local bloodbridge = vector():set(-106.74, 3, 257.00 )
	--local obj = alife():create("jornal_2", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	--clear_useful_for_ai(obj)
	--log1("create gar doky")
	nick.spwan_mercs_fordocs()
end



function create_holmy_doki()
	--local bloodbridge = vector():set(-18.46, -2, -16.68 )
	--local obj = alife():create("jornal_4", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	--clear_useful_for_ai(obj)
	--log1("create holmy doky")
	nick.spwan_mercs_fordocs()
end


function create_holmy_yantar()
	--local bloodbridge = vector():set(67.80, 12.70, -30 )
	--local obj = alife():create("jornal_5", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	--clear_useful_for_ai(obj)
	--log1("create yan doky")
	nick.spwan_mercs_fordocs()
end


function create_holmy_radar()
	--local bloodbridge = vector():set(-10, 2, -67.3 )
	--local obj = alife():create("jornal_6", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	--clear_useful_for_ai(obj)
	--log1("create radar doky")
	nick.spwan_mercs_fordocs()
end


function spwan_mercs_fordocs()
	local noobposition = db.actor:position()
	local xnoob = math.random(1,80)
	local znoob = math.random(1,90)
	local nmpos = vector():set( noobposition.x + xnoob, noobposition.y + 4, noobposition.z + znoob )
	alife():create("mil_killer_respawn_1", nmpos, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	alife():create("mil_killer_respawn_2", nmpos, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	alife():create("mil_killer_respawn_3", nmpos, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
	alife():create("mil_killer_respawn_4", nmpos, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
end


function camlook_dol_lampa_first()
get_console():execute("cam_inert 0.9")
for i=1,65535 do
local lokobj = level.object_by_id(i)
if lokobj then
if lokobj:name() == "warlab_prefix_lights_hanging_lamp_0144" then

local pos = lokobj:bone_position("link")
local vDir = pos:sub(db.actor:position())
db.actor:set_actor_direction(-vDir:getH())

olr_timers.st_timer("remove_cam_inert_timer", 1, "nick.remove_cam_inert_timer()")

end
end
end
end



----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


function spawn_rat_kat_medium()

local sectionsa = 
{ 
"ph_item_document_01",
"ph_item_box_01",
"ph_item_book_open_01",
"ph_shifer_03",
"ph_kirpich_one",
"ph_item_book_03",
"ph_banka_kraski_1",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_food_vater",
"ph_item_document_1",
"ph_item_mks10",
"ph_ognetushitel",
"ph_vedro_01",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
--"ph_konteyner_01",
"ph_balon_02",
"ph_balon_01",
"ph_food_conserv1",
"ph_food_conserv2",
"ph_food_konserva_kukuruza",
"ph_food_konserva_olives",
"ph_food_konserva_olives_open",
"ph_food_konserva_orehi",
"ph_food_konserva_orehi_open",
"ph_food_konserva_sardina",
"ph_food_konserva_sardina_open",
"ph_food_konserva_tushenka",
"ph_food_konserva_yantar",
"vodka_used_empty",
"ph_item_document_01",
"ph_item_box_01",
"ph_med_stolik_01",
"ph_item_book_open_01",
"ph_shifer_03",
"ph_food_konserva_olives_open",
"ph_kirpich_one",
"ph_item_book_03",
"ph_banka_kraski_1",
"ph_food_konserva_orehi",
"ph_box_wood_01",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_food_vater",
"ph_food_konserva_tushenka",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_food_vater",
"ph_item_document_1",
"ph_item_mks10",
"ph_ognetushitel",
"ph_med_stoyka_01",
"ph_vedro_01",
--"ph_med_katalka_01",
"ph_tumba_1g",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_shkaf_4",
"ph_shkaf_5",
"ph_shkaf_6",
"ph_tumba_1",
"ph_tumba_1a",
"ph_tumba_1b",
"ph_tumba_1c",
"ph_tumba_1d",
"ph_tumba_1f",
"ph_garbage_11",
"ph_garbage_10",
"ph_garbage_9",
"ph_garbage_8",
"ph_garbage_7",
"ph_garbage_6",
"ph_garbage_5",
--"ph_garbage_4",
--"ph_garbage_3",
--"ph_garbage_2",
--"ph_garbage_1",
--"ph_krovat_01",
--"ph_krovat_02",
--"ph_konteyner_03",
--"ph_konteyner_02",
--"ph_konteyner_01",

"ph_item_gasmask1"

}


local count = math.random(100,200) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

--log1(""..lv.."")
--log1(""..gv_max.."")

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)


if obj.position:distance_to_xz(vector():set( 0, 0, 2)) < 10 or  --- новичок и вход
obj.position:distance_to_xz(vector():set( -110, 0, 7)) < 10 or  --- контр и зал
obj.position:distance_to_xz(vector():set( -73, 0, 46)) < 10 then    --- разборка с бандосами
alife():release(obj, true) 
--log1("bad blace rat")
end

level.client_spawn_manager():add(obj.id, 0, 
function(id,obj) 		

                                local h = hit()
		                h.draftsman = obj
		                h.type = hit.strike
		                h.direction = vector():set(math.random(1),0.1,math.random(1))
		                h.power = 1
		                h.impulse = 2
		                obj:hit(h)


end)
--olr.add_spot_on_map( obj.id,"red_location",obj:name() )
end
end


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


function spawn_escape_rand_medium()

local sectionsa = 
{ 
"ph_item_document_01",
"ph_item_box_01",
"ph_item_book_open_01",
"ph_shifer_03",
"ph_kirpich_one",
"ph_item_book_03",
"ph_banka_kraski_1",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_food_vater",
"ph_item_document_1",
"ph_item_mks10",
"ph_ognetushitel",
"ph_vedro_01",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
--"ph_konteyner_01",
"ph_balon_02",
"ph_balon_01",
"ph_food_conserv1",
"ph_food_conserv2",
"ph_food_konserva_kukuruza",
"ph_food_konserva_olives",
"ph_food_konserva_olives_open",
"ph_food_konserva_orehi",
"ph_food_konserva_orehi_open",
"ph_food_konserva_sardina",
"ph_food_konserva_sardina_open",
"ph_food_konserva_tushenka",
"ph_food_konserva_yantar",
"vodka_used_empty",

"ph_item_gasmask1"

}


local count = math.random(50,150) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

--log1(""..lv.."")
--log1(""..gv_max.."")

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)
level.client_spawn_manager():add(obj.id, 0, 
function(id,obj) 		

                                local h = hit()
		                h.draftsman = obj
		                h.type = hit.strike
		                h.direction = vector():set(math.random(1),0.1,math.random(1))
		                h.power = 1
		                h.impulse = 2
		                obj:hit(h)


end)
--olr.add_spot_on_map( obj.id,"red_location",obj:name() )
end
end


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function spawn_citys_rand_medium()

if db.actor then

local sectionsa = 
{ 
"ph_item_document_01",
"ph_item_box_01",
"ph_med_stolik_01",
"ph_item_book_open_01",
"ph_shifer_03",
"ph_kirpich_one",
"ph_item_book_03",
"ph_banka_kraski_1",
"ph_food_konserva_orehi",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_food_vater",
"ph_item_document_1",
"ph_item_mks10",
"ph_ognetushitel",
"ph_med_stoyka_01",
"ph_vedro_01",
--"ph_med_katalka_01",
"ph_tumba_1g",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
"ph_shkaf_4",
"ph_shkaf_5",
"ph_shkaf_6",
"ph_tumba_1",
"ph_tumba_1a",
"ph_tumba_1b",
"ph_tumba_1c",
"ph_tumba_1d",
"ph_tumba_1f",
"ph_garbage_11",
"ph_garbage_10",
"ph_garbage_9",
"ph_garbage_8",
"ph_garbage_7",
"ph_garbage_6",
"ph_garbage_5",
--"ph_garbage_4",
--"ph_garbage_3",
--"ph_garbage_2",
"ph_garbage_1",
"ph_krovat_01",
"ph_krovat_02",
--"ph_konteyner_03",
--"ph_konteyner_02",
--"ph_konteyner_01",
"ph_balon_02",
"ph_balon_01",
"ph_food_conserv1",
"ph_food_conserv2",
"ph_food_konserva_kukuruza",
"ph_food_konserva_olives",
"ph_food_konserva_olives_open",
"ph_food_konserva_orehi",
"ph_food_konserva_orehi_open",
"ph_food_konserva_sardina",
"ph_food_konserva_sardina_open",
"ph_food_konserva_tushenka",
"ph_food_konserva_yantar",
"vodka_used_empty",

"ph_item_gasmask1"

}


local count = math.random(100,150) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

local section = sectionsa[math.random(table.getn(sectionsa))] 

local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)

if obj.position:distance_to_xz(vector():set( -189, 11, 177)) < 70 or  --- база учёных
obj.position:distance_to_xz(vector():set( 200, -10, -33)) < 50 then    --- мозг колба
alife():release(obj, true) 
end

if obj then
level.client_spawn_manager():add(obj.id, 0, 
function(id,obj) 		

                                local h = hit()
		                h.draftsman = obj
		                h.type = hit.strike
		                h.direction = vector():set(math.random(1),0.1,math.random(1))
		                h.power = 1
		                h.impulse = 2
		                obj:hit(h)


end)
--olr.add_spot_on_map( obj.id,"red_location",obj:name() )
end
end
end
end


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


function spawn_agr_rand_medium()

local sectionsa = 
{ 
"ph_item_document_01",
"ph_item_box_01",
"ph_med_stolik_01",
"ph_item_book_open_01",
"ph_shifer_03",
"ph_food_konserva_olives_open",
"ph_kirpich_one",
"ph_item_book_03",
"ph_banka_kraski_1",
"ph_food_konserva_orehi",
"ph_box_wood_01",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_food_vater",
"ph_food_konserva_tushenka",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_item_document_1",
"ph_item_mks10",
"ph_ognetushitel",
"ph_med_stoyka_01",
"ph_vedro_01",
--"ph_tomb_01",
--"ph_med_katalka_01",
"ph_tumba_1g",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",

"ph_item_gasmask1"

}


local count = math.random(150,250) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

--log1(""..lv.."")
--log1(""..gv_max.."")

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)

if obj then
if obj.position:distance_to_xz(vector():set( -9, -32, -6)) < 10 or
obj.position:distance_to_xz(vector():set( -9, -32, 28)) < 10 or
obj.position:distance_to_xz(vector():set( 37, -17, 10)) < 10 or
obj.position:distance_to_xz(vector():set( -29, -19, 9)) < 10 then
alife():release(obj, true) 
end
end

level.client_spawn_manager():add(obj.id, 0, 
function(id,obj) 		

                                local h = hit()
		                h.draftsman = obj
		                h.type = hit.strike
		                h.direction = vector():set(math.random(1),0.1,math.random(1))
		                h.power = 1
		                h.impulse = 2
		                obj:hit(h)


end)
--olr.add_spot_on_map( obj.id,"red_location",obj:name() )
end
end




function spawn_gar_rand_medium()

local sectionsa = 
{ 
--"ph_zabor_dver_01",
--"ph_zabor_dver_02",
"ph_med_stolik_01",
"ph_truba_bar_rostok",
"ph_shifer_03",
--"ph_pricep_01",
"ph_kirpich_one",
"ph_musor_konteyner_01",
"ph_banka_kraski_1",
--"ph_kozel_01",
"ph_box_wood_01",
"ph_food_vater",

"ph_bochka_open_1",
"ph_bochka_open_2",
"ph_bochka_open_3",
"ph_bochka_open_4",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",

"ph_item_gasmask1"

}


local count = math.random(150,250) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

--log1(""..lv.."")
--log1(""..gv_max.."")

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)
level.client_spawn_manager():add(obj.id, 0, 
function(id,obj) 		

                                local h = hit()
		                h.draftsman = obj
		                h.type = hit.strike
		                h.direction = vector():set(math.random(1),0.1,math.random(1))
		                h.power = 1
		                h.impulse = 2
		                obj:hit(h)


end)
--olr.add_spot_on_map( obj.id,"red_location",obj:name() )
end
end



function spawn_bar_rand_rats()

local sectionsa = 
{ 
"m_rat_e",
"m_rat_e2",
"m_rat_e3",
"m_rat_e4",
"m_rat_new"

}


local count = math.random(35,55) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))

local section = sectionsa[math.random(table.getn(sectionsa))] 
local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)

end
end



function spawn_bar_only_trash()

if db.actor then

local sectionsa = 
{ 
"ph_item_document_01",
"ph_item_box_01",
"ph_item_book_open_01",
"ph_shifer_03",
"ph_kirpich_one",
"ph_item_book_03",
"ph_banka_kraski_1",
"ph_item_book_02",
"ph_item_book_01",
"ph_item_battery_02",
"ph_item_rukzak",
"ph_gasmask1",
"ph_gasmask2",
"ph_gasmask3",
"ph_food_vater",
"ph_item_document_1",
"ph_item_mks10",
"ph_ognetushitel",
"ph_vedro_01",
"dead_body_skelet",
"dead_body_skelet2",
"dead_body_skelet3",
"dead_body_skelet4",
--"ph_konteyner_01",
"ph_balon_02",
"ph_balon_01",
"ph_food_conserv1",
"ph_food_conserv2",
"ph_food_konserva_kukuruza",
"ph_food_konserva_olives",
"ph_food_konserva_olives_open",
"ph_food_konserva_orehi",
"ph_food_konserva_orehi_open",
"ph_food_konserva_sardina",
"ph_food_konserva_sardina_open",
"ph_food_konserva_tushenka",
"ph_food_konserva_yantar",
"vodka_used_empty",

"ph_item_gasmask1"

}


local count = math.random(150,250) 
for ind = 1, count do

local lname = level.name()
local lvtab = GetLevelVertexes( lname )
local lvx = math.max(unpack(lvtab))
local lv  = math.random(1,lvx)

local gvtab  = GetGameVertexes(lname)
local gv_min = math.min( unpack(gvtab))
local gv_max = math.max( unpack(gvtab))


local section = sectionsa[math.random(table.getn(sectionsa))] 

local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)

if obj.position:distance_to_xz(vector():set( -73, -96, -224 )) < 50 or  --- бар
obj.position:distance_to_xz(vector():set( 123, -86, -128)) < 50 then   --- база долга
alife():release(obj, true)
--log1("bad place bar")
end

if obj then
level.client_spawn_manager():add(obj.id, 0, 
function(id,obj) 		

                                local h = hit()
		                h.draftsman = obj
		                h.type = hit.strike
		                h.direction = vector():set(math.random(1),0.1,math.random(1))
		                h.power = 1
		                h.impulse = 2
		                obj:hit(h)


end)

end
end
end
end


function del_zalog_beshenstvo(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,1000,"out")
db.actor:disable_info_portion("bolezn_beshenstvo_info_zalog")
end


function gg_prec_yasik_blokpost()
     return nik_dialog.item_much("agro_case_01",1) ~= false  
end


function gg_prec_special_artefact_zakaz()
     return nik_dialog.item_much("af_random_zakaz",1) ~= false  
end


function otdaem_special_artefact_zakaz()
nik_dialog.out_item_much("af_random_zakaz",1)
end



function gg_ecolog_outfit_has()
     return nik_dialog.item_much("ecolog_outfit",1) ~= false  
end


function gg_ecolog_outfit_nou()
     return nik_dialog.item_much("ecolog_outfit",1) == false  
end


function swapm_dok_fill_check()
    if has_alife_info("fil_start_quest_done") then
    db.actor:give_info_portion("swamp_spawen_fila_dok")
end
end


function clear_mertka_sobak()
	olr.del_by_name("lvl5_bar_physic_object_0555")
end


function otdaem_barmenu_doki_s_doliny()
	local sp1_place = alife():object("lvl5_bar_physic_object_0555")
	olr.add_spot_on_map( sp1_place.id,"crlc_mdl", "Dog pack." )
	nik_dialog.out_item_much("dolina_barman_house_doki",1)
	nik_dialog.out_item_much("dolina_barman_house_doki_additional",1)
	olr.give_item("battery_change")
end


function has_all_dolina_docs_barmen()
     return nik_dialog.item_much("dolina_barman_house_doki",1) ~= false and nik_dialog.item_much("dolina_barman_house_doki_additional",1) ~= false   
end



function actor_has_bsyblockirator_dol()
     return nik_dialog.item_much("psy_blocerator",1) ~= false 
end



function daem_pochinenyy_item_rem()
	local currep = xvars.cur_rest_wpn
	local stng = game.translate_string(currep)
	if tostring(stng) == tostring("FN HPSA") then
		--log1("!!!!!!!!!! FIX "..stng.."")
		stng = "wpn_hpsa"
	end
	local wpn = alife():create(stng, db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	local cwpn = level.object_by_id(wpn.id)
	if wpn and cwpn and cwpn:is_weapon() then
		cwpn:unload_magazine()
	end
	xvars.cur_rest_wpn = ""
	db.actor:disable_info_portion("ametist_repair_gotovo_done_info")
	db.actor:give_info_portion("bar_trader_repair_gotov")
end


function del_halavniy_shlem()
if has_alife_info("dolina_barman_house_doki_info") then
local sim = alife()
for id=1, 65534 do
local obj = sim:object(id)
if obj then
local sect = obj:section_name()
if sect == "psy_blocerator" and obj.id == xvars.id_psyblock_garbage then 
sim:release(obj)
end					
end
end
end
end


function actor_on_garbage_now(actor,npc)
local level_name = level.name()
if level_name == "lvl2_garbage" then
return true
end
end



function bar_barman_night_precond(actor,npc)
    return has_alife_info("olr_traders_night") and has_alife_info("bar_dogskill_done")
end


function gar_deadniv_prec(actor,npc)
    return has_alife_info("dolina_nov_zab_dead_1") and has_alife_info("dolina_nov_zab_dead_2") and has_alife_info("dolina_nov_zab_dead_3") and has_alife_info("talk_slizen_have_kill_novicov")
end


function bar_barman_day_precond(actor,npc)
    return has_alife_info("olr_traders_day") and has_alife_info("bar_dogskill_done")
end


function bar_godgs_staya_dead()
local gulag = xr_gulag.get_gulag("lvl5_bar_smart_terrain_0008")
if gulag then
local gulag_popular = gulag:get_population()
if gulag_popular < 1 then
db.actor:give_info_portion("bar_dogskill_have")
return true
end
end
end


function odvolf_plot_wpaber()
alife():create("flesh_strong", db.actor:position():add(db.actor:direction():add(44)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end



function npc_set_health_full(fs,ss)
local npc = fs:id()==0 and ss or fs
npc.health = 1
end



function has_bolezn_middle_beshenstvo()
return olr_timers.has_timer("bolezn_beshenstvo_timer_d") ~= false
end



function npc_talking(fs,ss)
local npc = fs:id()==0 and ss or fs
log1("talk anim2")
npc:clear_animations()
npc:add_animation("salut", true, false)
end



function create_coster_mg_podval()
	local level_name = level.name()
	local noobposition = db.actor:position()
		if level_name == "lvl11_deadcity" then
			local bloodbridge = vector():set( 2.76, -5.17, 320.00 )
			alife():create("zone_flame", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
                end
end





function spaven_doki_plot()
	local level_name = level.name()
	local noobposition = db.actor:position()
		if level_name == "lvl1_escape" then
			local bloodbridge = vector():set( 105.76, 12.17, -45.00 )
			local obj = alife():create("esc_zavod_plot_doki", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
			clear_useful_for_ai(obj)
                end
end







function spawen_grav_digeernanii()
	local level_name = level.name()
	local noobposition = db.actor:position()
	local bol_var = math.random(1,3)

		if level_name == "lvl1_escape" then

                        if bol_var == 1 then
			local bloodbridge = vector():set( 208.76, -0.17, 318.00 )
			alife():create("af_gravi", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
                        --news_manager.send_tip(db.actor, "СПАВЕН 1", nil, "default", 9000)
                        end

                        if bol_var == 2 then
			local bloodafterbridge = vector():set( 249.47, 2.22, 115.03 )
			alife():create("af_gravi", bloodafterbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
                        --news_manager.send_tip(db.actor, "СПАВЕН 2", nil, "default", 9000)
                        end

                        if bol_var == 3 then
			local fracunderbridge = vector():set( -94.91, -0.63, 110.13 ) 
			alife():create("af_gravi", fracunderbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )
                        --news_manager.send_tip(db.actor, "СПАВЕН 3", nil, "default", 9000)
                        end



end
end



function deadcity_bomb_explode()
    local source = nil
    local sim = alife ()
    if sim then
       local se_obj = sim:story_object (5481)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end

    if source == nil then
       return
    end

    local h = hit ();
    h.power = 1000000;
    h.direction = vector():set( 1, 0, 0 );
    h.impulse = 1;
    h.draftsman = source;
    h.type = hit.chemical_burn;
    source:hit (h);
    
end



function dead_spawen_dinamite()
log1(" shii ")
end


function esc_spawen_blokpost_docks()
 	local level_name = level.name()
		if level_name == "lvl1_escape" then
			local bloodbridgew = vector():set( -138.51, -29.32, -354.90 )
			alife():create("agro_case_01", bloodbridgew, db.actor:level_vertex_id() , db.actor:game_vertex_id() )

end
end


function esc_kill_gulag_military()
	local gulag = xr_gulag.get_gulag_by_name("esc_blokpost")
	if gulag then
		for k,v in pairs(gulag.Object) do
			if type(v)=="userdata" then
				local o = level.object_by_id(k) 
				if o then o:kill(o) end
			end
		end
	end
end




function agr_spawen_nauchinkia()
    if has_alife_info("digger_combez_zametka_info") then
 	local level_name = level.name()
		if level_name == "lvl3_agroprom" then
			local bloodbridge = vector():set( 97.55, 1.69, 48.00 )
			alife():create("ecolog_outfit", bloodbridge, db.actor:level_vertex_id() , db.actor:game_vertex_id() )

end
end
end



function proverka_est_net_banok_rats()
    local STbronb = db.actor:object("af_banka_s_holodcom")
    if STbronb then
    ahh_banki_agr()
end
end



function done_kill_gopllit_hmm_actor2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer. Throat cut from ear to ear. The blood was darkened and caked, but the pins were exhausted and could not close this wound... Oh, my God! Who could have gotten in the way of this dandelion of God? Hmm, no personal PDA...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function done_kill_gopllit_hmm_actor()
olr_timers.st_timer("jaba_about_deathtruck", 755, "nick.jaba_about_deathtruck()")
if has_alife_info("agr_olr_1_pogo_koluchki") then
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n I think I'll check Goplit as soon as I find something here...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),55000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.beep()
end
end

function jaba_about_deathtruck()
	news_manager.send_tip(db.actor, "Messer. I've received reports of another truck of death being seen in the dump area. Exactly like the one they found you in. There's also a rumor of zombie sightings in the southern territories, which is not common. One of them was shot by stalkers, and he had a PDA with a mission to kill Strelok, just like you... Draw conclusions.", nil, "trader", 35000)
end

function sms_city_monol_fake_take()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n Monolith... Does it really exist?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function killlll_plot_mg_sms2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n Idiots, what the hell are you doing?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 4000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.del_by_name("lvl7_yantar_stalker_0023")
olr.del_by_name("yan_equip_helicopter_0000")
end



function ahh_banki_agr()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n I think we should try using a can of cholent on the creatures.. It should burn them up no problem.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function digger_combez_zametka()
    if has_alife_info("esc_digger_go_nii_goo_now_info_blokpost") and not has_alife_info("digger_zdoh_nahui") then
    db.actor:give_info_portion("digger_combez_zametka_info")
end
end



function proverka_novic_alive_gar()
    if has_alife_info("esc_novic_go_nii_prisli_tosval") and not has_alife_info("neizv_novic_zdoh_nahui") then
    db.actor:give_info_portion("esc_novic_nasval_start")
end
end




function proverka_digger_alive_gar()
    if has_alife_info("esc_digger_go_nii_goo_now_info_blokpost") and not has_alife_info("digger_zdoh_nahui") then
    db.actor:give_info_portion("esc_novic_nasval_start")
end
end



function ros_kino_changed() 
db.actor:disable_info_portion("on_on_zzgh_theature")
db.actor:give_info_portion("theature_new_ros")
end


function hear_something_2_special() 
db.actor:give_info_portion("slizen1_prisli_hear_something_2_special")
end


function hear_something_2_special_disable() 
db.actor:disable_info_portion("slizen1_prisli_hear_something_2_special")
end



function done_kill_gopllit()
  local se_obj = alife():object("lvl3_agroprom_stalker_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function killlll_max_ros()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl6_rostok_stalker_0021" then 
            obj = alife():object(npc:id())
        npc:kill(npc)    
        end
    end
end


function goplit_5_have()
     return nik_dialog.item_much("af_rusty_thorn",5) ~= false 
end

function goplit_2_have()
     return nik_dialog.item_much("af_rusty_kristall",2) ~= false 
end


function goplit_5_otdaem()
nik_dialog.out_item_much("af_rusty_thorn",5)
end

function goplit_2_otdaem()
nik_dialog.out_item_much("af_rusty_kristall",2)
end

function otdaem_at_glaz_gar()
nik_dialog.out_item_much("af_jabiy_glaz_garbage",1)
olr.del_by_name("lvl2_garbage_staler_undead_olr_0002")
end

function otdaem_at_medkit_fix()
nik_dialog.out_item_much("medkit",1)
end


function otdaem_arg_jaba_voda_boloto()
nik_dialog.out_item_much("arg_jaba_voda_boloto",1)
end


function otdaem_jguchaya_vata()
nik_dialog.out_item_much("af_electra_flash",1)
end

function otdaem_wpn_vintorez_gravi()
nik_dialog.out_item_much("wpn_vintorez_gravi",1)
end

  
function actor_have_jguchaya_vata()
     return nik_dialog.item_much("af_electra_flash",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-electra-flash")
end


function precond_gravi_vintorez()
     return nik_dialog.item_much("wpn_vintorez_gravi",1) ~= false 
end


function precond_jabina_voda()
     return nik_dialog.item_much("arg_jaba_voda_boloto",1) ~= false 
end


function dolina_barman_house_doki_precond()
     return nik_dialog.item_much("dolina_barman_house_doki",1) ~= false 
end

function actor_have_medkitfix()
     return nik_dialog.item_much("medkit",1) ~= false or nik_dialog.item_much("medkit_army",1) ~= false or nik_dialog.item_much("medkit_scientic",1) ~= false
end    


function ros_kanistra_precond()
     return nik_dialog.item_much("kanistra_benz",1) ~= false 
end


function precond_gar_glaz_only()
     return nik_dialog.item_much("af_jabiy_glaz_garbage",1) ~= false
end


function precond_gar_glaz()
     return nik_dialog.item_much("af_jabiy_glaz_garbage",1) ~= false and has_alife_info("kaban_spawn_first_talk_talked") 
end

function esc_detector_precond()
	local has_geiger = db.actor:object("detector_simple")
	if has_geiger and has_geiger:condition() >= 0.24 then
		return true
	end
     --return nik_dialog.item_much("detector_simple",1) ~= false 
end


function precond_doki_plot_esc()
     return nik_dialog.item_much("esc_zavod_plot_doki",1) ~= false 
end


function precond_garb_miliraty_docs()
     return nik_dialog.item_much("garb_miliraty_docs",1) ~= false 
end


function arts_zakaz1_slab_precond()
     return nik_dialog.item_much("af_vyvert",1) ~= false 
end


function arts_zakaz1_sred_precond()
     return nik_dialog.item_much("af_gravi",1) ~= false 
end



function spaven_pmka_escape()
local bol_var = math.random(1,5)
if bol_var == 1 then
	local bobj445 = alife():create('wpn_hpsa', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	level.client_spawn_manager():add(bobj445.id, 0, function(id,obj) obj:set_condition((math.random(32,85)/100)) news_manager.send_tip(db.actor, "Weapon received - HPSA", nil, "default", 9000) end)
	alife():create('ammo_9x19_fmj', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
elseif bol_var == 2 then
	local bobj445 = alife():create('wpn_pm', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	level.client_spawn_manager():add(bobj445.id, 0, function(id,obj) obj:set_condition((math.random(22,85)/100)) news_manager.send_tip(db.actor, "Weapon received - PM", nil, "default", 9000) end)
	alife():create('ammo_9x18_fmj', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
elseif bol_var == 3 then
	local bobj445 = alife():create('wpn_fort', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	level.client_spawn_manager():add(bobj445.id, 0, function(id,obj) obj:set_condition((math.random(15,85)/100)) news_manager.send_tip(db.actor, "Weapon received - FORT", nil, "default", 9000) end)
	alife():create('ammo_9x18_fmj', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
elseif bol_var == 4 then
	local bobj445 = alife():create('wpn_pb', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	level.client_spawn_manager():add(bobj445.id, 0, function(id,obj) obj:set_condition((math.random(32,85)/100)) news_manager.send_tip(db.actor, "Weapon received - PB", nil, "default", 9000) end)
	alife():create('ammo_9x18_fmj', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
elseif bol_var == 5 then
	local bobj445 = alife():create('wpn_walther', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
	level.client_spawn_manager():add(bobj445.id, 0, function(id,obj) obj:set_condition((math.random(52,85)/100)) news_manager.send_tip(db.actor, "Weapon received - Walther", nil, "default", 9000) end)
	alife():create('ammo_9x19_fmj', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
end
end


function enaple_pda()
   db.actor:disable_info_portion("pda_dead_off")
   news_manager.send_tip(db.actor, "PDA: Battery fully charged.", nil, "default", 9000)
end


function barman_sotka_precond(actor,npc)
    return actor:money() >= 100
end

function barman_dvestipisat_precond(actor,npc)
    return actor:money() >= 250
end


function actor_have_sotka_deneg(actor,npc)
    return actor:money() >= 100
end


function actor_barman_patihatka_habar(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,100,"out")
end


function actor_barman_dvestipisat_banka(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,250,"out")
end


function dolg_voliny_barter(first_speaker, second_speaker)
	local reward = math.random(1,3)  
	if reward == 1 then  
                dialogs.relocate_item_section(second_speaker, "wpn_spas12","in")
	end
 	if reward == 2 then  
                dialogs.relocate_item_section(second_speaker, "wpn_rpk74","in")
	end
 	if reward == 3 then  
                dialogs.relocate_item_section(second_speaker, "wpn_vsk94","in")
	end
end




function dolg_kalash_ammo_barter(first_speaker, second_speaker)
	local reward = math.random(1,2)  
	if reward == 1 then  
                dialogs.relocate_item_section(second_speaker, "ammo_5.45x39_ap","in")
	end
 	if reward == 2 then  
                dialogs.relocate_item_section(second_speaker, "ammo_5.45x39_fmj","in")
	end
end





function dolg_nato_ammo_barter(first_speaker, second_speaker)
	local reward = math.random(1,2)  
	if reward == 1 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x19_fmj","in")
	end
 	if reward == 2 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
	end
end




function dolg_shodtag_ammo_barter(first_speaker, second_speaker)
	local reward = math.random(1,3)  
	if reward == 1 then  
                dialogs.relocate_item_section(second_speaker, "ammo_12x76_dart","in")
	end
 	if reward == 2 then  
                dialogs.relocate_item_section(second_speaker, "ammo_12x76_zhekan","in")
	end
 	if reward == 3 then  
                dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
	end
end



function dolg_nato_ammo_barter(first_speaker, second_speaker)
	local reward = math.random(1,2)  
	if reward == 1 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x19_fmj","in")
	end
 	if reward == 2 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
	end
end



function dolg_pm_ammo_barter(first_speaker, second_speaker)
	local reward = math.random(1,3)  
	if reward == 1 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x18_fmj","in")
	end
 	if reward == 2 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x18_pmm","in")
	end
 	if reward == 3 then  
                dialogs.relocate_item_section(second_speaker, "ammo_9x18_pbp","in")
	end
end

function dolg_benzin_barter(first_speaker, second_speaker)
         dialogs.relocate_item_section(second_speaker, "kanistra_benz","in")
end



function prec_dolg_tri_vodka()
     return nik_dialog.item_much("vodka",3) ~= false 
end

function del_tri_vodka()
nik_dialog.out_item_much("vodka",3)
end



function prec_dolg_two_vodka()
     return nik_dialog.item_much("vodka",2) ~= false 
end

function del_two_vodka()
nik_dialog.out_item_much("vodka",2)
end


function dolg_barter_precond(actor,npc)
    return has_alife_info("olr_traders_night") and has_alife_info("bar_dolgovec_pre_barter_done")
end

function is_den_dialog_bar(actor,npc)
return has_alife_info("lonewolf_bar_spawn") and has_alife_info("karlik_quest_one_done") and level.name() == "lvl5_bar"
end



function prec_dolg_one_vodka()
     return nik_dialog.item_much("vodka",1) ~= false 
end


function del_one_vodka()
nik_dialog.out_item_much("vodka",1)
end

 

function daem_dolg_ammo_pis_nato(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
end

function daem_antibeshenstvo_bar(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "anti_beshenstvo_dog_caps","in")
end

 
function daem_norm_ppm_esc_diger(first_speaker, second_speaker)  
  	olr.give_item("conserva")
  	olr.give_item("korobok_spichek")
  	olr.give_item("wpn_pm")
end


function daem_norm_shlem_yanfail(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "good_psy_helmet","in")
end

function daem_saf_papku(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "fil_saf_papka","in")
end

function give_konservas(first_speaker, second_speaker)  
  	olr.give_item("conserva")
  	olr.give_item("conserva")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
 dialogs.relocate_item_section(second_speaker, "af_banka_s_holodcom","in")
 dialogs.relocate_item_section(second_speaker, "af_banka_s_holodcom","in")
 if not has_alife_info("komandir_zdoh_nahui") then
	news_manager.send_tip(db.actor, "Stalker, over. This is the commander. Thank you again for helping me out... Listen, I'm leaving the zone now anyway, so I'll share some info... there's a box at our checkpoint, so that's where our soldiers dump all the junk they collect from stalkers. If you want, you can take a chance to sneak in there quietly at night... there's no one there at that time. Well, take care, maybe I'll see you again...", 17, "military", 49000)
 end
end


function give_konservas2(first_speaker, second_speaker)  
  	olr.give_item("conserva")
  	olr.give_item("kolbasa")
 dialogs.relocate_item_section(second_speaker, "medkit","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
end


function give_konservas3(first_speaker, second_speaker)  
  	olr.give_item("conserva")
  	olr.give_item("medkit")
  	olr.give_item("antirad")

end

function daem_vodka_dvashtuki(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "vodka","in")

  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0011")
  if se_obj then
    alife():release(se_obj, true)
  end

end


function arts_zakaz1_slab_daem_nag(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
end


function arts_zakaz1_sred_daem_nag(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
end


function arts_zakaz1_vse_daem_nag(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "vodka","in")
 dialogs.relocate_item_section(second_speaker, "ammo_9x19_pbp","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
end


-- стартовые параметры ПЕРВОЙ ПМКИ
function set_cond_pmka()
    local STbronp = db.actor:item_in_slot(2)
    if STbronp then
    STbronp:set_condition(math.random(15,55)/100)
end
end


function mertv_prines_banki()
     return nik_dialog.item_much("af_banka_s_holodcom",5) ~= false 
end



function mertv_vodka_vsk()
     return nik_dialog.item_much("wpn_vsk94",1) ~= false and nik_dialog.item_much("vodka",5) ~= false   
end


function arts_zakaz1_vse_precond()
     return nik_dialog.item_much("af_vyvert",1) ~= false and nik_dialog.item_much("af_gravi",1) ~= false   
end

function digger_equip_precind()
     return nik_dialog.item_much("stalker_outfit",1) ~= false and nik_dialog.item_much("af_gravi",1) ~= false   
end

function arts_leader_freedom_door_precond()
     return nik_dialog.item_much("af_dummy_battery",1) ~= false and nik_dialog.item_much("af_drops",1) ~= false   
end


function digger_equip_precind_slab()
     return nik_dialog.item_much("stalker_outfit",1) ~= false and nik_dialog.item_much("af_vyvert",2) ~= false   
end


function odtaem_banki_stud()
nik_dialog.out_item_much("af_banka_s_holodcom",5)
end
 


function odtaem_doki_plot_esc()
nik_dialog.out_item_much("esc_zavod_plot_doki",1)
end
 

function arts_zakaz1_slab_otdaem()
nik_dialog.out_item_much("af_vyvert",1)
end

  
function esc_detector_diger_otdaem()
	db.actor:change_character_reputation(20)
	nik_dialog.out_item_much("detector_simple",1)
	news_manager.send_tip(db.actor, "Digger: Man, the guy in the truck is smart. He'll be braver than you guys. He didn't piss on the attic of the factory to go...", 55, "default", 19000)
end


function arts_zakaz1_sred_otdaem()
nik_dialog.out_item_much("af_gravi",1)
end


function arts_zakaz1_vse_otdaem()
nik_dialog.out_item_much("af_vyvert",1)
nik_dialog.out_item_much("af_gravi",1)
end


function mertv_vodka_vsk_otdaem()
nik_dialog.out_item_much("wpn_vsk94",1)
nik_dialog.out_item_much("vodka",5)
end


function otdaem_digg_cost_slab()
nik_dialog.out_item_much("stalker_outfit",1)
nik_dialog.out_item_much("af_vyvert",2)
end



function otdaem_digg_cost()
nik_dialog.out_item_much("stalker_outfit",1)
nik_dialog.out_item_much("af_gravi",1)
xvars.naparnik_name = "Digger"
	local sobj = alife():object("lvl2_garbage_stalker_0037lloh") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Digger."
      			pk:set( data )
		end	
	end
end

function nap_zob()
xvars.naparnik_name = "Zob"
	local sobj = alife():object("lvl2_garbage_stalker_0037lloh") 
	if sobj then 
	local pk = get_netpk(sobj,1)
  		if pk:isOk() then
    			local data = pk:get()
          		data.character_name = "Zob"
      			pk:set( data )
		end	
	end
end

function arts_leader_freedom_give_otdaem()
nik_dialog.out_item_much("af_dummy_battery",1)
nik_dialog.out_item_much("af_drops",1)
end


function spaven_crow_spawn()
 local sim = alife()
 for i = 1, 25 do
  alife():create("m_crow", db.actor:position():add(db.actor:direction():mul(90)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
 end
 for i = 1, 15 do
  	olr.spawn_on_obj("m_rat_e", "lvl9_military_zone_radioactive_killing")
 end
end



function boloto_pizdez_actoru()
	local snd_underwater = xr_sound.get_safe_sound_object([[ol3\underwater]])
	local snd_in_water = xr_sound.get_safe_sound_object([[ol3\in_water]])
	snd_underwater:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	snd_in_water:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	xr_effects.disable_ui(db.actor, nil)
        --level.add_pp_effector("fire_hit.ppe", 1523, true)
	--level.set_pp_effector_factor(154523, 2.5)
        olr_teleport.pesdets_swmp_tp()
        --db.actor:kill(db.actor)
end


function golg_attack_pizdez_actoru()
        level.add_pp_effector("fire_hit.ppe", 1523, true)
	level.set_pp_effector_factor(154523, 2.5)
        soundtrack.ros_shoot_max()
        db.actor:kill(db.actor)
end


function kill_actor_svd_yan()
        if not has_alife_info("start_mission_yan_mon_done") then
        level.add_pp_effector("fire_hit.ppe", 1523, true)
	level.set_pp_effector_factor(254523, 2.5)
        soundtrack.ros_shoot_max()
        db.actor:kill(db.actor)
end
end


function kill_actor_svd_esc()
        level.add_pp_effector("fire_hit.ppe", 1523, true)
	level.set_pp_effector_factor(254523, 2.5)
        soundtrack.ros_shoot_max()
        db.actor:kill(db.actor)
end


function set_ustalost_start()  ---- установка усталости, жажды, времени выброса при старте игры
     olr_blowout.set_blow_timer(999) -- 0.99
     --olr_blowout.on_game_save()
end

function precond_pottishok_pit(actor,npc)
    return actor:money() >= 50
end

function set_thirst_jaba()
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\water_use\water_use]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
     db.actor:set_actor_thirst(1)
		db.actor:give_money(-50)
	game_stats.money_quest_update(-50)
end


function del_arts_start()
	local del_art = true
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
			local gvid, l_id
			if del_art == true then
				local sect = obj:section_name()
				if
					sect == "af_fireball" or
                                        sect == "af_gold_fish" or
					sect == "af_gravi" or
                                        sect == "af_electra_moonlight" or
					sect == "af_vyvert" 

				then
					gvid = obj.m_game_vertex_id
					l_id = game_graph():vertex(gvid):level_id()
					if l_id < 14 and l_id ~= 4 and l_id ~= 6 and l_id ~= 10 and l_id ~= 12 then
						sim:release(obj)
					end
				end
			end
end
end
end


function del_food_drugs_rnd_start()
        local count = 0
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "item_razradnik" or
					sect == "bread" or
                                        sect == "kolbasa" or
					sect == "conserva" or
                                        sect == "vodka" or
                                        sect == "medkit" or
                                        sect == "medkit_army" or
                                        sect == "medkit_scientic" or
                                        sect == "energy_drink" or
                                        sect == "bandage" or
                                        sect == "outfit_exo" or
                                        sect == "novice_outfit" or
                                        sect == "killer_outfit" or
                                        sect == "stalker_outfit" or
                                        sect == "scientific_outfit" or
                                        sect == "exo_outfit" or
                                        sect == "ecolog_outfit" or 
                                        sect == "protection_outfit" or 
                                        sect == "water" or 
                                        sect == "kanistra_benz" or 
                                        sect == "af_rusty_thorn" or
                                        sect == "af_rusty_kristall" or
                                        sect == "detector_simple" or
                                        sect == "detector_advances" or
                                        sect == "detector_elite" or
                                        sect == "af_electra_flash" or
                                        sect == "af_ameba_slug" or
                                        sect == "af_ameba_mica" or
                                        sect == "af_dummy_spring" or
                                        sect == "af_dummy_glassbeads" or
                                        sect == "grenade_rgd5" or
                                        sect == "grenade_f1" or
					sect == "korobok_spichek" or
					sect == "box_rukzak_treasure" or
					sect == "antirad" 

				then
                                                local bol_var = math.random(1,2) 
                                                if bol_var == 1 then  
						sim:release(obj)
                                                count = count + 1
                                                --news_manager.send_tip(db.actor, "старт игры удалено "..count.." еды медицины", nil, "freedom", 9000)
end					
end
end
end
end






function mecheny_swamp_attackeds2121() 
local sim = alife() 
local se_obj = sim:story_object(774) 
if se_obj then 
sim:set_relation(game_object.enemy, db.actor) 
end 
end


function mecheny_swamp_attackeds(sid)
    local npc = level_object_by_sid(774)
    if npc == nil or npc:alive () == false then
       return 
    end    
    npc:set_relation(game_object.enemy, db.actor)
end


function del_benz_generator_only()
	nik_dialog.out_item_much("kanistra_benz",1)
end

function del_benz_generator()
nik_dialog.out_item_much("kanistra_benz",1)
level.disable_input()
level.hide_indicators()
olr_timers.st_timer("enable_input_timolr", 5, "nick.enable_input_timolr()")
local level_name = level.name()
if level_name == "lvl5_bar" then
olr_timers.st_timer("enable_hata_gener", 2500, "nick.off_hata_gener()")
end
end



function jaba_horok_dead()
  if not has_alife_info("olr_5_have") then
      nick.horok_ne_have_go_nazad()
	olr.del_by_name("lvl1_escape_blow_hide_restr_0011")
      db.actor:give_info_portion("horok_dead_zafeilili")
      db.actor:change_character_reputation(-30) 
	olr_timers.st_timer("deldeadhorekfail", 915, "nick.deldeadhorekfail()")
	local sim = alife()
	for id=1, 65534 do
		local obj = sim:object(id)
		if obj then
				local sect = obj:section_name()
				if
					sect == "horok_ammo_zink" or sect == "horok_rukzak_arts"
				then
					alife():release(obj, true) 
				end					
		end
	end
end
end

function deldeadhorekfail()
	news_manager.send_tip(db.actor, "Ferret, come in. Where the hell are you?! Who was that cormorant next to you on the cordon? Come out to our channel, there is a bazaar...", nil, "default", 29000)
	olr.del_by_name("lvl1_escape_stalker")
end


function minus_repa_small()
      db.actor:change_character_reputation(-40) 
end

function del_dead_zombies_dolg()
olr.del_by_name("lvl5_bar_space_restrictor_0100")
for i= 1, 65535 do
	local obj = level.object_by_id(i)
	if obj ~= nil then
		if obj:clsid()==clsid.zombie_s or obj:clsid()==clsid.zombie and not obj:alive() then
			olr.del(obj)
		end
	end
end
end


function esc_kill_gulag_rats_contr()
for i= 1, 65535 do
	local obj = level.object_by_id(i)
		if obj ~= nil then
			if obj:section()=="m_rat_e" then
				olr.del(obj)
			end
		end
end
end

function hochu_odin_precond(actor,npc)
    return has_alife_info("digger_zdoh_nahui") and has_alife_info("neizv_novic_zdoh_nahui")
end



function dolg_zom_quest_precond(actor,npc)
    return has_alife_info("olr_traders_night") and has_alife_info("bar_pre_radar_talk_done")
end


function kstymy_naparnyky_precond(actor,npc)
    return has_alife_info("esc_novic_go_nii_start_find_st_outfit") or has_alife_info("esc_digger_go_nii_start_find_st_outfit")
end

function spawen_prk_rabochii()
	alife():create("mounted_weapon", db.actor:position():add(db.actor:direction():mul(1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
end


function get_food_cond_start()

        if db.actor then

	local foods = {}
	for i= 1, 65534 do
		local obj = level.object_by_id(i)
		if obj ~= nil then
                                local section = obj:section()
                                if section == "conserva" or section == "bread" or section == "kolbasa" then
				table.insert(foods, obj)
			end
                  end
            end

	for i, obj in ipairs(foods) do
		obj:set_condition(math.random(5,45)/100)
	end
end
end



function set_food_cond_glob() 

--	local sim = alife()
--	for i=1, 65534 do
--		local objq = sim:object(i)
--		if objq then
--		local sect = objq:section_name()
--		if sect == "bread" or sect == "kolbasa" or sect == "conserva" then
--
--
--    --news_manager.send_tip(db.actor, "сетконд оффлайн фуд", nil, "freedom", 9000)
--end					
--end
--end
end





function naparnik_blackened() 
	olr.del_by_name("lvl2_garbage_physic_object_0040")
	olr.del_by_name("lvl2_garbage_physic_object_0041")
	olr.del_by_name("gar_zaraza_nap")
	olr.del_by_name("gar_zaraza_nap_0000")
	olr.del_by_name("gar_zaraza_nap_0001")
	olr.del_by_name("lvl2_garbage_stalker_0043")
      local se_obj = alife():object("lvl2_garbage_stalker_0037lloh")
      if se_obj then 
    local te = texture_find("act\\act_stalker_nap_norm")
    if te then
    te:set_name("act\\act_blowout")
    te:reload() 
end
end
end


function actor_set_killer(actor, npc)
	if db.actor then
		db.actor:set_character_community("actor_killer", 0, 0)
	end
	return true
end


function precond_patihatka_lech(actor,npc)
    return actor:money() >= 500
end

function precond_semihatka_lech(actor,npc)
    return actor:money() >= 700
end

function precond_patihatka_dvaclech(actor,npc)
    return actor:money() >= 2000
end



function actor_esc_patihatka_dvaclech(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,5000,"out")
end



function actor_set_stolkir(actor, npc)
	if db.actor then
		if has_alife_info("talk_s_barmeno_radar_have") then
			db.actor:set_character_community("dolg", 0, 0)
		else
			db.actor:set_character_community("actor", 0, 0)
		end
		if has_alife_info("stan_first") then
			db.actor:set_character_community("actor", 0, 0)
		end
		nick.set_norm_relation_stalkers()
	end
	return true
end


function bolezn_beshenstvo_lecheba()
dialogs.relocate_money(npc,500,"out")
--level.add_pp_effector("escape.ppe",194375,true)
soundtrack.achit1()
end


function spawen_torzik()
alife():create("nap_krest_psyh", db.actor:position():add(db.actor:direction():mul(1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
db.actor:change_character_reputation(10) 
end


function precond_yan_svu()
     return nik_dialog.item_much("wpn_svu",1) ~= false    
end


function precond_yan_oborud_quest()
     return nik_dialog.item_much("yan_oborud_quest",1) ~= false    
end

function precond_happycase()
     return nik_dialog.item_much("diplomat_code_viska",1) ~= false    
end

function otdaem_happycase()
nik_dialog.out_item_much("diplomat_code_viska",1)
end

function otdaem_yan_oborud_quest()
nik_dialog.out_item_much("yan_oborud_quest",1)
local jan_profesor = alife():object("lvl7_yantar_arts_box_profa")
alife():create("korobok_spichek", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("korobok_spichek", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("kolbasa", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("vodka", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("medkit_scientic", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("device_torch", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("detector_simple", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("detector_advances", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("detector_elite", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("kanistra_benz", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("battery_change", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("battery_change_headlamp", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("med_injector_capsule", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("planshet", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
alife():create("item_razradnik", jan_profesor.position, jan_profesor.m_level_vertex_id, jan_profesor.m_game_vertex_id, jan_profesor.id)
end

function otdaem_yan_svu_quest()
nik_dialog.out_item_much("wpn_svu",1)
olr.del_by_name("lvl7_yantar_space_restrictor_0044")
end


function daem_koltarg(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_colt1911","in")
 db.actor:change_character_reputation(30) 
end


function daem_bnka_bar(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "empty_butilka","in")
end



function daem_psyblokeratordol(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "psy_blocerator","in")
end

function daem_yan_oborud_quest(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "yan_oborud_quest","in")
end

function actor_esc_poltishok(first_speaker, second_speaker)  
 dialogs.relocate_money(first_speaker, 50, "in")
end

function daem_ammo_voya(first_speaker, second_speaker) 
 olr.info("tips_esc_and_voyaks_done_vase") 
 dialogs.relocate_item_section(second_speaker, "wpn_addon_scope","in")
 dialogs.relocate_item_section(second_speaker, "korobok_spichek","in")
 dialogs.relocate_money(first_speaker, 350, "in")
 db.actor:change_character_reputation(30) 
end

function daem_razdadniki(first_speaker, second_speaker)  
dialogs.relocate_item_section(second_speaker, "item_razradnik","in")
dialogs.relocate_item_section(second_speaker, "item_razradnik","in")
dialogs.relocate_item_section(second_speaker, "item_razradnik","in")
end


function actor_esc_zarabotu(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in") 
end


function osv_bar_zarabotu(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_item_section(second_speaker, "item_razradnik","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_item_section(second_speaker, "ammo_7.62x54_7h14","in") 
 dialogs.relocate_item_section(second_speaker, "ammo_bolts","in")
 dialogs.relocate_money(first_speaker, 169, "in")
end


function jabina_voda_money(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_money(first_speaker, 669, "in")
end


function precond_peredachka()
     return nik_dialog.item_much("jabina_peredachka",1) ~= false    
end

function otdaem_peredachka()
nik_dialog.out_item_much("jabina_peredachka",1)
end

function otdaem_esc_dead_bochonok()
nik_dialog.out_item_much("esc_dead_bochonok",1)
end


function precond_labcoc1()
     return nik_dialog.item_much("olr_doc_lab_1",1) ~= false    
end

function precond_dezintegrator()
     return nik_dialog.item_much("af_dummy_dummy_q1",1) ~= false    
end

function precond_esc_dead_bochonok()
     return nik_dialog.item_much("esc_dead_bochonok",1) ~= false    
end

function otdaem_dezintegrator()
nik_dialog.out_item_much("af_dummy_dummy_q1",1)
db.actor:change_character_reputation(10) 
end


function daem_skafandr(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ecolog_outfit","in")
end


function daem_vodka_bochonok(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "item_razradnik","in")
 dialogs.relocate_item_section(second_speaker, "ammo_12x70_buck","in")
 dialogs.relocate_money(first_speaker, 238, "in") 
 db.actor:change_character_reputation(20) 
end

function lil_money(first_speaker, second_speaker)  
 dialogs.relocate_money(first_speaker, 70, "in") 
end


function fine_skafandr_have()
     return nik_dialog.item_much("ecolog_outfit",1) ~= false 
end


function spawen_krest_nap()
alife():create("nap_krest_psyh", db.actor:position():add(db.actor:direction():mul(1)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
db.actor:change_character_reputation(10)
end

function daem_svu_heli(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_addon_scope","in")
 dialogs.relocate_item_section(second_speaker, "wpn_svu","in")
 dialogs.relocate_item_section(second_speaker, "ammo_7.62x54_7h14","in")
 dialogs.relocate_item_section(second_speaker, "ammo_7.62x54_7h14","in")
end


-- убийство ГГ на генераторах если решит убежать или пальнуть в встречающих

function kill_actor_geners()
	local actor = db.actor
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\vintorez_shoot]])
	snd_obj:play_at_pos(db.actor, db.actor:position())
	local offset=vector():set(math.random()*6-3,0,math.random()*6-3)	-- создадим случайный вектор направления
	offset:normalize()
	local lv_id = level.vertex_in_direction(actor:level_vertex_id(),offset,2)	-- Получаем ближайшую доступную точку в 2 метрах от ГГ
	local pos = level.vertex_position(lv_id)	-- получаем позицию левелвертекса
	-- подбираем геймвертекс
	local gv_id = 0
	local min_dist = 100000
	local g1
	for a = 1162, 1362 do
		g1 = game_graph():vertex(a):game_point()
		if g1:distance_to(pos)<min_dist then
			min_dist = g1:distance_to(pos)
			gv_id = a
		end
	end	
	local sobj = alife():create("mil_stalker_respawn_3", pos, lv_id, gv_id)	
	db.actor.health = -1
	olr.kill_actor()
end



function daem_stbron(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "stalker_outfit","in")
end


function precond_stbrony()
     return nik_dialog.item_much("stalker_outfit",1) ~= false    
end

function otdaem_stbrony()
nik_dialog.out_item_much("stalker_outfit",1)
end


function precond_kalasha_u()
     return nik_dialog.item_much("wpn_ak74u",1) ~= false    
end


function otdaem_kalasha_u()
nik_dialog.out_item_much("wpn_ak74u",1)
db.actor:change_character_reputation(20)
news_manager.send_tip(db.actor, "Messer, thanks again for your help. I told the guys, you seem normal, despite how and where they found you.", 55, "default", 19000)
end





function precond_bablo_varka_silgrav(actor,npc)
    return actor:money() >= 5000
end



function give_bablo_varka_silgrav(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,5000,"out")
end


function daem_silgrav(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "af_gold_fish","in")
end


function precond_artshar()
     return nik_dialog.item_much("horok_rukzak_arts",1) ~= false    
end


function precond_patrons()
     return nik_dialog.item_much("horok_ammo_zink",1) ~= false    
end


function precond_spiralka()
     return nik_dialog.item_much("af_compas",1) ~= false    
end


function precond_mergera()
     return nik_dialog.item_much("atifact_merger",1) ~= false    
end



function daem_atifact_merger(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "atifact_merger","in")
 db.actor:change_character_reputation(50)
end



function precond_golovi()
     return nik_dialog.item_much("af_dummy_glassbeads",3) ~= false and has_alife_info("encyclopedy_zone_artifact_af-dummy-glassbeads")    
end



function otdaem_golovi()
nik_dialog.out_item_much("af_dummy_glassbeads",3)
end


function otdaem_golovi2()
nik_dialog.out_item_much("af_dummy_glassbeads",1)
end



function precond_golovi2()
     return nik_dialog.item_much("af_dummy_glassbeads",1) ~= false and has_alife_info("encyclopedy_zone_artifact_af-dummy-glassbeads")   
end



function precond_ribka()
     return nik_dialog.item_much("af_gold_fish",2) ~= false and has_alife_info("encyclopedy_zone_artifact_af-gold-fish")  
end


function otdaem_ribka()
nik_dialog.out_item_much("af_gold_fish",2)
end





function precond_chdoki()
     return nik_dialog.item_much("doki_dla_ch",1) ~= false    
end



function otdaem_chdoki()
nik_dialog.out_item_much("doki_dla_ch",1)
db.actor:change_character_reputation(20)
end



function precond_glaz()
     return nik_dialog.item_much("glaz_fila",1) ~= false    
end




function precond_kalasha()
     return nik_dialog.item_much("wpn_akm74",1) ~= false    
end


function otdaem_kalasha()
nik_dialog.out_item_much("wpn_akm74",1)
db.actor:change_character_reputation(20)
news_manager.send_tip(db.actor, "ZB: Messer, thanks again for your help. I told the guys, you seem fine, despite how and where they found you. You keep your word, and that's worth a lot...", 55, "default", 19000)
end



function hmm_cod(actor)
		db.actor:give_info_portion("aaa_cod_je")
end


function precond_dok_holodilnik()
     return nik_dialog.item_much("jabin_holodilnik",1) ~= false    
end



function otdaem_dok_holodilnik()
nik_dialog.out_item_much("jabin_holodilnik",1)
end



function daem_dok_holodilnik(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "jabin_holodilnik","in")
end


function precond_nojs_dla_barmena_feik()
     return nik_dialog.item_much("wpn_knife",1) ~= false    
end


function precond_nojs_dla_barmena()
     return nik_dialog.item_much("wpn_knife_m1",1) ~= false    
end

function otdaem_nojs_dla_barmena()
nik_dialog.out_item_much("wpn_knife_m1",1)
db.actor:change_character_reputation(10)
end


function otdaem_nojs_dla_barmena_fec()
nik_dialog.out_item_much("wpn_knife",1)
olr_timers.st_timer("angry_barman_knife_fec", 1234, "nick.angry_barman_knife_fec()")
end

function angry_barman_knife_fec()
db.actor:change_character_reputation(-10)
news_manager.send_tip(db.actor, "Messer, you hear me? That knife you supposedly found in the Rostok Underground is the wrong knife! We'll talk to you again for that kind of scam.", nil, "barman", 25000)
end

function precond_pda_mg()
     return nik_dialog.item_much("device_pda_uchenyh_deadcity",1) ~= false    
end


function otdaem_pda_mg()
	news_manager.send_tip(db.actor, "Money received - 700.", nil, "money", 39000)
	db.actor:give_money(700)
	game_stats.money_quest_update(700)
nik_dialog.out_item_much("device_pda_uchenyh_deadcity",1)
end




function daem_kombez_yan_zab(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ecolog_outfit","in")
end


function otdaem_kulon_zeny()
nik_dialog.out_item_much("amulet_karlikov",1)
db.actor:change_character_reputation(20)
end


function precond_kulon_zeny()
     return nik_dialog.item_much("amulet_karlikov",1) ~= false    
end


function precond_zablik_doks()
     return nik_dialog.item_much("olr_zablikov_doki",1) ~= false    
end


function otdaem_zablik_doks()
nik_dialog.out_item_much("olr_zablikov_doki",1)
db.actor:change_character_reputation(20)
end


function actor_set_dolg(actor, npc)
	--printf("ACTOR NOW IN [monolit] COMMUNITY")
	if db.actor then
		db.actor:set_character_community("dolg", 0, 0)
		nick.set_friend_dolg()
	end
	return true
end

function actor_set_dolg_equip(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_pkm","in")
 dialogs.relocate_item_section(second_speaker, "ammo_7.62x54_7h14","in")
 dialogs.relocate_item_section(second_speaker, "ammo_7.62x54_7h14","in")
 dialogs.relocate_item_section(second_speaker, "ammo_7.62x54_7h14","in")
end


function set_friend_dolg()
if db.actor then
	local chkgoodwill = relation_registry.community_goodwill("dolg", db.actor:id())
	if chkgoodwill < 0 then 
		chkgoodwill = chkgoodwill + 1500
		relation_registry.set_community_goodwill ("dolg", db.actor:id(), chkgoodwill)
	else
		relation_registry.set_community_goodwill ("dolg", db.actor:id(), 1700)
	end
end
end


function precond_gravishot()
     return nik_dialog.item_much("wpn_shotgra",1) ~= false    
end



function give_dve_hachki(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "ammo_bolts","in")
 dialogs.relocate_item_section(second_speaker, "ammo_bolts","in")
end



function give_gravshotgum(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_shotgra","in")
 dialogs.relocate_item_section(second_speaker, "ammo_bolts","in")
 dialogs.relocate_item_section(second_speaker, "ammo_bolts","in")
 dialogs.relocate_item_section(second_speaker, "ammo_bolts","in") 
 dialogs.relocate_item_section(second_speaker, "amulet_karlikov","in")
end


function give_gravshotgumonly(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_shotgra","in")
end



function reputation_up_fivetousand(stalker, player) 
 db.actor:change_character_reputation(100) 
end


function precond_graviart()
     return nik_dialog.item_much("wpn_hands_gravity",1) ~= false    
end

function otdaem_graviart()
	local se_obj = alife():object("dolin_to_escape_physic_object")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the catacombs")
  	end
	nik_dialog.out_item_much("wpn_hands_gravity",1)
end


function give_graviart(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "wpn_hands_gravity","in") 
end



function killlll_gar_naparnika_part()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl2_garbage_stalker_0037lloh" then 
            obj = alife():object(npc:id())           
        end
    end
end



function killlll_rabogo()
	olr_timers.st_timer("illlll_rabog", 43, "nick.illlll_rabog()")
	local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl5_bar_stalker_0038" then 
          	obj = alife():object(npc:id())
		npc:kill(npc)
 		local snd_obj = xr_sound.get_safe_sound_object([[weapons\pm_shoot]])
 		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 2.0)           
        end
    end
end


function illlll_rabog()
     	if ( xr_conditions.actor_in_zone(nil,nil,{"lvl5_bar_space_restrictor_0003"})) then
		olr_timers.st_timer("illlll_rabog", 43, "nick.illlll_rabog()")
		return
	end	
	local se_obj = alife():object("lvl5_bar_stalker_0038")
	if se_obj then
		alife():release(se_obj, true)
	end
end


function give_raboy_ap_barm(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "medkit_scientic","in") 
end


function na_apteku_raboy(first_speaker, second_speaker)  
nik_dialog.out_item_much("medkit_scientic",1)
end


-- стартовые параметры ГГ

function yasiik_dwa_have()
     return nik_dialog.item_much("agro_case_02",1) ~= false    
end

function akim_give_money_kompensacia(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,500,"out")
end


function have_first_aatr()
     return nik_dialog.item_much("af_esc_vishka",1) ~= false    
end

function have_first_yaas()
     return nik_dialog.item_much("agro_case_01",1) ~= false    
end

function na_glaz(first_speaker, second_speaker)  
 dialogs.relocate_item_section(second_speaker, "glaz_fila","in") 
end

function main_friend(npc)
npc:set_relation(game_object.friend, db.actor)
end

function give_glaz()
nik_dialog.out_item_much("glaz_fila",1)
db.actor:change_character_reputation(20)
end


function have_pzrk()
     return nik_dialog.item_much("wpn_igla",1) ~= false    
end

function give_pzrk()
nik_dialog.out_item_much("wpn_igla",1)
	local bsobj = alife():object("lvl14_stancia_physic_object_0076") 
	if bsobj then
		alife():create("wpn_igla", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id)
		alife():create_ammo("ammo_igla", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
		alife():create_ammo("ammo_igla", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
		alife():create_ammo("ammo_igla", bsobj.position, bsobj.m_level_vertex_id, bsobj.m_game_vertex_id, bsobj.id, 1)
	end
news_manager.send_tip(db.actor, "Finally, we have the shaitan pipe. If we rush to the center of the zone, no chopper will be afraid!", 30, "freedom", 9000)
end


function give_pattys_bablo (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 2500, "in") 
end



-- удаляем фейк прибор спавним норм прибор 1
function device_remove_prib()
    local ooItem = db.actor:object("fake_pribor_jaba") 
    if ooItem then
        alife():release(alife():object(ooItem:id()), true)
                  amk.spawn_item_in_inv("detector_siniy")
    end
end


-- удаляем фейк прибор спавним норм прибор 2
function device_remove_prib2()
    local ooItem = db.actor:object("fake_pribor_jaba") 
    if ooItem then
        alife():release(alife():object(ooItem:id()), true)
                  amk.spawn_item_in_inv("detector_siniy_2")
    end
end

-- удаляем фейк прибор спавним норм прибор 3
function device_remove_prib3()
    local ooItem = db.actor:object("fake_pribor_jaba") 
    if ooItem then
        alife():release(alife():object(ooItem:id()), true)
                  amk.spawn_item_in_inv("detector_siniy_3")
    end
end


-- удаляем фейк прибор спавним норм прибор 4
function device_remove_prib4()
    local ooItem = db.actor:object("fake_pribor_jaba") 
    if ooItem then
        alife():release(alife():object(ooItem:id()), true)
                  amk.spawn_item_in_inv("detector_siniy_4")
    end
end


-- удаляем фейк прибор спавним норм прибор 5
function device_remove_prib5()
    local ooItem = db.actor:object("fake_pribor_jaba") 
    if ooItem then
        alife():release(alife():object(ooItem:id()), true)
                  amk.spawn_item_in_inv("detector_siniy_5")
    end
end


-- удаляем фейк прибор спавним норм прибор 6
function device_remove_prib6()
    local ooItem = db.actor:object("fake_pribor_jaba") 
    if ooItem then
        alife():release(alife():object(ooItem:id()), true)
                  amk.spawn_item_in_inv("detector_siniy_6")
    end
end










function cit_drop_actor_inventory(actor)
	inv_box_2 = level_object_by_sid(18029)
	out_object = actor
	in_object = inv_box_2
		actor:inventory_for_each(transfer_object_item) 
end

function cross_off_yan()
        --olr_spawn_phantoms.genmyphatoms()
        log1("1")
end

function cross_on_yan()
        --device_torch_bad()
        log1("1")
end



--
function progulkarostok_del_4()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0007")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--------------------------Убийство новиса---------------------------------------------------

--' gar restrs
function del_gar_nap_dama()
  local se_obj = alife():object("gar_zaraza_nap")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' gar restrs
function del_gar_nap_dama0()
  local se_obj = alife():object("gar_zaraza_nap_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' gar restrs
function del_gar_nap_dama1()
  local se_obj = alife():object("gar_zaraza_nap_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' дверь подрыв
function del_door_podriv()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0016")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' росток прогулка
function progulkarostok_del_1()
  local se_obj = alife():object("lvl6_rostok_staler_undead_olr_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' росток прогулка
function progulkarostok_del_2()
  local se_obj = alife():object("lvl6_rostok_stalker_0026")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_3()
  local se_obj = alife():object("lvl6_rostok_stalker_0025")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulka_prisli_plos_del_door_sosaki()
	olr.del_by_name("lvl6_rostok_space_restrictor_0046")
	olr.del_by_name("lvl6_rostok_physic_object_0251")
end




--' росток прогулка
function progulkarostok_del_4()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0007")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' заграда подз свалки
function gar_und_del_shiet_1()
  local se_obj = alife():object("lvl2_garbage_physic_object_0046")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' заграда подз свалки 2
function gar_und_del_shiet_2()
  local se_obj = alife():object("lvl2_garbage_physic_object_0081")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' заграда подз свалки 3
function gar_und_del_shiet_3()
  local se_obj = alife():object("lvl2_garbage_physic_object_0043")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_5()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0009")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_6()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0010")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' росток прогулка
function progulkarostok_del_7()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_8()
  local se_obj = alife():object("rostok_physic_object_0182_truba")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_9()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0006")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' росток прогулка
function progulkarostok_del_10()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0005")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_11()
  local se_obj = alife():object("lvl6_rostok_stalker_0022")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_12()
  local se_obj = alife():object("lvl6_rostok_stalker_0023")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' росток прогулка
function progulkarostok_del_13()
  local se_obj = alife():object("lvl6_rostok_stalker_0024")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' бар тр1п 1
function delete_bar_trup1()
  local se_obj = alife():object("lvl5_bar_physic_object_0825")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 2
function delete_bar_trup2()
  local se_obj = alife():object("lvl5_bar_physic_object_0826")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 3
function delete_bar_trup3()
  local se_obj = alife():object("lvl5_bar_physic_object_0828")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 4
function delete_bar_trup4()
  local se_obj = alife():object("lvl5_bar_physic_object_0831")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' бар тр1п 5
function delete_bar_trup5()
  local se_obj = alife():object("lvl5_bar_physic_object_0830")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' бар тр1п 6
function delete_bar_trup6()
  local se_obj = alife():object("lvl5_bar_physic_object_0827")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 7
function delete_bar_trup7()
  local se_obj = alife():object("lvl5_bar_physic_object_0829")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 8
function delete_bar_trup8()
  local se_obj = alife():object("lvl5_bar_physic_object_0824")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 9
function delete_bar_trup9()
  local se_obj = alife():object("lvl5_bar_physic_object_0823")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 10
function delete_bar_trup10()
  local se_obj = alife():object("lvl5_bar_physic_object_0818")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 11
function delete_bar_trup11()
  local se_obj = alife():object("lvl5_bar_physic_object_0821")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 12
function delete_bar_trup12()
  local se_obj = alife():object("lvl5_bar_physic_object_0819")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' бар тр1п 13
function delete_bar_trup13()
  local se_obj = alife():object("lvl5_bar_physic_object_1245")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем глючную плоть МГ
function bad_esh_strong()
  local se_obj = alife():object("lvl11_deadcity_flesh_strong")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("poltery_zone_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем новика еск
function bad_timer_del_novic()
  local se_obj = alife():object("lvl1_escape_stalker_0029")
  if se_obj then
    alife():release(se_obj, true)
    db.actor:give_info_portion("neizv_novic_zdoh_nahui")
  end
end


--' удаляем таймер бед калаш
function del_timer_restr_badovskii()
  local se_obj = alife():object("lvl1_escape_space_restrictor_0075")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем двери мг лидеров
function mg_doors_leadesr_spawen()
  news_manager.send_tip(db.actor, "Attention, everyone. The main Freedom group has returned to Bright Ray. Anyone who needs to make some money, come on down.", 21, "freedom", 29000)
  local se_obj = alife():object("lvl11_deadcity_physic_object_0737")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем манекен фантасм
function fantasm_den_man()
  local se_obj = alife():object("lvl8_swamp_stalker_0021")
  if se_obj then
    alife():release(se_obj, true)
  end
  olr_timers.st_timer("fantasm_den_man", 21, "nick.fantasm_den_man_start_fun()")
  	olr.spawn_on_obj("medkit", "lvl8_swamp_stalker_0006")
	olr.spawn_on_obj("medkit", "lvl8_swamp_stalker_0006")

	olr.spawn_on_obj("ammo_plasma", "lvl8_swamp_stalker_0006")
	olr.spawn_on_obj("ammo_plasma", "lvl8_swamp_stalker_0006")
end


--' удаляем бандос доки плоть
function del_bandos_docsplot()
  local se_obj = alife():object("lvl1_escape_stalker_0052")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function fuck_this_door_prip_pri()
	olr.del_by_name("deadlight_green_prip_00")
	olr.del_by_name("lvl13_prip_physic_object_0355")
	olr_timers.st_timer("seen_fuck_this_door_prip", 31, "nick.seen_fuck_this_door_prip()")
end	


function seen_fuck_this_door_prip()
	news_manager.send_tip(db.actor, "Guys, what the hell? Why are there midgets in the bar? There's at least five of them by the playground. it's a common channel. Be advised.", nil, "flash", 39000)
	olr.del_by_name("lvl5_bar_physic_object_1001")
	olr.del_by_name("lvl5_bar_physic_object_1000")
end

--' удаляем двер прип
function fuck_this_door_prip()
	olr_timers.st_timer("daem_fuck_this_door_prip", 3, "nick.fuck_this_door_prip_pri()")
  local se_obj = alife():object("lvlpasdp324gfdzr_physic_object_0190")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем кадра прип
function fuck_this_door_kadr()
  local se_obj = alife():object("lvl13_prip_physic_object_0355")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("level_prefix_lights_hanging_lamp_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем ворота заз
function del_rpk_empty()
  local se_obj = alife():object("lvl5_bar_physic_object_0140")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_dog_normal")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_dog_normal_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_dog_strong_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_dog_strong")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_dog_weak_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_dog_weak")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем закрытой двери верт
function kk_del_vorot()
  local se_obj = alife():object("lvl_rat_physic_object_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_space_restrictor_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_physic_object_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("levelkkkdsq_prefix_lights_hanging_lamp_0014")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_physic_object_0006")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем ученого в закрытой двери верт
function del_proffesor2_ver()
  local se_obj = alife():object("lvl7_yantar_stalker_0046")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' переводим в ОФФЛАЙН професора верт
function del_proffesor_ver()
olr_timers.st_timer("del_proffesor_ver_online", 4224, "nick.del_proffesoronline_ver()")
news_manager.send_tip(db.actor, "Guys, you're not gonna believe this! Our guys found an entrance to some dungeons in Lucha, and there's tons of artifacts in there! They say they couldn't even carry it all away, it's like a Klondike!", 60, "freedom", 49000)
olr_timers.st_timer("omsoffeoffeff3", 25, "nick.del_agr_yan_arg_ployt()")
  local se_obj = alife():story_object(1510)
  if se_obj then
    alife():set_switch_offline (se_obj.id, true)
    alife():set_switch_online (se_obj.id, false)
    alife():set_interactive (se_obj.id, false)
  end
end


--' переводим в ОНЛАЙН професора верт
function del_proffesoronline_ver()
  olr.info("plot_door_letat_prof_sasestentom")
  local se_obj = alife():story_object(1510)
  if se_obj then
    alife():set_switch_offline (se_obj.id, false)
    alife():set_switch_online (se_obj.id, true)
    alife():set_interactive (se_obj.id, true)
  end
end


--' удаляем рестриктор агро у перехода
function edel_arra()
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0010")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_space_restrictor_0007")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_physic_object_0176")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем вояку2 у тонеля
function gar_nap_man3jhgyw2()
  local se_obj = alife():object("lvl1_escape_stalker_0043")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем вояку1 у тонеля
function gar_nap_man3jhgyw1()
  local se_obj = alife():object("lvl1_escape_stalker_0044")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем диггера после катсцены
function esc_digera_cud_del()
  local se_obj = alife():object("lvl1_escape_stalker_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем диггера после катсцены
function nertvetcz_1()
  local se_obj = alife():object("lvl4_darkdolina_staler_undead_olr")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем диггера после катсцены
function nertvetcz_2()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0092")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем диггера после катсцены
function c_psy_offfffff_del_do()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0739")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl11_deadcity_physic_object_0740")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем диггера после катсцены
function nertvetcz_3()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0091")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем диггера после катсцены
function nertvetcz_4()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0093")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем командира у тонеля
function gar_nap_man3jhgyw()
  local se_obj = alife():object("lvl1_escape_stalker_0042")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем напарника ман
function gar_nap_manyw()
  local se_obj = alife():object("lvl2_garbage_stalker_0037lloh_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем напарника труп
function gar_nap_bodyw()
  local se_obj = alife():object("lvl2_garbage_stalker_0037lloh")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' кочергу РПГ
function del_kocher_rpg()
  local se_obj = alife():object("lvl7_yantar_stalker_0050")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' хидлайт1 мил
function del_milhide_light1()
  local se_obj = alife():object("rsgf_prefix_lights_hanging_lamp_0007")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' хидлайт2 мил
function del_milhide_light2()
  local se_obj = alife():object("rsgf_prefix_lights_hanging_lamp_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' хидлайт3 мил
function del_milhide_light3()
  local se_obj = alife():object("rsgf_prefix_lights_hanging_lamp_0009")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' хидлайт4 мил
function del_milhide_light4()
  local se_obj = alife():object("rsgf_prefix_lights_hanging_lamp_0010")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' хидлайт5 мил
function del_milhide_light5()
  local se_obj = alife():object("rsgf_prefix_lights_hanging_lamp_0011")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем старейшину оне
function del_stareisina_one()
  local se_obj = alife():object("lvl4u_darklab_stalker_0023")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl4u_darklab_space_restrictor_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем сасаку три
function del_sasaka_tretio()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем сасаку два 
function del_sasaka_dvario()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем сасаку один
function del_sasaka_odin()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем бетеры агро
function agro_del_beteers()
  local se_obj = alife():object("lvl3_agroprom_m_car_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl3_agroprom_m_car")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем ворота москвич
function del_vorota_moskv()
  local se_obj = alife():object("lvl7_yantar_physic_object_0588")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем ворота лада
function del_vorota_lada()
  local se_obj = alife():object("lvl5_bar_physic_object_0754")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем ворота заз
function del_vorota_zaz()
  local se_obj = alife():object("lvl5_bar_physic_object_1480")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_physic_object_0753")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl5_bar_physic_object_0983")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем зяблика зону
function grazn_yan()
  news_manager.send_tip(db.actor, "Hmm. Looks like it's Zyablikov's brother... Perhaps we should inform his brother of the unpleasant news...", nil, "act", 29000)
  local se_obj = alife():object("lvl7_yantar_space_restrictor_0037")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем бетер янрать
function del_btr_yan_prieh()
  local se_obj = alife():object("lvl7_yantar_m_car_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем рослидер
function progulka_del_ros_leader_ondone()
  local se_obj = alife():object("lvl6_rostok_staler_undead_olr")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем первый ящик
function delete_yasik_oneer()
  local se_obj = alife():object("lvl1_escape_give_yashik_kvest_1_item")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем кошака
function pidornuli_koshaka()
	olr.del_by_name("lvl11_deadcity_m_cat_e")
	olr.del_by_name("lvl11_deadcity_space_restrictor_0004")
	olr.del_by_name("lvl11_deadcity_space_restrictor_0005")
	olr.del_by_name("lvl11_deadcity_space_restrictor_0006")
end


--' удаляем дверь за тайником
function ros_tainik_del()
  local se_obj = alife():object("lvl6_rostok_physic_object_0203")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем дверь за ножом
function ros_noj_del()
	olr.del_by_name("lvl6_rostok_physic_object_0200")
	olr.del_by_name("lvl6_rostok_physic_object_0012")
	olr.del_by_name("lvl6_rostok_physic_object_0010")	
	olr.del_by_name("lvl6_rostok_physic_object_0202")
	olr.del_by_name("lvl6_rostok_physic_object_0197")
	olr.del_by_name("lvl6_rostok_physic_object_0196")
end




--' удаляем дверь в МГ
function del_mgg_door()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0192")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем зяблика в баре
function bar_zablik_sp()
  local se_obj = alife():object("bar_bar_visitors_3_2_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем камаз бармена
function kamaz_barmena()
  news_manager.send_tip(db.actor, "General channel: On Rostok, they found an entrance to the underground tunnels that connect some of the territories. They say a lot of artifacts have been seen...", 40, "dolg", 49000)
  local se_obj = alife():object("lvl5_bar_m_car_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
end





--' удаляем проходящего зомби на янтаре
function del_yana_zzz()
  local se_obj = alife():object("lvl7_yantar_stalker_0043")
  if se_obj then
    alife():release(se_obj, true)
  end
end





--' удаляем маникен дробовика
function del_manik_gravdrobo()
  local se_obj = alife():object("lvl4u_darklab_physic_object_0450")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем дениса БАР
function del_den_bar()
  local se_obj = alife():object("lvl5_bar_stalker_0039")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем дениса
function del_denisa()
  local se_obj = alife():object("lvl4u_darklab_stalker_0024")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем заграду 2
function del_zagrada_quest_one()
  olr.del_by_name("lvl5_bar_physic_object_0214") 
  olr.del_by_name("bar_bar_visitors_3_2_0798") 

  olr.del_by_name("bar_bar_visitors_3_2_0001") 
  olr.del_by_name("bar_bar_visitors_3_2") 
  olr.del_by_name("bar_bar_visitors_3_2_0000") 
  olr.del_by_name("lvl4_darkdolina_from_kk") 
  local se_obj = alife():object("lvl4u_darklab_physic_object_0502")
  if se_obj then
    alife():release(se_obj, true)
  olr.beep()
  news_manager.send_tip(db.actor, "Elder: Hey, you, uh. come and join us. There's something to talk to you about, human...", nil, "unknown", 9000)
  news_manager.send_tip(db.actor, "Elder: We're waiting for you.", 10, "unknown", 9000)
  end
end

--' удаляем заграду 1
function del_zagrada_quest_oneone()
  local se_obj = alife():object("lvl4u_darklab_physic_object_0503")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем зомби манекена
function zom_udalalam()
  local se_obj = alife():object("lvl4u_darklab_physic_object_0472")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем командира зону
function remove_wolf_zone()
  local se_obj = alife():object("comandir_4")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем командира
function remove_wolfff()
  local se_obj = alife():object("lvl1_escape_stalker_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем сосыча росток cut
function remove_krovo_rostok()
  local se_obj = alife():object("lvl6_rostok_bloodsucker_strong_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем маникен ГГ сарко
function remove_gg_sarko()
  local se_obj = alife():object("lvl15_sarcofag_stalker_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем фила после отдачи глаза информеру
function otdal_glaz_informeru_del_fil()
  local se_obj = alife():object("lvl2_garbage_stalker_0030")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем шакала 1
function shakal_dele_t()
  local se_obj = alife():object("lvl1_escape_staler_undead_olr_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем маникен ГГ свамп
function remove_gg_swamp()
  local se_obj = alife():object("lvl8_swamp_stalker_0013")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем телеп ту круг
function del_mars_to_krug_teleport()
  local se_obj = alife():object("lvl_mars_space_restrictor_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  level.add_pp_effector("black.ppe", 20131, false) 
end



--' удаляем маникен Бурара
function burart_udaalaem()
  local se_obj = alife():object("lvl4u_darklab_physic_object_0435")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем манекен ГГ
function remove_gg()

  	local se_obj = alife():object("lvl1_escape_physic_object_0131")
  	if se_obj then
  	  alife():release(se_obj, true)
  	end

        --olr_timers.st_timer("dogs_task_select_timer", 8600, "nick.dogs_task_select_timer()")
        --olr_timers.st_timer("zombies_task_select_timer", 7600, "nick.zombies_task_select_timer()")
        --olr_timers.st_timer("stalkers_neutral_task_select_timer", 9600, "nick.stalkers_neutral_task_select_timer()")

	trick_sr.art_and_ammo_random()

end


function ring_timer_1()

	if db.actor and has_alife_info("start_olr_mod") then

	if not olr_timers.has_timer("zombies_task_select_timer") then
	olr_timers.st_timer("zombies_task_select_timer", 1460, "nick.zombies_task_select_timer()")
	end

	if not olr_timers.has_timer("dogs_task_select_timer") then
	olr_timers.st_timer("dogs_task_select_timer", 1600, "nick.dogs_task_select_timer()")
	end

	if not olr_timers.has_timer("stalkers_neutral_task_select_timer") then
	olr_timers.st_timer("stalkers_neutral_task_select_timer", 960, "nick.stalkers_neutral_task_select_timer()")
	end

	if not olr_timers.has_timer("stalkers_bandits_task_select_timer") then
	olr_timers.st_timer("stalkers_bandits_task_select_timer", 560, "nick.stalkers_bandits_task_select_timer()")
	end

	if not olr_timers.has_timer("ecologs_neutral_task_select") then
	olr_timers.st_timer("ecologs_neutral_task_select", 360, "nick.ecologs_neutral_task_select()")
	end

	end
end




--' удаляем нож жабы
function delete_nosh_stol()
  local se_obj = alife():object("lvl1_escape_physic_object_0130")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем друга фила
function remove_kebab()
  local se_obj = alife():object("lvl2_garbage_stalker_0031")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем камаз заграду
function kamaz_zagra_zfohssd()
  local se_obj = alife():object("lvl2_garbage_physic_object_0010")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_lights_hanging_lamp")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0008")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_space_restrictor_0005")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_zone_flame")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("level_prefix_lights_hanging_lamp_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("gar_prefix_lights_hangi3r3r3gdgdxng_lamp_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем новиса
function lider_verd_zfohssd()
  local se_obj = alife():object("lvl1_escape_stalker_0024")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем забор росток
function delete_ros_zabor()
  local se_obj = alife():object("lvl6_rostok_physic_object_0110")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl6_rostok_physic_object_0155")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем фейк пулемёт янтарь
function del_fake_pulemet()

olr.del_by_name("zona_zamera_home")
olr.del_by_name("zona_zamera_1")
olr.del_by_name("zona_zamera_2")
 
  olr.del_by_name("lvl7_yantar_physic_object_0088")
  olr.del_by_name("lvl7_yantar_physic_object_0111")
  olr.del_by_name("lvl5_bar_physic_object_0376")
  olr.del_by_name("bar_bar_visitors_1_2")
  olr.del_by_name("lvl5_bar_stalker_0052")
  olr.del_by_name("lvl5_bar_physic_object_0378")

  olr.del_by_name("lvl_rat_psy_to_new_yan")  -- удаляем пси под рат

  nick.create_sinii()

local sobj = olr.create_on_pos("mounted_weapon","lvl7_yantar", vector():set(-180, 14.55, 174))

		olr.spawn_crows(20,90)



end




function killlll_seregu()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl5_bar_stalker" then 
            obj = alife():object(npc:id())
        npc:kill(npc)           
        end
    end
end





function killlll_plot_mg()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl11_deadcity_flesh_strong" then 
            obj = alife():object(npc:id())
        npc:kill(npc)   
        end
    end
end


--------------------------Убийство ветеранов---------------------------------------------------



function napgar_gl_zfoh()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl2_garbage_stalker_0037lloh" then 
            obj = alife():object(npc:id())
        npc:kill(npc)           
        end
    end
end


function lider_gl_zfoh()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "lvl5_bar_stalker_0031" then 
            obj = alife():object(npc:id())
        npc:kill(npc)           
        end
    end
end

function lider_gl_zfoh2()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "bar_bar_visitors_3_3_0000" then 
            obj = alife():object(npc:id())
        npc:kill(npc)           
        end
    end
end

function lider_gl_zfoh3()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "bar_bar_visitors_3_3_0001" then 
            obj = alife():object(npc:id())
        npc:kill(npc)
        end
    end
end

function lider_gl_zfoh4()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "bar_bar_visitors_3_3" then 
            obj = alife():object(npc:id())
        npc:kill(npc)           
        end
    end
end

--------------------------Убийство ветеранов---------------------------------------------------

function actor_enemy(actor, npc)
	npc:set_relation(game_object.enemy, actor)
end


-- испортился фонарь
function device_torch_bad()
        local STfonar = db.actor:item_in_slot(9)
	if STfonar and STfonar:condition() > 0.16 then
        	STfonar:set_condition(0.16)
	end
end


--  OLR 2 ------------------------------------





function horror_voice(actor, npc)
	local sound_obj_l		= xr_sound.get_safe_sound_object( [[affects\horror_l]] )
        local sound_obj_r		= xr_sound.get_safe_sound_object( [[affects\horror_r]] )
        
		sound_obj_l:play_no_feedback(actor, sound_object.s2d, 0, vector():set(-1, 0, 1), 1.0)
		sound_obj_r:play_no_feedback(actor, sound_object.s2d, 0, vector():set( 1, 0, 1), 1.0)
end



function money_give_vosemsot (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 800, "in") 
end


--проверка арта в рюкзаке

function black_angel_have(actor,npc)
    return actor:money() >= 1000
end


function dva_k_have(actor,npc)
    return actor:money() >= 2000
end

function for_k_have(actor,npc)
    return actor:money() >= 5000
end

function for_six_have(actor,npc)
    return actor:money() >= 6000
end



function vos_k_have(actor,npc)
    return actor:money() >= 8000
end

function pat_k_have(actor,npc)
    return actor:money() >= 15000
end


function leader_freedom_bablodoor_precond(actor,npc)
    return actor:money() >= 10000
end


function dvepatsot_k_have(actor,npc)
    return actor:money() >= 5000
end


function dvepatsot_k_have_real(actor,npc)
    return actor:money() >= 2500
end


function dvepatsot_give_money_real(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,2500,"out")
end


function dvepatsot_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,5000,"out")
end


function akim_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,1000,"out")
end

function dva_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,2000,"out")
end

function for_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,5000,"out")
end

function for_sixe_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,6000,"out")
end

function vos_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,8000,"out")
end

function pat_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,15000,"out")
end


function desat_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,10000,"out")
end



function semisotka_dolgtabl_give_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,700,"out")
end
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function reputation_up_5000(stalker, player) 
 db.actor:change_character_reputation(5000) 
 end

function reputation_up_500(stalker, player) 
 db.actor:change_character_reputation(500) 
 end




-- Удаление объекта по имени
function del_so(name)
	local sim = alife()
	local se_obj = sim:object(name)
	if se_obj ~= nil then
		sim:release(se_obj, true)
	end
end



--' уч бар раш1
function del_wlabcut1()
	olr.kill_mon_in_radius(db.actor:position(), 650)
  local se_obj = alife():object("lvl5_bar_stalker_0031")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' уч бар раш2
function del_wlabcut2()
  local se_obj = alife():object("bar_bar_visitors_3_3_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' уч бар раш3
function del_wlabcut3()
  local se_obj = alife():object("bar_bar_visitors_3_3_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' уч бар раш4
function del_wlabcut4()
  local se_obj = alife():object("bar_bar_visitors_3_3")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' уч вар кутсц 1
function del_wlabcut1()
  local se_obj = alife():object("lvl17_warlab_stalker_00002143243242")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' уч вар кутсц 2
function del_wlabcut2()
  local se_obj = alife():object("lvl17_warlab_stalker_02305401")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' ян верт 
function del_vert_pilot_yan_boch()
  local se_obj = alife():object("lvl7_yantar_stalker_0023")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' уч вар кутсц 3
function del_wlabcut3()
  local se_obj = alife():object("lvl16_generators_physic_object_0192")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем плоть мг
function del_dead_plot_mgquws()
  local se_obj = alife():object("lvl11_deadcity_flesh_strong")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function start_to_tarelka()
	db.actor:give_info_portion("spaven_karlics_mars")
end

--' удаляем лампу марс
function del_mars_lamb()
		olr_timers.st_timer("uuuuu", 67, "nick.start_to_tarelka()")
		level.disable_input()
		level.hide_indicators()
		bind_stalker.hide_weapon()
		olr.disable_walk()
		local point = patrol("mmaes_rad_walk")
		local look = patrol("mmaes_rad_look")
		db.actor:set_actor_position(point:point(0))
		local dir = look:point(0):sub(point:point(0))
		db.actor:set_actor_direction(-dir:getH())
        	level.add_pp_effector("black.ppe", 201831, false)
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0005")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0006")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_mars_lights_hanging_lamp_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем гоплита еск
function remove_esc_goplit()
  local se_obj = alife():object("lvl1_escape_stalker_0038_goplit")
  if se_obj then
    alife():release(se_obj, true)
  end
end




--' удаляем рядового
function del_radovoy_dolineaa()
  olr.spawn_on_obj("wpn_lr300", "lvl4_darkdolina_stalker_0015")
  db.actor:change_character_reputation(20)
  news_manager.send_tip(db.actor, "Thank you, brother. We'll catch up in person when we get a chance. In the meantime, I'll tell you something. I know, one of ours, on the cordon in his safe at the checkpoint collects loot from stalkers. If you dare to go there, know that there must be a lot of loot there... And here, take my rifle, as a token of gratitude...", 2, "military", 9000)
  local se_obj = alife():object("lvl4_darkdolina_stalker_0015")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl4_darkdolina_space_restrictor_0006")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем новичка напарника с кордона 
function del_nap_svstart()
  local se_obj = alife():object("lvl1_escape_stalker_0029")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем мертвеца 1
function del_mer_one()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0020")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем мертвеца 2
function del_mer_two()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0018")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем мертвеца 3
function del_mer_tri()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0019")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем дверь журн
function deldoor_jourlalist_note()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0619")
  if se_obj then
    alife():release(se_obj, true)
  end
end



--' удаляем дверь подвал
function del_dver_mg_podval()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0683")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' удаляем rafik_yan
function del_rafik()
  local se_obj = alife():object("lvl7_yantar_m_car_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl7_yantar_physic_object_0055")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl7_yantar_m_car_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl7_yantar_stalker_0007")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем kazm_agro
function kazm_agro()
  local se_obj = alife():object("lvl3_agroprom_physic_object_0092")
  if se_obj then
    alife():release(se_obj, true)
  end
	local sobj = alife():object("lvl3_agroprom_inventory_box") 
	if sobj then 
	local id = sobj.id
  		olr_npc_eqp.convert_online_out(id)
	end
end


function lete_escape_jaba_sms()
	olr.del_by_name("lvl9_military_physic_object_0422")
	olr.del_by_name("lvl9_military_physic_object_0423")
  local se_obj = alife():story_object(1209)
  if se_obj then
    alife():set_switch_offline (se_obj.id, false)
    alife():set_switch_online (se_obj.id, true)
    alife():set_interactive (se_obj.id, true)
  end
end

--' удаляем жабу с кордона и его добро
function delete_escape_jaba()
  	olr_timers.st_timer("lete_escape_jaba_done", 135, "nick.lete_escape_jaba_sms()")
	olr.del_by_name("lvl1_escape_physic_object_0544")

  local se_obj = alife():object("lvl9_military_space_restrictor_0025")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("escape_trader_0000")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lights_hanging_lamp0000_0000")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lights_hanging_lamp0000_0001")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lights_hanging_lamp0000_0002")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0001")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("level_prefix_lights_hanging_lamp_0013")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0058")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0057")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0032")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("esc_jaba_radio")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0091")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0105")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0056")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0219")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0220")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0225")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0090")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0000")
  if se_obj then
    alife():release(se_obj, true)
  end


  local se_obj = alife():object("lvl1_escape_physic_object_0504")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0505")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0506")
  if se_obj then
    alife():release(se_obj, true)
  end

  local se_obj = alife():object("lvl1_escape_physic_object_0507")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0503")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("level_prefix_lights_hanging_lamssesp_0024")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0301")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0314")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0313")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0316")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0309")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0315")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0049")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl1_escape_physic_object_0048")
  if se_obj then
    alife():release(se_obj, true)
  end


	local cnt = 0
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and IsAnomaly(kill) then
			if kill.level_name == "lvl1_escape" then
				alife():release(kill, true) 
			end		
		end
	end
	--log1(cnt)

	olr.del_by_name("lvl1_escape_zone_acid_fog_0006")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0005")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0004")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0003")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0002")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0002")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0001")
	olr.del_by_name("lvl1_escape_zone_acid_fog_0000")


end


--' удаляем алкаша с каморки
function delete_alkash_bar()
  local se_obj = alife():object("lvl5_bar_physic_object_0377")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем алкаша с каморки2
function delete_alkash_bar2()
  local se_obj = alife():object("lvl5_bar_physic_object_0446")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем командора
function delete_escape_wolf()
  local se_obj = alife():object("lvl1_escape_stalker_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end

---------------------------------------------------------------

--' удаляем уч варлаб 1 
function delete_uch_war_1()
  local se_obj = alife():object("lvl17_warlab_stalker_0000")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем уч варлаб 2 
function delete_uch_war_2()
  local se_obj = alife():object("lvl17_warlab_stalker_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем уч варлаб 3 
function delete_uch_war_3()
  local se_obj = alife():object("lvl17_warlab_stalker_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
end

---------------------------------------------------------------

--' удаляем сосааку
function delete_sosakasaas()
  local se_obj = alife():object("sosich")
  if se_obj then
    alife():release(se_obj, true)
  end
end
---------------------------------------------------------------
--' зону слизней
function delete_sliz_zona()
  local se_obj = alife():object("slizni_save")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' cлизня с калашом
function delete_sliz_kalash()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0005")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' придурка 1
function delete_sliz_prid1()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0004")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' придурка 2
function delete_sliz_prid2()
  local se_obj = alife():object("lvl4_darkdolina_stalker")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' придурка 3
function delete_sliz_prid3()
  local se_obj = alife():object("lvl4_darkdolina_stalker_0003")
  if se_obj then
    alife():release(se_obj, true)
  end
end

---------------------------------------------------------------



function actor_set_monolit(actor, npc)
	if db.actor then
		db.actor:set_character_community("monolith", 0, 0)
	end
	relation_registry.set_community_goodwill ("monolith", db.actor:id(), -5000)
	return true
end


function Run_Vibros()

level.set_weather_fx ("surge_day")
level.add_pp_effector ("vibros.ppe", 1974, false)
local snd_obj = xr_sound.get_safe_sound_object([[anomaly\dezodor]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function clear_vibros()
    level.remove_pp_effector(1974)
end




function progulka_prisli_plos_lead12()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Leader\\n It's quiet. Shit. Go to the bar and talk to the Barkeep about what happened. I'm not going with you, I have some things I need to take care of... Go!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function mg_sms_hey_punkass()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Monolith\\n Stalker, get out of here... this is none of your business.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function progulka_prisli_plos_lead11()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Leader\\nMesser! Come on follow me, let's get out of here, hurry up! What the hell is this place!? That thing dragged you down here before I could get here!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function sms_val_garbage_bandits()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n Hey, stalker! Bro, come here, I've got something for you!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function olr_lab_2_door_unlocked_fake_sms1()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n This password expired on 20.02.2012. Please enter a new password.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.kill_mon_in_radius(db.actor:position(), 100)
end

function olr_lab_2_door_unlocked_fake_sms2()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer:\\n Fuck... Fucking Slug...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(5000, 7000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function olr_lab_2_door_unlocked_fake_sms3()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n I don't get it? Uh, bro, you come over here, around the corner.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(7000, 10000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function progulka_prisli_plos_lead10()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Leader\\nMesser! Get out of here, let's go!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function shakal_esc_sms1()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Jackal\\n Messer, turn on your PDA and find me through the Contacts tab. I'll tell you what's what...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function shakal_esc_sms2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message\\n Connection lost.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
news_manager.send_tip(db.actor, "Messer, what's up with the stash? Waiting for you, eagerly...", 5, "trader", 25000)
end



function progulka_prisli_plos_lead9()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Black Slug\\n Fuck! Get the fuck away!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function progulka_prisli_plos_lead8()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Black Slug\\n You! Get your backpack off!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function progulka_prisli_plos_lead7()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Black Slug\\n There's no shit here! Let's get these guys and get the fuck outta here!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function progulka_prisli_plos_lead6()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Black Slug\\n What the hell?! Nail, go check it out. We're holding these ones, don't piss--","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(400, 800),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function progulka_prisli_plos_lead5()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Alright, let's put the guns away, boys. This is just an ID check. You try to run, you're gonna get shot, I'm telling you.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function progulka_prisli_plos_lead4()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Black Slug\\n Freeze! Let's take the bastards down! Don't move! Whoa... who are these guys?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
nick.fix_rostok_slizni_weapons()
local snd_obj = xr_sound.get_safe_sound_object([[weapons\zarya2max]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	level.add_pp_effector("teleport.ppe", 47231, false)
end



function progulka_prisli_plos_lead3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Leader\\nThere's something out there...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function spawen_monolit_na_kordone_komandira_sms()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n Hey, you! Go to the building next to the water tower. We need to talk...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function progulka_prisli_plos_lead2()
	olr_timers.st_timer("del_punks_ros", 5, "nick.del_punks_ros_del()")
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Message: Leader\\n Keep quiet... Everybody check your guns.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.kill_mon_in_radius(db.actor:position(), 200)
	olr.blow_add(245)
	local se_obj = alife():object("lvl6_rostok_level_changer_0000")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the bar")
  	end
	olr.del_by_name("lvl5_bar_physic_object_1465")
	olr.del_by_name("bar_bar_lisiy_0000")
end





function progulka_prisli_plos_lead()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Leader\\nOkay, it seems quiet.. Come stalker, we'll discuss what to do next...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function rush_rostok_tmer_mochii()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message: Group\\n Shit, there's someone out there, everybody be on your guard.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function rush_rostok_tmer_mochii2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Group\\n Everyone group up! Remember, our goal now is to get to the tunnel leading to Rostok.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function maxsms_cool4()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message: Max.\\n Yes, I'm coming to you.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.spawn_on_obj("af_dummy_glassbeads", "lvl6_rostok_stalker_0021")
end


function mg_sms_hey_punkass_hrom()
	olr.kill_mon_in_radius(db.actor:position(), 60)
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Chrom:\\n I think I got a signal. Wait a bit, our guys will give them a warm welcome. If you can, do us a favor and help our guys out. I don't think they'll know who attacked them in the dark.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function mg_sms_hey_punkass_hrom2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming Freedom:\\n Quiet, boys. Let's try to get in quietly...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function sms_esc_doki_band()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message:\\n Bro, come out! Come on down.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function maxsms_cool3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message: Max.\\n This is it! This is what I was talking about!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end





function maxsms_cool2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message: Max.\\n The light is there, my friend, the light is there!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function maxsms_cool()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message: Max.\\n It's working! Let's run to the hall and see what's going on!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.kill_mon_in_radius(db.actor:position(), 45)
end






function noobik_progulka_tri()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message. Sergey, the group is dead... And the main thing is that everyone is dead... in safety... bloodsuckers! Damn it... what to do now... Thanks for coming with me, stalker. I owe you one. If you need me, look for me where I was or at the bar. I need a drink.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function noobik_progulka_two()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message.\\n Damn door.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function sms_mil_vishka_night_go()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message.\\n If you stay in the tower all night, something's bound to happen...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[characters_voice\scenario\military\pda\mil_pda_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function noobik_progulka_one()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message.\\n Damn it. I knew something was wrong here. Okay, let's go to another place...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function zagon_bandosa2()
if has_alife_info("start_zagon_bandosa_talked_good") then
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message.\\n Ah... bastards...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
news_manager.send_tip(db.actor, "Take that bastard... Thanks for your help, stalker. I'll put in a good word for you at the bar...", 5, "default", 25000)
db.actor:change_character_reputation(20)
end
  local sobj = alife():object("lvl2_garbage_stalker_0025")
  if sobj then
  local pk = get_netpk(sobj,1)
  local data = pk:get()
  data.custom_data:setString(
  "[smart_terrains]\n"
  .. "lvl3_agroprom_smart_terrain_0020 = true\n")
  pk:set( data )
  end
end



function zagon_bandosa()
if not has_alife_info("start_zagon_bandosa_dead") then
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message:\\n Sprout: Man, come with us! We got that thug bastard that put seven of our boys down the earth in that house up on the hill, help us smack that bastard! Come here, I'll tell you what's what.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
--local snd_obj = xr_sound.get_safe_sound_object([[ol3\voices\sproot_bandit_quest_01_v2_radio_v1]])
--snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end
end





function lonewolf_gar_smsm()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n Stalker. You've probably heard of the Stalker Bar by now, right? A place in the heart of the Zone, where stalkers gather after returning from distant raids. I can tell you they're interested in you, but they're not waiting for you empty-handed. There's a house in the Dark Valley area, and the Barkeep is very interested in the documents that may be there...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),45000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("lonewolf_gar_smsm2", 15, "nick.lonewolf_gar_smsm2()")
	olr_timers.st_timer("lonewolf_gar_smsm3", 35, "nick.lonewolf_gar_smsm3()")
end


function lonewolf_gar_smsm2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n...This loot will be your pass to the elite club, and you will automatically move into the category of experienced. However, you can't get into the valley for no reason - there is some kind of installation on its territory, which generates maddening psi waves...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),55000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function lonewolf_gar_smsm3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n You need a special blocker. The troopers went on a raid there recently, and it looks like they're all dead. I have information that a couple of soldiers made it out to the dump. I'm sure one of them has an interlock. They were seen at a crossing where a small creek runs off of it.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),65000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end





function dolina_barman_house_doki_voroniy_glas_smsm()
	olr.beep()
  local se_obj = alife():object("lvl2_garbage_staler_undead_olr")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl2_garbage_staler_undead_olr_0002")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl2_garbage_staler_undead_olr_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
news_manager.send_tip(db.actor, "Messer! Don't shoot! I know for a fact you're here. I've got a fix on your comp!", 2, "dolg", 19000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function volk_sasesc()
olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n Stalker, watch out, there's a pseudo-dog!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr_timers.st_timer("yan_yhggan_vsidetector", 30, "nick.volk_sasesc_exec()")
end



function volk_sasesc_exec()
	db.actor:give_info_portion("zam_jab_start_spaven_dog_ubil") 
end



function volk_sasesc_bar()
if bind_car.act_in_car_now() == true then
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n Wait, don't go! Messer!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.beep()
end
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\nHey, Messer! Wait, wait! I followed you from the Garbage, wait!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.beep()
db.actor:set_actor_sleep(-0.5)
olr.del_by_name("lvl2_garbage_stalker_0055")
olr.del_by_name("lvl2_garbage_stalker_0042")

	olr.del_by_name("lvl4_darkdolina_staler_undead_olr_0015")
	olr.del_by_name("lvl4_darkdolina_staler_undead_olr_0014")

	nick.actor_set_stolkir()
end


function volk_sasesc_bar2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Lone Wolf\\n Well, here we are. The pillow's all yours. Make yourself comfortable. I think you should get about seven or eight hours of sleep. The doors are only locked from the inside, and once the door is open, the compartment is considered unoccupied. You can't lock it from the outside, so everyone carries their own stuff. And if anything, you have to be ready to evacuate at a moment's notice. You get some sleep, and then we'll go to the bar, where we can drink, eat, and talk.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("lvl5_bar_physic_object_1351")
	olr.del_by_name("lvl5_bar_physic_object_1354")
	db.actor:set_actor_sleep(-0.2)
end




function volk_sasesc_bar3()
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Lone Wolf\\n You awake? Alright, time to move to the bar...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(6000, 8000),15000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	db.actor.satiety = 1
	db.actor:set_actor_thirst(1)
end




function bad_timer_del_novic_sms()
	olr.beep()
	local sactor = alife():actor()
	local cactor = level.object_by_id(sactor.id)
	cactor:give_game_news("Where's my gun, Messer?! What, are you keeping it for yourself? Well, I'll remember that for you, Messer!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	db.actor:change_character_reputation(-20)
	nick.clear_otmetka_kalash()
end




function bar_dolg_lider_stuka()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Duty Leader\\n Okay, we've dealt with the rat, alright... he was pushing our ammo to the left. Go to our merchant for the reward.","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function bar_dolg_fantasm_go_message()
	olr.beep()
news_manager.send_tip(db.actor, "Messer, come to my base. I think we can talk now without any problems.", nil, "dolg_voronin", 49000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function diggr_blokpost()
	news_manager.send_tip(db.actor, "Digger: Okay, here we go. You can go towards the Garbage, and I'll get changed. Don't worry, I'll catch up.", 2, "default", 9000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function dofhodi_kvestpat()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Messer, come in. So here's the situation: I need to get a piece of equipment. It's called the Toad's Eye. It's located in the Garbage to the north. I sent a group there before last, but they lost contact almost as soon as they got there. One of my defectors said that in the place where they saw the artifact there was no anomalous activity, but they were afraid to go there. So go to the Garbage and get me that artifact. The coordinates of the location are attached.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 1500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	local sobj = alife():object("lvl2_garbage_af_jabiy_glaz_garbage") 
	if sobj then 
	local id = sobj.id
    		alife():set_switch_offline (id, false)
    		alife():set_switch_online (id, true)
    		alife():set_interactive (id, true)
		--log1(" box id"..id.."")
	end
end


function jaba_zavod_doki_escsa()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Yeah, one more thing. That thing you shot stole one of my courier's documents while he was sleeping in the factory. He said it had some kind of lair on the roof. Maybe the creature took them there. Find them and bring them to me, as they have some value. Don't come back without them.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 3500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.del_by_name("lvl1_escape_physic_object_0570")
end


function horok_ne_have_go_nazad()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n I don't get it, is he dead or something? What the hell were you looking at? I sent you to him. Let's go back to my bunker.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 1500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function sms_esc_olr_kvest_3_zametki_bio()
olr.to_online("esc_jaba_radio")
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Oh, I forgot. In your PDA you have the ability to display the contacts of stalkers that are within a radius of about 200 meters from you. With some of them you can talk at a distance. To do this, select the desired stalker in the contacts section. There you can also find out a brief biography of this stalker. Try to reach Digger via PDA when you are near him. I think you'll figure it out...","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 1500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("lvl1_escape_physic_object_0341")
	olr_timers.st_timer("pda_zarad_info_zaba", 3, "nick.pda_zarad_info_zaba()")
end


function pda_zarad_info_zaba()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Yeah, one more thing... Your PDA has a charge, and it discharges over time. Keep an eye on the charge level so you don't end up without a PDA at the right moment...","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 1500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
news_manager.send_tip(db.actor, "Tutorial: To check the charge level of your PDA, press the TAB button in the PDA window.", 10, "default", 39000)
end


function olr_blowout_first_zaba()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n How are you alive?","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 1500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function olr_blowout_first_zaba_blok()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Messer, there's something going on at the checkpoint after the emission. I can't get any signals from there, it's like there's no one there. Listen, why don't you run over there quietly and see what's going on? But if you do, get the hell out of there. Tell me what you see.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 1500),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function bar_dolg_lider_zom3()
nick.rnd_zombies_spawn()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Duty Leader\\n Attention all! We're picking up some strange interference on the air, everybody keep your eyes open.","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

 
function bad_timer_gardolpsevdo()
olr.info("gar_test_info2")
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Duty\\n Caution! There's a pseudo-dog! Somebody kill it! Hurry up! Stalker, take it down!","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function pes_propaganda()
	db.actor:disable_info_portion("gar_test_info2")
	olr.del_by_name("lvl2_garbage_pseudodog_strong_0000")
	olr.del_by_name("lvl1_escape_space_restrictor_0001")
	olr.del_by_name("lvl1_escape_stalker_0055")
	olr.del_by_name("lvl1_escape_stalker_0054")
	olr_timers.st_timer("pes_propaganda", 21, "nick.pes_propaganda222()")
	news_manager.send_tip(db.actor, "Remember, fighters! We are the barrier, and not one creature, not one piece of paper, not one object, must slip through to the outside world. The zone spawned them, and here they will be buried!", nil, "dolg", 29000)
	news_manager.send_tip(db.actor, "Oh, one more thing, Messer. We'll share some information with you. If you get caught at our checkpoint, hide here by the rock next to the fence. The rocks here offer good protection from them. Alright, thank you.", 12, "dolg", 29000)	
end

function pes_propaganda222()
	news_manager.send_tip(db.actor, "Okay... damn, there are rats in the hangars again... They keep coming from the Dark Valley. What are they, breeding them or something? Messer, you can come into the bar, we'll let you through. The bar itself is closed now, but you can come to our base. There might be something for you.", nil, "dolg", 29000)
end

function fraer_yeag_3()
	if math.random(1,30) == 1 then
		news_manager.send_tip(db.actor, "Rock over London Rock over Chicago", nil, "zombied", 29000)
	end
end

function st_pes_go_talk1()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Watchdog\\n Hey, man, come here, let's talk. Just help us deal with the pack first...","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr_timers.st_timer("pes_propaganda", 123, "nick.pes_propaganda()")
end

function st_pes_go_talk2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Watchdog\\n How you feeling, rookie?","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function st_pes_go_talk3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Crow's Eye\\n He's doing great! And he's no rookie either, if you'd seen the way he deftly took down the ringleader...","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function st_pes_go_talk5()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Watchdog\\n Yes... he's no newbie. Come and talk to me.","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function bar_dolg_lider_zom2()
nick.rnd_zombies_spawn()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Duty Leader\\n Chin up, men! Another wave is coming!","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	news_manager.send_tip(db.actor, "Those things. They must be coming from the north. Probably after the rig at the lake stopped working. How come there's so many of them? Messer, give me a machine gun point! We'll cover the rear!", 12, "dolg_voronin", 9000)
end



function bar_dolg_lider_zom1()
nick.rnd_zombies_spawn()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Duty Leader\\n Soldiers, get into position! The dead are coming. Messer, this is your chance to make your mark.","ui\\ui_icons_task",Frect():set(150,0,50,50),math.random(1000, 15000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function monolit_pridi()
news_manager.send_tip(db.actor, "Come to me, stalker. come to me.", nil, "sos", 39000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function jaba_killar_washe()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Attention all! From now on, a stalker named Messer has been declared a murderer. There is a bounty on his head, let him be another example that you can not kill stalker brothers for profit. Or he can pay for his sins himself, if he can get to me.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 15000),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function jaba_killar_pre()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Hey, what are you doing? For one more killing of a neutral stalker you will be declared a murderer and your access to stalkers will be denied. You'll be hunted, so be aware of that.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 15000),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function jaba_ohrene()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Hey, are you out of your mind? These are my guys guarding my bunker!","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 15000),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function komandir_zdohnah()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Messer, what the fuck! Is he dead? Why the hell did I send you down there? Are you still suffering from amnesia? I don't know what I'm gonna tell the troops. Just come back.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(500, 1000),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function infor_glob_rad_palba()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("PDA\\n Attention! Critical radiation contamination! Check suit for leaks or leave the contaminated area immediately!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),20000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function voy_dolineaa()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Messer, the troops are raiding the area you're in. Don't get hurt. An army jeep came out of the cordon a couple hours ago. There were six or seven men with some kind of equipment. You know, when the mess dies down, see what's going on. You can borrow the car from the gentlemen in uniform. You know what I mean. If you find anything, I'll be in touch.","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(1000, 2000),35000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function kolodetz_task_jaba()
	olr.beep()
news_manager.send_tip(db.actor, "Messer, aren't you in the village area right now? A hobo from the Garbage was bringing me a package from the bar, but he disappeared somewhere in the neighborhood. Why don't you go check it out, see what you can find, bring it to me right away. We're out.", nil, "trader", 55000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function coolweather_napaai11()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Partner\\n Fuck... what the fuck was that... ah, that sucks... I'm getting something...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function radovoy_dolineaa_opne()
	olr.del_by_name("lvl4_darkdolina_physic_object_0027_tomb")
	olr.del_by_name("lvl4u_darklab_physic_object_0572")
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message:\\n Great, I think the door's open... Something's walking around upstairs... damn...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function coolweather_napaai22()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n Shit, what the hell is going on?! Are you okay? Can I help you?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function coolweather_napaai33()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n No, don't. Oh. Let's go to that fallen tree. I'll get the first aid kit and then we'll go on our way.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function coolweather_nap4()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n Shit. What was that? We gotta bury the guy.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("gar_zaraza_nap_0001")
	olr.del_by_name("gar_zaraza_nap_0000")
	olr.del_by_name("gar_zaraza_nap")
	olr.del_by_name("lvl2_garbage_stalker_0043")
end



function kostumu_pesda_agr()
if has_alife_info("medpribor_kvest_start_find_friend") then
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n Shit. Shit. Toad, I'm having trouble with my suit, come in.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end
end


function kostumu_pesda_agr2()
if has_alife_info("medpribor_kvest_start_find_friend") then
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Couldn't you have been a little more considerate? Okay, if you're not in the complexes now, where there's no background, run to me, I'll fix it. And if you are, you're in real trouble, stalker. Just something to think about. Heh. You can try on medicine to make a breakthrough, although it is not sure that you will succeed, and then you'll glow like a reactor. Or wait... There on the complexes were working on some experimental aniradiation drugs, I think someone told me that helps such an anti-radiation from the kind of radiation that is on the research institute now. Try to search in the complexes, perhaps there are any remnants of such drugs.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end
end


function coolweather_nap3()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n Hmm. What's that over there? Looks like a dead grabber. We should see if we can find a needle.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function now_final_swapm_naprav_talk_done_docsms()
	olr.beep()
	olr.del_by_name("lvl6_rostok_space_restrictor_0025")
	olr.del_by_name("lvl6_rostok_physic_object_0203")
	olr.del_by_name("lvl6_rostok_physic_object_0200")
	news_manager.send_tip(db.actor, "Stalker, come to my cabin. We need to talk.", nil, "dok", 39000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function coolweather_nap()
olr.blow_add(150)
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n Well, here's the Garbage. Here we go.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
get_console():execute("sv_setweather garbage")
--olr.kill_mon_in_radius(db.actor:position(), 100)
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_monster() and npc:position():distance_to(db.actor:position()) < 100 then
			log1("go offline "..npc:name().."")
			local se_obj = alife():object(npc:id())
  			if se_obj then
    				alife():set_switch_offline (se_obj.id, true)
    				alife():set_switch_online (se_obj.id, false)
    				alife():set_interactive (se_obj.id, false)
				olr_timers.st_timer("convert_online", 370, "olr_npc_eqp.convert_online_out("..npc:id()..")")
  			end
		end
	end
	for k,v in pairs(db.storage) do
		local npc = level.object_by_id(k)
		if npc and npc:is_stalker() and npc:position():distance_to(db.actor:position()) < 100 then
			if npc:character_community() == "monolith" or npc:character_community() == "killer" or npc:character_community() == "bandit" then
				log1("go offline "..npc:name().."")
				local se_obj = alife():object(npc:id())
  				if se_obj then
    						alife():set_switch_offline (se_obj.id, true)
    						alife():set_switch_online (se_obj.id, false)
    						alife():set_interactive (se_obj.id, false)
						olr_timers.st_timer("convert_online", 370, "olr_npc_eqp.convert_online_out("..npc:id()..")")
  				end
			end
		end
	end
end


function coolweather_napaai2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Partner\\n I can't get more--","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
 for i = 1, 20 do
  alife():create("m_crow", db.actor:position():add(db.actor:direction():mul(90)), db.actor:level_vertex_id(), db.actor:game_vertex_id())
 end
end


function coolweather_napaai()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n's partner. Ow! Shit. Ahem. Bastard, what's wrong with me?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function coolweather_napaaim()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Messer\\n Hey! You okay? What is this?","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function prof_boloto_spawn_bandosov_smss5()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n Oh, I think you've succeeded. Stop by our bunker on Yantar, and don't forget your emulator hat. We have some information for you.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function rnd_zombies_spawn()
for id=1, math.random(4,8) do

local sectionsa = { 
"m_zombie_e",
"zombie_normal",
"zombie_strong",
"zombie_blue",
"zombie_plague"
}

local section = sectionsa[math.random(table.getn(sectionsa))] 
alife():create(section, db.actor:position():add(db.actor:direction():mul(-19)), db.actor:level_vertex_id(), db.actor:game_vertex_id())

end
end

function prof_boloto_spawn_bandosov_smss4()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n There seems to be some kind of signal, some kind of interference. Be careful.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
level.add_pp_effector("vibros_p.ppe", 231, false)
nick.rnd_zombies_spawn()
for id=1, 21 do
	olr_rnd_sounds.play_rnd_snd()
	local tmr = math.random(10,50)
	olr_timers.st_timer("rndppe", tmr, "nick.rnd_ppe_eff()")
	olr_timers.st_timer("rndppesnd", tmr, "olr_rnd_sounds.play_rnd_snd()")
end
end


function rnd_ppe_eff()
	local ppe = {
        "alcohol.ppe", "controller_hit.ppe", "fire_hit.ppe",
	"psy_antenna.ppe", "psy_antenna_indoor.ppe", "radar_psi.ppe", "radar_stop.ppe", "radar_wake.ppe",
	"radiation.ppe", "teleport.ppe", "vibros.ppe", "blink.ppe", "dead_zone.ppe"
	}

	local col = math.random(1,10)
	for i=1,col do
		level.add_pp_effector(ppe[math.random(#ppe)], 2001, false)
	end
end


function prof_heliequp_spawn_bandosov_smss()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n Stalker, finish them off, but do it discreetly, leave no witnesses and don't let yourself be detected. Once you've dealt with them, leave the village at once, you shouldn't be seen in that neighborhood...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.kill_mon_in_radius(db.actor:position(), 120)
end


function killlll_plot_mg_sms3()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n Messer! Is the flesh dead? Damn we don't have much time... come back.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(5000, 7000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function killlll_plot_mg_sms4()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n Messer, you may approach our bunker.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(5000, 7000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function yan_zamery_ucheny_zdoh_proff()
	olr.beep()
if not has_alife_info("yan_talk_done_zamery") then
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n What's the matter? Is he dead!? What the hell, Messer, you're supposed to be protecting him! Well, get back here.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end
end



function prof_heliequp_sms_krisabun()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n Alright, get up to the roof of the bunker.","ui\\ui_icons_task",Frect():set(450,150,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function prof_heliequp_sms_pilot2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Pilot\\n Shit, he's got an RPG! Stalker, take him down! He's hiding in the ruined building, hurry!","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),25000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function prof_heliequp_sms_pilot()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Pilot\\n I'm seeing suspicious activity in the area. I think it's the local gangs. Stalker, the professor told us he sent you to cover us. Deal with them. They're running from a ruined building with no roof.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),25000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function prof_heliequp_smsone()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Professor\\n Alright, watch the road from Bar. After the helicopter crosses paths with you, head towards the bunker...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.kill_mon_in_radius(db.actor:position(), 100)
end


function yan_zamery_ucheny_gohome_proff()
	local wait_time = 0
  	wait_time = time_global() + 30000
  	level.add_call(
    	function() return time_global() > wait_time end,
    	function() level.add_pp_effector("psychic.ppe", 20131, false) end
  	)
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Junior Assistant\\n Okay, I think that's it. We're making a final push around the complex to the base. Check your gun and cover me in case of emergency.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function zov_monolita_pda()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("PDA\\n New contact.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[characters_voice\scenario\sarcofag\o_soznanie_call]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function zov_kontakta_pda()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("PDA\\n New contact - access error.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function zov_osvedom_case_pda()
	olr.beep()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n Over. Got the password to your briefcase. Get here as soon as you can, don't forget the case. And 200 bucks for the job.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function zov_dveri_pda()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n Automatic sealing system activated.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function zaba_ab_note()
	olr.beep()
olr_timers.st_timer("jaba_ab_radweak", 165, "nick.jaba_ab_radweak()")
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Toad\\n Yes, and one more thing... You have a special note pad in your PDA for notes. You can write your notes there if you find something interesting!","ui\\ui_iconsTotal",Frect():set(332,950,50,50),math.random(2000, 5000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function jaba_ab_radweak()
	olr.beep()
	olr.info("tutor_radiat_jornl")
	news_manager.send_tip(db.actor, "One more piece of information for you... There's radiation everywhere you look. So, I'm sending you a little information about it and what to expect from it to your PDA. Make sure you read it, or you won't be able to survive any longer. I'm sure you will.", nil, "trader", 95000)
end


function barm_sms_prcpntr()

olr.del_by_name("psy_izl_0000")
olr.del_by_name("psy_izl_0001")
olr.del_by_name("psy_izl")
olr.del_by_name("psy_izl_0003_script")

news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Toad:".."\\n".."%c[255,245,118,54]Stalker, there is a large amount of psi radiation activity in the city that is blocking passage to the power plant. I've spotted a large group of controllers somewhere in the center of the city, possibly preventing passage. I recommend using the Dead Head artifact, and more than one, in that area.".."".."\n", nil, "trader", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
if has_alife_info("bun_mosk_start_quest_go_done") then
	olr_timers.st_timer("del_bun_to_mosk", 25, "nick.rad_bun_to_mosk_prip()")
end
end


function njvis_oka_sch()
	olr.beep()
local sobj = alife():object("lvl1_escape_physic_object_0193") 
if sobj then 
olr.add_spot_on_map(sobj.id,"crlc_big","Unknown Stalker") 
end
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Zob:\\n Stalker, come here, I've got something for you. I'm here, by the mountainside.","ui\\ui_icons_task",Frect():set(350,50,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function oobrataan()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Zyablikov:".."\\n".."%c[255,245,118,54]Thanks for your help... I need to be alone...".."".."\n", nil, "default", 30000)
	olr_timers.st_timer("oobrataan_thk_start", 1330, "nick.oobrataan_thk_start()")
end


function oobrataan_thk_start()
	if has_alife_info("yan_zablik_dead") then
		return
	end
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Zyablikov:".."\\n".."%c[255,245,118,54]Thanks again for your help... I've decided to leave the zone, I have nothing more to do here... Leave before it takes me away too... I'll give you a tip on my stash, I don't need it anyway. Goodbye.".."".."\n", nil, "default", 30000)
	olr.del_by_name("lvl7_yantar_bar_bar_visitors_3_2_0002")
	db.actor:change_character_reputation(20)
	olr_treasure.create_treasure()
end



function potkluchil_mg_izl()
	olr.spawn_on_obj("zombie_normal", "lvl11_deadcity_space_restrictor_0009")
	olr.spawn_on_obj("zombie_normal", "lvl11_deadcity_space_restrictor_0009")
	olr.spawn_on_obj("zombie_normal", "lvl11_deadcity_space_restrictor_0009")
	olr.spawn_on_obj("zombie_normal", "lvl11_deadcity_space_restrictor_0009")
	olr.spawn_on_obj("chimera_weak", "lvl11_deadcity_space_restrictor_0009")
	olr.spawn_on_obj("chimera_strong", "lvl11_deadcity_space_restrictor_0009")
	olr.spawn_on_obj("zombie_blue", "lvl11_deadcity_space_restrictor_0008")
	olr.spawn_on_obj("zombie_blue", "lvl11_deadcity_space_restrictor_0008")
	olr.spawn_on_obj("zombie_blue", "lvl11_deadcity_space_restrictor_0008")
	olr.spawn_on_obj("zombie_blue", "lvl11_deadcity_space_restrictor_0008")
	olr.spawn_on_obj("chimera_midl", "lvl11_deadcity_space_restrictor_0008")

	olr.spawn_on_obj("m_fracture_e", "lvl11_deadcity_space_restrictor_0008")
	olr.spawn_on_obj("fracture_midle", "lvl11_deadcity_space_restrictor_0008")

olr_timers.st_timer("yahfg", 330, "nick.mg_lead_about_mon_start()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Leader:".."\\n".."%c[255,245,118,54]Whoa! I think the radiation's gone! Well done, stalker... Shit, I think we got company!".."".."\n", 4, "freedom", 30000)
  local se_obj = alife():object("lvl7_dcccdewry_m_car_0001")
  if se_obj then
    alife():release(se_obj, true)
  end
  local se_obj = alife():object("lvl_rat_psy_to_new_dead")
  if se_obj then
    alife():release(se_obj, true)
  end
end



function killlll_plot_mg_sms1()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Sniper:".."\\n".."%c[255,245,118,54]Damn flesh, we don't need them around here! Go to hell, piggy.".."".."\n", nil, "freedom", 30000)
end




function freedom_podriv_bazar_1()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Bomb Squad:".."\\n".."%c[255,245,118,54]Oh, hey, bro! Come on, let's go. Let's not stay here too long.".."".."\n", nil, "freedom", 30000)
olr.blow_add(500)
end


function freedom_podriv_bazar_2()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Bomb Squad:".."\\n".."%c[255,245,118,54]Here we go. Which door is it? Oh, it's this one. Bro, you might want to stand back, there's explosives in here.".."".."\n", nil, "freedom", 30000)
end

function freedom_podriv_bazar_3()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Bomb Squad:".."\\n".."%c[255,245,118,54]Get to cover, it's gonna blow!".."".."\n", nil, "freedom", 30000)
end


function freedom_podriv_bazar_4()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Bomb Squad:".."\\n".."%c[255,245,118,54]So... How are you doing? Let's go see what's going on.".."".."\n", 5, "freedom", 30000)
end


function freedom_podriv_bazar_5()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Freedom Bomb Squad:".."\\n".."%c[255,245,118,54]Ha! Looks like they're having a good time. Dude, look at this. Huh, what a picture. I'm gonna head back to the base. It's a little bit of a buzz. You figure out what you want.".."".."\n", nil, "freedom", 30000)
end




function a_cod_dvery_ros()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Hmm.\\n I remember some code. 3781... I think some tunnels...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function prisad_nahui()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Messer:".."\\n".."%c[255,245,118,54]Hold on, buddy. Stand here by the entrance.".."".."\n", nil, "default", 10000)
olr.del_by_name("lvl8_swamp_physic_object_0040")
olr.del_by_name("lvl8_swamp_pseudodog_friend")
end



function gr_lid_haha()
if has_alife_info("greh_leader_key_taken_docs_vetri") then
return
end
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Sin Leader:".."\\n".."%c[255,245,118,54]If you sin, you sin for real...".."".."\n", nil, "sos", 20000)
end



function car_barmen_bardachok()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Messer:".."\\n".."%c[255,245,118,54]Hmm... what's this? Looks like some kind of journal.".."".."\n", nil, "default", 20000)
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Item received:".."\\n".."%c[255,245,118,54]Travel log.".."".."\n", nil, "default", 10000)
alife():create('bar_barman_kamaz_doki', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
end


function zomb_zametka_lab()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Messer:".."\\n".."%c[255,160,160,160,160]Hm... That's weird. My photo. And a kill order.".."".."\n", nil, "default", 10000)
end



function zomb_zametka_agro()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Messer:".."\\n".."%c[255,160,160,160,160]Hmm. That's weird. There's a picture of me! And a kill order. Looks like someone has a grudge against me.".."".."\n", nil, "default", 10000)
end




function daaaa_vot()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,245,118,54]Yes! That's it!".."".."\n", nil, "default", 20000)
olr.spawn_on_obj("wpn_igla", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_gauss", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_gauss", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_gauss", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_og-7b", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
olr.spawn_on_obj("ammo_vog-25p", "lvl5_bar_space_restrictor_0046")
end



function basement_seryy_dee_dee_dee()
news_manager.send_tip(db.actor, "%c[255,245,118,54]".."Witcher:".."\\n".."%c[255,245,118,54]It's here. Enter the code - 9783.".."".."\n", nil, "default", 20000)
end

 

function basement_seryy_dee_dee()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,245,118,54]Mm. No, not here. Well, then somewhere else, obviously not here... Let's go.".."".."\n", nil, "default", 20000)
end


function basement_seryy_dee()
	olr.beep()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Messer:".."\\n".."%c[255,245,118,54]Witcher over. Looks like your man is dead...".."".."\n", nil, "default", 30000)
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,245,118,54]Shit... Alright, come back, there's one clue.".."".."\n", 8, "default", 30000)
olr_timers.st_timer("rost_alarm_korps", 22, "nick.rost_alarm_korps()")
end

function rost_alarm_korps()
	local snd_obj = xr_sound.get_safe_sound_object([[ol3\gener_last_knopka]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function ohran_zdoher()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Professor:".."\\n".."%c[255,245,118,54]What about the guard? Damn it... We'll have to hire a new one.".."".."\n", nil, "saharov", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function dol_sms_two_mertv()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Military Pilot:".."\\n".."%c[255,245,118,54]Eight, do you copy? Beginning landing. The professor told me about this neighborhood.".."".."\n", nil, "heli", 10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\contact_1]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	nick.set_mertvecy_enemys()
end


function dol_sms_one_mertv()
olr.spawn_on_obj("wpn_knife_old_rotten", "lvl4_darkdolina_zombie_strong")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Dead man:".."\\n".."%c[255,245,118,54]Well, well, well, who do we have here? Come on over here, slowly.".."".."\n", nil, "unknown", 10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\contact_1]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function car_olr()
--local sactor = alife():actor()
--local cactor = level.object_by_id(sactor.id)
--cactor:give_game_news("Транспорт:\\nЗавести - K. Управление: WASD. Переключение передач - LCtrl,LShift. Ручной тормоз - Space. Фары - L. Дверь - T. Багажник - F. ","ui\\ui_iconsTotal",Frect():set(486,431,50,50),math.random(1000, 3000),15000)
--local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
--snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function flacke()
olr_timers.st_timer("flacke", 6, "nick.flacke2_mons()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Wolfram:".."\\n".."%c[255,160,160,160,160]Hey, stalker! Hurry up and join us, we're on the second floor of the complex.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function flacke2_mons()
olr_timers.st_timer("flacke3", 6, "nick.flacke3_mons()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Wolfram, the sensors are malfunctioning, or am I misreading something... it looks like a large pack of beasts is approaching the complex...".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function flacke3_mons()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Tungsten:".."\\n".."%c[255,160,160,160,160]Roger... Team, be on the lookout.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end




function turn_arena_lamps_off_yan_tip()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Bunker lighting system:".."\\n".."%c[255,160,160,160,160]Power is off.".."".."\n", nil, "default", 10000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function basement_seryy()
	olr.beep()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,245,118,54]Messer, come to my place, I have something to do.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\contact_1]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function messer_fonar_sms()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Message\\n Yeah, I think that's him...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function messer_fonar_sms2()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n Dwarf: I want to ask you about...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(3000, 6000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end



function barmen_abyantar_pre_blow_psy()
	olr.beep()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Toad:".."\\n".."%c[255,160,160,160,160]Stalker! Are you in the lake area? I suggest you look for some kind of shelter. When the blowout begins, those antennas that are there begin to work in amplified mode. I suggest you hurry if you want to live.".."".."\n", nil, "trader", 90000)
end


function barman_group_sms()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Barkeep:".."\\n".."%c[255,160,160,160,160]What's with the band? Shit. Messer.".."".."\n", nil, "barman", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\geiger_8]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function bar_kill_actor_agerss()
	olr.kill_actor()
	local snd_obj = xr_sound.get_safe_sound_object([[weapons\t_svd_shot]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	news_manager.send_tip(db.actor, "You've got yourself a little bit of a bummer.", 2, "dolg", 5000)
end

function edel_arrabar_territory_palba()
	if not has_alife_info("bun_antenna_off") then
		olr_timers.st_timer("garbage_timer_bigrat_done", 5, "nick.bar_kill_actor_agerss()")
		news_manager.send_tip(db.actor, "Barkeep: What the hell?! What's all this shooting on the bar premises?".."\n", nil, "barman", 30000)
		local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\geiger_8]])
		snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	end
end

function dolg_arrabar_territory_palba()
if ( xr_conditions.actor_in_zone(nil,nil,{"bar_bunker_online_restrictor"})) then
	olr.beep()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Duty:".."\\n".."%c[255,160,160,160,160]Hold your fire! Now!".."".."\n", nil, "dolg", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\geiger_8]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end
end


function proffes_aftrbrain_sms()
	olr.beep()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Professor:".."\\n".."%c[255,160,160,160,160]Come to our bunker, we'll thank you for what you've done. Yeah, I don't recommend going to the Swamp, because the residual psi field will kill you in no time. We'll have to wait a couple more days.".."".."\n", nil, "saharov", 60000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function spawn_jourlalist_note()
local pos = vector():set(-93,1,100)
olr.kill_mon_in_radius(pos, 80)
	olr.beep()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Journalist:".."\\n".."%c[255,160,160,160,160]It's not too safe here, so I've moved to an apartment building nearby, where I'm watching you. Come and talk to me...".."".."\n", nil, "default", 30000)
end


function seiy_2_sms()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,160,160,160,160]Die bitch!".."".."\n", nil, "default", 30000)
olr_timers.st_timer("deadlamp_sosach_tmr", 2915, "nick.del_bomj_and_sosach_vedmak()")
end

function seiy_1_sms()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Witcher:".."\\n".."%c[255,160,160,160,160]Oba-na... Did you hear that? Next door!".."".."\n", nil, "default", 30000)
end


function radar_ant_off_sms()

olr.del_by_name("lvl5_bar_space_restrictor_0116")
olr.del_by_name("lvl5_bar_physic_object_1378")



olr.del_by_name("lvl5_bar_physic_object_1382")
olr.del_by_name("lvl5_bar_physic_object_1349")
olr.del_by_name("lvl5_bar_physic_object_0446")
olr.del_by_name("lvl5_bar_physic_object_1350")
olr.del_by_name("lvl5_bar_physic_object_1348")
olr.del_by_name("lvl5_bar_physic_object_1380")
olr.del_by_name("lvl5_bar_physic_object_0376")
olr.del_by_name("lvl5_bar_physic_object_1382")
olr.del_by_name("lvl5_bar_physic_object_1381")


local se_obj = alife():object("lvl5_bar_physic_object_1123")
if se_obj then
alife():release(se_obj, true)
end

local snd_obj = xr_sound.get_safe_sound_object([[ol3\new_amb\explode_large_away_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1)

--local sactor = alife():actor()
--local cactor = level.object_by_id(sactor.id)
--cactor:give_game_news("Бармен\\nГоворит Бармен! Приборы не фиксируют излучения с севера, дорога на Припять открыта. Мессер, если ты будешь ещё у нас, знай, что мы ценим то, что ты сделал... Зайди, если сможешь...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
--local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
--snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)

local se_obj = alife():object("lvl5_bar_space_restrictor_0089")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_space_restrictor_0090")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_m_car_0004")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_bar_guard_2")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0010")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_barman")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1109")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1111")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1110")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_bar_guard")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_radio")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_stalker_0038")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0032_exit")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1067")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_0008")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_lights_hanging_lamp")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0041")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_tv_01")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1065")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_ventilyator_01")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1064")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("bar_prefix_lights_hanging_lamp_0040")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_0087")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_0393")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1086")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_1416")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_0519")
if se_obj then
alife():release(se_obj, true)
end
local se_obj = alife():object("lvl5_bar_physic_object_0520")
if se_obj then
alife():release(se_obj, true)
end
end


function kol()
	olr.beep()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Unknown Stalker:".."\\n".."%c[255,160,160,160,160,160]Stalker, come see me in the school building, we need to talk. Cobalt.".."".."\n", nil, "default", 30000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\geiger_8]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.del_by_name("lvl5_bar_physic_object_1411")
	olr.del_by_name("lvl5_bar_physic_object_0011")
	olr.del_by_name("lvl5_bar_physic_object_0308")
	olr.del_by_name("lvl5_bar_stalker_0025")
	if has_alife_info("olr_traders_night") then
		news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Cobalt:".."\\n".."%c[255,160,160,160,160,160]Come only better in the daytime, it's nighttime, not really a good time to talk.".."".."\n", nil, "default", 30000)	
	end
end

function tele3()
olr_timers.st_timer("ombied_punk_tele3", 10, "nick.selfdestruck_lab_start()")
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Message:".."\\n".."%c[255,160,160,160,160]Attention all! The power supply of the object's defense has been deactivated! Personnel urgently leave the facility. To the management of the object to apply the program B-175 in action.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\medik_2]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end

function tele2()
	olr.beep()
olr_timers.st_timer("dok_zaidi_jurn_propal", 35, "nick.dok_zaidi_jurn_propal()")
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Incoming message Tikhonov:\\n Messer, are you alive? There's a hell of a lot going on here... This is a mobile science team in the swamps. Come and join us, we have a topic of conversation for you...","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),5000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr.info("tihonov_zaidi_jurn_propal_st") 
end


function dok_zaidi_jurn_propal()
	olr.beep()
	news_manager.send_tip(db.actor, "Doctor: Strelok! Alive?! Bloody hell. I've been thinking. come to my cabin. It's about the Journalist...", nil, "dok", 99000)
	olr.info("dok_zaidi_jurn_propal_st") 
end


function tele()
	local bobj = alife():object("lvl1_escape_big_safe_box_0000")
	local bobj2 = alife():object("lvl1_escape_big_safe_box")
	local bobj3 = alife():object("lvl5_bar_inventory_box")
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and bobj and bobj2 and bobj3 then
                if kill.parent_id == bobj.id or kill.parent_id == bobj2.id or kill.parent_id == bobj3.id then
			local rnd = math.random(1,2)
			if rnd == 1 then
				alife():release(kill, true) 
			end  
		end
	end
	end
	local jaba_place = alife():object("lvl1_escape_stalker_0023")
	if jaba_place then
		alife():create("novice_outfit", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("detector_simple", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("battery_change", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
		alife():create("conserva", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
	end
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."...".."\\n".."%c[255,160,160,160,160]I know exactly what I want...".."".."\n", nil, "act", 20000)
	olr.del_by_name("lvl1_escape_karlik")
	olr.del_by_name("lvl1_escape_stalker_0024")
	olr.del_by_name("lvl1_escape_stalker_0001")
	olr.del_by_name("lvl1_escape_flesh_weak")
	local sim = alife()
	for id=1, 65534 do
		local kill = sim:object(id)
		if kill and not olr_protected.is_no_offline_alife_obj(kill:name()) then
                if IsStalker(kill) and not kill:alive() then
			if kill:name() ~= "lvl1_escape_stalker_0023" or kill:name() ~= "lvl16_generators_stalker_0035" then 
			if kill.level_name == "lvl1_escape" or kill.level_name == "lvl2_garbage" or kill.level_name == "lvl5_bar" or kill.level_name == "lvl7_yantar" or kill.level_name == "lvl11_deadcity" then 
			alife():release(kill, true)   
			--log1("delllll")         
			end
			end
			end
		end
	end
end



function varlab_1()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Hmm..:".."\\n".."%c[255,160,160,160,160]Looks like an emergency exit from the lab.".."".."\n", nil, "default", 30000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\medik_1]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
end


function radar_door()
	olr.beep()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."PDA:".."\\n".."%c[255,160,160,160,160]New contact detected.".."".."\n", nil, "default", 40000)
	local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_tip]])
	snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("spawen_phantoms", 15, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 35, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 65, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 95, "olr.spawen_phantoms()")
	olr_timers.st_timer("spawen_phantoms", 115, "olr.spawen_phantoms()")
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("m_poltergeist_normal_tele", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	olr.spawn_on_obj("chimera_weak", "lvl12_radar_bunker_zone_radioactive_killing_0003")
	nick.rnd_zombies_spawn()
end


function jurnl()
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("Reporter\\n I'll be in Freedom territory, find me in one of the houses on the outskirts of town.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(1000, 3000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
	olr_timers.st_timer("chaes_add_spawn_doki_seven", 5, "nick.chaes_add_spawn_doki_seven()")
	olr_timers.st_timer("chaes_add_spawn_doki_seven", 25, "nick.chaes_add_spawn_doki_seven()")
	olr_timers.st_timer("chaes_add_spawn_doki_seven", 35, "nick.chaes_add_spawn_doki_seven()")
end



function chaes_add_spawn_doki_seven()
local sectionsa = 
{ 
"karlito",
"m_bloodsucker_e",
"bloodsucker_proto",
"m_zombie_e",
"zombie_blue",
"m_gigant_e",  
"m_burer_green"
}


local count = 30
for ind = 1, count do

	local lname = level.name()

	local lvtab = GetLevelVertexes( lname )
	local lvx = math.max(unpack(lvtab))
	local lv  = math.random(1,lvx)

	local gvtab  = GetGameVertexes(lname)
	local gv_min = math.min( unpack(gvtab))
	local gv_max = math.max( unpack(gvtab))

	local section = sectionsa[math.random(table.getn(sectionsa))] 
	local obj = alife():create(section, level.vertex_position(lv), lv, gv_max)
	if obj and obj.position:distance_to_xz(db.actor:position()) < 50 then    --- ваяки
		alife():release(obj, true) 
	end

end
end




function spasipo_freed()
  local se_obj = alife():object("lvl11_deadcity_physic_object_0736")
  if se_obj then
    alife():release(se_obj, true)
  end
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Patrol:".."\\n".."%c[255,160,160,160,160]Thanks buddy! I don't know what we'd do without you!".."".."\n", nil, "freedom", 20000)
end


function slizen()
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Audio message: Unknown stalker".."\\n".."%c[255,160,160,160,160]Hey, hey, bro! Come over here. This is our territory. We need to talk.".."".."\n", nil, "unknown", 40000)
local snd_obj = xr_sound.get_safe_sound_object([[olr\slizen\sms]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr.del_by_name("lvl5_bar_staler_undead_olr_0012")
	olr_timers.st_timer("dolg_pro_slizeny", 19, "olr.dolg_pro_slizeny()")
end

function dolg_pro_slizeny()
	news_manager.send_tip(db.actor, "Stalker, come in. This is Duty's base in Bar. We've received a signal from one of the Dark Valley bandit groups. They're looters and killers who had the nerve to attack one of our squads. Be on the lookout for them, and know that if you get a chance to put these bastards down, I'd appreciate it. But that's up to you... out.", nil, "dolg_voronin", 39000)
end

function poeh()
level.add_pp_effector("duality_circle.ppe", 207131, false)
local sactor = alife():actor()
local cactor = level.object_by_id(sactor.id)
cactor:give_game_news("\\n Messer, I'm waiting for you at my place... Come and talk to me.","ui\\ui_iconsTotal",Frect():set(486,486,50,50),math.random(5000, 13000),15000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr_timers.st_timer("blowout_additional_timer4", 13, "olr_blowout.blowout_additional_timer5()")
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Docent:".."\\n".."%c[255,160,160,160,160,160]Messer, come in, we have a conversation.".."".."\n", 20, "ecolog", 40000)
end


function zaba_zovet()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Toad:".."\\n".."%c[255,160,160,160,160,160]Come to me, we need to talk!".."".."\n", nil, "trader", 40000)
end

function zaba_sobaki_angar()
	olr.beep()
	news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Toad:".."\\n".."%c[255,160,160,160,160,160]Yes, also... Stalkers reported that in that area is a large concentration of blind dogs... Try to find out what the reason is for their presence there in such large numbers... Stalkers avoid this pack, no one has decided to destroy them yet. ".."".."\n", nil, "trader", 30000)
end

function zaba_art_garb()
	olr.beep()
olr_timers.st_timer("zaba_sobaki_angar", 15, "nick.zaba_sobaki_angar()")
olr_timers.st_timer("sms_about_angar_art", 1500, "nick.angar_art_jaba()")
local jaba_place = alife():object("lvl2_garbage_stalker_0012")
if jaba_place then
local sobj = alife():create("kanistra_benz", jaba_place.position, jaba_place.m_level_vertex_id, jaba_place.m_game_vertex_id)
end
news_manager.send_tip(db.actor, "%c[255,160,160,160]".."Toad:".."\\n".."%c[255,160,160,160,160]Messer, one specific artifact was seen in the hangar in the destroyed warehouses... Get it for me, I won't hurt you with money...".."".."\n", nil, "trader", 40000)
local snd_obj = xr_sound.get_safe_sound_object([[olr_pda\pda_objective]])
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)
olr_timers.st_timer("zaba_gar_rat_go", 95, "nick.zaba_gar_rat_go()")
olr.to_online("lvl2_garbage_af_compas")
end


--  варлаб экран ------------------------------------


function zaba_gar_rat_go()
	olr.beep()
	local se_obj = alife():object("lvl_rat_level_changer_0002")
  	if se_obj then
    		olr.add_spot_on_map( se_obj.id,"level_changer","To the Garbage")
  	end
	local sobj = alife():object("lvl2_garbage_physic_object_0042") 
	if sobj then  
		olr.add_spot_on_map( sobj.id,"level_changer", "To the catacombs." )
	end
	olr.info("zaba_gar_rat_go_now")
	news_manager.send_tip(db.actor, "check_gar_rat_cache", nil, "trader", 40000)
end




-- даём бабло 
function money_give (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 700, "in") 
end

-- даём бабло 2
function money_give2 (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 500, "in") 
end

-- даём бабло 2
function money_give_pisot_kamaz (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 75, "in") 
end

function money_give_pisot (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 500, "in") 
end

function money_give_trista (first_speaker, second_speaker) 
 dialogs.relocate_money(first_speaker, 300, "in") 
end

-- открываем хату за квест на сосыча 
function hata ()
 	db.actor:give_info_portion ("door_forse")
	olr.del_by_name("rostok_physic_object_0012")
	olr.del_by_name("lvl6_rostok_physic_object_0081")
	olr.del_by_name("lvl6_rostok_physic_object_0068")
	olr.del_by_name("lvl6_rostok_physic_object_0070")
	olr.del_by_name("lvl6_rostok_physic_object_0078")
	olr.del_by_name("lvl6_rostok_physic_object_0069")
	olr.del_by_name("lvl6_rostok_physic_object_0080")
	olr.del_by_name("lvl6_rostok_physic_object_0079")
	olr.del_by_name("lvl6_rostok_physic_object_0077")
	olr.del_by_name("lvl6_rostok_physic_object_0074")
	olr.del_by_name("lvl6_rostok_physic_object_0066")
	olr.del_by_name("lvl6_rostok_bloodsucker_strong_0003")
	olr.to_online("lvl5_bar_physic_object_1466")
end

-- квесты кордона ------------------------------------





-- имеет бабло 30к

function have_money_30000(actor,npc)
    return actor:money() >= 30000
end





--
function main_g ()
         db.actor:give_info_portion ("radar_de_done")
end


-- изымание 

function give_money_30000(actor, npc)    
    dialogs.relocate_money(actor, 30000, "out")
end



-- отдай (работает, но вещь остаётся в инвентаре)
function esc_pda_done(first_speaker, second_speaker)
dialogs.relocate_item_section(first_speaker, "wpn_pm", "out")
end

-- пистол отдай (работает, но вещь остаётся в инвентаре)
function otday_pist (npc, actor)
 dialogs.relocate_item_section(npc, "wpn_pm", "out")
end

-- 
function have_a_pist (stalker, player)
 return stalker:object ("wpn_pm") ~= nil
end


function chemodan_have(first_speaker, second_speaker)
      return first_speaker:object("chemodan") ~= nil
end


function heal_actor()
  db.actor.health = 1;
end


function have_af_baloon_1 ()
 return have_item_namber ("wpn_pm",1) ~= false
 end


-- скрипт для наличия итема

function delete_some_somth(section, count)
    news_manager.relocate_item(db.actor, "out", section, count)
    db.actor:iterate_inventory(
        function(dummy, item)
            if (count > 0) and (item:section() == section) then
                alife():release(alife():object(item:id()))
                count = count - 1
            end
        end,
    db.actor)
end




function have_item_namber(itm,need_namber)
local actor=db.actor
items_count=0
itemin=itm
actor:iterate_inventory(cheking_item,actor)
    if items_count>=need_namber then
        return true
    else
        return false
    end
end










